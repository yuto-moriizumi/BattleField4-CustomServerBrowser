/*

  Generated by ESN Planet
  www.esn.me

*/

(function ($, window, undefined) {

    profile.on("tabloaded.assignments", function (e, contextData) {

        var missions = contextData.allMissions;  // todo: make it handle all game extensions
        var suggestionTypeId = contextData.suggestionType;

        $("#assignments-statistics")
            .on("click.page", ".assignments-list li:not(.dependency-icon)", function(e){
                var $this = $(this),
                    code = $this.data("mission-code");

                selectAssignment(code);
                profile.deepNavigate(code);
            })
            .on("click.page", ".assignments-list li.dependency-icon.clickable", function(e){
                e.stopPropagation();
                var $this = $(this),
                    code = $this.data("code");
                selectAssignment(code, true);
                profile.deepNavigate(code);
            })
            .on("click.page", ".track-assignment:not(.disabled)", function(e){
                var $bn = $(this);
                var missionCode = $bn.attr("data-mission-code");
                var assignment = missions[missionCode];
                profile.trackItem({
                    bn: $bn,
                    game: contextData.gameInt,
                    platform: contextData.platformInt,
                    suggestionTypeId: suggestionTypeId,
                    type: "award_mission",
                    imageConfig: assignment.award.imageConfig,
                    nameSID: assignment.award.stringID,
                    itemId: missionCode,
                    suggestions: contextData.suggestions,
                    onSuccess: function(response){
                        // If the replaced suggestion exists on the current page, remove its icon.
                         var suggestion = response.data,
                             replacedSuggestion = contextData.suggestions[suggestion.index-1];
                        if (replacedSuggestion && replacedSuggestion.type == suggestionTypeId){
                            $("li[data-mission-code='"+ replacedSuggestion.guid +"'] .track-icon").remove();
                        }

                        // Update current suggestions
                        contextData.suggestions[suggestion.index-1] = suggestion;

                        // Add track icon to list elem
                        $("li[data-mission-code='"+ missionCode +"']").append(
                            $("<i></i>").addClass("track-icon icon").attr("data-tooltip", "プレイヤーがトラッキング中")
                        );
                    }
                });
            })

            // Untrack assignment
            .on("click.page", ".untrack-assignment:not(.disabled)", function(e){
                var $bn = $(this);
                var missionCode = $bn.attr("data-mission-code");
                for (var i = 0; i < contextData.suggestions.length; i++) {
                    var suggestion = contextData.suggestions[i];
                    if (missionCode == suggestion.guid && suggestionTypeId == suggestion.type) {
                        profile.untrackItem({
                            bn: $bn,
                            game: contextData.gameInt,
                            platform: contextData.platformInt,
                            atIndex: i + 1,
                            isTrackedManually: suggestion.isTrackedManually,
                            onSuccess: function(replacedSuggestion) {
                                $("li[data-mission-code='"+ missionCode +"'] .track-icon").remove();

                                contextData.suggestions[replacedSuggestion.index - 1] = replacedSuggestion;
                            }
                        });
                    }
                }
            })
            .on("mousewheel", function(e){
                e.stopPropagation();
                $("html, body").stop();
            })
        ;

        function selectAssignment (code, scrollTo) {
            var $element = $("[data-mission-code=" + code + "]");

            $(".assignments-list li.active").removeClass("active");
            $element.addClass("active");

            try {
                showAssignmentDetails(code);

                if (scrollTo && !base.isElementInViewport($element)) {
                    var baseHeader = $('#base-header');
                    if (baseHeader.length) {
                        var baseHeaderHeight = baseHeader.height() || 0;
                        $('html, body').animate({
                            scrollTop: $element.offset().top - baseHeaderHeight
                        }, 1000);
                    }
                }
            } catch(e) {
                // silent pass in SC
            }
        }

        function showAssignmentDetails (code) {
            $S("assignment-details").update({
                "detailedMission": $.extend(true, {}, missions[code])
            });
            profile.updateStickyBoundaries();
        }

        function selectDefault () {
            var $first = $(".assignments-list").first().children().first();
            var code = $first.data("mission-code");

            if (code) {
                selectAssignment(code);
            }
        }

        if (profile.router) {
            profile.router.route("*notFound", selectDefault);
            profile.router.route(":code", "assignment", function (code) {
                selectAssignment(code, true)
            });
        } else {
            selectDefault();
        }
    });

}(jQuery, window));;;(function ($, window, undefined) {
    var _l = battlereport.locales;

    var COMPARE_DIALOG_OPTIONS = {
        template: "battlereport.bf4compare",
        modal: true,
        buttons: {
            close: true
        }
    };

    // Bind to init event
    battlereport.on("init", function () {});

    // Bind to pageshow event
    battlereport.on("pageshow", function () {
        var loadUrl = $("#battlereport-load-url").val();
        if (loadUrl) {
            $.get(loadUrl).done(function (response, responseWith) {
                br.data = response;
                br.render(response);
                br.bindEvents();
            });
        }
    });

    battlereport.on("pageleave", function () {
        br.unbindEvents();
    });


    /**
     * battleReport "controller"
     * This object handles the loading of a battlereport
     */
    var br = {
        playerReports: {}
    };

    br.bindEvents = function(){
        battlereport.bindEvents();

        $("#battlereport-toggleHiddenPlayers").on("click", br.toggleHiddenPlayers);
        $(".battlereport-teamstats-row.player").on("click", br.togglePlayerScore);
        $(".battlereport-teamstats-row.commander").on("click", br.togglePlayerScore);
        $("#battlereport-scoreboard nav li").on("click", br.switchScoreboard);
        $("#add-as-favorite-battlereport").on("click", br.addAsFavorite);
        $("#remove-as-favorite-battlereport").on("click", br.removeFavorite);
        $("#share-to-feed-battlereport").on("click", br.shareToFeed);
        $("#battlereport").on("click", "#battlereport-comments a[data-url]", br.paginateComments);
        $("#battlereport").on("click", ".gamereport-comment-delete", br.deleteComment);

        // Add sorting to score table
        $.tablesorter.addParser({
            id: 'scoreParser',
            is: function(s){ return false; },
            format: function(s){ return parseInt(s.replace(",", "")) },
            type: 'numeric'
        });
        $('table.scoreboard').each(function(){
            if ($(this).find("tbody tr").size()){
                $(this).tablesorter({
                    sortInitialOrder: "desc",
                    sortList: [[0, 0]],
                    headers: {
                        // Add a special sorter for the score column, since the score is formatted
                        4: { sorter:'scoreParser' }
                    }
                }).on("sortEnd", function(e){
                    // Reposition any open player score rows
                    var $tbl = $(e.target);
                    $tbl.find(".battlereport-player-score").each(function(i, elem){
                        var $elem = $(elem);
                        $elem.insertAfter( $tbl.find("tr[data-personaid='"+ $elem.data("personaid") +"']"));
                    });
                });
            }
        });
    };
    br.unbindEvents = function(){
        battlereport.unbindEvents();

        $("#battlereport-toggleHiddenPlayers").off();
        $(".battlereport-teamstats-row.player").off();
        $("#battlereport-scoreboard nav li").off();
        $('table.scoreboard').off();
        $("#share-to-feed-battlereport").off();
        $("#battlereport").off();
    };

    br.render = function (data) {
        data = data || false;
        $S("battlereport").update({battleReport: data});
        $("#playerreport-awards").sodaSlider({ centered: false });

        if (data.playerReport && data.playerReport.scores.total > 0) {

            if(S.globalContext.realm.section === S.globalContext.staticContext.sections.BFH) {
                var pie = new PieChart([
                    {label: battlereport.locales["ID_WEB_COMMON_AWARD"], val:data.playerReport.scores.sc_award},
                    {label: battlereport.locales["ID_WEB_COMMON_PROGRESS_UNLOCKS"], val:data.playerReport.scores.sc_unlock},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_ENFORCER"], val:data.playerReport.scores.sc_enforcer},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_MECHANIC"], val:data.playerReport.scores.sc_mechanic},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_OPERATOR"], val:data.playerReport.scores.sc_operator},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_PROFESSIONAL"], val:data.playerReport.scores.sc_professional},
                    {label: battlereport.locales["ID_WEB_COMMON_VEHICLE"], val:data.playerReport.scores.vehicle},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_HACKER"], val:data.playerReport.scores.sc_commander}
                ], "#playerreport-score", {
                    showLines: true,
                    strokeWidth: 0,
                    lineColor: "rgba(255, 255, 255, 0.05)",
                    colors: ["#f9690e", "#68c3a3", "#eb974e", "#1e824c", "#d91e18", "#9a12b3", "#87d37c", "#4183d7"],
                    showTooltip: false,
                    hoverLabelElem: $("#playerreport-pie-label"),
                    hoverValueElem: $("#playerreport-pie-value"),
                    hoverPercentElem: $("#playerreport-pie-percent"),
                    arcWidth: 12
                });
            } else {
                var pie = new PieChart([
                    {label: battlereport.locales["ID_WEB_COMMON_AWARD"], val:data.playerReport.scores.sc_award},
                    {label: battlereport.locales["ID_WEB_COMMON_PROGRESS_UNLOCKS"], val:data.playerReport.scores.sc_unlock},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_ASSAULT"], val:data.playerReport.scores.sc_assault},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_ENGINEER"], val:data.playerReport.scores.sc_engineer},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_SUPPORT"], val:data.playerReport.scores.sc_support},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_RECON"], val:data.playerReport.scores.sc_recon},
                    {label: battlereport.locales["ID_WEB_COMMON_VEHICLE"], val:data.playerReport.scores.vehicle},
                    {label: battlereport.locales["ID_WEB_COMMON_CLASS_COMMANDER"], val:data.playerReport.scores.sc_commander}
                ], "#playerreport-score", {
                    showLines: true,
                    strokeWidth: 1,
                    lineColor: "rgba(255, 255, 255, 0.05)",
                    colors: ["#c36a12", "#5295bf", "#ead522", "#8eb070", "#ba1111", "#b411ba", "#11baa8", "#1259c3"],
                    showTooltip: false,
                    hoverLabelElem: $("#playerreport-pie-label"),
                    hoverValueElem: $("#playerreport-pie-value"),
                    hoverPercentElem: $("#playerreport-pie-percent")
                });
            }


        }

        // Animate round score
        var delay = 2000;
        $("#round-summary-content .legend > div").delay(delay).fadeIn();
        $(".round-summary-chart").each(function(i, elem){
            var $elem = $(elem),
                $bar = $elem.find(".team-bar"),
                $playerBar = $(elem).find(".player-bar"),
                $teamValue = $(elem).find(".round-summary-value"),
                totalHeight = parseFloat($bar.attr("data-percent"));

            delay += 200;
            $bar.delay(delay).animate(
                { height: $bar.attr("data-percent") +"%" },
                { duration: 400, easing: "swing" }
            );
            if ($playerBar.length){
                totalHeight += parseFloat($playerBar.attr("data-percent"));
                $playerBar.delay(delay).animate({
                    height: $playerBar.attr("data-percent") +"%",
                    bottom: $playerBar.attr("data-ypos") +"%"
                });
            }
            if ($teamValue.length){
                $teamValue.css("bottom", totalHeight +"%").delay(delay + 500).fadeIn();
            }
        });

        $(".eor-bg.hide").on("load", function(e){
            $(this).removeClass("hide").addClass("fade in");
        });

        br.markMyFriends();
    };

    br.toggleHiddenPlayers = function(){
        var $hiddenRows = $(".battlereport-teamstats-row.player.hiddenPlayer");
        $hiddenRows.each(function (i, $row) {
            $row = $($row);
            if ($row.hasClass("active")) {
                br.removePlayerScore($row, 0)
            }
        });
        $hiddenRows.toggle();
        $("#battlereport-toggleHiddenPlayers").text( $hiddenRows.is(":visible") ? _l["ID_WEB_COMMON_HIDE"] : _l["ID_WEB_BATTLEREPORT_SHOW_MORE_PLAYERS"] );
    };


    br.togglePlayerScore = function(){
        var $this = $(this),
            $active;
        if ($this.hasClass("active")) {
            br.removePlayerScore($this);
        } else {
            $active = $this.parents(".scoreboard-section").find("table").find(".active");
            if ($active.length) {
                br.removePlayerScore($active, 0);
            }
            br.showPlayerScore($this);
        }
        if(S.globalContext.staticContext.isSC) {
            scbridge.setHeight();
        }
    };
    br.removePlayerScore = function(row, speed){
        speed = speed || 200;
        var scoreRow = $("#" + br.getScoreRowId(row));
        var scoreContent = scoreRow.find(".player-score-container");
        scoreContent.slideUp(speed, function(){
            scoreRow.hide();
            row.removeClass("active");
            if(S.globalContext.realm.section !== S.globalContext.staticContext.sections.BFH) {
                row.find('.tinyinv').addClass('tiny').removeClass('tinyinv');
            }
        });
    };
	br.showPlayerScore = function(row){
        var personaId = row.attr("data-personaid");
        var reportId = row.parent().attr("data-reportId");
        var cacheKey = getPlayerInReportCacheKey(personaId, reportId);
        var cachedData = br.playerReports[cacheKey];
        var $scoreRow = $("#" + br.getScoreRowId(row));

        row.addClass("active");
        if(S.globalContext.realm.section !== S.globalContext.staticContext.sections.BFH) {
            row.find('.tiny').addClass('tinyinv').removeClass('tiny');
        }

        if (!$scoreRow.length) {
            $scoreRow = $("<tr></tr>").attr("id", br.getScoreRowId(row))
                                      .addClass("battlereport-player-score")
                                      .data("personaid", personaId);
            row.after( $scoreRow );
        }

        $scoreRow.show();

        function getPlayerInReportCacheKey(persona, report) {
            return [persona, report].join("-");
        }

        function displayPlayerScoreContent(data, animated){
            if (!data) data = {};
            data.reportId = br.data.id;
            data.platform = br.data.platform;
            data.isActivePlayer = false;
            if (S.globalContext.session.user && S.globalContext.session.user.presence && data.user &&
                S.globalContext.session.user.presence.userId == data.user.userId) {
                data.isActivePlayer = true;
            }

            data.prize = br.data.allPersonalPrizes[personaId];

            if(S.globalContext.realm.section === S.globalContext.staticContext.sections.BFH) {
                $scoreRow.html( $S("battlereport.bfhplayerscore").render(data) );
            }
            else {
                $scoreRow.html( $S("battlereport.warsawplayerscore").render(data) );
            }

            if (animated){
                $scoreRow.find(".player-score-container").slideDown(200);
            } else {
                $scoreRow.find(".player-score-container").show();
            }
            if (data && data.scores && data.scores.total > 0){
                if(S.globalContext.realm.section === S.globalContext.staticContext.sections.BFH) {
                    var pie = new PieChart([
                        {label: battlereport.locales["ID_WEB_COMMON_AWARD"], val:data.scores.sc_award},
                        {label: battlereport.locales["ID_WEB_COMMON_PROGRESS_UNLOCKS"], val:data.scores.sc_unlock},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_ENFORCER"], val:data.scores.sc_enforcer},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_MECHANIC"], val:data.scores.sc_mechanic},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_OPERATOR"], val:data.scores.sc_operator},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_PROFESSIONAL"], val:data.scores.sc_professional},
                        {label: battlereport.locales["ID_WEB_COMMON_VEHICLE"], val:data.scores.vehicle}
                    ], "#" + br.getScoreRowId(row) + " .player-score-pie", {
                        arcWidth: 12,
                        colors: ["#f9690e", "#68c3a3", "#eb974e", "#1e824c", "#d91e18", "#9a12b3", "#87d37c", "#4183d7"],
                        showLines: true,
                        lineCount: 64,
                        lineColor: "rgba(255, 255, 255, 0.05)",
                        strokeWidth: 0,
                        showTooltip: true
                    });
                }else{
                    var pie = new PieChart([
                        {label: battlereport.locales["ID_WEB_COMMON_AWARD"], val:data.scores.sc_award},
                        {label: battlereport.locales["ID_WEB_COMMON_PROGRESS_UNLOCKS"], val:data.scores.sc_unlock},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_ASSAULT"], val:data.scores.sc_assault},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_ENGINEER"], val:data.scores.sc_engineer},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_SUPPORT"], val:data.scores.sc_support},
                        {label: battlereport.locales["ID_WEB_COMMON_CLASS_RECON"], val:data.scores.sc_recon},
                        {label: battlereport.locales["ID_WEB_COMMON_VEHICLE"], val:data.scores.vehicle}
                    ], "#" + br.getScoreRowId(row) + " .player-score-pie", {
                        arcWidth: 15,
                        colors: ["#c36a12", "#5295bf", "#ead522", "#8eb070", "#ba1111", "#b411ba", "#11baa8"],
                        showLines: true,
                        lineCount: 64,
                        lineColor: "rgba(255, 255, 255, 0.05)",
                        strokeWidth: true,
                        showTooltip: true
                    });
                }

            }
            $scoreRow.find(".compare").on("click", br.openCompare);
        }

        // Display the box with cached data. If this is empty it will just render a loading text
        displayPlayerScoreContent(cachedData, true);

        if (!cachedData){
            var url = row.data("path");
            $.ajax({
                url: url,
                dataType: "json",
                type: "GET",
                complete: base.onComplete(function(success, response) {
                    var cacheKey = getPlayerInReportCacheKey(personaId, reportId);
                    br.playerReports[cacheKey] = response;
                    displayPlayerScoreContent(response, false);
                }, false)
            });
        }
    };

    br.addAsFavorite = function(e){
        var btn = $(this);

        $.ajax({
            type: 'post',
            url: btn.attr('data-url'),
            cache: false,
            data: {"post-check-sum": S.globalContext.session.postChecksum},
            dataType: 'json',
            success: function() {
                btn.attr("disabled", "disabled");
                base.showReceipt(battlereport.locales["ID_WEB_BATTLEREPORT_ADDED_TO_FAVORITES"], receiptTypes.OK);
            },
            error: function(xhr) {
                base.showReceipt(battlereport.locales["ID_WEB_BATTLEREPORT_ADD_TO_FAVORITES_FAILED"], receiptTypes.ERROR);
            }
        });
    };
    br.removeFavorite = function(e){
        var btn = $(this);
        $.ajax({
            type: 'post',
            url: btn.attr('data-url'),
            cache: false,
            data: {"post-check-sum": S.globalContext.session.postChecksum},
            dataType: 'json',
            success: function() {
                btn.attr("disabled", "disabled");
                base.showReceipt(battlereport.locales["ID_WEB_BATTLEREPORT_REMOVED_FROM_FAVORITES"], receiptTypes.OK);

                profile.battlereportsCache.selectedReportId = undefined;
                profile.battlereportsCache.isFavorite = undefined;
            },
            error: function(xhr) {
                base.showReceipt(battlereport.locales["ID_WEB_BATTLEREPORT_REMOVE_FROM_FAVORITES_FAILED"], receiptTypes.ERROR);
            }
        });
    };

    br.switchScoreboard = function(e){
        var $li = $(e.currentTarget),
            contentId = $li.attr("data-contentid");
        if (contentId){
            e.preventDefault();
            $(".scoreboard-section").removeClass("active");
            $(".scoreboard-section[data-contentid='" + contentId + "']").addClass("active");

            $("#battlereport-scoreboard nav li").removeClass("active");
            $("#battlereport-scoreboard .battlereport-player-score").remove();
            $("#battlereport-scoreboard tr").removeClass("active");
            $li.addClass("active");
        }
    };

    br.openCompare = function () {
        $.dialog({
            player1: br.data.playerReport,
            player2: br.playerReports[$(this).parents(".battlereport-player-score").data("personaid")]
        }, COMPARE_DIALOG_OPTIONS);
    };

    br.comparePlayers = function (player1, player2) {

    };

    br.markMyFriends = function () {
        var friends = comcenter.getFriendsListFromLs();

        for (var i = 0; i < friends.length; i++) {
            $("tr.battlereport-teamstats-row.player[data-userId='" + friends[i].userId +"'").addClass("myfriend");
        }
    };

    br.paginateComments = function () {
        var reportMetaId = $("#battlereport-comments").attr("data-meta-id"),
            commentsSurfaceId = "comment" + reportMetaId;

        $.get($(this).attr("data-url"), function(response){
            var surface = $S(commentsSurfaceId),
                state = surface.getState();

            state.data.comments = response.comments;
            state.pagination = response.pagination;
            surface.setState(state);
            surface.refresh();
        });
    };

    br.deleteComment = function(){
        var $bn = $(this),
            comment_id = $bn.attr("data-comment-id"),
            comment_url = $bn.attr("data-comment-url"),
            $comment = $bn.closest(".comment-body");

        $.post(comment_url, { commentId: comment_id }).always(
            base.onComplete(function(success, response){
                if (!success){
                    base.showReceipt("コメントを削除できませんでした", receiptTypes.ERROR);
                } else {
                    var dataMetaId = $("#battlereport-comments").attr("data-meta-id"),
                        surface = $S("comment"+ dataMetaId),
                        state = surface.getState();

                    // Remove comment from current state
                    for (var i=0; i<state.data.comments.length; i++){
                        if (state.data.comments[i].id === comment_id) {
                            state.data.comments.splice(i, 1);
                            state.data.totalCommentCount--;
                            break;
                        }
                    }

                    base.showReceipt("コメントを非表示にしました", receiptTypes.OK);
                    $comment.fadeOut(function(){
                        $comment.remove();
                    });
                }
            })
        );

    };

    br.shareToFeed = function() {
        var dialog = $.dialog({
                battleReport: br.data,
                buttons: {
                    ok: true
                }
        }, {
                template: "dialog.shareBattleReport"
            })
            .on("ok", function(e, d){
                var params = {"reportId":br.data.id, "platform":br.data.platform},
                    url = Surface.Modifier.urlformat('/{_section}/{_language}/battlereport/share/{reportId}/{platform}/', Surface.urlContext, params),
                    comment = $("#share-comment-textarea").val();

                $.post(url, {"comment": comment}).always(
                    base.onComplete(function(success, response){
                        if (response.message == "ALREADY_SHARED") {
                            base.showReceipt("バトルレポートは既にシェアされています", receiptTypes.ERROR);
                        } else if (success == 0) {
                            base.showReceipt("バトルレポートの共有ができません", receiptTypes.ERROR);
                        } else {
                            base.showReceipt("バトルレポートが共有されました", receiptTypes.OK);
                            $("#share-to-feed-battlereport").addClass("disabled").attr("disabled", "disabled");
                        }
                        d.destroy();
                    })
                );
            })
            .on("cancel", function (e, d) {
                d.destroy();
            })
            .on("show", function(e, d) {
                $(".eor-bg.hide").on("load", function(){
                   $(this).removeClass("hide");
                });
                $(".facebook-sharing a", d.element).click(function(event) {
                    event.preventDefault();
                    window.facebook.showInfoDialog();
                });
                var checkbox = $(".facebook-sharing .facebook-sharing-toggle", d.element);
                checkbox.prop("checked", window.facebook.isSharing());
                window.facebook.prepareToggleCheckbox(checkbox);
            });
    };

    br.getScoreRowId = function(row) {
        var type = "teamstats";
        if(row.parents('[data-contentid="squads"]').length) {
            type = "squads";
        }
        return "battlereport-player-score-" + type + "-" + row.attr("data-personaid");
    };



}(jQuery, window));

;(function ($, window, undefined) {

    profile.on("tabloaded.battlereports", function (e, data) {
        var $favoritesTable = $("#battlereports-favorites .battlereports-table");
        var $latestTable = $("#battlereports-latest .battlereports-table");
        var $favNoReportBox = $("#battlereports-favorites .no-reports");
        var rowTemplate = $S("profile.warsawbattlereportsrow");
        var battleReportById = {};
        var earliestTimestamp = 0;

        if (profile.battlereportsCache && profile.battlereportsCache.userId == data.userId){
            if (profile.battlereportsCache.gameReports && profile.battlereportsCache.gameReports.length){
                // If we have cached reports, check if any new ones has been added
                var l = data.gameReports.length;
                var new_reports = [];
                for (var i=0; i<l; i++){
                    if (data.gameReports[i].createdAt > profile.battlereportsCache.gameReports[0].createdAt){
                        new_reports.push(data.gameReports[i]);
                    } else {
                        break;
                    }
                }
                data.gameReports = new_reports.concat(profile.battlereportsCache.gameReports);

                // Add the cached reports, skip those already in the table
                l = data.gameReports.length;
                var curr_visible = $latestTable.find("tbody tr").size();
                var html = "";
                for (var i = curr_visible; i < l; i++){
                    html += rowTemplate.render({
                        report: data.gameReports[i],
                        game: data.game,
                        platform: data.platform,
                        favGameReportIds: data.favGameReportIds,
                        personaId: data.personaId
                    });
                }
                $("#battlereports-latest tbody").append(html);

                $("#game-stats aside").sticky("update")
            }

            if (profile.battlereportsCache.hideMoreButton){
                $("#battlereports-latest footer").hide();
            }
        } else {
            profile.battlereportsCache = {
                userId: data.userId
            };
        }
        if($favoritesTable.length > 0) {
            $.each(data.favGameReports, function(i, gr){
                battleReportById[gr.gameReportId] = gr;
            });
        };
        $.each(data.gameReports, function(i, gr){
            battleReportById[gr.gameReportId] = gr;
            if (gr.createdAt < earliestTimestamp || earliestTimestamp === 0){
                earliestTimestamp = gr.createdAt;
            }
        });

        function showReportDetails(gameReportId, isFavorite) {
            var details = $S("battlereports-details");
            var state = details.getState();
            state.activeReport = battleReportById[gameReportId];
            details.setState(state);
            details.refresh();

            $("#battlereports-details .eor-bg").on("load", function(e){
                $(this).removeClass("hide").addClass("fade in");
            });

            // Mark the row as active
            $(".battlereports-table tbody tr.active").removeClass("active");
            var table = isFavorite ? $favoritesTable : $latestTable
            table.find("tr[data-reportid='"+ gameReportId +"']").addClass("active");

            profile.battlereportsCache.selectedReportId = gameReportId;
            profile.battlereportsCache.isFavorite = isFavorite;
        }


        if (profile.battlereportsCache.selectedReportId){
            showReportDetails(profile.battlereportsCache.selectedReportId, profile.battlereportsCache.isFavorite);
            $(document).scrollTop( Math.max(0, $(".battlereports-table tbody tr.active").offset().top - 200) );
        } else {
            showReportDetails(data.gameReports[0].gameReportId);
        }

        $(".battlereports-table").on("click", "tbody tr", function(e){
            var $this = $(this);
            var gameReportId = $this.attr("data-reportid");
            var isFavorite = $this.parents("section").is("#battlereports-favorites");

            showReportDetails(gameReportId, isFavorite);
        });

        // Favorites
        $(".battlereports-table.own-reports").on("click", "td.premfav", function(e){
            e.preventDefault();
            e.stopPropagation();
            var $td = $(this);
            if ($td.data("loading")){
                return;
            }
            $td.data("loading", true);
            var $tr = $td.parent();
            var reportId = $tr.attr("data-reportid");
            var platform = $tr.attr("data-platform");
            var isFavorite = $td.hasClass("favorite");
            var params = {"reportId": reportId, "platform": platform};
            var url = isFavorite ?
                Surface.Modifier.urlformat('/{_section}/{_language}/battlereport/removeFavorite/{reportId}/{platform}/', Surface.urlContext, params) + "?json=1" :
                Surface.Modifier.urlformat('/{_section}/{_language}/battlereport/addFavorite/{reportId}/{platform}/', Surface.urlContext, params) + "?json=1";

            $.ajax({
                url: url,
                dataType: "json",
                type: "POST"
            }).done(S.C.base.onComplete(function (success, response) {
                if (success) {
                    var okMsg = isFavorite
                        ? profile.locales["ID_WEB_BATTLEREPORT_REMOVED_FROM_FAVORITES"]
                        : profile.locales["ID_WEB_BATTLEREPORT_ADDED_TO_FAVORITES"];
                    S.C.base.showReceipt(okMsg, "checkbox");

                    var $latestStarTd = $latestTable.find("[data-reportid='"+ reportId +"'] .favcell");
                    if (!isFavorite){
                        data.favGameReportIds.push(reportId);

                        // Add the row to the favorites section
                        if (!$favoritesTable.find("[data-reportid='"+ reportId +"']").size()){
                            $favoritesTable.find("tbody").prepend(
                                rowTemplate.render({
                                    report: battleReportById[reportId],
                                    game: data.game,
                                    platform: data.platform,
                                    favGameReportIds: data.favGameReportIds,
                                    personaId: data.personaId
                                })
                            );
                        }

                        // Update star icon in latest table
                        if ($latestStarTd.size()){
                            $latestStarTd.addClass("favorite");
                            $latestStarTd.find(".star").addClass("starred");
                            window.testtest = $latestStarTd;
                        }

                        $favNoReportBox.hide();

                    } else {
                        var index = data.favGameReportIds.indexOf(reportId);
                        if (index > -1) {
                            data.favGameReportIds.splice(index, 1);
                        }

                        // Remove the row from the favorites section
                        var $favRow = $favoritesTable.find("[data-reportid='"+ reportId +"']");
                        if ($favRow.size()){
                            $favRow.remove();
                            if (!data.favGameReportIds.length){
                                $favNoReportBox.show();
                            }
                        }

                        // Update star icon in latest table
                        if ($latestStarTd.size()){
                            $latestStarTd.removeClass("favorite");
                            $latestStarTd.find(".star").removeClass("starred");
                        }
                    }

                    $("#game-stats aside").sticky("setBoundaries");

                } else {
                    var errorMsg = isFavorite
                        ? profile.locales["ID_WEB_BATTLEREPORT_REMOVE_FROM_FAVORITES_FAILED"]
                        : profile.locales["ID_WEB_BATTLEREPORT_ADD_TO_FAVORITES_FAILED"];
                    S.C.base.showReceipt(errorMsg, "skull");
                }
                $td.data("loading", false);
            }));
        });

        // Load more
        var $bnLoadMore = $("#load-more-reports");
        $bnLoadMore.on("click", function(){
            $bnLoadMore.attr("disabled", "disabled");
            var params = {
                personaId: data.personaId,
                game: data.game,
                platform: data.platform,
                timestamp: earliestTimestamp
            };
            var url = Surface.Modifier.urlformat('/{_section}/{_language}/warsawbattlereportspopulatemore/{personaId}/{game}/{platform}/{timestamp}/', Surface.urlContext, params);

            $.ajax({
                url: url,
                dataType: "json",
                type: "GET",
                complete: base.onComplete(function(success, response){
                    if (success){

                        data.gameReports = data.gameReports.concat(response.data.gameReports);
                        profile.battlereportsCache.gameReports = data.gameReports;
                        $.each(response.data.gameReports, function(i, report){
                            battleReportById[report.gameReportId] = report;
                            if (report.createdAt < earliestTimestamp){
                                earliestTimestamp = report.createdAt;
                            }
                            var row = rowTemplate.render({
                                report: report,
                                game: data.game,
                                platform: data.platform,
                                favGameReportIds: data.favGameReportIds,
                                personaId: data.personaId
                            });
                            $("#battlereports-latest tbody").append(row);
                        });

                        if (response.data.gameReports.length < 10){
                            $("#battlereports-latest footer").hide();
                            profile.battlereportsCache.hideMoreButton = true;
                        }

                        if(S.globalContext.staticContext.isSC) {
                            scbridge.setHeight();
                        }
                        $("#game-stats aside").sticky("setBoundaries");
                    }
                    $bnLoadMore.removeAttr("disabled");
                })
            });
        });

        // Show all favorites
        var $bnShowAllFav = $("#show-all-favorites");
        $bnShowAllFav.on("click", function(){
            $bnShowAllFav.parent().remove();
            $favoritesTable.removeClass("show-first-ten");
        });
    });

}(jQuery, window));;(function ($, window, undefined) {

    profile.on("tabloaded.detailedstats", function(e, data){

    });

}(jQuery, window));;(function ($, window, undefined) {
    profile.on("tabloaded.venicedogtag", function (e, contextData) {
        var currentFilter = "basic";
        var selectedDogTag;
        // Game data
        var dogtagGamedata = $S.callFunction("gamedata.get", S.globalContext.realm.section, "dogtag").dogtags;
        var n_basic = Object.keys(dogtagGamedata.basic).length;
        var n_advanced = Object.keys(dogtagGamedata.advanced).length;
        // Create a flatten slug map: slug => dog tag
        var slugMap = {};
        var basicIndexToSlug = {};
        var advancedIndexToSlug = {};

        $.each(dogtagGamedata.basic, function (i, dogtag) {
            slugMap[dogtag.slug] = dogtag;
            basicIndexToSlug[dogtag.index] = dogtag.slug;
        });
        $.each(dogtagGamedata.advanced, function (i, dogtag) {
            slugMap[dogtag.slug] = dogtag;
            advancedIndexToSlug[dogtag.index] = dogtag.slug;
        });

        // Filter dog tags view
        $("#dogtags-filter li").on("click.page", function (e) {
            var $this = $(this),
                type = $this.data("filter");

            filter(type);
            $this.addClass("active").siblings().removeClass("active");
            $("#game-stats aside").sticky("setBoundaries");
        });

        // Smart loading of dogtags
        var loadedDogtagImages = {
            basic: new Array(n_basic),
            advanced: new Array(n_advanced),
            n_basic: 0,
            n_advanced: 0
        };

        $("img.dogtags").hide();
        $('.dogtag-item').appear();
        $('.dogtag-item').on('appear', function(event, $all_appeared_elements) {
            var nFilterTotal = currentFilter === "basic" ? n_basic : n_advanced;
            if (loadedDogtagImages["n_"+currentFilter] === nFilterTotal) { return; }

            $all_appeared_elements.each(function(i, el) {
                var $el = $(el),
                    type = $el.data("type"),
                    index = $el.data("index"),
                    $img, src;

                if (!loadedDogtagImages[type][index]) {
                    $img = $el.find("img.dogtags");
                    $img.attr("src", $img.data("src")).removeAttr("data-src").fadeIn();
                    loadedDogtagImages[type][index] = true;
                    loadedDogtagImages["n_"+type]++;
                }
            });

            $("#game-stats aside").sticky("setBoundaries");
        });


        function filter(type) {
            type = type || "basic";
            var $categories = $(".dogtags-list > .box"),
                $dogTags = $("li.dogtag-item");

            // Show only dogtags of type
            $dogTags.hide().filter("." + type).show();

            $("span.dtcategory").hide();
            $("span.dtcategory-" + type).show();

            // Hide all empty categories
            $categories.each(function (i, el) {
                var $el = $(el),
                    n = $el.find(".dogtag-item").filter("."+type).length;

                $el[n ? "show" : "hide"].call($el);
            });

            currentFilter = type;
            $.force_appear();
             if(S.globalContext.staticContext.isSC) {
                scbridge.setHeight();
             }
        }

        function equipDogTag() {
            var surf = $S("dogtags-equipped");
            var surfState = surf.getState();

            var params = {
                    personaId: contextData.personaId,
                    platform: contextData.platformInt,
                    basic: surfState.basicSelected.index,
                    advanced: surfState.advancedSelected.index
                };

            $.ajax({
                url: Surface.Modifier.urlformat('/{_section}/{_language}/user/savedogtag/', Surface.urlContext, params),
                dataType: "json",
                type: "POST",
                data: params,
                complete: base.onComplete(function (success, response) {
                    if (success) {
                            if(S.globalContext.realm.game == games.BFH)
                                base.showReceipt("パッチを保存しました", 'checkbox');
                            else
                                base.showReceipt(profile.locales["ID_WEB_SHOWRECEIPT_DOGTAGS_SAVED"], receiptTypes.OK);
                        surf.update({
                            basic: surfState.basicSelected,
                            advanced: surfState.advancedSelected
                        });
                        surf.refresh();

                    } else {
                        base.showReceipt(response.message, receiptTypes.ERROR);
                    }
                }, false)
            });
        }

        $("#dogtags-equipped-box")
            .on("click.page", ".basic", function(e){
                var surf = $S("dogtags-equipped").getState();
                var slug = surf.basicSelected.slug;
                if(!slug)
                    slug = "default-dog-tag";
                    // slug = "default-patch";


                selectDogTag(slug, true);
            })
            .on("click.page", ".advanced", function(e){
                var surf = $S("dogtags-equipped").getState();
                var slug = surf.advancedSelected.slug;
                if(!slug)
                    slug = "default-dog-tag";
                    //slug = "blank-patch";

                selectDogTag(slug, true);
            });

        $("#dogtag-statistics")
            .on("click.page", "li.dogtag-item", function(e){
                var $this = $(this),
                    slug = $this.data("slug");

                selectDogTag(slug, false);
            })
            .on("click.page", "#dogtags-equip", function(e) {
                equipDogTag();
            })
            .on("click.page", ".claim-dogtag", function(e) {
                e.preventDefault();
                var $this = $(this);
                if($this.hasClass("disabled")) {
                    return false;
                }
                var slug = $this.data("claimslug");

                $.ajax({
                    url: "/user/claimdogtag/",
                    type: "POST",
                    data: {slug: slug},
                    success: base.onComplete(function(success, response) {
                        base.showReceipt("Successfully unlocked the dogtag", receiptTypes.OK);
                        location.reload();
                    }),
                    error: function() {
                        base.showReceipt("Couldn't unlock the dogtag", receiptTypes.ERROR);
                    }
                });
            });


        function selectDogTag(slug, forceFilterUpdate) {
            try {
                showDogTagDetails(slug, forceFilterUpdate);

                var surf = $S("dogtags-equipped");
                var surfState = surf.getState();

                var currentSelected = surfState.currentSelected;
                var basicSelected = surfState.basicSelected;
                var advancedSelected = surfState.advancedSelected;

                var $dogTagsList = $(".dogtags-list");
                var $currentSelected = $dogTagsList.find("[data-slug=" + currentSelected.slug + "]");
                var $basicSelected = $dogTagsList.find("[data-slug=" + basicSelected.slug + "]");
                var $advancedSelected = $dogTagsList.find("[data-slug=" + advancedSelected.slug + "]");

                $dogTagsList.find("[data-slug]").removeClass("active equipped");

                $currentSelected.addClass("active");
                $basicSelected.addClass("equipped");
                $advancedSelected.addClass("equipped");

                window.setTimeout(function() { profile.deepNavigate(slug); }, 0);
            } catch (e) {
                // pass since it broke in sc navigation
            }
        }

        function showDogTagDetails(slug, forceFilterUpdate) {
            var copy = $.extend(true, {}, slugMap[slug]);
            var surf = $S("dogtags-equipped");
            var surfState = surf.getState();
            var type = copy.isAdvanced ? "advanced" : "basic";

            surfState.currentSelected = copy;
            surfState[type + "Selected"] = copy;

            if (forceFilterUpdate) {
                filter(type);
            }

            $("#dogtags-filter li[data-filter=" + type + "]").addClass("active").siblings().removeClass("active");

            $S("dogtags-equipped").refresh();
            selectedDogTag = copy;
        }

        function selectDefault() {
            var slug = basicIndexToSlug[contextData.basic.index];

            if (slug) {
                selectDogTag(slug, true);
            }
        }

        if (profile.router) {
            profile.router.route("*notFound", selectDefault);
            profile.router.route(":slug", "dogtag", function(slug) { selectDogTag(slug, true) });
        } else {
            selectDefault();
        }
    });
}(jQuery, window));;(function ($, window, undefined) {
    profile.on("tabloaded.kits", function (e, contextData) {
        // Create a flatten slug map: slug => kit item
        var slugMap = {};
        $.each(contextData.unlocks, function (kit, items) {
            $.each(items, function (i, item) {
                var value = (item.weaponUnlock || item.kitItemUnlock);
                slugMap[value.slug] = item;
            });
        });

        function selectKitItem (slug, element, scrollTo) {
            element = element || $("[data-slug=" + slug + "]");
            var $element = $(element);

            $("li.kit-item").removeClass("active");
            $element.addClass("active");
            $('.smallinv').removeClass('smallinv').addClass('small');
            $('.largersmallinv').removeClass('largersmallinv').addClass('largersmall');
            $element.find('.small').removeClass('small').addClass('smallinv');
            $element.find('.largersmall').removeClass('largersmall').addClass('largersmallinv');

            showKitItemDetails(slug);
            profile.deepNavigate(slug);

            if (scrollTo) {
                var baseHeader = $('#base-header');
                if (baseHeader.length) {
                    var baseHeaderHeight = baseHeader.height() || 0;
                    $('html, body').animate({
                        scrollTop: $element.offset().top - baseHeaderHeight
                    }, 1000);
                }
            }
        }

        function showKitItemDetails (slug) {
            var item = $.extend(true, {}, slugMap[slug]);
            $S("kits-details").update({"selectedKitItem": item});
        }

        $("#stats-kits")
            .on("click.page", "li.kit-item", function(e){
                var $this = $(this),
                    slug = $this.data("slug");

                selectKitItem(slug, $this);
            })
            .on("click.page", ".track-kititem:not(.disabled)", function(){
                var $bn = $(this);
                var unlock_guid = $bn.attr("data-guid");
                var type = $bn.attr("data-type");
                var unlock = contextData.gadgetsLocale[type][unlock_guid];

                // unfortunately kit items are a bit special as some of them are weapons really
                var itemType, suggestionTypeId;
                if (type == "kititems") {
                    itemType = "kititem_unlock";
                    suggestionTypeId = contextData.suggestionType;
                } else {
                    itemType = "weapon_unlock";
                    suggestionTypeId = 2;
                }

                profile.trackItem({
                    bn: $bn,
                    game: contextData.gameInt,
                    platform: contextData.platformInt,
                    suggestionTypeId: suggestionTypeId,
                    type: itemType,
                    imageConfig: unlock.unlockImageConfig,
                    nameSID: unlock.name,
                    itemId: unlock_guid,
                    suggestions: contextData.suggestions,
                    onSuccess: function(response){
                        // If the replaced suggestion exists on the current page, remove its icon.
                        var suggestion = response.data,
                            replacedSuggestion = contextData.suggestions[suggestion.index-1];
                        if (replacedSuggestion && replacedSuggestion.type == 2 || replacedSuggestion.type == 16){
                            $("li[data-guid='"+ replacedSuggestion.guid +"'] .track-icon").remove();
                        }

                        // Update current suggestions
                        contextData.suggestions[suggestion.index-1] = suggestion;

                        // Add track icon to list elem
                        $("li[data-guid='"+ unlock_guid +"']").append(
                            $("<i></i>").addClass("track-icon icon").attr("data-tooltip", "プレイヤーがトラッキング中")
                        );
                    }
                });
            })

            // Untrack kititem
            .on("click.page", ".untrack-kititem:not(.disabled)", function(e){
                var $bn = $(this);
                var unlock_guid = $bn.attr("data-guid");

                for (var i = 0; i < contextData.suggestions.length; i++) {
                    if (unlock_guid == contextData.suggestions[i].guid) {
                        profile.untrackItem({
                            bn: $bn,
                            game: contextData.gameInt,
                            platform: contextData.platformInt,
                            atIndex: i + 1,
                            isTrackedManually: contextData.suggestions[i].isTrackedManually,
                            onSuccess: function(replacedSuggestion) {
                                $("li[data-guid='"+ unlock_guid +"'] .track-icon").remove();

                                contextData.suggestions[replacedSuggestion.index - 1] = replacedSuggestion;
                            }
                        });
                    }
                }
            });

        function selectDefault() {
            var $first = $(".kit-item").first();
            var slug = $first.data("slug");
            if (slug) {
                selectKitItem(slug, $first);
            }
        }

        if (profile.router) {
            profile.router.route("*notFound", selectDefault);
            profile.router.route(":slug", "kititem", function (slug) {
                selectKitItem(slug, null, true)
            });
        } else {
            selectDefault();
        }
    });

}(jQuery, window));
;(function ($, window, undefined) {
    profile.needSaving = false;

    profile.on("pageleave", function() {
        Surface.ajaxNavigation.doPageLoad = function() { return true; }
    });
    
    profile.on("pageshow", function() {
        if (S.globalContext.realm.section != sections.WARSAW) {
            return;
        }

        feed.bindSwitcher();

        // Fetch soldier stats
        profile.soldierStatsFetch();

        // Update soldier list
        profile.updateSoldierList();
        profile.updateTab();


        $("#game-stats .submenu [data-bind-toggle=profile-submenu]").on("click.page", function(){
            var $this = $(this);
            var target = $this.data("target");
            var $target = $("#game-stats .submenu ul." + target);
            $this.parent().addClass("active").siblings(".active").removeClass("active");
            $target.fadeIn("fast").siblings(".stats, .unlocks").hide();
            $target.find("li:first").addClass("active").find("a").click();
        });

        $("#profile-edit-full-form").find("input, textarea, select").not(".facebook-sharing-toggle").change( function() {
            profile.needSaving = true;
            Surface.ajaxNavigation.doPageLoad = function(url) {
                 $.confirm(profile.locales.ID_WEB_PROFILE_SAVE_SETTINGS, profile.locales.ID_WEB_PROFILE_SAVE_SETTINGS_TITLE)
                .on("yes", function (e, d) {
                    Surface.ajaxNavigation.doPageLoad = function() { return true; }
                    $("#profile-edit-full-form").submit();
                    d.hide();
                }).on("no", function (e, d) {
                    Surface.ajaxNavigation.doPageLoad = function() { return true; }
                    Surface.ajaxNavigation.navigateTo(url);
                    d.hide();
                });

                return false;
            }
        });

        // handle facebook sharing checkbox toggle
        window.facebook.prepareToggleCheckbox($("#profile-edit-full-form .facebook-sharing-toggle"));
        $("#profile-edit-full-form .facebook-learn-more").click(function(event) {
            event.preventDefault();
            window.facebook.showInfoDialog();
        });

        $(document).on("click.page", ".profile-warsawstats-resetstatsbutton", function (e) {

                if (premium.isPremiumRequiredOn($(this))) {
                    return true;
                }

                var $holder = $('#profile-stats-personadata');
                var data = {
                    resetUrl: $(this).attr("data-profile-stats-reseturl")
                };
                popup.render('profile.statsResetPopup', data, true, false);
                return false;
            });

        // TODO: Shouldn't delegate from document
        $(document).on("click.page", ".profile-venicestats-resetpopup-confirmbutton", function (e) {
            var $button = $(this);
            var popupId = $(this).closest('.dialog').attr('id');
            $button.siblings().add($button).each(function () {
                $(this).attr('disabled', 'disabled');
            });

            $.ajax({
                url: $(this).attr("data-url"),
                cache: false,
                type: 'POST',
                dataType: 'json',
                data: {"post-check-sum": S.globalContext.session.postChecksum},
                success: function () {
                    base.showReceipt(profile.locales["ID_WEB_PROFILE_STATS_RESETSTATS_SHOWRECEIPT_SUCCESS"]);
                    $.ga.trackClickEvent("statsreset.success");
                },
                error: function () {
                    base.showReceipt(profile.locales["ID_WEB_PROFILE_STATS_RESETSTATS_SHOWRECEIPT_FAILURE"], 'skull');
                    $.ga.trackClickEvent("statsreset.fail");
                },
                complete: function () {
                    popup.closePopup(popupId);
                    $(".overlay-container").remove();
                }
            });
        });

        $('#soldierbox-footer').on("click.page", function() {
            $('#soldiers').find(".soldier-hidden").removeClass("soldier-hidden");
            $(this).hide();
        });

        $("form.wallpost").on("submit.page", function (event) {
            event.preventDefault();
            //wallMessageExpanded = 0;
            var form = $(this);
            var $message = form.find("textarea");
            var $inputs = form.find("button").add($message);
            var message = $.trim($message.val());
            if (message.length > 1) {
                $.ajax({
                    url: form.attr("action"),
                    dataType: "json",
                    type: "POST",
                    data: form.serialize(),
                    complete: base.onComplete(function() {
                        $message.val("");
                        $message.css("height", "14px");
                        $inputs.prop("disabled", false);
                    }, false)
                });
                $inputs.prop("disabled", true);
            } else {
                base.showReceipt(profile.locales["ID_WEB_SHOWRECEIPT_ENTRY_TOO_SHORT"], "skull");
            }
        });

        $("form.wallpost textarea")
            .autosize()
            .on("focus.page blur.page", function(e) {
                var $this = $(this);
                var focus = e.type === "focus";
                // Move placeholder into data-placeholder and vice versa
                $this[focus ? "data" : "attr"]("placeholder", $this[!focus ? "data" : "attr"]
                    ("placeholder"))[!focus ? "data" : "attr"]("placeholder", "");
            })
            .on("keydown.page", function(e) {
                // Do nothing on enter
                if (e.which === $.ui.keyCode.ENTER) {
                    return false;
                }
            });

        // TODO: Move to feed.js?
        $(document).on("click.page.feed", "#feed-container .feed-story-delete", function() {
            popup.prompt({ "header": profile.locales["ID_WEB_SHOWRECEIPT_ENTRY_DELETED_CONFIRMATION"]}, function () {
                var feedEntry = $(this).parents("li:first");
                var storyUrl = $(this).attr("storyUrl");
                var data = $(this).siblings(".feed-story-ids").find("input[name='feed-eventIds[]']").serialize();

                data += "&post-check-sum=" + S.globalContext.session.postChecksum;
                $.ajax({
                    url: storyUrl,
                    type: "POST",
                    data: data,
                    complete: base.onComplete(function (success, response) {
                        if (success && response == "Deleted") {
                            feedEntry.fadeOut("fast", function () {
                                feedEntry.remove();
                            });
                            base.showReceipt(profile.locales["ID_WEB_SHOWRECEIPT_ENTRY_DELETED"], "checkbox");
                        } else {
                            base.showReceipt(profile.locales["ID_WEB_SHOWRECEIPT_ENTRY_DELETED_ERROR"], "skull");
                        }
                    }, false)
                });
            }, this);
        });

        // TODO: Move to feed.js?
        $(document).on('click.page.feed', '#feed-container .feed-story-comment-delete', function () {
            popup.prompt({ "header": profile.locales["ID_WEB_SHOWRECEIPT_COMMENT_DELETED_HEADER"]}, function () {
                var feedComment = $(this).parents(".feed-comments-item");
                var commentId = $(this).attr("commentId");
                var commentUrl = $(this).attr("commentUrl");

                var data = { "post-check-sum": S.globalContext.session.postChecksum, "commentId": commentId};
                $.ajax({
                    url: commentUrl,
                    type: "POST",
                    data: data,
                    complete: base.onComplete(function (success, response) {
                        if (success && response == "Deleted") {
                            feedComment.fadeOut("fast", function () {
                                feedComment.remove();
                            });
                            base.showReceipt(profile.locales["ID_WEB_SHOWRECEIPT_COMMENT_DELETED"], "checkbox");
                        } else {
                            base.showReceipt(profile.locales["ID_WEB_SHOWRECEIPT_COMMENT_DELETED_ERROR"], "skull");
                        }
                    }, false)
                });
            }, this);
        });

        /*!  */

        $(".profile-edit-picture").on("click.page.profile", function(){
            var $this = $(this);
            var soldier = "" + $this.data("soldier");
            var game = $this.data("game");
            var platform = $this.data("platform");
            $.dialog({
                platform: platform,
                soldier: soldier,
                game: game
            }, {
                template: "dialog.soldierimage",
                modal: true
            }).on("select", function(ev, dia, elem) {
                profile.updateProfilePortraitImage();
                dia.hide();
            }).on("show", function() {
                profile.setProfilePortrait();
            });
        });
        /*!  */


        $("#profile-edit-inactivatefeed").on("change.page.profile", function(){
            $(this).parents(".profile-edit-row:first").find(".hidden").removeClass("hidden");
        });


        $(document).on("click", ".assignment-link" , function(e){
            var ass = $(".game-stats-content").find("li[data-mission-code="+$(this).data("code")+"]");
            if(!base.isElementInViewport(ass)) {
                $("html, body").animate({scrollTop: $(ass).offset().top - $("#content").offset().top});
            }
            ass.click();
        });




        profile.soldierImageShowing = {};

        profile.updateProfilePortraitImage = function() {
            var soldier_img_html = $S("profile.showsoldierpic").render({
                "picture": profile.soldierImageShowing.portrait,
                "size": "small",
                "game": profile.soldierImageShowing.game_id
            });

            var $li = $("tr#" + profile.soldierImageShowing.id + "-" + profile.soldierImageShowing.platform+ "[data-soldierGame='" + profile.soldierImageShowing.game_id + "']");
            $li.find("span.profile-solder-picture").html(soldier_img_html);
            $li.find("input.soldier-picture-input").val(profile.soldierImageShowing.portrait);
            return true;
        };

        profile.setProfilePortrait = function(current_portrait) {
            var $container = $("#soldierportraits-container");
            var $portraits = $container.find("li");
            if (current_portrait) {
                $portraits.removeClass("selected");
                $("#" + current_portrait).addClass("selected");
            }
            if ($portraits.filter(".selected").length == 0) {
                $portraits.not(".disabled").first().addClass("selected");
            }
//            var soldier_portrait = "";
            $portraits.live("click", function () {
                var $this = $(this);
                if ($this.hasClass("disabled")) {
                    return false;
                }
                $portraits.removeClass("selected");
                $this.addClass("selected");
                var soldier_portrait = $this.attr("id");
                var soldier_id = $container.find("input#soldier").attr("value");
                var soldier_game_id = $container.find("input#soldierGameId").attr("value");
                var soldier_platform = $container.find("input#soldierPlatform").attr("value");
                profile.soldierImageShowing = {"id": soldier_id, "platform": soldier_platform, "portrait": soldier_portrait, "game_id":soldier_game_id};


            });

            return true;

        };

        $("#profile-status-message").on("click.page", "#profile-status-message-area, #profile-edit-status-button", function () {
            if ($("#profile-edit-status-button").length) {
                var $edit = $("#profile-status-message-edit").select();
                $(".profile-toggle-edit").toggleClass("base-hide");
                $("#feed-addlink-container").show();
                $("#feed-addlinkwithpreviewarea").hide();
                $edit.focus();

                var message = $edit.val();
                if (message == $edit.attr("placeholder")) {
                    $edit.val("");
                }
                $.trim($("#profile-status-message-area").html());

                $(document.body).bind("click.profileEditClick", function (e) {
                    if ($(e.target).parents("#profile-status-message").length) {
                        return true;
                    }
                    else {
                        $(".profile-toggle-edit").toggleClass("base-hide");
                        $(document.body).unbind("click.profileEditClick");
                    }
                });
            }
        });

        if ($("#profile-friends").length) {
            $("#profile-friends .friend").on("click.page.profile", function() {
                S.ajaxNavigation.navigateTo($(this).data("url"));
            });

            // Show add friend buttons
            var friends = comcenter.getFriendsListFromLs();
            var friendsIds = friends.map(function(o){
                return o.userId;
            });
            $("#friend-list .friend").each(function(){
                var $this = $(this);
                var userId = $this.attr("data-user-id");
                if (friendsIds.indexOf(userId) === -1) {
                    $this.find("button.base-hide").removeClass("base-hide");
                }
            });
        }
    });

    profile.updateTab = function(){
        if(S.globalContext.realm.section != sections.WARSAW) {
            return;
        }

        var parts = S.globalContext.currentUrl.split("|");
        var key = "";

        if (parts.length > 4) {
            var submenus = $("#game-stats .submenu ul");
            var tabs = submenus.children("li");
            tabs.find(".active").removeClass("active");
            if (parts[2] == "loadout") {
                key = "loadout";
            } else {
                if (parts[2].length == 2) // language in url
                    key = parts[5];
                else
                    key = parts[4];
            }

            if (key == "stats") {
                key = "overview";
            }

            var submenu;
            switch (key) {
                case "weapons":
                case "vehicles":
                case "detailedstats":
                case "battlereports":
                    submenu = "stats";
                    break;

                case "weaponunlocks":
                case "vehicleunlocks":
                case "kits":
                case "dogtags":
                    submenu = "unlocks";
                    break;
            }

            if (submenu) {
                var $submenu = submenus.filter("." + submenu);
                tabs.filter("." + submenu).addClass("active");
                $submenu.siblings(".stats, .unlocks").hide();
                $submenu.show().find("." + key).addClass("active");
            } else {
                tabs.filter("." + key).addClass("active");
            }
        }
    };

    profile.updateSoldierList = function () {
        var $soldiers = $("#soldiers");
        if ($soldiers.length) {

            var params =  {"userId": S.globalContext.profileUserId};
            var url = Surface.Modifier.urlformat('/{_section}/{_language}/user/overviewBoxStats/{userId}/', Surface.urlContext, params);
            $.get(url).always(base.onComplete(function(success, response) {
                if (success && response.data && response.data.soldiersBox.length) {
                    var html = "";
                    $.each(response.data.soldiersBox, function(i) {
                        var active = i === 0;
                        var soldierHtml =  $S("profile.warsawoverviewsoldier").render({
                            "soldier": this,
                            "active": active
                        });
                        var id = "#soldierdata-"+this.persona.personaId+"-"+this.game+"-"+this.platform;
                        $(id).html(soldierHtml).find(".hidden").removeClass("hidden");
                    });
                }
            }));
        }
    };

    var loadedLib;
    function loadItemsLib() {
        if (loadedLib) { return loadedLib; };

        /*!  */

        /*!  */
        var path = '/public/gamedatawarsaw/warsaw.items.js';
        /*!  */

        loadedLib = $.ajax({
            type: "GET",
            dataType: "script",
            url: base.asset(path),
            cache: true
        });
        return loadedLib;
    }

    profile.soldierStatsFetch = function () {
        var statsFetch = $("#profile-stats-fetch-url");
        var fetchLink = $('#fetch-stats-url');
        var fetchUrls = [];

        if (statsFetch.length && statsFetch.data("url")){
            fetchUrls.push($.ajax(statsFetch.data('url')));
            statsFetch.removeAttr("data-url");
        }

        if (fetchLink.length) {
            fetchUrls.push(
                $.ajax(fetchLink.attr('rel')),
                loadItemsLib()
            );
            fetchLink.remove();
        }


        if(fetchUrls.length){
            $.when.apply($,fetchUrls).done(function(response,items){
                response = response[0] || response;

                // If stats has been disabled (killswitch) show error page
                if (response.message === "DISABLED") {
                    statsFetch.html($S("profile.warsawpopulatedisabled").render({}));
                    return;
                }

                if(typeof window.items !== 'undefined' && typeof window.items.game_data.compact !== 'undefined'){
                    response.data.gadgetsLocale = profile.parseItems();
                }

                // Update header with challenge versus stats
                if (response.data.challengesVersus) {
                    $S("stats-header-challenges").update({challengesVersus: response.data.challengesVersus})
                }

                // Get the personaName from the view
                if ($(".profile-venicestats-header-soldier-info-name span").length){
                    response.data.personaName = $.trim($(".profile-venicestats-header-soldier-info-name span").text());
                } else if ($(".soldier-info-name span").length){
                    response.data.personaName = $.trim($(".soldier-info-name span:last").text());
                }

                var html = $S(response.data.statsTemplate).render(response.data);
                statsFetch.html($(html));

                // Abort here if the template is an error
                if (response.data.statsTemplate === "common.warsawerror"
                    || response.data.statsTemplate === "profile.statsblazedown") {
                    return;
                }
                if(response.data.statsTemplate == "battlepacks.index") {
                    battlepacks.setupIndexPage(response.data);
                    battlepacks.trigger("pageshow");
                }

                if ($("#createdogtag").length) {
                    profile.showDogTags($("#dogtag1-render").data("url"), $("#dogtag2-render").data("url"));
                }

                $("#game-stats aside").sticky("update");
                base.scrollToAnchor();
                setTimeout(function(){
                    $("#game-stats aside").sticky("position");
                }, 1001);

                profile.loadView(response.data);

                // Make sidebar sticky
                $("#game-stats aside").sticky(false, {
                    offset: $("#base-header").height() + 16,
                    fixed: !S.globalContext.staticContext.isTouchDevice,
                    scrollArea: S.globalContext.staticContext.isTouchDevice ? $("#viewport") : window
                });
            }).fail(function(response, err){
                statsFetch.html($S("profile.statsinternalerror").render({}));
            });
        }
    };

    profile.updatesortlist = function(){
        $('.profile-stats-table').each(function(){
            var $table = $(this),
                my_headers = {},
                tableId = $table.attr("id");

            $table.find("th.nosort").each(function () {
                my_headers[table.index()] = { sorter: false };
            });

            // Store current sorting in a global variable
            if (!window.tablesort) window.tablesort = [];

            $table.tablesorter({
                sortList: [((tableId && window.tablesort[tableId]) ? window.tablesort[tableId] : [0, 0])],
                sortInitialOrder: "desc",
                headers: my_headers,
                textExtraction: function (node) {
                    var $node = $(node);
                    var nodeAttr = $node.attr("data-sort-value");
                    if (typeof nodeAttr !== 'undefined' && nodeAttr !== false) {
                        return nodeAttr;
                    } else if ($node.find(".common-percentbar-container").length > 0 && $node.find(".item-object[data-count]").length > 0) {
                        var myProgress = parseInt($node.find(".common-percentbar-container:first div").css("width"), 10) / 100;
                        myProgress += parseInt($node.find(".item-object").attr("data-count"), 10);
                        return myProgress;
                    } else if ($node.find(".common-percentbar-container").length > 0) {
                        return $node.find(".common-percentbar-container:first div").css("width").replace("px", "");
                    } else if ($node.find(".item-object").length > 0) {
                        if ($.trim($node.find(".item-object").text()) == "-") {
                            return "-100.0%";
                        } else {
                            return $.trim($node.find(".item-object").text());
                        }
                    } else if ($node.find("p.item-name").length > 0) {
                        return $.trim($node.find("p.item-name").text());
                    } else {
                        return $node.text();
                    }
                }
            });
            $table.bind("sortEnd",function(e) {
                var table = $(this),
                    tableId = table.attr("id");
                if ($(".headerSortDown", table).length){
                    window.tablesort[tableId] = [$(".headerSortDown", table).index(), 0];
                } else if ($(".headerSortUp", table).length){
                    window.tablesort[tableId] = [$(".headerSortUp", table).index(), 1];
                }
            });
        });
    };

    profile.loadView = function (data) {
        var viewName = S.globalContext.actionName;
        delete profile.router;
        if (typeof S.ajaxNavigation.html5history !== "undefined" && !S.globalContext.staticContext.isSC) {
            profile.router = new Backbone.Router();
        }
        profile.trigger("tabloaded." + viewName, data);
        if (profile.router) {
            Backbone.history.start();
        }
        // Animate all progress bars
        $(".progress-bar.animate").progressbar();
    };

    profile.deepNavigate = function (to) {
        if (profile.router) {
            profile.router.navigate(to, {replace: true});
        }
    };

    profile.parseItems = function(){
        if(typeof window.items.game_data.formatted === 'undefined'){
            var compact = window.items.game_data.compact;
            var items = {
                weapons: {},
                kititems: {},
                vehicles: {},
                appearances: {},
                vehicleunlocks: {},
                weaponaccessory: {},
                battlepacks: {}
            };

            for (var key in items) {
                var category = compact[key];
                for (var guid in category) {
                    var item = category[guid];
                    var see = item.see || false;
                    if (see) {
                        var i = 0;
                        var len = see.length;
                        while (i < len) {
                            _.extend(item, category[see[i]]);
                            i++;
                        }
                        item.guid = guid;
                        items[key][guid] = item;
                    }
                }
            }
            window.items.game_data.formatted = items;
        }
        return window.items.game_data.formatted;
    };

    profile.getItemBySlug = function (items, slug) {
        var item;
        $.each(items, function (i, it) {
            if (it.slug === slug) {
                item = it;
                return false;
            }
        });
        return $.extend(true, {}, item);
    };

    profile.getItemByGuid = function (items, guid) {
        var item;
        $.each(items, function (i, it) {
            if (it.guid === guid) {
                item = it;
                return false;
            }
        });
        return $.extend(true, {}, item);
    };

    profile.trackItem = function (options){
        var dialog = $.dialog({
            type: options.type,
            imageConfig: options.imageConfig,
            nameSID: options.nameSID,
            itemId: options.itemId,
            suggestions: options.suggestions,
            buttons: {
                ok: true,
                cancel: true
            }
        }, {
            template: "dialog.trackitem"
        })
            .on("ok", function(e, d){
                var index = d.element.find(".suggestion-box.active").index() + 1,
                    params = {"game":options.game, "platform":options.platform, "suggestionTypeId": options.suggestionTypeId, "guid": options.itemId, "atIndex": index},
                    url = Surface.Modifier.urlformat('/{_section}/{_language}/track/item/{game}/{platform}/{guid}/{suggestionTypeId}/{atIndex}/', Surface.urlContext, params);

                if (options.bn){
                    options.bn.attr("disabled", "disabled");
                }
                $.post(url).always(
                    base.onComplete(function(success, response){
                        if (!success){
                            base.showReceipt("アイテムをトラッキングできません", receiptTypes.ERROR);
                        } else {
                            base.showReceipt("トラッキングを開始しました", receiptTypes.OK);

                            if (options.bn){
                                var trackClass = options.bn.attr("data-track-type");
                                options.bn.removeAttr("disabled")
                                    .removeClass("track-" + trackClass)
                                    .addClass("untrack-" + trackClass)
                                    .text("トラッキングをやめる")
                                    .prepend("<i></i> ");
                            }

                            options.onSuccess(response);
                        }
                        $.ga.trackClickEvent("track." + options.type);
                        d.hide();
                    })
                );
            });
    };

    profile.untrackItem = function (options){
        var params = {"game":options.game, "platform":options.platform, "atIndex": options.atIndex},
            isTrackedManually = options.isTrackedManually || false,
            url = (isTrackedManually) ? Surface.Modifier.urlformat('/{_section}/{_language}/untrack/item/{game}/{platform}/{atIndex}/', Surface.urlContext, params) : Surface.Modifier.urlformat('/{_section}/{_language}/suggestanother/item/{game}/{platform}/{atIndex}/', Surface.urlContext, params);

        options.bn.attr("disabled", "disabled");
        $.post(url).always(
            base.onComplete(function(success, response){
                if (!success){
                    base.showReceipt("アイテムのトラッキングを解除できません", receiptTypes.ERROR);
                } else {
                    base.showReceipt("トラッキングを解除しました", receiptTypes.OK);

                    var trackClass = options.bn.attr("data-track-type");
                    options.bn.removeAttr("disabled")
                        .removeClass("untrack-" + trackClass)
                        .addClass("track-" + trackClass)
                        .text("トラッキングする")
                        .prepend("<i></i> ");

                    options.onSuccess(response.data);
                }
            })
        );
    };

    profile.updateStickyBoundaries = function () {
        var stickyInstance = $("#game-stats aside").data("stickyInstance");
        if (stickyInstance) {
            stickyInstance.update();
        }
    };

    // Unbind stuff on page leave
    profile.on("pageleave", function(){
        Backbone.history.stop();
    });

}(jQuery, window));;(function ($, window, undefined) {

    profile.on("tabloaded.stats", function (e, data) {

        var IS_DEVICE = S.globalContext.staticContext.detectedBrowser.isTouchDevice,
            winPercentPiechart;

        // ******************** Init ********************
        function init() {
            // Animate skill value and bar
            var $skillValue = $("#overview-skill-value");
            var $skillBar = $(".overview-skill-bar div");
            var targetVal = $skillValue.attr("data-value");

            if (S.globalContext.realm.section === S.globalContext.staticContext.sections.BFH) {
                var od = new Odometer({
                    el: $skillValue[0],
                    value: 0
                });
                od.update(targetVal);
            } else {
                if (targetVal > 0) {
                    $skillValue.addClass("animating");
                    $({val: 0}).delay(200).animate({
                        val: targetVal
                    }, {
                        duration: 1000,
                        easing: "easeOutExpo",
                        step: function (now) {
                            $skillValue.html(S.Modifier.numberformat(
                                Math.round(now),
                                ".",
                                ",",
                                "3"
                            ));
                        },
                        complete: function () {
                            $skillValue.removeClass("animating");
                        }
                    });
                    $skillBar.width(8).delay(200).animate({
                        left: $skillBar.attr("data-percent") + "%"
                    }, {
                        duration: 1000,
                        easing: "easeOutExpo"
                    });
                }
            }

            // Setup the win percentage pie chart
            var teamPlayStats = $("#player-stats-winrate");
            var winCount = parseInt(teamPlayStats.data('wins'), 10);
            var lossCount = parseInt(teamPlayStats.data('losses'), 10);
            var winPercentage = parseInt(teamPlayStats.data('percentage'), 10);

            if (S.globalContext.realm.section === S.globalContext.staticContext.sections.BFH) {
                winPercentPiechart = new PieChart([
                    {label: "勝利", val: winPercentage, id: "wins"},
                    {label: "敗北", val: 100 - winPercentage, id: "losses"}
                ], "#player-stats-winrate", {
                    showLines: false,
                    showTooltip: !IS_DEVICE,
                    keepZeros: true,
                    strokeWidth: 0,
                    colors: ['#f88f05', '#acaeb1'],
                    arcWidth: 8
                });
            } else {
                winPercentPiechart = new PieChart([
                    {label: "勝利", val: winCount, id: "wins"},
                    {label: "敗北", val: lossCount, id: "losses"}
                ], "#player-stats-winrate", {
                    showLines: false,
                    showTooltip: !IS_DEVICE,
                    keepZeros: true,
                    strokeWidth: 1,
                    colors: ['#129de8', '#c33411'],
                    arcWidth: 12
                });
            }

            $(".battlereport-minicard").off("click").click(function (e) {
                var href = $(this).data("href");
                if (href) {
                    e.stopPropagation();
                    base.redirect(href);
                }
            });
        }

        init();

        if (S.globalContext.realm.section === S.globalContext.staticContext.sections.WARSAW) {
            var assault = data.playstyle.assault;
            var engineer = data.playstyle.engineer;
            var support = data.playstyle.support;
            var recon = data.playstyle.recon;

            var radarData = {
                1: {
                    axes: [
                        {axis: "Doctor", value: assault[0] || 0},
                        {axis: "Grenadier", value: assault[1] || 0},
                        {axis: "Rifleman", value: assault[2] || 0},
                        {axis: "Marksman", value: assault[3] || 0},
                        {axis: "Scorer", value: assault[4] || 0}
                    ]
                },
                2: {
                    axes: [
                        {axis: "Demolitionist", value: engineer[0] },
                        {axis: "Mechanic", value: engineer[1] },
                        {axis: "Anti-tank", value: engineer[2] },
                        {axis: "Anti-air", value: engineer[3] },
                        {axis: "Scorer", value: engineer[4] }
                    ]
                },
                32: {
                    axes: [
                        {axis: "Defender", value: support[0] || 0},
                        {axis: "Resupplier", value: support[1] || 0},
                        {axis: "Bombardier", value: support[2] || 0},
                        {axis: "Machine gunner", value: support[3] || 0},
                        {axis: "Scorer", value: support[4] || 0}
                    ]
                },
                8: {
                    axes: [
                        {axis: "Saboteur", value: recon[0] || 0},
                        {axis: "Spec Ops", value: recon[1] || 0},
                        {axis: "Sniper", value: recon[2] || 0},
                        {axis: "Headhunter", value: recon[3] || 0},
                        {axis: "Scorer", value: recon[4] || 0}
                    ]
                }
            };

            var chart = RadarChart.chart();
            chart.config({
                w: 335,
                h: 230,
                axisText: true,
                levels: 1,
                circles: false,
                factor: 0.8,
                factorLegend: .9,
                radius: 3,
                tooltip: false,
                transitionDuration: 250,
                maxValue: 1
            });
            var cfg = chart.config(); // retrieve config
            var svg = d3.select("#play-style .radar-chart").append("svg")
                .attr('width', cfg.w)
                .attr('height', cfg.h);

            var kit = svg.append('g').classed('kit', 1);

            var kitIcon = $("#play-style .box-content .kit-icon");
            $(".playstyle-kits .kit-icon").on("click.page", function () {
                var $this = $(this);
                $this.addClass("active").siblings(".active").removeClass("active");
                var kitId = parseInt($this.data("kit"), 10);
                kitIcon.removeClass("kit-1 kit-2 kit-32 kit-8").addClass("kit-" + kitId);
                kit.data([[radarData[kitId]]]).call(chart);
            }).filter(".kit-" + data.playstyleDisplayClass).click();
        }
    });

}(jQuery, window));;(function ($, window, undefined) {
    profile.on("tabloaded.vehicles tabloaded.vehicleunlocks", function (e, contextData) {
        var suggestionTypeId = contextData.suggestionType;
        var isGridView = contextData.isGridView;

        function selectVehicleCategory (slug, scrollTo) {
            var $element = $("#vehicle-list").find("tbody tr[data-slug='" + slug +"']"),
                refGuid = false;


            if (!$element.size()){
                // Try to find a category if a vehicle slug was passed
                var l = contextData.mainVehicleStats.length;
                for (var i=0; i<l; i++){
                    if (contextData.mainVehicleStats[i].slug == slug){
                        refGuid = contextData.mainVehicleStats[i].guid;
                        slug = contextData.mainVehicleStats[i].category;
                        $element = $("#vehicle-list").find("tbody tr[data-category='" + slug +"']");
                        break;
                    }
                }
            }
            if (!$element.size()){
                return;
            }
            var $active = $(".active[data-category]"),
                category = $element.data("category");

            $active.removeClass("active").find('.mediuminv').removeClass('mediuminv').addClass('medium');
            $element.addClass("active").find('.image.medium').removeClass('medium').addClass('mediuminv');

            showVehicleCategoryDetails(category, refGuid);

            if (scrollTo) {
                var baseHeader = $('#base-header');
                if (baseHeader.length) {
                    var baseHeaderHeight = baseHeader.height() || 0;
                    $('html, body').animate({
                        scrollTop: $element.offset().top - baseHeaderHeight
                    }, 1000);
                }
            }

            profile.updateStickyBoundaries();
        }

        function showVehicleCategoryDetails(category, refGuid) {
            $S("vehicle-category-details").update({
                "detailedCategory": category,
                "refGuid": refGuid,
                "detailedUnlock": null,
                "suggestions": contextData.suggestions
            });
        }

        function selectVehicleUnlock (slug, scrollTo) {
            var $element = $("#vehicle-list").find("li[data-slug=" + slug  +"]");
            var $active = $(".active[data-guid]"),
                category = $element.parent().data("category");

            $active.removeClass("active").find('.mediuminv').removeClass('mediuminv').addClass('medium');
            $element.addClass("active").find('.image.medium').removeClass('medium').addClass('mediuminv');
            showVehicleUnlockDetails($element.attr('data-guid'), category);

            if (scrollTo) {
                var baseHeader = $('#base-header');
                if (baseHeader.length) {
                    var baseHeaderHeight = baseHeader.height() || 0;
                    $('html, body').animate({
                        scrollTop: $element.offset().top - baseHeaderHeight
                    }, 1000);
                }
            }

            profile.updateStickyBoundaries();
        }

        function showVehicleUnlockDetails(guid, category) {

            var unlock = profile.getItemByGuid(contextData.unlockProgression[category], guid);

            $S("vehicle-category-details").update({
                "detailedCategory": category,
                "detailedUnlock": unlock,
                "suggestions": contextData.suggestions
            });
        }

        // Setup event listeners
        $("#game-stats")
            .on("click.page", ".vehicles-stat-tbl tbody tr", function(e){
                var $element = $(this),
                    category = $element.data("category"),
                    slug = $element.data("slug");

                selectVehicleCategory(slug);
                profile.deepNavigate(slug);
            })
            .on("click.page", ".vehicle-stats-list li", function(e){
                var $element = $(this);
                var guid = $element.data("guid");
                var slug = $element.data("slug");
                selectVehicleUnlock(slug);
                profile.deepNavigate(slug);
            })
            .on("click.page", ".track-vehicle:not(.disabled)", function(){
                var $bn = $(this);
                var unlock_guid = $bn.attr("data-unlock-guid");
                var unlock = contextData.gadgetsLocale.vehicleunlocks[unlock_guid];
                profile.trackItem({
                    bn: $bn,
                    game: contextData.gameInt,
                    platform: contextData.platformInt,
                    suggestionTypeId: suggestionTypeId,
                    type: "vehicleunlock_unlock",
                    imageConfig: unlock.unlockImageConfig,
                    nameSID: unlock.name,
                    itemId: unlock_guid,
                    suggestions: contextData.suggestions,
                    onSuccess: function(response){
                        // If the replaced suggestion exists on the current page, remove its icon.
                        var suggestion = response.data,
                            replacedSuggestion = contextData.suggestions[suggestion.index-1];
                        if (replacedSuggestion && replacedSuggestion.type == suggestionTypeId){
                            $("[data-next-unlock-guid='"+ replacedSuggestion.guid +"'] .track-icon").remove();
                            $("li[data-guid='"+ replacedSuggestion.guid +"'] .track-icon").remove();
                        }

                        // Update current suggestions
                        contextData.suggestions[suggestion.index-1] = suggestion;

                        // Add track icon to list elem
                        $("li[data-guid='"+ unlock_guid +"']").append(
                            $("<i></i>").addClass("track-icon icon").attr("data-tooltip", "プレイヤーがトラッキング中")
                        );

                        // Add track icon to table cell
                        $("[data-next-unlock-guid='"+ unlock_guid +"']").append(
                            $("<i></i>").addClass("track-icon icon").attr("data-tooltip", "プレイヤーがトラッキング中")
                        );
                    }
                });
            })

            // Untrack vehicle
            .on("click.page", ".untrack-vehicle:not(.disabled)", function() {
                var $bn = $(this);
                var guid = $bn.attr("data-unlock-guid");
                for (var i = 0; i < contextData.suggestions.length; i++) {
                    var suggestion = contextData.suggestions[i];
                    if (guid == suggestion.guid && suggestionTypeId == suggestion.type) {
                        profile.untrackItem({
                            bn: $bn,
                            game: contextData.gameInt,
                            platform: contextData.platformInt,
                            atIndex: i + 1,
                            isTrackedManually: suggestion.isTrackedManually,
                            onSuccess: function(replacedSuggestion) {
                                $("li[data-guid='"+ guid +"'] .track-icon").remove();
                                $("[data-next-unlock-guid='"+ guid +"'] .track-icon").remove();

                                contextData.suggestions[replacedSuggestion.index - 1] = replacedSuggestion;
                            }
                        });
                    }
                }
            })

            .on("click.page", ".category-vehicles-list li[data-guid]", function(){
                var guid = this.getAttribute("data-guid");
                $S("vehicle-details").update(
                    {
                        category: {
                            refGuid: guid
                        }
                    }
                );
            });

        $S("vehicle-list").update({"isGridView": isGridView});
        profile.updatesortlist();

        function selectDefault () {
            var slug = isGridView ?
                $('#vehicle-list').find('li:first-of-type').attr('data-slug') :
                $('#vehicle-list').find('tbody tr:first-of-type').attr('data-slug');

            if (slug) {
                if (isGridView) {
                    selectVehicleUnlock(slug);
                } else {
                    selectVehicleCategory(slug);
                }
            }
        }

        if (profile.router) {
            profile.router.route("*notFound", selectDefault);
            profile.router.route(":slug", "vehicle",
                isGridView ?
                    function (slug) {
                        selectVehicleUnlock(slug, true)
                    } :
                    function (slug) {
                        selectVehicleCategory(slug, true)
                    }
            );
        } else {
            selectDefault();
        }
    });
}(jQuery, window));;(function ($, window, undefined) {
    
    profile.weaponData = [];
    
    profile.on("tabloaded.weapons tabloaded.weaponunlocks", function (e, contextData) {
        var isGridView = contextData.isGridView;
        var slider_initalized = false;
        var showAll = false;
        var suggestionTypeId = contextData.suggestionType;
        // Shorthands
        var unlockProgression = contextData.mainWeaponStatsMetadata ?
            contextData.mainWeaponStatsMetadata.unlockProgression : {};
        var accessories = contextData.selectedWeaponAccessory;
        var gadgetsLocale = contextData.gadgetsLocale;
        var guidToWeapon = {};
        var accessoryXHR;

        populateWeapons();

        function selectWeapon(slug, element, scrollTo) {
            function getElementBySlug(slug){
                var weaponInTable = $(".weapons-stat-tbl tbody tr[data-slug=" + slug  +"]");
                if (weaponInTable.length) {
                    return weaponInTable;
                }

                var weaponInList = $(".weapon-stats-list li[data-slug=" + slug  +"]");
                if (weaponInList.length) {
                    return weaponInList;
                }

                return [];
            }

            element = element || getElementBySlug(slug);

            // If deeplinked to a weapon that isn't in the first view, display all weapons
            if (!element.length){
                showAll = true;
                updateWeapons();
                element = getElementBySlug(slug);
            }
            // Urgh.. TODO: Seperate bfh and warsaw scripts better..
            if (S.globalContext.realm.game == games.BFH){
                $(".active[data-slug]").removeClass("active");
            } else {
                $(".active[data-slug]").removeClass("active").find(".smallinv").removeClass("smallinv").addClass("small");
            }

            var noAccessories = true,
                noStatistics = false;
            if (element.length){
                noAccessories = element.hasClass("no-accessories");
                noStatistics = element.hasClass("no-statistics");
                if (S.globalContext.realm.game == games.BFH){
                    element.addClass("active");
                } else {
                    element.addClass("active").find(".small").removeClass("small").addClass("smallinv");
                }


                if (scrollTo) {
                    var baseHeader = $('#base-header');
                    if (baseHeader.length) {
                        var baseHeaderHeight = baseHeader.height() || 0;
                        $('html, body').animate({
                            scrollTop: element.offset().top - baseHeaderHeight
                        }, 1000);
                    }
                }
            }

            showWeaponDetails(slug, noAccessories, noStatistics);

        }

        function showWeaponDetails(slug, noAccessories, noStatistics){
            var weapon = profile.getItemBySlug(profile.weaponData, slug);
            if (weapon){

                var state = $S("weapon-details").getState();
                state["noAccessories"] = noAccessories;
                state["detailedWeapon"] = weapon;
                state["suggestions"] = contextData.suggestions;
                state["hideStatistics"] = noStatistics || false;

                $S("weapon-details").setState(state);
                $S("weapon-details").refresh();
            }

            if (!isGridView || noAccessories) {
                $("#weapon-details-accessories").empty();
            } else if (typeof weapon.statsItemUnlocks === "undefined") {
                if(accessoryXHR && accessoryXHR.abort) {
                    accessoryXHR.abort();
                }
                $S("weapon-details-accessories").update({
                    accessories: null,
                    accessoryGameData: null,
                    battlepacksGameData: null
                });

                var params = {
                    personaId: contextData.personaId,
                    platformInt: contextData.platformInt,
                    weaponguid: weapon.guid
                };
                var url = Surface.Modifier.urlformat('/{_section}/{_language}/warsawWeaponAccessoriesPopulateStats/{personaId}/{platformInt}/{weaponguid}/', Surface.urlContext, params);
                accessoryXHR = $.get(url, function() {}).done(function (response) {
                    var weaponData = profile.weaponData[guidToWeapon[weapon.guid]];
                    weaponData.statsItemUnlocks = response.data.statsItemUnlocks;
                    $S("weapon-details-accessories").update({
                        accessories: response.data.statsItemUnlocks,
                        accessoryGameData: window.items.game_data.compact.weaponaccessory,
                        battlepacksGameData: window.items.game_data.compact.battlepacks,
                        guid: weapon.guid
                    });
                    if($S("weapon-details-accessories").getState()["accessories"].length){
                        $('#weapon-details-accessories').show();
                    } else {
                        $('#weapon-details-accessories').hide();
                    }
                });
                // Abort the above xhr if navigating
                profile.one("pageleave", function(){
                    accessoryXHR.abort();
                });
            } else {
                $S("weapon-details-accessories").update({
                    accessories: weapon.statsItemUnlocks,
                    accessoryGameData: window.items.game_data.compact.weaponaccessory,
                    battlepacksGameData: window.items.game_data.compact.battlepacks
                });
                if($S("weapon-details-accessories").getState()["accessories"].length){
                    $('#weapon-details-accessories').show();
                } else {
                    $('#weapon-details-accessories').hide();
                }
            }
            profile.updateStickyBoundaries();
            $(".progress-bar.animate", "#weapon-details").progressbar(1);
        }

        function populateWeapons () {
            profile.weaponData = contextData.mainWeaponStats.map(function(weapon, i){
                var info = gadgetsLocale.weapons[weapon.guid];
                // Populate weapon
                // Moved from the template profile.warsawweaponsstats.surf to speed up refresh
                if (!weapon.info) {
                    weapon.info = info;
                    if (S.globalContext.realm.section !== S.globalContext.staticContext.sections.BFH) {
                        weapon.nextAccessoryUnlock = accessories[weapon.guid];
                    }
                    weapon.unlockData = profile.function_getUnlockData(weapon.guid, unlockProgression);
                    weapon.locked = weapon.unlockData && !weapon.unlockData.completed;
                    weapon.initVisible = (!weapon.locked && weapon.timeEquipped) || weapon.kills;
                }
                return weapon;
            });

            // Sort weapon list
            profile.weaponData = profile.weaponData.sort(function(a, b) {
                if (a.kills != b.kills) {
                    return (a.kills > b.kills) ? -1 : 1;
                } else if (a.timeEquipped != b.timeEquipped) {
                    return (a.timeEquipped > b.timeEquipped) ? -1 : 1;
                } else if (a.locked != b.locked) {
                    return (!a.locked) ? -1 : 1;
                } else {
                    return a.category < b.category ? -1 : 1;
                }
            });

            // Setup guidToWeapon Index
            guidToWeapon = {};
            for (i = 0; i < profile.weaponData.length; i++) {
                guidToWeapon[profile.weaponData[i].guid] = i;
            }

            // Make sure at least 10 and most 50 weapons always is visible in first view
            var displayMin = 10,
                displayMax = 50,
                l = profile.weaponData.length,
                n = Math.min(l, displayMin),
                i;
            for (i=0; i<n; i++){
                if (!profile.weaponData[i].initVisible){
                    profile.weaponData[i].initVisible = true;
                }
            }
            if (l > displayMax && profile.weaponData[displayMax-1].initVisible){
                for (i=displayMax; i<l; i++){
                    if (profile.weaponData[i].initVisible){
                        profile.weaponData[i].initVisible = false;
                    }
                }
            }
        }

        function updateWeapons(){
            var data = contextData;

            if (!isGridView){
                // At first just display unlocked and used weapons
                if (!showAll){
                    data.mainWeapons = profile.weaponData.filter(function(weapon, i){
                        return weapon.initVisible;
                    });
                } else {
                    data.mainWeapons = profile.weaponData;
                }
            }

            var state = $S("weapon-list").getState();
            state.isGridView = isGridView;
            state.mainWeapons = data.mainWeapons;
            state.showAll = showAll;
            $S("weapon-list").refresh();
            if (!isGridView) {
                setTimeout(function(){
                    profile.updateStickyBoundaries();
                }, 0);
            }
            profile.updatesortlist();
            if(S.globalContext.staticContext.isSC) {
                scbridge.setHeight();
            }
        }

        $("#weapon-head")
            // Enable advanced filter options
            .on("click.page.stats", ".show-filters header", function(e){
                $('#filter-options').toggle();
                if (!slider_initalized){
                    slider_initalized = true;
                    $(".filter-slider").slider({
                        range: true,
                        min: 0,
                        max: 100,
                        values: [0, 100],
                        slide: function(event, ui){
                            $(this).parent().find(".filter-values").text(ui.values[0] +" - "+ ui.values[1]);
                        },
                        stop: function(event, ui){
                            filters[$(this).attr("data-filter")] = [ui.values[0] / 100, ui.values[1] / 100];
                            updateWeapons();
                        }
                    });
                }
                if ($filter_options.data("toggled")){
                    $filter_options.data("toggled", false);
                    $(this).removeClass("active");
                    $("#filter-options").slideUp(profile.updateStickyBoundaries);
                } else {
                    $filter_options.data("toggled", true);
                    $(this).addClass("active");
                    $("#filter-options").slideDown(profile.updateStickyBoundaries);
                }

            })
            .on("click.page.stats", ".filter-list li", function(e){
                $(this).toggleClass("on");
                updateWeapons();
            });

        // Setup event listeners
        $("#weapon-statistics")
            .on("click.page.stats", ".weapons-stat-tbl tbody tr", function(e){
                var $element = $(this),
                    slug = $element.attr("data-slug");
                selectWeapon(slug, $element);
                profile.deepNavigate(slug);
            })
            .on("click.page.stats", ".weapon-stats-list li[data-slug]", function(e){
                var $element = $(this),
                    slug = $element.attr("data-slug");
                selectWeapon(slug, $element);
                profile.deepNavigate(slug);
            })
            .on("click.page.stats", "#bn-show-all", function(e){
                e.preventDefault();
                showAll = true;
                updateWeapons();
            })

            // Track weapon dialogs
            .on("click.page.stats", ".track-weapon:not(.disabled)", function(){
                var $bn = $(this);
                var guid = $bn.attr("data-guid");
                var item = contextData.gadgetsLocale.weapons[guid];

                profile.trackItem({
                    bn: $bn,
                    game: contextData.gameInt,
                    platform: contextData.platformInt,
                    suggestionTypeId: suggestionTypeId,
                    type: "weapon_unlock",
                    imageConfig: item.unlockImageConfig,
                    nameSID: item.name,
                    itemId: guid,
                    suggestions: contextData.suggestions,
                    onSuccess: function(response){
                        // If the replaced suggestion exists on the current page, remove its icon.
                        var suggestion = response.data,
                            replacedSuggestion = contextData.suggestions[suggestion.index-1];
                        if (replacedSuggestion && replacedSuggestion.type == suggestionTypeId){
                            $("li[data-guid='"+ replacedSuggestion.guid +"'] .track-icon").remove();
                        }

                        // Update current suggestions
                        contextData.suggestions[suggestion.index-1] = suggestion;

                        // Add track icon to list elem
                        $("li[data-guid='"+ guid +"']").append(
                            '<i class="track-icon icon" data-tooltip="プレイヤーがトラッキング中"></i>'
                        );
                    }
                });
            })
            // Untrack weapon dialog
            .on("click.page.stats", ".untrack-weapon:not(.disabled)", function() {
                var $bn = $(this);
                var guid = $bn.attr("data-guid");
                for (var i = 0; i < contextData.suggestions.length; i++) {
                    var suggestion = contextData.suggestions[i];
                    if (guid == suggestion.guid && suggestionTypeId == suggestion.type) {
                        profile.untrackItem({
                            bn: $bn,
                            game: contextData.gameInt,
                            platform: contextData.platformInt,
                            atIndex: i + 1,
                            isTrackedManually: suggestion.isTrackedManually,
                            onSuccess: function(replacedSuggestion) {
                                // Remove the track icon from the list elem
                                $("li[data-guid='"+ guid +"'] .track-icon").remove();

                                contextData.suggestions[replacedSuggestion.index - 1] = replacedSuggestion;
                            }
                        });
                    }
                }

            })
            // Enable advanced filter options
            .on("click.page.stats", ".show-filters header", function(e){
                $('#filter-options').toggle();
                if (!slider_initalized){
                    slider_initalized = true;
                    $(".filter-slider").slider({
                        range: true,
                        min: 0,
                        max: 100,
                        values: [0, 100],
                        slide: function(event, ui){
                            $(this).parent().find(".filter-values").text(ui.values[0] +" - "+ ui.values[1]);
                        },
                        stop: function(event, ui){
                            filters[$(this).attr("data-filter")] = [ui.values[0] / 100, ui.values[1] / 100];
                            updateWeapons();
                        }
                    });
                }
                if ($filter_options.data("toggled")){
                    $filter_options.data("toggled", false);
                    $(this).removeClass("active");
                    $("#filter-options").slideUp(profile.updateStickyBoundaries);
                } else {
                    $filter_options.data("toggled", true);
                    $(this).addClass("active");
                    $("#filter-options").slideDown(profile.updateStickyBoundaries);
                }

            })
            .on("click.page.stats", ".category-filter-list li", function(e){
                $(this).toggleClass("on");
                updateWeapons();
            });

        updateWeapons();

        function selectDefault() {
            var slug = $("[data-slug]").first().data("slug");
            if (slug) {
                selectWeapon(slug);
            }
        }

        // TryHard routing with Backbone
        if (profile.router) {
            profile.router.route("*notFound", selectDefault);
            profile.router.route(":slug", "weapon", function (slug) {
                selectWeapon(slug, null, true)
            });
        } else {
            selectDefault();
        }

    });

    cash.on("purchase", function (e, err, guid) {
        if (err || profile.weaponData.length === 0) { return; }
        var weapon;
        // Set to unlocked since it is now bought
        $.each(profile.weaponData, function (i, it) {
            if (it.guid === guid) {
                it.locked = false;
                weapon = it;
                return false;
            }
        });
    });

}(jQuery, window));;;(function ($, window, undefined) {

    var state;
    var urls = {}

    function showImageOnLoad() {
        $("#campaign .show-on-load").on("load.page", function(){
           $(this).removeClass("show-on-load");
        });
    };

    function updateLeaderboards() {
        var $leaderboardsUrl = $("#campaign-leaderboards-url");
        if ($leaderboardsUrl.length) {
            urls.leaderboards = $leaderboardsUrl.val();
        }
        if (!urls.leaderboards) {
            return;
        }
        $S("campaign-leaderboard").update({ leaderboard: false });
        $.get(urls.leaderboards).done(function (response, responseWith) {
            if (responseWith !== "success" || !response) { return; }
            $S("campaign-leaderboard").update({ leaderboard: response });
        });
    }

    function updateLevel() {
        $.get(urls.progress).done(function (response, responseWith) {
            if (responseWith !== "success" || !response) { return; }
            $S("campaign-content").update(response);
            showImageOnLoad();
            updateLeaderboards();
        })
        .fail(function (response, responseWith) {
            $S("campaign-content").update({error: response.responseText});
        });
    }

    // Bind to pageshow event
    campaign.on("pageshow", function () {
        if (S.globalContext.realm.section !== S.globalContext.staticContext.sections.WARSAW) {
            return;
        }

        var $progressUrl = $("#campaign-progress-url");
        if ($progressUrl.length) {
            urls.progress = $progressUrl.val();

        }
        var $leaderboardsUrl = $("#campaign-leaderboards-url");
        if ($leaderboardsUrl.length) {
            urls.leaderboards = $leaderboardsUrl.val();
        }
        updateLevel();

        $("#campaign").on("click.page", "table.table-leaderboard .show-more", function (e) {
            $(this).addClass("hide").nextAll(".hide").removeClass("hide");
        });

        $("#campaign").on("click.page", "table.table-leaderboard.table-hover tr:not(.show-more)", function (e) {
            if (e.target.nodeName !== "A") {
                e.preventDefault();
                $(this).find(".user a").click();
            }
        });

        $("#campaign").on("click.page", "[data-assignment-code]", function (e) {
            /*
            var url = $("#assignment-url").val();
            var code = $(this).attr("data-assignment-code");
            base.redirect(url + "#" + code);
            */
        });

        $("#campaign").on("click.page", "table.menu .box.unlocked", function (e) {
            var $item = $(e.currentTarget);
            var url = $item.attr("data-url");
            var level = $item.attr("data-level");
            var state = $S("campaign-content").getState();

            if (state.level === level) {
                return;
            }
            state.mission = level;
            $S("campaign-content").update({
                level: level
            });

            if (Surface.ajaxNavigation.html5history) {
                history.pushState({ url: url, initial: false}, "", url);
            }
            updateLeaderboards();
            showImageOnLoad();
        });
    });

}(jQuery, window));
;/**
 * ServerBrowser
 *
 * @dependency jquery.esn.pagebind.js
 * @dependency jquery.stickyelement.js
 * @dependency sort.js
 * @dependency list.js
 * @dependency filters.js
 * @dependency playnowtabs.js
 */
;(function ($, window, undefined) {

    // Name of component
    var name = "serverbrowserwarsaw";

    // Exported variables
    var exports = {
        hasPluginAndGame: false,
        filterSearchTimeout: false,
        activeScoreboard: false,
        serverHighlightIndex: 0,
        invitesTimeout: 0,
        filterSurfaceTimeout: 0,
        table: null,
        tbody: null,
        currentIndex: -1
    };

    // Extend component with event emitter
    $.extend(exports, $.eventEmitter);

    /**
     * Init event
     */
    exports.on("init", function () {
        var self = serverbrowserwarsaw;
        self.game = S.globalContext["realm"]["game"];
        self.sorter.init(self);
    });

    /**
     * PageShow event
     */
    exports.on("pageshow", function () {
        var self = serverbrowserwarsaw;
        // Cache some element selectors
        self.container = $("#serverbrowser");
        self.table = self.container.find("table.servers-list");
        self.sidebar = self.container.find("aside");
        self.stickySidebar = !S.globalContext.staticContext.isTouchDevice;
        self.tbody = self.table.find("tbody");
        self.servers = self.tbody.children(".server-row");
        self.activeTab = self.container.find("nav.submenu").data("active");
        // Set default values
        self.initialLoad = true;
        self.pingServers = {};

        if (self.activeTab == "quickmatch"){
            $(".tutorial").on("click", function(e){
                e.preventDefault();
                e.stopPropagation();
                var $bn = $(e.currentTarget),
                    title = $bn.attr("data-title"),
                    video = {
                        src: $bn.attr("data-video-src"),
                        width: $bn.attr("data-video-width"),
                        height: $bn.attr("data-video-height")
                    };

                /*dialog.showVideoPlayer({
                    videoUrl: $bn.attr("data-video-src")
                });*/

                var dialog = $.dialog({
                    title: title,
                    video: video
                }, {
                    template: "dialog.videojs",
                    modal: true,
                    fade: true
                });

                var videoElement = dialog.find("video")[0];

                videojs(videoElement, { autoplay: true }, function(){
                    // Player is ready
                });

                var player = videojs(videoElement);

                dialog.on("hide", function(){
                    player.dispose();
                });
            });
            return;
        }

        self.baseHeaderHeight = $("#base-header").height();
        self.$scrollElement = $(document.body);

        var detectedBrowser = S.globalContext.staticContext.detectedBrowser;
        if (detectedBrowser.isIOS) {
            self.$scrollElement = $("#viewport");
        } else if (detectedBrowser.isIE || detectedBrowser.isFirefox) {
            self.$scrollElement = $("html");
        }

        /**
         * Toggle server favorite click handler
         * Add data-bind-toggle="favorite" and data-type="server" to element
         * It will use data-guid from itself or closest parent
         */
        $(document).on("click.serverbrowser", "[data-bind-toggle=favorite][data-type=server]", function (e) {
            e.preventDefault();
            e.stopPropagation();
            var $this = $(this);
            var guid = $this.data("guid") || $this.closest("[data-guid]").data("guid");
            var platform = $this.data("platform") || $this.closest("[data-platform]").data("platform");
            var starred = $this.hasClass("starred");
            $this.toggleClass("starred");
            self.toggleFavorite(guid, platform, function (success) {
                if (!success) {
                    $this.toggleClass("starred");
                }
            });
        });

        /**
         * Platform filter
         */
        var $platformFilter = $("#serverbrowser-platform-filter");
        $platformFilter.on("change.page.serverbrowser", function() {
            base.redirect($platformFilter.find(":selected").val());
        });

        $(document).on("keydown.serverbrowser", function(e) {
            if (e.which === 38 || e.which === 40 || e.which === 13) {
                if (!$(this).hasClass("has-modal")) {
                    if (e.which === 13) {
                        $("#serverbrowser-show [data-bind-action=join]").click();
                    } else if (self.currentIndex !== -1) {
                        e.preventDefault();
                        self.select(e.which === 40 ? self.currentIndex+1 : self.currentIndex-1, true);
                    }
                }
            }
        });

        var j = S.globalContext.join;
        if(j){
            gamemanager.joinServerByGuid(j.guid, j.platform, j.game, j.friendPersonaId, 1);
        }

        // Offset and count
        var sensitivity = 400;
        var maxLoad = 300;
        var offset = 0;
        var loading = false;
        var count = S.globalContext.staticContext.serverBrowserPageSize;

        if (self.stickySidebar) {
            // Make sidebar sticky
            self.sidebar.sticky("#serverbrowser [data-contain=sticky]", {
                offset: 112,
                fixedOffset: 16
            });
        }
        // Get servers

        if (self.activeTab) {
            self.getServers(S.globalContext.platform, offset, count, function (servers) {
                // Select first server when done
                if (servers.length) {
                    self.select(0, true);
                    self.liveScoreboard();
                }

                if (self.activeTab === "index" && S.globalContext.staticContext.isTouchDevice) {
                    // Populate on "View More" button press
                    $(document).on("click.page", "[data-bind-action='view-more-servers']", function (e) {
                        e.preventDefault();
                        if (!loading) {
                            offset += S.globalContext.staticContext.serverBrowserPageSize;
                            loading = true;
                            self.getServers(S.globalContext.platform, offset, count, function () {
                                loading = false;
                            });
                        }
                    })
                } else if (self.activeTab === "index") {
                    // Infinite scroll
                    serverbrowserwarsaw.infiniteScrollingEnabled = true;
                    $(document).on("scroll.page.serverbrowser", function (e) {
                        if (!serverbrowserwarsaw.infiniteScrollingEnabled || loading && offset <= maxLoad || !self.table.length) {
                            return;
                        }
                        var scrollTop = $(window).scrollTop();
                        var objBottom = self.table.height() + self.table.offset().top;
                        var winHeight = window.innerHeight ? window.innerHeight : $(window).height();
                        var winBtmPos = scrollTop + winHeight;
                        if (objBottom - sensitivity < winBtmPos) {
                            offset += S.globalContext.staticContext.serverBrowserPageSize;
                            loading = true;
                            self.getServers(S.globalContext.platform, offset, count, function () {
                                loading = false;
                                if (self.stickySidebar) {
                                    self.sidebar.sticky("update");
                                }
                            });
                        }
                    });
                }
            });

            // Click on server row
            $(document).on("click.page.serverbrowser", ".server-row", function (e) {
                var $target = $(e.target);
                if (!$target.hasClass("star") && !$target.hasClass("quick-join")) {
                    e.preventDefault();
                    self.select($(this).index(".server-row"), true);
                }
            });

            self.playnowtabs.init(self);

            self.filters.init(self);

            // Listen to pings
            // Update selected server box with appropriate ping when server browser is first loaded
            launcher.registerForEvent("pingResult", function (event, result) {
                //S.debug(event, result);
                self._updatePing(result);
            });

            //Make sure that recommended servers are consistent in header
            if (["index", "playnow"].indexOf(self.activeTab) !== -1) {
                base.on("recommended-servers.page.serverbrowser", function(e, data) {
                    if(!data.servers) {
                        data.servers = [];
                    }


                    if(!$("#serverbrowser-recommended-servers").length) {
                        S.debug("Found no recommended server surface...");
                        return false;
                    }


                    var state = $S("serverbrowser-recommended-servers").getState();
                    state.recommendedServers = data.servers;
                    try {
                        state.recommendedServer = data.servers[0].server;
                    } catch(err) {
                        state.recommendedServer = null;
                    }
                    state.isLoading = false;
                    state.showContent = true;
                    $S("serverbrowser-recommended-servers").refresh();
                    $("#serverbrowser-recommended-servers").find(".show-on-load").one("load", function(e){
                        $(this).removeClass("show-on-load");
                    });
                    if (self.stickySidebar) {
                        self.sidebar.sticky("update");
                    }
                    if (main.intro) {
                        main.intro.resize();
                    }
                });
                base.recommendedServersFetch();
            }
        } else {
            serverbrowserwarsaw.showPage.init();
        }

        /**
         * Manually refresh the server list
         */
        $(document).on("click.serverbrowser", "[data-bind-action=refresh-servers-global]:not(.disabled)", function (e) {
            //var count = S.globalContext.staticContext.serverBrowserPageSize;
            self.getServers(S.globalContext.platform, offset, count, function (servers) {
                // Select first server when done
                if (servers.length) {
                    self.select(0, true);
                    self.liveScoreboard();
                }
            });
        });

        if (S.globalContext.npsActive) {
            var dialog = $.dialog({ }, { template: "dialog.bfhnps" });
            dialog.on("show", function (e, d) {
                dialog.find("label").on("click", function () {
                    $.post(Surface.Modifier.urlformat('/{_section}/{_language}/survey/', Surface.urlContext, null), {
                        vote: dialog.find("input:checked").val(),
                        survey: "game_client"
                    }).done(function(e){
                        dialog.find(".step-1").hide();
                        dialog.find(".step-2").show();
                    });
                });
            });
        }
    });

    /**
     * PageLeave event
     */
    exports.on("pageleave", function () {

        // Unbind events
        $(document).add("[data-bind-toggle=favorite][data-type=server]").off(".serverbrowser");
        if (this.filters.regionFilter && this.filters.regionFilter.length) {
            this.filters.regionFilter.dialog("destroy");
        }
        launcher.cancelPingServers();
    });

    var idx = 0;
    var pingServers = {};

    /**
     * Select server in server list
     * @param idx
     * @param updateData
     * @param liveScoreboard
     * @returns {*}
     */
    exports.select = function (idx, updateData, liveScoreboard) {
        updateData = !!updateData;
        var self = serverbrowserwarsaw;
        self.servers = self.tbody.children(".server-row");
        if (!self.servers.length) {
            return;
        }
        if (idx === -1) {
            idx = self.servers.length - 1;
        } else if (idx > (self.servers.length - 1)) {
            idx = 0;
        }
        var server;
        if (idx === "first" || idx === "last") {
            server = self.servers.filter(":" + idx);
        } else {
            server = self.servers.eq(idx);
        }
        server.addClass("active").siblings(".active").removeClass("active");

        if (self.stickySidebar && updateData) {
            self.sidebar.sticky("update");
        }

        var guid = server.data("guid");
        var game = server.data("game") || S.globalContext.realm.game;
        var platform = server.data("platform");

        // Friends playing on server
        var friendsOnServer = comcenter.getFriendsPlayingOnServer(guid);

        // Update server info
        var url = self.function_numPlayersUrl(guid, game, platform);
        if (updateData) {
            // Do a non-update select first to show something before data is loaded.
            self.select(idx, false);
            server.addClass("loading-info");

            if (self._updateRequest && typeof self._updateRequest.abort !== "undefined") {
                self._updateRequest.abort();
            }
            self._updateRequest = $.getJSON(url).always(function(response, status) {
                server.removeClass("loading-info");
                if (status === "success") {
                    var sdata = server.data("server");
                    var ping = (server.find(".ping").text()).trim();
                    sdata.slots = response.slots;
                    sdata.map = response.map;
                    sdata.mapMode = response.mapMode;
                    var context = {
                        server: sdata,
                        ping: ping || "-",
                        isFavorite: S.globalContext.favGuids.indexOf(guid) !== -1,
                        friendsOnServer: friendsOnServer,
                        formEnabled: 0,
                        mapinfo: $S.callFunction("common.mapinfo", game, response.map),
                        iteration: server.data("idx")
                    };
                    var template = $S("serverbrowserwarsaw.serverrow");
                    var row = server.html($(template.render(context)).children())
                        .data("friends", friendsOnServer)
                        .data("mapinfo", context.mapinfo);

                    $S("serverbrowser-show").setState(context);
                    $S("serverbrowser-show").refresh();

                    // Re-ping server
                    var pingServer = {};
                    pingServer[sdata.guid] = sdata.ip;
                    launcher.pingServers(pingServer);

                    // Update live score
                    self.liveScoreboard();

                    $("#serverbrowser-show .server-info").fadeIn("slow");

                }
            });
        } else {
            var context = {
                server: server.data("server"),
                ping: server.find(".ping").text() || "-",
                isFavorite: S.globalContext.favGuids.indexOf(guid) !== -1,
                friendsOnServer: friendsOnServer,
                formEnabled: 0,
                mapinfo: server.data("mapinfo"),
                iteration: server.data("idx")
            };
            $S("serverbrowser-show").setState(context);
            $S("serverbrowser-show").refresh();
        }
        self.currentIndex = server.index(".server-row");
        return server;
    };

    exports.reportServer = function(id, type){
        if(confirm("このサーバーを報告しますか？")){
            var rep = "";
            switch(type){
                case 2: rep = "Report boosting"; break;
                case 3: rep = "Report content"; break;
            }

            if(rep){
                $.ajax( { url: "/bf4/serverbrowserwarsaw/reportserver",
                dataType: "json",
                type: "POST",
                data: {
                    guid: id,
                    reason: rep,
                    "post-check-sum": S.globalContext.session.postChecksum
                }}).complete(function(){
                    $.ga.trackServerReportEvent(rep);
                    base.showReceipt("報告を送信しました", "checkbox");
                }, false);
            }
        }
        $(".common-reportbutton-container").removeClass("active");
    };

    /**
     * Select first server in list
     */
    exports.selectFirstServer = function () {
        var self = serverbrowserwarsaw;
        self.select(0);
    };

    /**
     * Toggle favorite
     * @param guid
     * @param cb
     */
    exports.toggleFavorite = function (guid, platform, cb) {
        S.debug("Toggling favorite for", guid);
        var url = serverbrowserwarsaw.function_addFavoriteServerUrl();
        if (!cb) {
            cb = function () {
            };
        }
        $.ajax({
            url: url,
            dataType: "json",
            type: "POST",
            data: {
                guid: guid,
                platform: base.function_platform(platform).toLowerCase(),
                "post-check-sum": S.globalContext.session.postChecksum
            }
        }).complete(
                base.onComplete(function (success, response) {
                    if (success) {
                        if (self.activeTab === "favourites") {
                            self.tbody.children("[data-guid=" + guid + "]").remove();
                        }
                        if (response.message == "GAMESERVERBOOKMARK_REMOVED") {
                            base.showReceipt("サーバーをお気に入りから外しました", "checkbox");
                        } else {
                            base.showReceipt("サーバーをお気に入りに追加する", "checkbox");
                        }
                        S.globalContext.favGuids.push(guid);
                        cb(true);
                    } else {
                        cb(false);
                    }
                }, false)
            );
    };

    /**
     * Update ping
     */
    var pingbar = $S("ui.pingbar");
    exports._updatePing = function (result, refresh) {
        var self = serverbrowserwarsaw;
        if (self.activeTab) {
            $.each(result, function (serverId, ping) {
                var server = self.servers.filter("[data-guid="+serverId+"]");
                try {
                    var html = pingbar.render({ ping: parseInt(ping, 10) < 0 ? "-" : ping});
                } catch (e) {
                    S.error(e);
                }
                server.data("ping", ping).find(".ping").html(html);
            });
            if (refresh) {
                self.sorter.refresh();
            }
        }
    };

    /**
     * Callback that render servers to the list
     */
    exports._renderServers = function (servers, offset, cb) {
        var self = serverbrowserwarsaw;
        var playingFriends = comcenter.getFriendsPlaying();
        var template = $S("serverbrowserwarsaw.serverrow");
        var rows = [];
        if (!servers || !servers.length) {
            serverbrowserwarsaw.infiniteScrollingEnabled = false;
            if (offset === 0) {
                $("#results-container").hide();
                $("#no-results").show();
            }
        } else {
            serverbrowserwarsaw.infiniteScrollingEnabled = true;
            $("#results-container").show();
            $("#no-results").hide();
            for (var i = 0, server, mapinfo, friendsOnServer; i < servers.length; i++) {
                server = servers[i];
                mapinfo = $S.callFunction("common.mapinfo", server.game, server.map);
                friendsOnServer = playingFriends[server.guid];

                // Add server to ping list
                self.pingServers[server.guid] = server.ip;

                // This is used for sorting
                server.mapModeString = $S.callFunction(
                    "serverbrowserwarsaw.gameServerModeStringLocalized",
                    server.mapMode,
                    server.game
                );

                var context = {
                    idx: i,
                    server: server,
                    ping: "-",
                    isFavorite: S.globalContext.favGuids.indexOf(server.guid) !== -1,
                    friendsOnServer: friendsOnServer,
                    formEnabled: 0,
                    mapinfo: mapinfo,
                    iteration: parseInt(idx, 10) + 1
                };

                var rowElement = $(template.render(context))
                    .attr("data-guid", server.guid)
                    .data("idx", i)
                    .data("friends", friendsOnServer)
                    .data("server", server)
                    .attr("data-game", server.game)
                    .attr("data-platform", server.platform)
                    .attr("data-role", gameServerRoleTypes.SOLDIER)
                    .data("mapinfo", mapinfo)
                    .data("ping", "-");

                var existingServer = self.tbody.find("[data-guid="+server.guid+"]");
                if (existingServer.length) {
                    existingServer.replaceWith(rowElement);
                } else {
                    rows.push(rowElement);
                }
            }
            self.tbody.append.apply(self.tbody, rows);
            self.servers = self.tbody.children(".server-row");
            if (offset === 0) {
                self.trigger("list:init");
            } else {
                self.trigger("list:added");
            }
        }
        self.table.removeClass("loading");
        if (typeof cb === "function") {
            cb(self.servers);
        }
        launcher.pingServers(self.pingServers);
    };

    /**
     * Get servers and populate server list
     * @param platform
     * @param offset
     * @param count
     * @param cb
     * @param addParams
     */
    exports.getServers = function (platform, offset, count, cb, addParams) {
        addParams = addParams || "";
        var self = serverbrowserwarsaw;
        var url = self.function_getServersUrl(platform);
        var urlParts = Surface.ajaxNavigation.getCurrentUrl().split("?");
        if (urlParts[1] == undefined) {
            urlParts = Surface.ajaxNavigation.getCurrentUrl().split("%3F");
        }
        addParams += urlParts.length > 1 ? ("&" + urlParts[1]) : "";

        if (self.activeTab === "favourites") {
            addParams += "&favorites=1";
        } else if (self.activeTab === "history") {
            addParams += "&history=1";
        }

        // On initial load we have the first response stored in globalContext
        if (self.initialLoad) {
            self.initialLoad = false;
            self._renderServers(S.globalContext.servers, offset, cb);

        } else {
            var loading = setTimeout(function(){
                self.table.addClass("loading");
            }, 150);
            $.get(url + "?offset=" + offset + "&count=" + count + addParams).done(function (response) {
                clearTimeout(loading);
                self._renderServers(response.data, offset, cb);
            });
        }
    };

    /**
     * Update the server page and scoreboard with current live data
     */
    exports.updateServerScoreboard = function () {
        var guid = $("#server-guid").attr("value");
        var url = $("#serverbrowser-show-url").val().replace("%GUID%", guid);

        base.ajaxGetJson(url, function (success, response) {
            if (success) {
                var serverinfo = response['message']['SERVER_INFO'];
                $S("serverbrowser-scoreboard").update({ "scoreboard": serverinfo });
            }
        });
    };

    /**
     * Continuous live updating of the scoreboard. This function calls itself.
     */
    exports.liveUpdateServerScoreboard = function () {
        var self = serverbrowserwarsaw;
        self.updateServerScoreboard();
        self.activeScoreboard = setTimeout(self.liveUpdateServerScoreboard, 5000);
    };

    /**
     * Stop live updating the server scoreboard
     */
    exports.stopUpdateServerScoreboard = function () {
        var self = serverbrowserwarsaw;
        clearTimeout(self.activeScoreboard);
    };

    /**
     * Live Scoreboard
     */
    exports.liveScoreboard = function () {
        var self = serverbrowserwarsaw;
        var $dataContainer = $("#serverguide-show, #serverbrowser-show").find("div.hidden-server-data");

        var server = {
            ip: $dataContainer.data("ip"),
            gameId: $dataContainer.attr("data-gameid"),
            port: $dataContainer.data("port"),
            game: $dataContainer.data("game"),
            mapMode: $dataContainer.data("map-mode"),
            guid: $dataContainer.data("guid"),
            platform: $dataContainer.data("platform")
        };

        if (base.liveScoreboardEnabled(server.game, server.platform)) {
            var update = "";
            launcher.queryServer(server, function(queryInfo) {
                switch (queryInfo.status) {
                    case "OK":
                        // 205 is a bug that will make the scoreboard look bad
                        if ((queryInfo.result.teams.length > 0) && (queryInfo.result.teams[0].status.teamId == 205)) {
                            update = { "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_NO_DATA" };
                        } else if (queryInfo.result.isEoR) {
                            update = { "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_NO_DATA" };
                        } else {
                            update = { "scoreboard": queryInfo };
                        }
                    break;

                    case "NOT_SUPPORTED":
                        update = { "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_NOT_SUPPORTED" };
                    break;

                    case "NO_PLUGIN":
                        update = { "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_NO_PLUGIN" };
                    break;

                    case "TIMEOUT":
                        update = { "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_TIMEOUT" };
                    break;

                    case "ROUND_NOT_STARTED":
                        update = { "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_ROUND_NOT_STARTED" };
                    break;

                    case "KEEPER_DISABLED":
                        // Doesn't need translation; only used internally
                        update = { "errormessage": "Keeper is not configured on this environment" };
                    break;

                    default:
                        update = { "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_UNKNOWN_ERROR" };
                    break;
                }
                $S("selected-server-scoreboard").update(update);

                if (S.globalContext.realm.section === sections.BFH){
                    $("#selected-server-scoreboard .progress-bar.animate").progressbar();
                }
            });
        } else {
            $S("selected-server-scoreboard").update({
                "errormessage": "ID_WEB_SERVERGUIDE_SCOREBOARD_NOT_SUPPORTED"
            });
        }
    };

    /**
     * Invite to server
     */
    exports.inviteToServer = function (userId, guid) {
        var params = {"userId": userId, "guid": guid};
        var url = Surface.Modifier.urlformat('/{_section}/{_language}/comcenter/inviteToServer/', Surface.urlContext, params);
        base.ajaxPostJson(url, function (success, response) {
            if (success) {
                S.debug(response);
            }
        });
    };

    /**
     * ScrollTo
     * @param elm
     * TODO: Move this to separate plugin
     */
    exports.scrollTo = function (elm) {
        var scrollTop = $(elm).offset().top - 250;
        $(document.body).animate({ scrollTop: scrollTop }, 200);
    };

    // Export to S.C and window
    if (!S.C) { S.C = {}; }
    S.C[name] = exports;
    window[name] = S.C[name];
}(jQuery, window));;;(function ($, window, undefined) {

    var serverbrowserShow = {
        activeScoreboard: 0,
        liveScoreboardStorage: [],

        init: function () {
            serverbrowserShow.serverShowPlayersSelector();
            $("#serverbrowser-show-favorite").pageLive("click", function () {
                $(this).hide();
                $("#serverbrowser-show-favorite-loader").show();
                var form = $(this).children("form");

                $.ajax({
                    url: form.attr("action"),
                    dataType: "json",
                    type: "POST",
                    data: form.serialize()
                }).always(
                    base.onComplete(function (success, response) {
                        if (success) {
                            surf.update({"isFavorite": response.message == "GAMESERVERBOOKMARK_ADDED"});
                        } else {
                            surf.refresh();
                        }
                    }, false)
                );
            });

            function refreshPing () {
                var doPingServer = function(plugin) {
                    // Don't try to ping if the user doesn't have the plugin installed
                    if (!plugin) {
                        S.debug("No launcher instance");
                        return;
                    }

                    function pingResult(event, result) {
                        launcher.unregisterForEvent('pingResult', pingResult);
                        $.each(result, function (serverId, ping) {
                            if (serverId === ip && ping >= 0) {
                                var ping = parseInt(ping, 10) < 0 ? "-" : ping;
                                $S("serverbrowser-show-info-ping").update({"server": { "ping": ping }});
                            }
                        });
                    }

                    launcher.registerForEvent("pingResult", pingResult);

                    var pingServer = {};
                    var ip = $("#server-page").data("ip");
                    pingServer[ip] = ip;
                    launcher.pingServers(pingServer);
                    // Lets ping again in 10 secs
                    setTimeout(refreshPing, 10000);
                };

                if(launcher.useOriginLaunch()) {
                    return doPingServer(true);
                } else {
                   return launcher.getInstance(doPingServer);
                }


            }

            setTimeout(function(){
                refreshPing();
            }, 1000);

            $("#serverbrowser-show-refresh").pageLive("click", function () {
                refreshPing();
            });

            var setLiveUpdateStatus = function (status) {
                if (status) {
                    $("#live-selector-off").removeClass("selected");
                    $("#live-selector-on").addClass("selected");
                    serverbrowserShow.liveUpdateServerScoreboard();
                } else {
                    $("#live-selector-on").removeClass("selected");
                    $("#live-selector-off").addClass("selected");
                    clearTimeout(serverbrowserShow.activeScoreboard);
                    serverbrowserShow.activeScoreboard = 0;
                }
            };

            $("#live-selector li").pageLive("click", function (e) {
                var update_status = ($(this).attr("id") == "live-selector-on");
                window.location.hash = (update_status) ? "live" : "";
                setLiveUpdateStatus(update_status);
            });

            // Warsaw live selector switch (checkbox)
            $("#serverbrowser-edit-livescoreboard").pageLive("change", function (e) {
                var update_status = $(this).is(":checked");
                window.location.hash = (update_status) ? "live" : "/";
                setLiveUpdateStatus(update_status);
            });

            // Check if live-update is turned on through hash
            if (new RegExp("live").test(window.location.hash)) {
                setLiveUpdateStatus(true);
            }
            if (serverbrowserShow.activeScoreboard) {
                window.location.hash = "live";
            }

            // Make sure the live-update status is passed along when the scoreboard is refreshed
            $(".serverbrowser-header-refresh-button a").on("click", function () {
                $(this)[0].hash = (serverbrowserShow.activeScoreboard) ? "live" : "";
            });

            serverbrowserShow.highlightSquads();
            $("#server-page-map-rotation .scroll-area").jScrollPane();
        },

        serverShowPlayersSelector: function () {
            var $joinMpServerButton = $("#server-page-join-buttons");
            var server = {
                game: $joinMpServerButton.data("game"),
                platform: $joinMpServerButton.data("platform")
            };

            if (base.liveScoreboardEnabled(server.game, server.platform)) {
                serverbrowserShow.liveScoreboardStorage = [];
                serverbrowserShow.updateServerScoreboard();
            } else {
                $S("serverbrowser-scoreboard").update({ "showplayers": "true" });
            }
        },

        /**
         * Update the server page and scoreboard with current live data
         */
        updateServerScoreboard: function () {
            var $joinMpServerButton = $("#server-page-join-buttons");
            var server = {
                ip: $joinMpServerButton.data("ip"),
                gameId: $joinMpServerButton.attr("data-gameid"),
                port: $joinMpServerButton.data("port"),
                game: $joinMpServerButton.data("game"),
                guid: $joinMpServerButton.data("guid")
            };

            launcher.queryServer(server, function(queryInfo) {
                if (queryInfo.status !== "UNKNOWN_ERROR" && queryInfo.result) {
                    var teams = queryInfo.result.teams;
                    var gameMode = queryInfo.result.gameMode;
                    var liveUpdating = false;

                    // TODO: Remove this hack when it's been fixed in the plugin
                    // Hack to remove the two extra teams from TDM
                    if (gameMode === 32 && teams.length > 2) {
                        teams.splice(2);
                    }

                    if (serverbrowserShow.activeScoreboard) {
                        // If there's an active setTimeout,
                        // send variable liveUpdating to template to show the correct state
                        liveUpdating = true;
                    }
                    $S("serverbrowser-scoreboard").update({
                        "scoreboard": queryInfo,
                        "liveupdating": liveUpdating
                    });

                    // If a team have number 205, game is in EOR or restarting,
                    // so we just don't refresh
                    var isNotTeamId205 = teams && teams[0] && teams[0].status && teams[0].status.id != 205;
                    if (teams && isNotTeamId205) {
                        for (var team in teams) {
                            for (var player in teams[team].players) {
                                var playerData = JSON.stringify(teams[team].players[player]);
                                var playerId = teams[team].players[player].personaId;

                                if (serverbrowserShow.liveScoreboardStorage[playerId] != playerData) {
                                    $("#p-" + playerId).animate({ backgroundColor: "#ffe6a1" }, "slow", function () {
                                        $(this).animate({ backgroundColor: "#FFF" }, "slow", function () {
                                            // When the animation is done,
                                            // reset background color to enable hover highlights again
                                            $(this).css("background-color", "");
                                        });
                                    });
                                    serverbrowserShow.liveScoreboardStorage[playerId] = playerData;
                                }
                            }
                        }
                    } else {
                        $("#serverbrowser-scoreboard table").addClass("locked");
                    }
                } else {
                    // Live Scoreboard is not supported and we'll show the list of players instead
                    $S("serverbrowser-scoreboard").update({ "showplayers": "true" });
                }
            });
        },

        liveUpdateServerScoreboard: function () {
            clearTimeout(serverbrowserShow.activeScoreboard);
            serverbrowserShow.updateServerScoreboard();
            serverbrowserShow.activeScoreboard = setTimeout(serverbrowserShow.liveUpdateServerScoreboard, 6000);
        },

        /**
         * Highlight players squad members when user hovers on a player
         */
        highlightSquads: function () {
            $(document).on("mouseenter mouseleave", "#serverbrowser-scoreboard tbody tr",function (e) {
                if (e.type === "mouseleave") {
                    $("#serverbrowser-scoreboard .squad-box").removeClass("active");
                } else {
                    var squad = $(this).attr("class");
                    $("#serverbrowser-scoreboard ." + squad).find(".squad-box").addClass("active");
                }
            });
        }
    };

    serverbrowserwarsaw.showPage = serverbrowserShow;

}(jQuery, window));
;;(function ($, window, document, undefined) {

    var ASC = false;
    var DESC = !ASC;

    serverbrowserwarsaw.sorter = {
        surfaceIds: [],
        sortings: [],

        /**
         * Init
         * @param browser
         */
        init: function (browser) {
            var self = this;
            self.initialized = false;
            self.browser = browser;

            self.browser.on("pageshow.sort", function (e) {
                // Defaults
                self.currentKey = "name";
                self.currentReverse = false;
                self.initialized = true;

                self.table = self.browser.table;
                self.tbody = self.browser.tbody;
                self.toggles = self.table.find("[data-sort]");
                self.refreshSortings();
                self.setupSort();
                self.refresh();
            });
        },

        /**
         * Refresh sortings
         */
        refreshSortings: function () {
            /* Object with sortable columns
             defaultOrder: default sort order
             sortFunc: function to return sort value from surface state] */
            this.sortings = {
                recentlyPlayed: {
                    defaultOrder: DESC,
                    dataType: "idx",
                    sortFunc: function (data) {
                        return -(data);
                    }
                },
                friend: {
                    defaultOrder: DESC,
                    dataType: "friends",
                    sortFunc: function (data) {
                        return (data) ? data.length : 0;
                    }
                },
                name: {
                    defaultOrder: ASC,
                    dataType: "server",
                    sortFunc: function (data) {
                        return data.name.toLowerCase();
                    }
                },
                players: {
                    defaultOrder: DESC,
                    dataType: "server",
                    sortFunc: function (data) {
                        // TODO: Use proper enums for GameServerSlotType.SOLDIER
                        return data.slots[2].current + data.slots[2].max / 1000;
                    }
                },
                map: {
                    defaultOrder: ASC,
                    dataType: "mapinfo",
                    sortFunc: function (data) {
                        return data.name.toLowerCase();
                    }
                },
                mode: {
                    defaultOrder: ASC,
                    dataType: "server",
                    sortFunc: function (data) {
                        return data.mapModeString.toLowerCase();
                    }
                },
                ranked: {
                    defaultOrder: DESC,
                    dataType: "server",
                    sortFunc: function (data) {
                        return (data.ranked + data.serverType);
                    }
                },
                punkbuster: {
                    defaultOrder: DESC,
                    dataType: "server",
                    sortFunc: function (data) {
                        return data.punkbuster;
                    }
                },
                type: {
                    defaultOrder: ASC,
                    dataType: "server",
                    sortFunc: function (data) {
                        return data.preset === 2 ? 1337 : data.preset;
                    }
                },
                ping: {
                    defaultOrder: ASC,
                    dataType: "ping",
                    sortFunc: function (data) {
                        data = parseInt(data, 10);
                        return data ? data : 9999;
                    }
                }
            };
        },

        /**
         * Refresh sort
         */
        refresh: function () {
            this.sort(this.currentKey, this.currentReverse);
        },

        /**
         * Setup sort
         */
        setupSort: function () {
            var self = this;
            var sortings = self.sortings;
            var divider = $(".serverbrowser-autobrowse-divider");

            self.toggles.each(function(){
                var $this = $(this);
                $this.on("click.page.serverbrowser", function (e) {
                    e.preventDefault();
                    var key = $this.data("sort");
                    var sorting = sortings[key];
                    var direction;

                    if (divider.length) {
                        divider.remove();
                    }

                    /* This is not already sorted, use the default sort order */
                    if (!$this.hasClass("sort-asc") && !$this.hasClass("sort-desc")) {
                        direction = sorting.defaultOrder;
                    } else {
                        direction = !$this.hasClass("sort-asc") || $this.hasClass("sort-desc");
                    }

                    // Perform sort
                    self.sort(key, direction);

                    // Store current search value in local storage
                    $.browserStorage.set("serverbrowser.sort", [key, direction]);
                });
            });

            // Set current sorting from local storage
            var ls = $.browserStorage.get("serverbrowser.sort");
            if (ls) {
                self.currentKey = ls[0];
                self.currentReverse = ls[1];
            }
        },

        /**
         * Sort
         * @param key
         * @param reverse
         */
        sort: function (key, reverse) {
            this.currentSort = key;
            this.currentReverse = reverse;

            this.toggles
                .removeClass("sort-asc sort-desc")
                .filter("[data-sort="+key+"]")
                .addClass("sort-" + (reverse ? "asc" : "desc"));
            this.table.data("sortedBy", key);
            this.rows = this.tbody.children(".server-row");

            if (this.sortings.hasOwnProperty(key) && this.sortings[key] !== undefined) {

                var sortFunc = this.sortings[key].sortFunc;
                var dataType = this.sortings[key].dataType;

                this.rows.sort(function (a, b) {

                    var $a = $(a);
                    var $b = $(b);

                    var valA = sortFunc($a.data(dataType));
                    var valB = sortFunc($b.data(dataType));

                    typeof valA === 'undefined' && typeof valB === 'string' && (valA = '');
                    typeof valB === 'undefined' && typeof valA === 'string' && (valB = '');
                    typeof valA === 'undefined' && typeof valB === 'undefined' && (valA = 9999, valB = 9998);

                    if (valA === "-") {
                        valA = 9999;
                    }

                    if (valB === "-") {
                        valB = 9998;
                    }

                    var cmp = a > b ? 1 : -1;
                    /* Never return 0 since Array.sort in chrome/mozilla is not stable */
                    if (valA > valB) {
                        cmp = 1;
                    }
                    else if (valA < valB) {
                        cmp = -1;
                    }

                    return cmp;
                });

                if (reverse) {
                    this.rows = $(this.rows.get().reverse());
                } else {
                    this.rows = $(this.rows.get());
                }

                this.tbody.append(this.rows);
            }
            // Update servers container
            this.browser.servers = this.tbody.children(".server-row");
        }
    };

}($, window, document));;/**
 * FilterControl
 * @dependency jquery.esn.pagebind.js
 */
;
(function ($, window, document, undefined) {

    var pluginName = "filterControl",
        defaults = {
            // Which input elements to include
            inputElements: "select, :checkbox",
            // Which filter items to ignore
            ignoreClick: ".ignore",
            // What to do on click
            onClick: null
        };

    /**
     * Plugin constructor
     * @param elm
     * @param options
     */
    function FilterControl(elm, options) {
        this.options = $.extend({}, defaults, options);
        this.element = $(elm);
        this.items = $("li", this.element);
        this.init();
    }

    /**
     * Init plugin
     */
    FilterControl.prototype.init = function () {
        var self = this;

        // Loop through each filter item
        self.items.each(function () {
            var filter = $(this),
                input = filter.find(self.options.inputElements);

            if (input.length === 0) {
                return;
            }

            var opts = filter.find("option"),
                label = filter.find("label"),
                type = input[0].type;

            // Remove default behavior from label
            label.on("click.page.filtercontrol", function (e) {
                e.preventDefault();
            });

            // Bind to input change to reflect programmatical changes
            input.on("change.page.filtercontrol",function () {
                // Get new state
                // On/off for selects, on/empty for checkbox
                var state = (this.checked || (type !== "checkbox" && this.value == 1)) ?
                    "On" : ((type !== "checkbox" && this.value == 0) ? "Off" : "");

                // Set filter class based on state
                filter.removeClass("on off").addClass(state.toLowerCase());

                // Trigger filterchange
                self.element.trigger({
                    type: "filterchange",
                    label: label.text(),
                    target: this,
                    value: state
                });
            }).trigger("change");

            // Set provided onClick function or use default
            self.onClick = typeof self.options.onClick === "function" ? self.options.onClick : function (e) {
                e.preventDefault();
                var currIdx, newVal, nextIdx;
                switch (type) {
                    // Checkbox
                    case "checkbox":
                        newVal = input[0].checked ? "" : "On";
                        input[0].checked = !input[0].checked;
                        break;
                    // Select
                    case "select-one":
                        currIdx = input[0].selectedIndex;
                        currIdx = currIdx === -1 ? 0 : currIdx;
                        nextIdx = currIdx + 1 === opts.length ? 0 : currIdx + 1;
                        newVal = input.find("option").eq(nextIdx).attr("value");
                        input.val(newVal);
                        opts.removeAttr("selected").eq(nextIdx).attr("selected", true);
                        break;
                }
                // Trigger change event on input
                input.trigger("change");
            };

            // Bind onClick handler
            filter.not(self.options.ignoreClick).on("click.page.filtercontrol", self.onClick);
        });

        $(self.element).on('keyup.page.filtercontrol', 'input[type="text"]', function () {
            self.element.trigger({
                type: "filterchange",
                label: $(this).attr('placeholder') || $(this).attr('name'),
                value: $(this).val()
            });
        });
    };

    /**
     * Destroy plugin
     */
    FilterControl.prototype.destroy = function () {
        this.items.each(function () {
            var filter = $(this),
                input = filter.find(":input"),
                type = input[0].type;

            input.unbind(".filtercontrol");

            filter.unbind(".filtercontrol")
                .removeClass("on off");
        });
        this.element.removeData("filtercontrol");
    };

    /**
     * Plugin wrapper
     * @param options
     */
    $.fn[pluginName] = function (options) {
        return this.each(function () {
            var lcName = pluginName.toLowerCase();
            if (!$.data(this, lcName)) {
                $.data(this, lcName, new FilterControl(this, options));
            }
        });
    };

    // Instantiate based on markup
    $(function () {
        $("[data-filtercontrol]").filterControl();
    });

}(jQuery, window, document));
;;(function ($this$, window, undefined) {

    var regionCache = null;

    serverbrowserwarsaw.filters = {

        /**
         * Init
         * @param browser
         */
        init: function (browser) {
            var self = this;

            self.browser = browser;

            self.container = $("#serverbrowser-filters");
            self.filtersContainer = self.container.find(".filters-container");
            self.content = self.container.children(".box-content");

            self.filters = self.container.find("section.filter");
            self.filterToggle = self.container.find(".toggle");
            self.advancedToggle = self.container.find(".button-row").find('.toggle-advanced');
            self.resetToggle = self.container.find(".button-row").find('.reset-filters');
            self.filterCols = self.container.find(".filter-col");

            self.searchInput = self.container.find("#serverbrowser-search-input");
            self.resetButton = self.container.find(".serverbrowser-reset-filter-button");
            self.refreshButton = self.container.find(".serverbrowser-refresh");

            self.filterString = $S("serverbrowser-filterstring");

            // Setup selectors
            self.selectors = {
                regionFilter: ".region-server-filter",
                regionFilterOpen: "#serverguide-open-region-link",
                regionFilterShow: ".serverbrowser-region-filter-show"
            };

            self.advFilter = [];
            self.regionFilter = [];

            self.initSearchField();
            self.initGuideFilters();
            self.renderFilterHeader();
            self.greyOutGameSelectionMaps();
            self.bindEventHandlers();

            // Reset region cache
            regionCache = null;
        },

        /**
         * Reset filters
         * @param element
         */
        resetFilters: function (element) {
            gamemanager._deleteMatchmakingFilter(S.globalContext["realm"]["game"]);
            $(".serverbrowser-selectable.serverbrowser-include").removeClass(".serverbrowser-include").click();
            this.searchInput.val("");
            S.globalContext.searchQuery = "";
            this.filterString.update({ searchQuery: false });
            var resetUrl = $(element).attr("href");
            base.redirect(resetUrl);
        },

        /**
         * Show region filter
         * @param existingRegions
         */
        showRegionFilterDialog: function (existingRegions, noShow) {
            var self = this;
            if (this.regionFilter.length) {
                this.regionFilter.dialog("show");
            } else {
                var dialog = $.dialog({
                    title: "地域フィルター設定",
                    existingRegions: existingRegions,
                    regionFilters: S.globalContext.filterRegionSettings,
                    countryFilters: S.globalContext.filterCountrySettings
                }, {
                    template: "dialog.serverbrowserregionfilter",
                    destroyOnHide: false
                });

                dialog.on("ok", function (e, d) {
                    // Cache selectors
                    var c = $(".region-server-filter");
                    var elems = {
                        filterRegions: $("#filter-regions-input"),
                        filterCountries: $("#filter-countries-input"),
                        inputRegions: $("#serverbrowser-filter-regions-input"),
                        inputCountries: $("#serverbrowser-filter-countries-input"),
                        checkboxes: $("#serverguide-region-settings-checkbox"),
                        useLoc: $("#serverbrowser-filter-use-location"),
                        locationPopupAnchor: $("#serverguide-open-region-link")
                    };

                    // Overwrite cache with new state
                    regionCache = $S("serverbrowser-region-filter").getState().existingRegions;

                    try {
                        var regions = elems.filterRegions.val();
                        elems.inputRegions.val(regions);
                        var countries = elems.filterCountries.val();
                        elems.inputCountries.val(countries);

                        elems.checkboxes.addClass("on").removeClass("off ignore");

                        S.globalContext.filterRegionSettings = regions !== "" ? regions.split("|") : [];
                        S.globalContext.filterCountrySettings = countries !== "" ? countries.split("|") : [];

                        $("#serverbrowser-region-filter input:not([name=custom])").prop("disabled", true);

                        if (S.globalContext.filterRegionSettings.length === 0);

                        $S("serverguide-open-region-link").update({
                            filterCountrySettings: S.globalContext.filterCountrySettings
                        });

                        if (S.globalContext.filterCountrySettings.length === 0) {
                            // Uncheck the custom checkbox if there's no countries selected
                            $("#serverbrowser-region-filter input[name=custom]")
                                .prop("checked", false).trigger("change");
                        }

                        var html = "";
                        $.each(S.globalContext.filterCountrySettings, function(i,r) {
                            html += "<input type='hidden' name='country' value='"+r+"'>";
                        });
                        $(".countrycustom").html(html);

                    } catch (err) {
                        S.debug("Could not save region filter:", err.stack);
                    }
                    self.renderFilterHeader();
                });

                dialog.find(".serverbrowser-regionfilter-selectable, .serverbrowser-regionfilter-selectable-selectall").each(function () {
                    var filter = $(this).attr("filter");
                    if (!filter) {
                        return;
                    }

                    $(this).off("mousedown").pageBind("mousedown", function (e) {
                        var $this = $(this);

                        if ($this.hasClass("serverbrowser-disabled")) {
                            return;
                        }

                        var isSelected = $this.hasClass("serverbrowser-include");
                        var isSelected2 = $this.hasClass("serverbrowser-noinclude");

                        var isMultiSelectable = $this.hasClass("serverbrowser-selectable-multi");

                        var checked = 0;

                        if (isSelected || isSelected2) {
                            $this.removeClass('serverbrowser-include');
                            checked = 0;

                            if (isMultiSelectable && !isSelected2) {
                                $this.addClass('serverbrowser-noinclude');
                                checked = 2;
                            } else {
                                $this.removeClass('serverbrowser-noinclude').addClass('serverbrowser-exclude');
                                checked = 0;
                            }
                        } else {
                            $this.removeClass('serverbrowser-exclude').addClass('serverbrowser-include');
                            checked = 1;
                        }

                        var value = $this.attr("value");

                        if (isMultiSelectable) {
                            var selectOptions = value.split(",");
                            value = (checked === 1 ? selectOptions[0] : (checked === 2 ? selectOptions[1] : null));
                        }

                        var inp;
                        if (filter=="countries") {
                            inp =  $("#filter-countries-input");
                        } else if (filter=="regions") {
                            inp =  $("#filter-regions-input");
                        } else {
                            inp = $("input[name=" + filter + "]");
                        }

                        var elements = inp.val().split("|");
                        if (inp.val() == "") {
                            elements = [];
                        }
                        if (isSelected && !isMultiSelectable) {
                            var index = $.inArray(value, elements);
                            if (index > -1) {
                                elements.splice(index, 1);
                            }
                        } else if (isMultiSelectable) {
                            elements = [value];
                        } else {
                            elements.push(value);
                        }

                        inp.val(elements.join("|"));

                        var subselection = 0;

                        if (!$this.hasClass("serverbrowser-regionfilter-selectable-selectall")) {
                            var numSiblings = $(this).siblings().length;
                            $this = $(this);
                            var len = $this.siblings(".serverbrowser-regionfilter-selectable.serverbrowser-include").length;
                            var i = ($this.is(".serverbrowser-include") ? 1 : 0) + len;

                            subselection += i;

                            if ((i == numSiblings && $this.siblings(".serverbrowser-regionfilter-selectable-selectall").hasClass("serverbrowser-exclude"))) {
                                $this.siblings(".serverbrowser-regionfilter-selectable-selectall").trigger("mousedown");
                            } else if (i != numSiblings && $this.siblings(".serverbrowser-regionfilter-selectable-selectall").hasClass("serverbrowser-include")) {
                                $this.siblings(".serverbrowser-regionfilter-selectable-selectall").trigger("mousedown");
                            }
                        }

                        var counter = $($('#serverbrowser-region-filter-show-' + $(this).parent().data("region") + ' span').get(1));
                        if (subselection) {
                            counter.html("(" + subselection + ")");
                        }
                        else {
                            counter.html("");
                        }
                    });
                });

                var selectAll;
                dialog.find(".serverbrowser-regionfilter-selectable-selectall")
                    .on("click.page.serverbrowser", function (e) {
                        selectAll = $(this);
                        if (selectAll.hasClass("serverbrowser-include")) {
                            selectAll.siblings(":not(.serverbrowser-include)").trigger("mousedown");
                        } else {
                            selectAll.siblings(":not(.serverbrowser-exclude)").trigger("mousedown");
                        }
                    });

                dialog.attr("data-remove", true);

                this.regionFilter = dialog;
            }
        },

        /**
         * Init search field
         */
        initSearchField: function () {
            var self = this;
            var q = $("#serverbrowser-search-input");
            var clear = function () {
                if (q.val() == q.attr("title")) {
                    q.val("");
                }
                // Show "filter-is-saved-receipt";
            };

            var submitfilter = function () {
                $("#serverbrowser-filter-saved").stop(true, true).fadeIn(200);
                clear();
            };

            var fill = function () {
                if (q.val() == "") {
                    q.val(q.attr("title"));
                }
            };

            q.on("focus.page.serverbrowser", clear);
            q.on("keypress.page.serverbrowser", function (e) {
                if (e.which === 13) {
                    $("#serverbrowser-filters").submit();
                }
            });
            q.on("blur.page.serverbrowser", fill);

            $("#serverbrowser-filter-form").on("submit.page.serverbrowser", submitfilter);
            fill();
        },

        /**
         *  renderFilterHeader loops through server filters and creates header
         */
        renderFilterHeader: function () {
            var valOut = function(str) {
                return $.trim(Surface.valOut(str));
            };

            var self = this;
            var filterString = "<ul>";

            self.filters.each(function (index, item) {
                var $item = $(item);
                var collectionName = $item.find('h3').text() || $item.find("label:first").text();
                var checkboxes = $item.find(':input[type="checkbox"]');
                var checkedBoxes = $item.find(':input[type="checkbox"][checked]');
                var selectElements = $item.find('select');
                var textInputs = $item.find('input[type="text"]');

                var id = checkboxes.attr("id");
                if (id === "useAdvanced") {
                    var active = 0;
                    if (checkedBoxes.length > 0) {
                        $("#serverfilter-advancedfilters-form input").each(function () {
                            if (this.type === "hidden") {
                                if (this.value === "1" || this.value === "0") {
                                    active++;
                                }
                            } else if (this.type === "number") {
                                if (this.value != this.min && this.value != this.max) {
                                    active++;
                                }
                            }
                        });
                        if (active > 0) {
                            filterString += '<li>' + valOut(collectionName) + ' : ' + active + '</li>';
                        }
                    }
                } else if (id === "useLocation-input") {
                    if (checkedBoxes.length > 0) {
                        var regions = $("#serverbrowser-country-serverfilter-popup input[name=countries]").val() || "";
                        regions = regions.split("|").length;
                        if (regions > 0) {
                            filterString += '<li>' + valOut(collectionName) + ' : ' + regions + '</li>';
                        }
                    }
                } else if (selectElements.length === 1 && checkboxes.length) {

                    var txt = "";
                    var val = selectElements.val();
                    if (val === "1" && checkboxes.length === checkedBoxes.length) {
                       txt = S.translations["ID_WEB_SERVERGUIDE_FILTEREXTRA_ALL"];
                    } else if (val === "0") {
                       txt = S.translations["ID_WEB_SERVERGUIDE_FILTEREXTRA_NONE"];
                    }

                    if (txt) {
                        filterString += '<li>' + valOut(collectionName) + ' : ' + txt + '</li>';
                    } else if (checkedBoxes.length) {
                        filterString += '<li>' + valOut(collectionName) + ' : ' + $.map(checkedBoxes, function (element) {
                            var filterLabel = "";
                            var labelElement = $('label[for="' + $(element).attr('id') + '"]');
                            if (labelElement.text()) {
                                filterLabel = labelElement.text();
                            }
                            else if (labelElement.find('img').size) {
                                filterLabel = labelElement.find('img').attr('alt');
                            }
                            return ' ' + valOut(filterLabel);
                        }).join() + '</li>';
                    }

                } else if (checkboxes.length == 0 && collectionName.length > 0) {

                    selectElements.each(function () {
                        var $this = $(this);
                        var val = $this.val();
                        if (val != -1) {
                            var filterName = $('label[for="' + this.id + '"]').text();
                            if (filterName == '') {
                                filterName = $('label[for="' + this.id + '"] img').attr("alt");
                            }
                            filterString += '<li>' + valOut(filterName) + ' : ' +
                                (val == 1 ?
                                    S.translations["ID_WEB_SERVERGUIDE_FILTEREXTRA_ON"] : S.translations["ID_WEB_SERVERGUIDE_FILTEREXTRA_OFF"]
                                ) + '</li>';
                        }
                    });

                    textInputs.each(function () {
                        var $this = $(this);
                        if ($this.val().length > 0) {
                            var filterName = $this.attr('placeholder') || $this.attr('name');
                            filterString += '<li>' + valOut(filterName) + ' : ' + valOut($this.val()) + '</li>';
                        }
                    });
                }
            });
            filterString += "</ul>";
            $('#custom-filter-list-content').html(filterString);
        },

        /**
         * Toggle advanced filters
         */
        toggleAdvancedFilters: function () {
            var self = this;
            if (self.container.hasClass("advanced-expanded")) {
                self.container.removeClass("advanced-expanded");
                $("#serverbrowser-filter-settings-use-advanced").val(0);
                $.browserStorage.deleteKey("serverbrowser.expandAdvancedFilters");
            } else {
                self.container.addClass("advanced-expanded");
                $("#serverbrowser-filter-settings-use-advanced").val(1);
                $.browserStorage.set("serverbrowser.expandAdvancedFilters", true);
            }
            serverbrowserwarsaw.sidebar.sticky("update");
        },

        /**
         * Init guide filters
         */
        initGuideFilters: function () {
            var self = this;

            // Init new server filters
            self.filters.filterControl()
                .on("filterchange.page.serverbrowser", function (e) {
                    //S.debug("Filter " + e.label + " was changed to " + (e.value || "Any"));
                    var $this = $(this);
                    var $target = $(e.target);
                    var $inputs = $this.find("input").not($target);

                    if ($target.closest("li").attr("data-toggle") === "section") {
                        if (e.value === "On") {
                            $inputs.prop("checked", true).prop("disabled", false).trigger("change");
                        } else if (e.value === "Off") {
                            $inputs.prop("checked", false).prop("disabled", true).trigger("change");
                        } else {
                            $inputs.prop("checked", false).prop("disabled", false).trigger("change");
                        }
                        return;
                    }

                    if (this.id === "serverbrowser-region-filter") {
                        var $custom = $inputs.filter("[name=custom]");
                        $inputs = $inputs.not($custom);
                        if (e.target.name === "custom") {
                            $custom.prop("disabled", false);
                            if (e.value === "On") {
                                $inputs
                                    .prop("checked", false)
                                    .prop("disabled", true)
                                    .trigger("change");
                            } else {
                                $inputs.prop("disabled", false);
                            }
                        } else {
                            if (e.value === "On") {
                                $custom
                                    .prop("checked", false)
                                    .prop("disabled", true)
                                    .trigger("change");
                            } else if ($inputs.filter(":checked").length === 0) {
                                $custom.prop("disabled", false);
                            }
                        }
                    }
                    self.renderFilterHeader();
                });

            // Rest is old filters
            self.searchInput.on("focus.page.serverbrowser", function () {
                $(".serverbrowser-apply-filter-button").prop("disabled", false);
            });

            self.advancedToggle.on("click.page.serverbrowser", function (e) {
                e.preventDefault();
                self.toggleAdvancedFilters();
            });

            self.resetToggle.on("click.page.serverbrowser", function (e) {
                e.preventDefault();
                self.resetFilters(e.target);
            });

            self.filterToggle.on("click.page.serverbrowser", function (e) {
                if ($(e.target).hasClass("serverbrowser-reset-filter-button")) {
                    self.resetFilters(e.target);
                    return false;
                }

                if (!$(e.target).is("input[type='submit']") &&
                        !$(e.target).hasClass("serverbrowser-apply-filter-button") &&
                        !$(e.target).parent().hasClass("serverbrowser-apply-filter-button")) {

                    if (self.container.hasClass("expanded")) {
                        self.filtersContainer.slideUp(function(){
                            self.container.removeClass("expanded");
                            $.browserStorage.deleteKey("serverbrowser.expandFilters");
                            $("#serverbrowser-filter-expanded").val(0);
                            self.browser.sidebar.sticky("update");
                        });

                    } else {
                        self.container.addClass("expanded");
                        self.filtersContainer.slideDown(function(){
                            $("#serverbrowser-filter-expanded").val(1);
                            $.browserStorage.set("serverbrowser.expandFilters", true);
                            if (!S.globalContext.staticContext.detectedBrowser.isTouchDevice) {
                                self.searchInput.focus();
                            }
                            self.browser.sidebar.sticky("update");
                        });
                    }
                } else {
                    self.browser.sidebar.sticky("update");
                }
            });

            var toggleAdvancedFilters =
                $.browserStorage.get("serverbrowser.expandAdvancedFilters") === true ||
                $("#serverbrowser-filter-settings-use-advanced").val() == 1;
            if (toggleAdvancedFilters && !self.container.hasClass("advanced-expanded")) {
                self.toggleAdvancedFilters();
            }

            self.addSelectableTriggers();

            $("#serverbrowser-join-random").on("click.page.serverbrowser", function () {
                // Select a random server from the list
                var itemCount = $("#serverbrowser-results .serverbrowser-cell-join form").length;
                var idx = Math.floor(Math.random() * itemCount);
                $("#serverbrowser-server-" + idx + " .serverbrowser-cell-join form input[type=submit]").click();
            });
        },

        /*
         * Add selectable triggers
         */
        addSelectableTriggers: function () {
            var self = this;
            $(".serverbrowser-selectable").each(function () {
                var filter = $(this).attr("filter");
                if (!filter) {
                    return;
                }

                $(this).pageBind("mousedown", function (e) {
                    var $this = $(this);
                    if ($this.hasClass('serverbrowser-disabled')) {
                        return;
                    }

                    var isSelected = $this.hasClass('serverbrowser-include');
                    var isSelected2 = $this.hasClass('serverbrowser-noinclude');

                    var isMultiSelectable = $this.hasClass("serverbrowser-selectable-multi");

                    var checked = 0;

                    if (isSelected || isSelected2) {
                        $this.removeClass('serverbrowser-include');
                        checked = 0;

                        if (isMultiSelectable && !isSelected2) {
                            $this.addClass('serverbrowser-noinclude');
                            checked = 2;
                        } else {
                            $this.removeClass('serverbrowser-noinclude').addClass('serverbrowser-exclude');
                            checked = 0;
                        }
                    } else {
                        $this.removeClass('serverbrowser-exclude').addClass('serverbrowser-include');
                        checked = 1;
                    }

                    var value = $this.val();

                    if (isMultiSelectable) {
                        var selectOptions = value.split(",");
                        value = (checked === 1 ? selectOptions[0] : (checked === 2 ? selectOptions[1] : null));
                    }

                    var inp = $("input[name=" + filter + "]");
                    var elements = inp.val().split("|");
                    if (inp.val() == "") {
                        elements = [];
                    }
                    if (isSelected && !isMultiSelectable) {
                        var index = $.inArray(value, elements);
                        if (index > -1) {
                            elements.splice(index, 1);
                        }
                    } else if (isMultiSelectable) {
                        elements = [value];
                    } else {
                        elements.push(value);
                    }

                    inp.val(elements.join("|"));

                    // gray out maps that aren't supported
                    if (filter == "gamemodes" && false) {

                        // currently all maps have all modes
                        var noGameModesSelected = true;
                        $(".serverbrowser-selectable[filter='gamemodes']").each(function () {
                            if ($(this).hasClass("serverbrowser-include")) {
                                noGameModesSelected = false;
                            }
                        });

                        if (noGameModesSelected) {
                            $(".serverbrowser-filter-gamemode input[name='gamemodes']").val("");
                            $(".serverbrowser-selectable[filter='maps']").removeClass("serverbrowser-disabled");
                        }

                        // Don't gray out if none is selected
                        if (!noGameModesSelected) {
                            $(".serverbrowser-selectable[filter='maps']").each(function () {
                                var mapmode = false;
                                var mapmodes = $(this).attr("modes").toLowerCase();

                                for (var i = 0; i <= elements.length; i++) {
                                    if (elements[i] === undefined) {
                                        continue;
                                    }

                                    if (mapmodes.indexOf(elements[i].toLowerCase()) > -1) {
                                        mapmode = true;
                                    }
                                }

                                if (mapmode) {
                                    $(this).removeClass("serverbrowser-disabled");
                                }
                                else {
                                    $(this).addClass("serverbrowser-disabled");
                                }
                            });
                        }
                    }
                });
            });
        },

        /*
         * Add advanced selectable triggers
         */
        addAdvancedSelectableTriggers: function () {
            $('.popup-serveradvancedfilter-input[type="number"]').forceNumeric();

            // Fix max length attribute for chrome
            $('.popup-serveradvancedfilter-input[type="number"][maxlength]').keyup(function (e) {
                if (this.value.length > $(this).attr("maxlength")) {
                    this.value = this.value.slice(0, $(this).attr("maxlength"));
                }
            });

            $(".serverbrowser-advancedfilter-selectable").each(function () {
                var filter = $(this).attr("filter");
                if (!filter) {
                    return;
                }

                $(this).pageBind("mousedown", function (e) {
                    var $this = $(this);

                    if ($this.hasClass('serverbrowser-disabled')) {
                        return;
                    }

                    var isSelected = $this.hasClass('serverbrowser-include');
                    var isSelected2 = $this.hasClass('serverbrowser-noinclude');
                    var isMultiSelectable = $this.hasClass("serverbrowser-selectable-multi");
                    var checked = 0;

                    if (isSelected || isSelected2) {
                        $this.removeClass('serverbrowser-include');
                        checked = 0;

                        if (isMultiSelectable && !isSelected2) {
                            $this.addClass('serverbrowser-noinclude');
                            checked = 2;
                        } else {
                            $this.removeClass('serverbrowser-noinclude').addClass('serverbrowser-exclude')
                            checked = 0;
                        }
                    } else {
                        $this.removeClass('serverbrowser-exclude').addClass('serverbrowser-include');
                        checked = 1;
                    }

                    var value = $this.val();

                    if (isMultiSelectable) {
                        var selectOptions = value.split(",");
                        value = (checked === 1 ? selectOptions[0] : (checked === 2 ? selectOptions[1] : null));
                    }

                    var inp = $("input[name=" + filter + "]");
                    var elements = inp.val().split("|");
                    if (inp.val() == "") {
                        elements = [];
                    }
                    if (isSelected && !isMultiSelectable) {
                        var index = $.inArray(value, elements);
                        if (index > -1) {
                            elements.splice(index, 1);
                        }
                    } else if (isMultiSelectable) {
                        elements = [value];
                    } else {
                        elements.push(value);
                    }

                    inp.val(elements.join("|"));
                });
            });
        },


        /*
         * Grey out game selection maps
         */
        greyOutGameSelectionMaps: function () {
            var bc2 = $(".serverbrowser-selectable[value='bfbc2']")
                .hasClass("serverbrowser-include");
            var nam = $(".serverbrowser-selectable[value='bfbc2nam']")
                .hasClass("serverbrowser-include");

            $("[filter='maps']").removeClass("serverbrowser-disabled");

            if (bc2 && !nam) {
                $(".serverbrowser-include[value*='NAM']").trigger('click');
                $("div[value*='NAM']")
                    .addClass("serverbrowser-disabled")
                    .removeClass("serverbrowser-include")
                    .addClass("serverbrowser-exclude");
            }

            if (!bc2 && nam) {
                $(".serverbrowser-include[filter='maps']:not([value*='NAM'])").trigger('click');
                $("[filter='maps']:not([value*='NAM'])")
                    .addClass("serverbrowser-disabled")
                    .removeClass("serverbrowser-include")
                    .addClass("serverbrowser-exclude");
                $("div[value*='NAM']").removeClass("serverbrowser-disabled");
            }

            var maps = "";
            $(".serverbrowser-selectable[filter='maps']").filter(".serverbrowser-include").each(function () {
                maps = maps + "|" + this.value;
            });

            if ($("input[name='maps']").size == 1) {
                $("input[name='maps']").val(maps);
            }
        },

        bindEventHandlers: function () {
            var self = this;

            // Reset button
            self.resetButton.on("click.page.serverbrowser", function () {
                self.resetFilters();
            });

            // Refresh button
            self.refreshButton.on("click.page.serverbrowser", function(e){
                self.container.submit();
            });

            // On filter form submit
            self.container.on("submit.page.serverbrowser", function (e) {

                // Does the advanced filters for warsaw
                // TODO: Make this pretty
                var $target = $(e.currentTarget);
                var $settings = $target.find("[id^=settings-]:checked");
                var $advanced = $target.find('[id^=advanced-]');

                // Player settings and rules
                var settings = $settings.map(function(){
                    var $this = $(this);
                    var values = [];
                    values.push($this.attr("name").replace("settings-",""));
                    values.push($target.find("#" + values[0] + "-min").val());
                    values.push($target.find("#" + values[0] + "-max").val());
                    return values.join(',');
                }).get();

                var $expansions = $("select[name=gameexpansions]");
                var includeExpansions = [];
                var excludeExpansions = [];
                var html = "";
                $expansions.each(function(){
                    var value = this.value;
                    var exp = $(this).data("expansion");
                    if (typeof exp !== "undefined" && value !== "-1") {
                        if (value === "1") {
                            name = "includeExpansions";
                        } else if(value === "0") {
                            name = "excludeExpansions";
                        }
                        html += '<input type="hidden" name="'+name+'" value="'+exp+'">';
                    }
                });

                if (html) {
                    $("#serverbrowser-filters").append(html);
                    $expansions.remove();
                }

                // Advanced filters
                var advanced = $advanced.map(function() {
                    if (this.value == -1) {
                        return;
                    }
                    return [this.name, this.value, this.value].join(',');
                }).get();

                var encoded = settings.concat(advanced).join("|");

                $("#serverbrowser-filter-settings-input").val(encoded);
                self.browser.table.hide();
                self.browser.sidebar.hide();
                $("#serverbrowser-loading-list-indicator").show();
                self.container.find("input:submit").prop("disabled", true);
                gamemanager._deleteMatchmakingFilter(S.globalContext["realm"]["game"]);
            });

            $(".min-max-field").on("click.page.serverbrowser",function(e){
                e.stopPropagation();
            });

            // Open region filters
            $("#serverguide-region-settings-checkbox").on("click.page.serverbrowser", function (e) {
                e.preventDefault();
                e.stopImmediatePropagation();
                if ($(this).find(":checked").length === 0) { return; }
                if (regionCache) {
                    self.showRegionFilterDialog(regionCache);
                } else {
                    $url = Surface.Modifier.urlformat('/{_section}/{_language}/servers/getServerRegions/{platform}/', Surface.urlContext, { "platform": "pc" });
                    $.ajax({
                        "url": $url,
                        "dataType": "json",
                        "type": "GET"
                    }).always(base.onComplete(function (success, response) {
                        if (success) {
                            regionCache = response.message;
                            self.showRegionFilterDialog(regionCache);
                        } else {
                            base.showReceipt(S.translations["ID_WEB_SHOWRECEIPT_NO_REGIONS"], "skull");
                        }
                    }));
                }
            });

            // Show region filters
            // TODO: clean up selectors
            $(self.selectors.regionFilterShow).pageLive("click", function (e) {
                var region = $(this).data("region");

                $("#serverbrowser-country-serverfilter-popup h1").show();
                $(this).addClass("showing").siblings().removeClass("showing");
                $("#serverbrowser-region-countries-" + region).show().siblings().hide();
            });
        }
    }

}(jQuery, window));;;(function ($, window, undefined) {

    serverbrowserwarsaw.playnowtabs = {

        /**
         * Init
         * @param browser
         */
        init: function (browser) {
            var self = this;

            self.browser = browser;

            self.container = $("nav.play-now-menu");
            self.gameModeItems = self.container.find("ul > li");
            self.initListeners();
        },

        showImageOnLoad: function()  {
            $("#playnow .show-on-load").on("load.page", function(){
                $("img.show-on-load").removeClass("show-on-load");
            });
        },


        /**
         * Init Listeners
         */
        initListeners: function () {
            var self = this;

            self.showImageOnLoad();

            self.gameModeItems.on("click.page.serverbrowser", function (e) {
                e.preventDefault();
                var $item = $(e.currentTarget);

                var url = $item.data('url');
                var gameMode = $item.attr("data-game-mode-name");

                $S("play-now-tab-content").update({selectedMode: gameMode});

                //Update History in  order to be able to use browser navigation
                /* if (Surface.ajaxNavigation.html5history) {
                    window.history.pushState({ url: url, initial: false}, "", url);
                }*/

                // handle highlight of selected game mode tab
                self.gameModeItems.removeClass("active");
                $item.addClass("active");

                self.showImageOnLoad();
            });

            $("#playnow").on("click.page.serverbrowser", "#ranked-only", function (e) {
                $("#playnow [data-bind-action=matchmake-mp-role]").attr("data-ranked-only", $(this).prop("checked") ? 1 : 0);
            });

            $("#playnow").on("click.page.serverbrowser", "[data-bind=game-mode-video-play]", function (e) {
                var $video_container = $(".game-mode-image");
                var $play_button = $video_container.find("[data-bind=game-mode-video-play]");
                var $video = $video_container.find(".video");
                var $img = $video_container.find("img");
                var src = $video.attr("data-src");

                $play_button.hide();
                $img.hide();
                $video.append("<iframe width=\"662\" height=\"400\" src=\"" + src + "\" frameborder=\"0\" allowfullscreen></iframe>");
                $video.removeClass("hide");
            });

        }
    }

}(jQuery, window));

;(function (window, document, $) {
    var name = "battlescreenMonitor";
    var exports = {};
    var constants = {
      CONNECTION_LAUNCH: 'Connection.Launch',
      CONNECTION_SUCCESS: 'Connection.Success',
      ERROR_CONNECTION_TIMEOUT: 'Error.ConnectionTimeout',
      ERROR_NO_CONNECTION: 'Error.NoConnection',
      ERROR_NO_WEBSOCKETS: 'Error.NoWebsockets'
    };

    exports.isLaunching = false;

    exports.constants = constants;

    function getEventValue () {
        var activePersonaPlatform = 0;

        if (S.globalContext.staticContext.activePersona && S.globalContext.staticContext.activePersona.platform) {
            activePersonaPlatform = S.globalContext.staticContext.activePersona.platform;
        }

        var platform = $S.callFunction('base.platform', activePersonaPlatform);
        var context = "Desktop";
        var currentDevice = S.globalContext.staticContext.detectedBrowser;

        if (currentDevice.isTablet) {
            context = "Tablet";
            if (currentDevice.isAndroid) {
                context += ".Android";
            }
            if (currentDevice.isIOS) {
                context += ".iOS";
            }
            if (currentDevice.isHybridApp) {
                context += '.Hybrid';
            } else {
                context += '.Web'
            }
        }

        var value = platform + '.' + context

        if (S.globalContext.standalone) {
            value = 'Standalone.' + value;
        }
        return value;
    }

    exports.trackEvent = function (action) {
        var value = getEventValue();
        $.ga.trackEvent('BattleScreen', action, value);
    };

    // Export to S.C and window
    if (!S.C) { S.C = {}; }
    S.C[name] = exports;
    window[name] = S.C[name];

})(window, document, jQuery);;/* FBCompanionAppConnection
 *
 * A JavaScript library to connect a web based companion app to the Frostbite
 * engine.
 *
 * To use it, create a 'new FBCompanionAppConnection("resource")', where
 * resource is the resource you want to request from the game, for example
 * "battlescreen".
 *
 * After creating the connection you should register listeners using
 * 'addEventListener("event", function)' where event is one of:
 * "connect" - The connection to the game is established
 * "disconnect" - The connection to the game was lost
 * "recv" - A message was received. The argument passed to the function is a
 *         javascript object, not the JSON string.
 * "error" - An error was encountered. The argument passed to the function is a
 *           string with the error message.
 *
 * Messages are sent with "send", the message can be either a JSON string or
 * a JavaScript object, which will then be stringified.
 */
var fbCompanionAppUseXbc = (window.location.hash.substring(1)=="smartglass");
if (fbCompanionAppUseXbc)
	document.write("<script src=\"http://sg.xboxlive.com/november2013-1/Xbc.js\"></script>");
function FBCompanionAppConnection(res) {
	this.isConnected = false;
	this.resource = res;
	this.eventListeners = new Object;

	this.partialString = "";

	var dim_layer = document.createElement("div");
	dim_layer.id = "dim_layer";
	dim_layer.style.width = "100%";
	dim_layer.style.height = "100%";
	dim_layer.style.backgroundColor = "rgba(0,0,0,0.75)";
	dim_layer.style.zIndex = "1";
	dim_layer.style.position = "fixed";
	dim_layer.style.left = "0";
	dim_layer.style.top = "0";
	if (fbCompanionAppUseXbc) {
		window.setTimeout(this.connectXbc.bind(this), 0);
	} else {
		this.connectionDetails = this.getConnectionDetails();
		if (this.connectionDetails.ip)
		{
			this.connectWebSocket();
		}
		else
		{
			var connect_dlg = document.createElement("div");
			connect_dlg.id = "connect_dlg";
			connect_dlg.style.width = "16em";
			connect_dlg.style.margin = "25% auto";
			connect_dlg.style.border = "1px solid black";
			connect_dlg.style.backgroundColor = "white";
			connect_dlg.style.borderRadius = "5px";
			var dlg_header = document.createElement("div");
			dlg_header.className = "connect_dlg_header";
			dlg_header.innerHTML = "Connect to game";
			connect_dlg.appendChild(dlg_header);
			var dlg_content = document.createElement("div");
			dlg_content.style.padding = "5px";
			dlg_content.className = "connect_dlg_content";
			var dlg_input = document.createElement("input");
			dlg_input.type = "text";
			dlg_input.id = "connect_dlg_ip";
			dlg_input.addEventListener("keydown", function(event){if (event.keyCode == 13) {this.connectWebSocket(); return false;} return true;}.bind(this), false);
			var cookielist = document.cookie.split(";");
			var default_ip = "localhost";
			for (var ci = 0; ci < cookielist.length; ++ci) {
				var cookie = cookielist[ci].replace(/^\s+/g, "");
				if (cookie.indexOf("default_websocket_ip=") == 0)
					default_ip = cookie.substring(21);
			}
			dlg_input.value = default_ip;
			dlg_content.appendChild(dlg_input);
			var dlg_connect = document.createElement("div");
			dlg_connect.className = "connect_dlg_button";
			dlg_connect.style.border = "1px solid black";
			dlg_connect.style.display = "inline-block";
			dlg_connect.style.padding = "0px 5px";
			dlg_connect.style.cursor = "pointer";
			dlg_connect.addEventListener("click", this.connectWebSocket.bind(this), false);
			dlg_connect.innerHTML = "Connect";
			dlg_content.appendChild(dlg_connect);
			connect_dlg.appendChild(dlg_content);
			dim_layer.appendChild(connect_dlg);
		}
	}
	document.getElementsByTagName("body")[0].appendChild(dim_layer);
}

FBCompanionAppConnection.prototype.getConnectionDetails = function() {
	var params = window.location.hash.substring(1).split("&");
	var ip = null;
	var port = 0;
	var clientToken = 0;
	for (var i = 0; i < params.length; ++i) {
		if (/^ip=/.test(params[i]))
			ip = params[i].substring(3);
		else if (/^port=/.test(params[i]))
			port = parseInt(params[i].substring(5));
		else if (/^clienttoken=/.test(params[i]))
			clientToken = parseInt(params[i].substring(12));
	}
	return {"ip": ip, "port": port, "clienttoken": clientToken};
}

FBCompanionAppConnection.prototype.addEventListener = function(evt, func) {
	this.eventListeners[evt] = func;
}

FBCompanionAppConnection.prototype.onMessage = function(msg) {
	if (typeof this.eventListeners["recv"] == "function") {
		if (!fbCompanionAppUseXbc) {
			try {
				var x = JSON.parse(msg.data);
                // Help GC
                msg.data = "";
                msg = x;
			} catch (e) {
				this.onError({"fatal": false, "message": "Received message with invalid JSON"});
				return;
			}
		}
		if (msg.type == "partial") {
			this.partialString += msg.fragment;
			if (!msg.last)
				return;
			try {
				msg = JSON.parse(this.partialString);
			} catch (e) {
				this.partialString = "";
				this.onError({"fatal": false, "message": "Received message with invalid JSON"});
				return;
			}
			this.partialString = "";
		}
		this.eventListeners["recv"](msg);
	}
}
FBCompanionAppConnection.prototype.onOpen = function(loaded) {  // ´loaded´ is passed here when connecting with Xbc
    if (fbCompanionAppUseXbc && loaded) {
        if (!loaded.Information.isConnected) {
            this.onClose();
            return;
        }
    }

	this.isConnected = true;
	this.send("{ \"type\" : \"initialized\" }");
	if (typeof this.eventListeners["connect"] == "function")
		this.eventListeners["connect"]();
	document.getElementById("dim_layer").style.display = "none";
}
FBCompanionAppConnection.prototype.onClose = function() {
	this.isConnected = false;
	document.getElementById("dim_layer").style.display = "block";
	if (typeof this.eventListeners["disconnect"] == "function")
		this.eventListeners["disconnect"]();
}
FBCompanionAppConnection.prototype.onError = function(err) {
	if (typeof this.eventListeners["error"] == "function")
		this.eventListener["error"](err.message);
	if (typeof err.fatal == "undefined")
		err.fatal = !fbCompanionAppUseXbc;
	if (err.fatal && this.isConnected)
		this.onClose();
}


FBCompanionAppConnection.prototype.send = function(msg) {
	if (!this.isConnected) {
		this.onError({"fatal": true, "message": "Attempting to send a message while not connected"});
		return;
	}
	if (fbCompanionAppUseXbc) {
		if (typeof msg == "string")
			msg = JSON.parse(msg);
		Xbc.Messaging.sendMessage(msg).then(function() {
            // Succeeded to send message to console
        }, function () {
            // Failed to send message to console
        });
	} else {
		if (typeof msg != "string")
			msg = JSON.stringify(msg);
		this.socket.send(msg);
	}
}

FBCompanionAppConnection.prototype.connectWebSocket = function() {
	var ip;
	var port;
	var subProto = "0";
	if (this.connectionDetails.ip) {
		ip = this.connectionDetails.ip;
		port = this.connectionDetails.port;
		subProto = ""+this.connectionDetails.clienttoken;
	} else {
		ip = document.getElementById("connect_dlg_ip").value;
		port = 8080;
		var date = new Date();
		// Store the cookie for 1 year
		date.setTime(date.getTime()+(365*24*60*60*1000));
		var exp = date.toGMTString();
		document.cookie = "default_websocket_ip="+ip+"; expires="+exp+"; path=/";
	}
	this.socket = new WebSocket("ws://"+ip+":"+port+"/" + this.resource, subProto);
	this.socket.addEventListener("message", this.onMessage.bind(this), false);
	this.socket.addEventListener("open", this.onOpen.bind(this), false);
	this.socket.addEventListener("close", this.onClose.bind(this), false);
	this.socket.addEventListener("error", this.onError.bind(this), false);
}

FBCompanionAppConnection.prototype.disconnectWebSocket = function() {
	this.socket.onmessage = function() {};
	this.socket.onopen = function() {};
	this.socket.onclose = function() {};
	this.socket.onerror = function() {};
	this.socket.close();
};

FBCompanionAppConnection.prototype.loadXbc = function() {
	if (this.xhr.readyState != 4)
		return;
	if (this.xhr.status != 200) {
		this.onError({"fatal": true, "message": "Failed to download Xbc"});
		return;
	}
	if (typeof Xbc == "undefined") {
		eval(this.xhr.responseText);
		if (typeof Xbc == "undefined") {
			this.onError({"fatal": true, "message": "Failed to execute Xbc"});
			return;
		}
	}
	this.connectXbc();
}

FBCompanionAppConnection.prototype.connectXbc = function() {
	Xbc.on("received", this.onMessage.bind(this));
	Xbc.on("error", this.onError.bind(this));
	Xbc.on("loaded", this.onOpen.bind(this));
}

;FBCompanionAppConnection.prototype.getConnectionDetails = function () {
    var ip = document.getElementById("client-ip").value;
    var port = document.getElementById("client-port").value;
    var clientToken = document.getElementById("client-token").value;

    return {"ip": ip, "port": port, "clienttoken": clientToken};
};;var GadgetName = [
	"Helmet camera",
	"Remote vehicle"
];

function BattleScreenUiOverlay(bs){
	this.battlescreen = bs;
	this.roundTime = 0;
	this.roundTimeStart = 0;
	this.squadMode = -1;
    this.element = $("#uioverlay");
}

BattleScreenUiOverlay.prototype.setSquadMode = function(mode){
	if (this.squadMode != mode){
		this.squadMode = mode;
		switch (mode) {
		case SQUADSTATUS_NONE:
			document.getElementById("request_order").style.display="none";
			document.getElementById("request_asset_group").style.display="none";
			document.getElementById("squad_list_spacer").style.display="none";
			document.getElementById("squad_list").style.display="none";
			break;
		case SQUADSTATUS_MEMBER:
			document.getElementById("request_order").style.display="block";
			document.getElementById("request_asset_group").style.display="none";
			document.getElementById("squad_list_spacer").style.display="block";
			document.getElementById("squad_list").style.display="block";
			break;
		case SQUADSTATUS_LEADER:
			document.getElementById("request_order").style.display="none";
			document.getElementById("request_asset_group").style.display="none";
			document.getElementById("squad_list_spacer").style.display="none";
			document.getElementById("squad_list").style.display="block";
			break;
		case SQUADSTATUS_LEADER_WITH_COMMANDER:
			document.getElementById("request_order").style.display="block";
			document.getElementById("request_asset_group").style.display="block";
			document.getElementById("squad_list_spacer").style.display="block";
			document.getElementById("squad_list").style.display="block";
			break;
		}
	}
};

BattleScreenUiOverlay.prototype.update = function(){
	if (this.roundTime > 0 && this.roundTimeStart > 0)
	{
		var diff = new Date().getTime()-this.roundTimeStart;
		diff /= 1000;
		diff += this.roundTime;
		diff = Math.round(diff);
		var minutes = Math.floor(diff / 60);
		var seconds = diff - minutes*60;
		var hours = Math.floor(minutes / 60);
		minutes = minutes - hours*60;
		var rt = document.getElementById("roundtime");
		if (rt) {
			var newHtml = "";
			if (hours > 0) {
				if (hours < 10)
					newHtml += "0";
				newHtml += hours;
				newHtml += ":";
			}
			if (minutes < 10)
				newHtml += "0";
			newHtml += minutes;
			newHtml += ":";
			if (seconds < 10)
				newHtml += "0";
			newHtml += seconds;
			rt.innerHTML = newHtml;
		}
	}
};

BattleScreenUiOverlay.prototype.resize = function(w, h){
	var overlay = document.getElementById("uioverlay");
	overlay.style.width = w + "px";
	overlay.style.height = h + "px";
};

BattleScreenUiOverlay.prototype.toggleRemoteRendering = function(enable){
	document.getElementById("gadgetscroller").style.display = enable?"block":"none";
};

BattleScreenUiOverlay.prototype.updateCapturePoints = function(friendCP, neutralCP, enemyCP){
	friendCP.sort(function(a,b){return a.name.localeCompare(b.name);});
	neutralCP.sort(function(a,b){return a.name.localeCompare(b.name);});
	enemyCP.sort(function(a,b){return a.name.localeCompare(b.name);});
	var newHtml = "";
	for (var i = 0; i < friendCP.length; ++i)
		newHtml += "<span class=\"friendlycapturepoint"+(friendCP[i].capture?" changingcapturepoint":"")+"\">"+friendCP[i].name+"</span>";
	for (var i = 0; i < neutralCP.length; ++i)
		newHtml += "<span class=\"neutralcapturepoint"+(neutralCP[i].capture?" changingcapturepoint":"")+"\">"+neutralCP[i].name+"</span>";
	for (var i = 0; i < enemyCP.length; ++i)
		newHtml += "<span class=\"enemycapturepoint"+(enemyCP[i].capture?" changingcapturepoint":"")+"\">"+enemyCP[i].name+"</span>";
	
	var tc_cp = document.getElementById("ticketcounter_capture_points");
	tc_cp.innerHTML = newHtml;	
};

BattleScreenUiOverlay.prototype.updateSquadInfo = function(members){
	var squaddiv = document.getElementById("squadcontent");
	var newHTML = "";
	for (var i = 0; i < members.length; ++i) {
		var kit = "";
		var subIcon = bs.getSubIcon(members[i].leaderIcon, TEAMSTATE_SQUAD, 0);
		if (subIcon) {
			var cv = document.createElement("canvas");
			cv.width = subIcon.width;
			cv.height = subIcon.height;
			ctx = cv.getContext("2d");
			ctx.drawImage(subIcon.image, subIcon.x, subIcon.y, subIcon.width, subIcon.height, 0, 0, subIcon.width, subIcon.height);
			kit = "<img src=\"" + cv.toDataURL() + "\">";
		}
		subIcon = bs.getSubIcon(members[i].kitIcon, TEAMSTATE_SQUAD, 0);
		if (subIcon) {
			var cv = document.createElement("canvas");
			cv.width = subIcon.width;
			cv.height = subIcon.height;
			ctx = cv.getContext("2d");
			ctx.drawImage(subIcon.image, subIcon.x, subIcon.y, subIcon.width, subIcon.height, 0, 0, subIcon.width, subIcon.height);
			kit += "<img src=\"" + cv.toDataURL() + "\">";
		}
		newHTML += "<div class=\"squadname\">[" + kit + "] " + members[i].name + "</div><div class=\"squaddetails\">" + Math.round(members[i].health) + "%</div>";
	}
	squaddiv.innerHTML = newHTML;
};

BattleScreenUiOverlay.prototype.updateGadgets = function(myGadgets, squadGadgets){
	var myList = document.getElementById("my_gadgets");
	var squadList = document.getElementById("squad_gadgets");
	myList.innerHTML = "";
	squadList.innerHTML = "";
	for (var i = 0; i < myGadgets.length; ++i) {
		var gadget = document.createElement("div");
		gadget.className = "uioverlaygroup uioverlaysignalfeed";
		gadget.innerHTML = GadgetName[myGadgets[i].type]+"<br>"+myGadgets[i].name;
		gadget.gadgettype = myGadgets[i].type;
		gadget.gadgetname = myGadgets[i].name;
		gadget.onclick = function(){showRemoteView(this.gadgettype, this.gadgetname);};
		myList.appendChild(gadget);
	}
	for (var i = 0; i < squadGadgets.length; ++i) {
		var gadget = document.createElement("div");
		gadget.className = "uioverlaygroup uioverlaysignalfeed";
		gadget.innerHTML = GadgetName[squadGadgets[i].type]+"<br>"+squadGadgets[i].name;
		gadget.gadgettype = squadGadgets[i].type;
		gadget.gadgetname = squadGadgets[i].name;
		gadget.onclick = function(){showRemoteView(this.gadgettype, this.gadgetname);};
		squadList.appendChild(gadget);
	}
};

BattleScreenUiOverlay.prototype.updateTickets = function(tickets){
	var tc_progress = document.getElementById("ticketcounter_progress");
	var tc_time = document.getElementById("ticketcounter_time");
	tc_progress.innerHTML = "<span class=\"friendlyteamname\">"+tickets.friendName+"</span> <span class=\"friendlyprogress\">" +
		Math.round(100 * tickets.friendTickets / tickets.friendMaxTickets) +
		"</span> <span class=\"enemyprogress\">" +
		Math.round(100 * tickets.enemyTickets / tickets.enemyMaxTickets) +
		"</span> <span class=\"enemyteamname\">"+tickets.enemyName+"</span>";
	tc_time.innerHTML = "<span class=\"friendlyscore\">" +
		tickets.friendTickets +
		"</span> <span id=\"roundtime\">00:00</span> <span class=\"enemyscore\">" +
		tickets.enemyTickets +
		"</span>";
	this.roundTime = tickets.roundTime;
	this.roundTimeStart = this.roundTime > 0 ? new Date().getTime() : 0;
};

BattleScreenUiOverlay.prototype.requestOrder = function() {
	var elem = document.getElementById("request_order");
	var classes = elem.className.split(" ");
	for (var i = 0; i < classes.length; ++i)
		if (classes[i] == "disabledbutton")
			return;
	elem.className += " disabledbutton";
	// schedule an event to re-enable the button
	setTimeout(function(){this.className = this.className.replace("disabledbutton", "").trim()}.bind(elem), 10000);
	this.battlescreen.requestOrder();
};

BattleScreenUiOverlay.prototype.requestAsset = function(ass) {
	var elem = document.getElementById("request_asset_" + ass);
	var classes = elem.className.split(" ");
	for (var i = 0; i < classes.length; ++i)
		if (classes[i] == "disabledbutton")
			return;
	elem.className += " disabledbutton";
	// schedule an event to re-enable the button
	setTimeout(function(){this.className = this.className.replace("disabledbutton", "").trim()}.bind(elem), 10000);
	this.battlescreen.requestAsset(ass);
};

;BattleScreenUiOverlay.prototype.setSquadMode = function () {

};

BattleScreenUiOverlay.prototype.flagProgress = function (x1, y1, x2, y2, x3, y3) {
    var distance = function(x1, y1, x2, y2) {
        var dx = x2 - x1;
        var dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
    };
    var total = distance(x1, y1, x2, y2);
    var infront = distance(x2, y2, x3, y3);
    var done = 1 - infront / total;

    if (done < 0) {
        done = 0;
    }
    return done;
}

BattleScreenUiOverlay.prototype.updateCapturePoints = function () {
    var cps = this.battlescreen.targets;
    var state = $S("scoring-widget").getState();

    // CTF
    if (this.battlescreen.gameMode === this.battlescreen.gameModes.CAPTURETHEFLAG) {
        if (cps.length > 2) {
            cps[2].isFlag = true;
            if (cps[2].teamState === cps[0].teamState) {
                cps[2].flagPosition = 162 * this.flagProgress(cps[0].xpos, cps[0].ypos, cps[1].xpos, cps[1].ypos, cps[2].xpos, cps[2].ypos);
            } else {
                cps[2].flagPosition = 162 * this.flagProgress(cps[1].xpos, cps[1].ypos, cps[0].xpos, cps[0].ypos, cps[2].xpos, cps[2].ypos);
            }

            if (cps.length === 4) {
                cps[3].isFlag = true;
                if (cps[3].teamState === cps[0].teamState) {
                    cps[3].flagPosition = 162 * this.flagProgress(cps[0].xpos, cps[0].ypos, cps[1].xpos, cps[1].ypos, cps[3].xpos, cps[3].ypos);
                } else {
                    cps[3].flagPosition = 162 * this.flagProgress(cps[1].xpos, cps[1].ypos, cps[0].xpos, cps[0].ypos, cps[3].xpos, cps[3].ypos);
                }
                cps[0].flagTaken = cps[0].teamState === cps[3].teamState;
                cps[1].flagTaken = cps[1].teamState === cps[3].teamState;
            }

            cps[0].flagTaken = cps[0].teamState === cps[2].teamState;
            cps[1].flagTaken = cps[1].teamState === cps[2].teamState;
        }
        state.capturePoints = cps;
    // Other game modes
    } else {
        state.capturePoints = $.map(cps, function(v,k){
            if (v.name && v.captureState !== CAPTURESTATE_NOT_CAPTURABLE && v.captureState !== CAPTURESTATE_BOMB) {
                if (v.type === CP_TYPE_BOMB || v.type === CP_TYPE_BOMBSITE) {
                    v.isBomb = true;
                }
                return v;
            }
        }).sort(function(a, b){
            return a.name > b.name;
        });
    }

    $S("scoring-widget").refresh();
};

BattleScreenUiOverlay.prototype.getIcon = function(icon) {
    if (!this.iconCache[icon]) {
        var subIcon = bs.getSubIcon(icon, TEAMSTATE_SQUAD, 0);
        if (subIcon) {
            var cv = document.createElement("canvas");
            cv.width = subIcon.width;
            cv.height = subIcon.height;
            var ctx = cv.getContext("2d");
            ctx.drawImage(subIcon.image, subIcon.x, subIcon.y, subIcon.width, subIcon.height, 0, 0, subIcon.width, subIcon.height);
            this.iconCache[icon] = cv.toDataURL();
        }
    }

    return this.iconCache[icon];
};

BattleScreenUiOverlay.prototype.updateSquadInfo = function (members) {
    // Early out if no data
    if (members.length === 0) {
        return;
    }

    $("#squadcontent").show();

    var self = this;

    if (self.avatarCache === undefined) {
        self.avatarCache = {};
    }

    if (self.iconCache === undefined) {
        self.iconCache = {};
    }

    if (self.avatarCheckedBefore === undefined) {
        self.avatarCheckedBefore = [];
    }

    var missingAvatars = [];
    $(members).each(function (i, member) {
        member.leaderIconSrc = self.getIcon(member.leaderIcon);
        member.kitIconSrc = self.getIcon(member.kitIcon);

        var name = member.name;
        if (!self.avatarCache[name] && self.avatarCheckedBefore.indexOf(name) === -1) {
            missingAvatars.push(name);
            self.avatarCheckedBefore.push(name);
        }
    });

    var state = $S("bs_squadcontent").getState();

    if (missingAvatars.length > 0) {
        $.get("/battlescreen/getAvatars", {"personas[]": missingAvatars}, function (data) {
            $(data).each(function (i, user) {
                self.avatarCache[user.name] = user.gravatarMd5;
            });
            state.members = members;
            state.avatars = self.avatarCache;
            $S("bs_squadcontent").refresh();
        });
    } else {
        state.members = members;
        state.avatars = self.avatarCache;
        $S("bs_squadcontent").refresh();
    }
};

BattleScreenUiOverlay.prototype.updateTickets = function (tickets) {
    var state = $S("scoring-widget").getState();
    state.gameMode = this.battlescreen.gameMode;
    state.enemyMaxTickets = tickets.enemyMaxTickets;
    state.enemyName = tickets.enemyName;
    state.enemyTickets = tickets.enemyTickets;
    state.friendMaxTickets = tickets.friendMaxTickets;
    state.friendName = tickets.friendName;
    state.friendTickets = tickets.friendTickets;
    $S("scoring-widget").refresh();
};

BattleScreenUiOverlay.prototype.hide = function () {
    this.element.hide();
};

BattleScreenUiOverlay.prototype.show = function () {
    this.element.show();
};
;var bs;

var TEAMSTATE_SQUAD = 0;
var TEAMSTATE_TEAM = 1;
var TEAMSTATE_ENEMY = 2;
var TEAMSTATE_NEUTRAL = 3;
var TEAMSTATE_SELF = 4;
var TEAMSTATE_NONE = 5;

var CP_TYPE_CAPTURE = 0;
var CP_TYPE_BASE = 1;
var CP_TYPE_BOMBSITE = 2;
var CP_TYPE_BOMB = 3;
var CP_TYPE_FLAG = 4;

var CP_TYPES = [
    CP_TYPE_CAPTURE,
    CP_TYPE_BASE,
    CP_TYPE_BOMBSITE,
    CP_TYPE_BOMB,
    CP_TYPE_FLAG
];

var CAPTURESTATE_NORMAL = 0;
var CAPTURESTATE_CAPTURING = 1;
var CAPTURESTATE_NOT_CAPTURABLE = 2;
var CAPTURESTATE_BOMB = 3;

var GADGETTYPE_HELMETCAM = 0;
var GADGETTYPE_REMOTE = 1;

var SQUADSTATUS_NONE = 0;
var SQUADSTATUS_MEMBER = 1;
var SQUADSTATUS_LEADER = 2;
var SQUADSTATUS_LEADER_WITH_COMMANDER = 3;

var TeamColorization = [
	[107, 209, 12, 255],
	[0, 169, 255, 255],
	[255, 85, 0, 255],
	[175, 178, 178, 255]
];

var IconTeamState = [
	4, //TEAMSTATE_SQUAD
	2, //TEAMSTATE_TEAM
	1, //TEAMSTATE_ENEMY
	3, //TEAMSTATE_NEUTRAL
	5, //TEAMSTATE_SELF
	0 //TEAMSTATE_NONE
];

function getTeamColorizationRGBA(teamState, opacity) {
    opacity = opacity || 1;
	if (teamState == TEAMSTATE_SELF)
		teamState = TEAMSTATE_SQUAD;
	return "rgba(" + TeamColorization[teamState][0] + ", " + TeamColorization[teamState][1] + ", " + TeamColorization[teamState][2] + ", " + opacity + ")";
}

function getFrame(icon, lastChange) {
	var diff = new Date().getTime()-lastChange;
	var frameTime = 1000 / icon.framerate;
	var frame = Math.abs(Math.floor(diff/frameTime)%icon.frames.length);
	return icon.frames[frame];
}
function OrderAnimation(xpos, ypos, teamState) {
    this.xpos = xpos;
    this.ypos = ypos;
    this.teamState = teamState;
    this.stopAnimation = new Date().getTime() + 2000;
}
OrderAnimation.prototype.update = function(teamState) {
    if (this.teamState != teamState) {
        this.teamState = teamState;
        this.stopAnimation = new Date().getTime() + 2000;
    }
};
OrderAnimation.prototype.drawAttackArrows = function() {
    bs.ctx.beginPath();

    var sides = [[1, 1], [-1, 1], [1, -1], [-1, -1]];
    for (var i = 0; i < sides.length; i++) {
        var sideX = sides[i][0];
        var sideY = sides[i][1];



        bs.ctx.moveTo(sideX * 10, sideY * 10);
        bs.ctx.lineTo(sideX * 17, sideY * 13);
        bs.ctx.lineTo(sideX * 13, sideY * 17);
        bs.ctx.lineTo(sideX * 10, sideY * 10);

        bs.ctx.fill();
        bs.ctx.stroke();
    }

    bs.ctx.closePath();
};
OrderAnimation.prototype.drawDefendArrows = function() {
    bs.ctx.beginPath();

    var sides = [1, -1];
    for (var i = 0; i < sides.length; i++) {
        var side = sides[i];

        // Top and bottom
        bs.ctx.moveTo(0, side * 22);
        bs.ctx.lineTo(3, side * 14);
        bs.ctx.lineTo(-3, side * 14);
        bs.ctx.lineTo(0, side * 22);
        bs.ctx.fill();
        bs.ctx.stroke();

        // Left and right
        bs.ctx.moveTo(side * 22, 0);
        bs.ctx.lineTo(side * 14, 3);
        bs.ctx.lineTo(side * 14, -3);
        bs.ctx.lineTo(side * 22, 0);
        bs.ctx.fill();
        bs.ctx.stroke();
    }

    bs.ctx.closePath();
};
OrderAnimation.prototype.draw = function() {
    bs.ctx.save();
    var cpos = bs.minimap.minimapToCanvasPos([this.xpos, this.ypos]);
    bs.ctx.translate(cpos[0], cpos[1]);

    // Animate opacity for three seconds
    var now = Date.now();
    var opacity = 1;
    if (this.stopAnimation > now) {
        opacity = Math.sin((now / 150) % Math.PI);
    }

    bs.ctx.fillStyle   = 'rgba(205, 237, 175, ' + opacity + ')';
    bs.ctx.strokeStyle = 'rgba(116, 203, 31, ' + opacity + ')';
    bs.ctx.lineWidth   = 1;

    if (this.teamState == TEAMSTATE_ENEMY) {
        this.drawAttackArrows();
    }
    else {
        this.drawDefendArrows();
    }

    bs.ctx.restore();
};

function CapturePoint(type, name, x, y, teamState, cap, icon){
    this.type = type;
	this.name = name;
	this.xpos = x;
	this.ypos = y;
	this.teamState = teamState;
	this.captureState = cap;
	this.iconId = icon;
	this.lastChange = Date.now();
};

CapturePoint.prototype.draw = function(){
	bs.ctx.save();
	var cpos = bs.minimap.minimapToCanvasPos([this.xpos, this.ypos]);
	bs.ctx.translate(cpos[0], cpos[1]);
	if (this.captureState == CAPTURESTATE_CAPTURING) {
		var diff = Date.now()-this.lastChange;
		var blinkTime = 1000;
		diff = Math.abs(diff%blinkTime-blinkTime/2);
		bs.ctx.globalAlpha = (diff*2/blinkTime);
	}
	var sizeScale = bs.iconScale;
	var subIcon = bs.getSubIcon(this.iconId, this.teamState, this.lastChange);
	if (subIcon) {
		bs.ctx.drawImage(subIcon.image, subIcon.x, subIcon.y, subIcon.width, subIcon.height, -subIcon.width*sizeScale/2, -subIcon.height*sizeScale/2, subIcon.width*sizeScale, subIcon.height*sizeScale);
	} else {
		if (this.teamState == TEAMSTATE_ENEMY) {
			bs.ctx.rotate(45*Math.PI/180);
        }
		bs.ctx.strokeStyle = getTeamColorizationRGBA(this.teamState);
		bs.ctx.lineWidth = 2*sizeScale;

		bs.ctx.strokeRect(-20*sizeScale, -20*sizeScale, 40*sizeScale, 40*sizeScale);
	}
	if (this.name != "") {
		bs.ctx.fillStyle = "rgba(220, 220, 220, 200)";
		bs.ctx.textAlign = "center";
		bs.ctx.textBaseline = "middle";
		bs.ctx.font = "600 19px Purista";
		bs.ctx.fillText(this.name, 0, 0);
	}
	if (this.captureState == CAPTURESTATE_CAPTURING) {
		bs.ctx.globalAlpha = 1.0;
    }
	bs.ctx.restore();
};

CapturePoint.prototype.drawChainlink = function () {
    bs.ctx.beginPath();

    var sides = [[1, 1], [-1, 1], [1, -1], [-1, -1]];
    for (var i = 0; i < sides.length; i++) {
        var sideX = sides[i][0],
            sideY = sides[i][1];

        bs.ctx.moveTo(sideX * 10, sideY * 10);
        bs.ctx.lineTo(sideX * 17, sideY * 13);
        bs.ctx.lineTo(sideX * 13, sideY * 17);
        bs.ctx.lineTo(sideX * 10, sideY * 10);

        bs.ctx.fill();
        bs.ctx.stroke();
    }

    bs.ctx.closePath();
};

function Chainlink(from, to) {
    this.from = from;
    this.to = to;
    this.lastChange = Date.now();
    this.capturing = false;
    this.neutral = (this.from.teamState === TEAMSTATE_NEUTRAL || this.to.teamState === TEAMSTATE_NEUTRAL);
    this.friendly = (this.from.teamState === TEAMSTATE_TEAM && this.to.teamState === TEAMSTATE_TEAM);
    this.enemy = (this.from.teamState === TEAMSTATE_ENEMY && this.to.teamState === TEAMSTATE_ENEMY);
}

Chainlink.prototype.calculateLine = function (x1, y1, x2, y2, type) {
    var bs = 26;
    var dx = x2-x1;
    var dy = y2-y1;
    if (type === "circle") {
      var v1 = Math.atan(dy / dx);
      if (dx < 0) {
        v1 += Math.PI;
      }
      if (v1 < 0) {
        v1 += Math.PI * 2;
      }
      v2 = v1 + Math.PI;
      ret = [
        x1 + Math.cos(v1) * bs,
        y1 + Math.sin(v1) * bs,
        x2 + Math.cos(v2) * bs,
        y2 + Math.sin(v2) * bs
      ]
    } else {
        var right = dy > 0 ? 1 : -1;
        var up = dx > 0 ? 1 : -1;

        if (Math.abs(dx) < Math.abs(dy)) {
            var xpy = Math.abs(dx / dy);
            ret = [
                x1 + bs * xpy * up,
                y1 + bs * right,
                x2 - bs * xpy * up,
                y2 - bs * right]
        } else {
            var ypx = Math.abs(dy/dx);
            ret = [
                x1 + bs * up,
                y1 + bs * ypx * right,
                x2 - bs * up,
                y2 - bs * ypx * right
            ]
        }
    }
    return ret;
};

Chainlink.prototype.draw = function () {
    var fpos = bs.minimap.minimapToCanvasPos([this.from.xpos, this.from.ypos]);
    var tpos = bs.minimap.minimapToCanvasPos([this.to.xpos, this.to.ypos]);
    this.neutral = (this.from.teamState === TEAMSTATE_NEUTRAL || this.to.teamState === TEAMSTATE_NEUTRAL || this.to.teamState !== this.from.teamState);
    this.friendly = (this.from.teamState === TEAMSTATE_TEAM && this.to.teamState === TEAMSTATE_TEAM);
    this.enemy = (this.from.teamState === TEAMSTATE_ENEMY && this.to.teamState === TEAMSTATE_ENEMY);

    bs.ctx.save();
    bs.ctx.beginPath();
        if (this.neutral) {
            bs.ctx.setLineDash([8,2]);
            bs.ctx.globalAlpha = .7;
        } else {
            if (this.from.captureState == CAPTURESTATE_CAPTURING || this.from.captureState == CAPTURESTATE_CAPTURING) {
                var diff = Date.now() - this.lastChange;
                var blinkTime = 1000;
                diff = Math.abs(diff % blinkTime-blinkTime / 2);
                bs.ctx.globalAlpha = (diff * 2 / blinkTime);
            }
        }

        bs.ctx.strokeStyle = getTeamColorizationRGBA(this.neutral ? TEAMSTATE_NEUTRAL : this.from.teamState, this.neutral ? .7 : 1);

        var pos = { from: { x: 0, y: 0}, to: { x: 0, y: 0}};
        var line = this.calculateLine(fpos[0], fpos[1], tpos[0], tpos[1], this.neutral ? "circle" : "box");

        pos.from.x = line[0];
        pos.from.y = line[1];
        pos.to.x = line[2];
        pos.to.y = line[3];

        bs.ctx.moveTo(pos.from.x, pos.from.y);
        bs.ctx.lineTo(pos.to.x, pos.to.y);
        bs.ctx.lineWidth = 4;
        bs.ctx.fill();
        bs.ctx.stroke();
    bs.ctx.closePath();

    bs.ctx.restore();
};

function Player(x, y, rotation, target, teamState, icon){
	this.update(x, y, rotation, target, teamState, icon);
	this.lastChange = new Date().getTime();
}

Player.prototype.update = function(x, y, rotation, target, teamState, icon){
	this.xpos = x;
	this.ypos = y;
    if (teamState == TEAMSTATE_ENEMY)
	    this.rotation = (rotation + Math.PI) % (2 * Math.PI);
    else
        this.rotation = rotation;
	this.target = target;
	this.commanderTarget = -1;
	this.teamState = teamState;
	this.iconId = icon;
};

Player.prototype.draw = function(){
	bs.ctx.save();
	var cpos = bs.minimap.minimapToCanvasPos([this.xpos, this.ypos]);
    var dest, cpcpos;
	if (this.target >= 0 && this.target < bs.targets.length) {
		dest = bs.targets[this.target];
		cpcpos = bs.minimap.minimapToCanvasPos([dest.xpos, dest.ypos]);

		bs.ctx.strokeStyle = "#86E620";
		bs.ctx.lineCap = "round";
		bs.ctx.beginPath();
		bs.ctx.moveTo(cpos[0], cpos[1]);
		bs.ctx.lineTo(cpcpos[0], cpcpos[1]);
		bs.ctx.stroke();
		bs.ctx.restore();
		bs.ctx.save();
	}
	if (this.commanderTarget >= 0 && this.commanderTarget < bs.targets.length) {
		dest = bs.targets[this.commanderTarget];
		cpcpos = bs.minimap.minimapToCanvasPos([dest.xpos, dest.ypos]);

		bs.ctx.strokeStyle = "#fefefe";
		bs.ctx.lineCap = "round";
        if (bs.ctx.setLineDash) {
            bs.ctx.setLineDash([10]);
        }
		bs.ctx.beginPath();
		bs.ctx.moveTo(cpos[0], cpos[1]);
		bs.ctx.lineTo(cpcpos[0], cpcpos[1]);
		bs.ctx.stroke();
		bs.ctx.restore();
		bs.ctx.save();
	}
	if (this.iconId) {
		bs.ctx.translate(cpos[0], cpos[1]);
		bs.ctx.rotate(this.rotation + bs.minimap.rotation*Math.PI/180);
		var sizeScale = bs.iconScale;
		var subIcon = bs.getSubIcon(this.iconId, this.teamState, this.lastChange);
		if (subIcon) {
			bs.ctx.drawImage(subIcon.image, subIcon.x, subIcon.y, subIcon.width, subIcon.height, -subIcon.width*sizeScale/2, -subIcon.height*sizeScale/2, subIcon.width*sizeScale, subIcon.height*sizeScale);
		} else {
			var size = 4 * sizeScale;
			bs.ctx.strokeStyle = getTeamColorizationRGBA(this.teamState);
			bs.ctx.beginPath();
			bs.ctx.moveTo(-size, size);
			bs.ctx.lineTo(0, -size);
			bs.ctx.lineTo(size, size);
			bs.ctx.stroke();
		}
	}
	if (this.teamState == TEAMSTATE_SELF) {
		var size = 20*bs.iconScale;
		bs.ctx.restore();
		bs.ctx.save();
		bs.ctx.strokeStyle = "rgba(254, 254, 254, .4)";
		bs.ctx.lineCap = "round";
		bs.ctx.beginPath();
        bs.ctx.lineWidth = 2;
		bs.ctx.moveTo(cpos[0]+0.5, 0);
		bs.ctx.lineTo(cpos[0]+0.5, cpos[1]-size);
		bs.ctx.moveTo(cpos[0]+0.5, cpos[1]+size);
		bs.ctx.lineTo(cpos[0]+0.5, bs.canvas.height);
		bs.ctx.moveTo(0, cpos[1]+0.5);
		bs.ctx.lineTo(cpos[0]-size, cpos[1]+0.5);
		bs.ctx.moveTo(cpos[0]+size, cpos[1]+0.5);
		bs.ctx.lineTo(bs.canvas.width, cpos[1]+0.5);
		bs.ctx.stroke();

		bs.ctx.lineWidth = 2;
		bs.ctx.beginPath();
		bs.ctx.moveTo(cpos[0]-size/2, cpos[1]-size);
		bs.ctx.lineTo(cpos[0]-size, cpos[1]-size);
		bs.ctx.lineTo(cpos[0]-size, cpos[1]+size);
		bs.ctx.lineTo(cpos[0]-size/2, cpos[1]+size);

		bs.ctx.moveTo(cpos[0]+size/2, cpos[1]-size);
		bs.ctx.lineTo(cpos[0]+size, cpos[1]-size);
		bs.ctx.lineTo(cpos[0]+size, cpos[1]+size);
		bs.ctx.lineTo(cpos[0]+size/2, cpos[1]+size);
		bs.ctx.stroke();

	}

	bs.ctx.restore();
};

function Vehicle(x, y, rot, teamState, iconId){
	this.update(x, y, rot, teamState, iconId);
	this.lastChange = new Date().getTime();
}

Vehicle.prototype.update = function(x, y, rot, teamState, iconId){
	this.xpos = x;
	this.ypos = y;
	this.rotation = rot;
	this.teamState = teamState;
	this.iconId = iconId;
};

Vehicle.prototype.draw = function(){
	bs.ctx.save();
	var cpos = bs.minimap.minimapToCanvasPos([this.xpos, this.ypos]);
	bs.ctx.translate(cpos[0], cpos[1]);
	bs.ctx.rotate(this.rotation + bs.minimap.rotation*Math.PI/180);
	var sizeScale = bs.iconScale;
	var subIcon = bs.getSubIcon(this.iconId, this.teamState, this.lastChange);
	if (subIcon) {
		bs.ctx.drawImage(subIcon.image, subIcon.x, subIcon.y, subIcon.width, subIcon.height, -subIcon.width*sizeScale/2, -subIcon.height*sizeScale/2, subIcon.width*sizeScale, subIcon.height*sizeScale);
	} else {
		bs.ctx.beginPath();
		bs.ctx.strokeStyle = getTeamColorizationRGBA(this.teamState);
		var size = 4 * sizeScale;
		bs.ctx.moveTo(-size, size);
		bs.ctx.lineTo(0, -size);
		bs.ctx.lineTo(size, size);
		bs.ctx.stroke();
	}
	bs.ctx.restore();
};

function BattleScreen(minimapUrlPrefix){
	this.minimapUrlPrefix = minimapUrlPrefix;
	this.targets = [];
    this.chainlinks = [];
	this.players = [];
	this.vehicles = [];
	this.squadmembers = [];
	this.commanderTarget = -1;
	this.canvas = document.getElementById("battlescreen");
	this.ctx = this.canvas.getContext("2d");
    this.ctx.translate(0.5, 0.5);

    this.gameModes = $S.callFunction("battlereport.getGameServerMapModes");
    this.gameModeCategories = $S.callFunction("battlereport.getGameModeCategories");
    this.orderAnimation = null;

    this.gameClientGameModeMapping = [
        this.gameModes.UNKNOWN,
        this.gameModes.CAPTURETHEFLAG,
        this.gameModes.CHAINLINK,
        this.gameModes.CARRIERASSAULT,
        this.gameModes.CONQUEST,
        this.gameModes.RUSH,
        this.gameModes.OBLITERATION,
        this.gameModes.SQUADOBLITERATION
    ];

	this.staticNoise = null;

    this.listeners = {};
	this.addEventListeners();

	this.iconScale = 0.5;
	this.localPlayerIdx = -1;

	this.highlight = -1;
	this.remoteRenderingSupported = false;

	this.connection = new FBCompanionAppConnection("battlescreen");
	this.connection.addEventListener("recv", this.onRecv.bind(this));
	this.connection.addEventListener("connect", this.onConnect.bind(this));
	this.connection.addEventListener("disconnect", this.onDisconnect.bind(this));

	this.minimap = new Minimap();
    this.uiOverlay = new BattleScreenUiOverlay(this);
}

BattleScreen.prototype.addEventListeners = function() {
    this.removeEventListeners();

    var self = this;

    var addListener = function(type, listener) {
        document.getElementById("uioverlay").addEventListener(type, listener);
        self.listeners[type] = listener;
    };

    if (!navigator.pointerEnabled && !navigator.msPointerEnabled) {
        addListener("touchstart", function l1(e) { self.touchStart(e); });
        addListener("touchend", function l2(e) { self.touchEnd(e); });
        addListener("touchmove", function l3(e) { self.touchMove(e); });
    }

    addListener("mousedown", function l4(e) { self.mouseDown(e); });
    addListener("mousewheel", function l5(e) { self.mouseWheel(e); });
};

BattleScreen.prototype.removeEventListeners = function() {
	for (var type in this.listeners) {
		document.getElementById("uioverlay").removeEventListener(type, this.listeners[type]);
	}
	this.listeners = {};
};

BattleScreen.prototype.getSubIcon = function(id, state, lastChange) {
	if (!this.iconFrames || !this.icons)
		return null;
	// Try 'hud' first
	var subIcon = this.iconFrames[id+";2;"+IconTeamState[state]];
	if (!subIcon)
		subIcon = this.iconFrames[id+";2;0"];
	// then 'default'
	if (!subIcon)
		subIcon = this.iconFrames[id+";0;"+IconTeamState[state]];
	if (!subIcon)
		subIcon = this.iconFrames[id+";0;0"];

	if (subIcon) {
		var iconNum = state;
		if (state == TEAMSTATE_SELF)
			iconNum = TEAMSTATE_SQUAD;
		var diff = new Date().getTime()-lastChange;
		var frameTime = 1000 / subIcon.framerate;
		var frame = Math.abs(Math.floor(diff/frameTime)%subIcon.frames.length);
		subIcon = subIcon.frames[frame];
		subIcon.image = this.icons[iconNum];
		if (!subIcon.image)
			return null;
	}
	return subIcon;
}

BattleScreen.prototype.loadIcons = function(img) {

    if(!img) return;

	this.icons = new Array(TeamColorization.length+1);
	this.icons[TeamColorization.length] = img;
	var canvas = document.createElement("canvas");
	canvas.width = img.width;
	canvas.height = img.height;
	var ctx = canvas.getContext("2d");
	ctx.drawImage(img, 0, 0);
	var pixels = ctx.getImageData(0, 0, img.width, img.height);
	for (var color = 0; color < TeamColorization.length; ++color) {
		var destPixels = ctx.createImageData(img.width, img.height);
		var weightR = TeamColorization[color][0] / 255;
		var weightG = TeamColorization[color][1] / 255;
		var weightB = TeamColorization[color][2] / 255;
		var weightAlpha = TeamColorization[color][3] / 255;

		for (var yp = 0; yp < pixels.height; ++yp) {
			for (var xp = 0; xp < pixels.width; ++xp) {
				var pixelOffset = (yp*pixels.width+xp)*4;
				var luminance = pixels.data[pixelOffset] * 0.3 + pixels.data[pixelOffset+1] * 0.59 + pixels.data[pixelOffset+2] * 0.11;
				var darken = Math.min(luminance*2, 255);
				var lighten = Math.max(luminance*2-255, 0);
				destPixels.data[pixelOffset] = darken * weightR + lighten * (1-weightR);
				destPixels.data[pixelOffset+1] = darken * weightG + lighten * (1-weightG);
				destPixels.data[pixelOffset+2] = darken * weightB + lighten * (1-weightB);
				destPixels.data[pixelOffset+3] = pixels.data[pixelOffset+3] * weightAlpha;
			}
		}
		ctx.putImageData(destPixels, 0, 0);
		this.icons[color] = new Image();
		this.icons[color].src = canvas.toDataURL();
	}
}

var _timeout = 0;

BattleScreen.prototype.onRecv = function(newState) {

    // Reset state first if loading,
    if( $("#battlescreen-state-surface").length &&  $S("battlescreen-state-surface").getState().state == "loading" )
        $("#battlescreen-state").hide();

    if (newState.type == "gamestate" && newState.state == "disabled") {
        S.debug("GameStateEvent", newState);
        $S("battlescreen-state-surface").update({"state": "disabled"});
        $("#battlescreen").removeClass("battlescreen-visible").addClass("battlescreen-transparent");
    }
    else if (newState.type == "gamestate") {
        S.debug("GameStateEvent", newState);
        if (newState.gamemode) {
            this.gameMode = this.gameClientGameModeMapping[newState.gamemode];
        } else if (S.globalContext.session.user.presence.playingMp &&
            S.globalContext.staticContext.gameServerMapModes &&
            S.globalContext.session.user.presence.playingMp.gameMode) {
            this.gameMode = S.globalContext.session.user.presence.playingMp.gameMode;
        }

        // Default to conquest if gameMode is not set
        if (!this.gameMode) {
            this.gameMode = S.globalContext.staticContext.gameServerMapModes.CONQUEST;
        }

        var state = $S("scoring-widget").getState();
        if (state) {
            state.gameMode = this.gameMode;
            $S("scoring-widget").refresh();
        }

        $("#uioverlay").attr("data-gamemode", this.gameMode);

        switch (newState.state) {
            case "preround":
                this.uiOverlay.show();
            break;

            case "playing":
                bs.startRoundTimer();
                this.uiOverlay.show();
            break;

            default:
                this.uiOverlay.hide();
                this.roundTime = 0;
                clearInterval(this._roundTimer);
            break;
        }
    }
	else if (newState.type == "player") {
        //S.debug("PlayerEvent", newState);
		var localPlayerIdx = -1;

        this.num_players = newState.rotation.length;

        var oldTarget = this.localPlayerIdx >= 0 ? this.players[this.localPlayerIdx].target : null;

        for (var i = 0; i < newState.rotation.length; ++i) {
            if (newState.teamstate[i] == TEAMSTATE_SELF) {
                localPlayerIdx = i;
            }

            if (this.players[i]) {
                this.players[i].update(newState.x[i]/newState.pixelresolution, newState.y[i]/newState.pixelresolution, Math.PI-newState.rotation[i]*Math.PI/180, newState.target[i], newState.teamstate[i], newState.icon[i]);
            }
            else {
                this.players[i] = new Player(newState.x[i]/newState.pixelresolution, newState.y[i]/newState.pixelresolution, Math.PI-newState.rotation[i]*Math.PI/180, newState.target[i], newState.teamstate[i], newState.icon[i]);
            }
        }
		this.localPlayerIdx = localPlayerIdx;

        if (this.localPlayerIdx >= 0) {
            var localPlayer = this.players[this.localPlayerIdx];

            // Add commander target
            localPlayer.commanderTarget = this.commanderTarget;

            // Check if new order received
            if (oldTarget != localPlayer.target) {
                // Current target reset
                if (localPlayer.target == -1) {
                    bs.orderAnimation = null;
                }
                else {
                    var newTarget = this.targets[localPlayer.target];
                    // Ignore drops for now
                    if (newTarget && newTarget.name) {
                        bs.orderAnimation = new OrderAnimation(newTarget.xpos, newTarget.ypos, newTarget.teamState);
                    }
                }
            }
            // Make sure teamState is up-to-date
            else {
                if (bs.orderAnimation && this.targets[localPlayer.target]) {
                    bs.orderAnimation.update(this.targets[localPlayer.target].teamState);
                }
            }
        }
	} else if (newState.type == "vehicles") {
        //S.debug("Vehicles", newState);
		this.num_vehicles = newState.rotation.length;

        for (var i = 0; i < newState.rotation.length; ++i) {
            if (this.vehicles[i]) {
                this.vehicles[i].update(newState.x[i]/newState.pixelresolution, newState.y[i]/newState.pixelresolution, Math.PI-(newState.rotation[i])*Math.PI/180, newState.teamstate[i], newState.icon[i]);
            }
            else {
                this.vehicles[i] = new Vehicle(newState.x[i]/newState.pixelresolution, newState.y[i]/newState.pixelresolution, Math.PI-(newState.rotation[i])*Math.PI/180, newState.teamstate[i], newState.icon[i]);
            }
        }
	} else if (newState.type == "capturepoints") {
        S.debug("CapturePointEvent", newState);
		this.targets = [];
        this.chainlinks = [];
        this.flag = null;
        var names  = ["A", "B", "C", "D", "E", "F", "G", "H"];
        var nameMapping = {}, name, captureType, teamState;
		for (i = 0; i < newState.teamstate.length; ++i) {
            name = newState.name[i];
            if (name === "ID_H_US_H") {
                name = "F";
            }
            captureType = newState.captureType ? newState.captureType[i] : CP_TYPE_CAPTURE;
            teamState = newState.teamstate[i];
            this.targets[i] = new CapturePoint(
                captureType,
                name || captureType === CP_TYPE_CAPTURE ? name : "",
                newState.x[i]/newState.pixelresolution,
                newState.y[i]/newState.pixelresolution,
                newState.teamstate[i],
                newState.capturestate[i],
                newState.icon[i],
                newState.type
            );
            if (name) {
                nameMapping[name] = this.targets[i];
            }
            if (newState.capturetype === CP_TYPE_FLAG) {
                this.flag = this.targets[i];
            }
		}
        if (this.gameMode === S.globalContext.staticContext.gameServerMapModes.CHAINLINK) {
            var friendlyChainlinks = 0;
            var enemyChainlinks = 0;
            for (var i = 0, len = names.length, ch; i < len; i++) {
                if (nameMapping[names[i+1]]) {
                    var cl = new Chainlink(nameMapping[names[i]], nameMapping[names[i+1]]);
                    if (cl.friendly) {
                        friendlyChainlinks++;
                    }
                    if (cl.enemy) {
                        enemyChainlinks++;
                    }
                    this.chainlinks.push(cl);
                }
            }
            $S("scoring-widget").update({
                friendlyChainlinks: friendlyChainlinks,
                enemyChainlinks: enemyChainlinks
            })
        }

        this.uiOverlay.updateCapturePoints();
    } else if (newState.type == "squadinfo") {
        S.debug("SquadInfo", newState);
        this.commanderTarget = newState.commandertarget;
        if (this.localPlayerIdx >= 0) {
            this.players[this.localPlayerIdx].commanderTarget = this.commanderTarget;
        }

        this.uiOverlay.setSquadMode(newState.status);
        var members = [];
        for (var i = 0; i < newState.name.length; ++i) {
            members.push({
                "name": newState.name[i],
                "health": newState.health[i],
                "kitIcon": newState.kit[i],
                "leaderIcon": newState.leadericon[i]
            });
        }
        this.uiOverlay.updateSquadInfo(members);
    } else if (newState.type == "gadgets") {
        S.debug("Gadgets", newState);
        var myGadgets = [];
        var squadGadgets = [];
        for (var i = 0; i < newState.name.length; ++i) {
            var gadget = {"name": newState.name[i], "type": newState.gadgettype[i]};
            if (newState.teamstate[i] == TEAMSTATE_SQUAD) {
                squadGadgets.push(gadget);
            } else {
                myGadgets.push(gadget);
            }
        }
        this.uiOverlay.updateGadgets(myGadgets, squadGadgets);
    } else if (newState.type == "tickets") {
        S.debug("TicketsEvent", newState);
        this.roundTime = Math.floor(newState.roundTime);
        this.uiOverlay.updateTickets(newState);
    } else if (newState.type == "minimapdata") {
        S.debug("MinimapData", newState);
        this.minimap.load(newState);
    } else if (newState.type == "minimapimage") {
        S.debug("MinimapImage", newState);
        for (var j = 0; j < newState.dataURL.length; j++) {
            newState.dataURL[j] = this.minimapUrlPrefix.replace("%FILE%", newState.dataURL[j]);
        }

        // Minimap loaded, remove loading state
        if (newState.dataURL.length > 0) {
            if (_timeout) {
                clearTimeout(_timeout);
                _timeout = 0;
            }

            $("#battlescreen-state").fadeOut("fast", function() {
                $(this).remove();
            });

            // Remove battlescreen transparency and make it visible
            $("#battlescreen").removeClass("battlescreen-transparent").addClass("battlescreen-visible");
        }
        // HACK: Map reset, show loading state (should be solved properly with map changed event)
        else {
            $S("battlescreen-state-surface").update({"state": "loading"});
            $("#battlescreen").removeClass("battlescreen-visible").addClass("battlescreen-transparent");

            // Hide UI
            this.uiOverlay.hide();
        }

		this.minimap.loadImage(newState);
	} else if (newState.type == "minimappatch") {
        S.debug("MinimapPatch", newState);
		this.minimap.loadPatch(newState);
	} else if (newState.type == "minimappatchimage") {
        S.debug("MinimapPatchImage", newState);
		for (var k = 0; k < newState.dataURL.length; k++) {
			for (var l = 0; l < newState.dataURL[k].length; l++) {
				newState.dataURL[k][l] = this.minimapUrlPrefix.replace("%FILE%", newState.dataURL[k][l]);
			}
		}
		this.minimap.loadPatchImage(newState);
	} else if (newState.type == "combatarea") {
        S.debug("CombatArea", newState);
		this.minimap.setCombatArea(newState);
	} else if (newState.type == "remoterendering") {
        S.debug("RemoteRendering", newState);
		this.uiOverlay.toggleRemoteRendering(newState.supported);
		this.remoteRenderingSupported = newState.supported;
	} else if (newState.type == "icondata") {
        S.debug("IconData", newState);
		this.iconFrames = JSON.parse(newState.atlas.replace(/\s+/g, " "));
		var img = new Image();
		img.battlescreen = this;
		img.onload = function(){this.battlescreen.loadIcons(this);}
		img.src = this.iconFrames.imageData;
        this.loadIcons(img);
	} else {
        S.debug("UnhandledEvent", newState);
    }
};
BattleScreen.prototype.onConnect = function() {
    battlescreenMonitor.trackEvent(battlescreenMonitor.constants.CONNECTION_SUCCESS);
    if (S.globalContext.standalone) {
        _timeout = setTimeout(this.onTimeout.bind(this), 10000);
    }

	this.minimap.load({"visibleRect" : [0,0,1,1], "rotation" : 0, "dataURL" : []});
};
BattleScreen.prototype.onTimeout = function() {

    battlescreenMonitor.trackEvent(battlescreenMonitor.constants.ERROR_CONNECTION_TIMEOUT);

	$S("battlescreen-state-surface").update({"state": "timeout"});
    $("#battlescreen").removeClass("battlescreen-visible").addClass("battlescreen-transparent");
};
BattleScreen.prototype.onDisconnect = function() {

    battlescreenMonitor.trackEvent(battlescreenMonitor.constants.ERROR_NO_CONNECTION);

    $S("battlescreen-state-surface").update({"state": "noconnection"});
    $("#battlescreen").removeClass("battlescreen-visible").addClass("battlescreen-transparent");

    // Patch: clear UI
    this.uiOverlay.hide();

	// Clear the old state
	this.targets = [];
	this.players = [];
	this.vehicles = [];
	this.squadmembers = [];
    this.chainlinks = [];
	this.localPlayerIdx = -1;
	this.highlight = -1;
	this.remoteRenderingSupported = false;
    this.orderAnimation = null;
    this.num_players = 0;
    this.num_vehicles = 0;
	// Make sure the old data is cleared
	this.minimap = new Minimap();
};

var headerHeight = $("#base-header").height();
var comcenterWidth = $("#comcenter-friends").width();

BattleScreen.prototype.startRoundTimer = function () {
    if (this._roundTimer) { return; }
    var self = this;
    var lastUpdate = Date.now();
    this._roundTimer = setInterval(function(){
        if (self.roundTime > 0) {
            var now = Date.now();
            var diff = Math.floor((now - lastUpdate) / 1000);
            var state = $S("scoring-widget").getState();
            lastUpdate = now;
            if (state) {
                state.roundTime = self.roundTime;
                $S("scoring-widget").refresh();
            }
            self.roundTime -= diff;
        }
    }, 1000);
};

BattleScreen.prototype.render = function(timestamp){
    // Return if Battlescreen has been detached
    if (!bs) {
        return;
    }

	window.requestAnimationFrame(this.render.bind(this));
	// clear and resize
	var width = window.innerWidth,
		height = window.innerHeight;

    if (!S.globalContext.standalone) {
        if (S.globalContext.staticContext.detectedBrowser.isTouchDevice) {
            width = 1024;
        }
        else if ($("#comcenter-friends").is(":visible") && $("#comcenter-friends").css("z-index") > 0) {
            width -= comcenterWidth;
        }

        if ($("#base-header").is(":visible")) {
             height -= headerHeight;
        }
    }

	if (width != this.curWinWidth || height != this.curWinHeight) {
		this.curWinWidth = width;
		this.curWinHeight = height;
		this.canvas.width = this.curWinWidth;
		this.canvas.height = this.curWinHeight;
		if (this.connection.isConnected)
			this.minimap.calculateBounds();
		this.staticNoise = null;

		this.uiOverlay.resize(this.curWinWidth, this.curWinHeight);
	}
	// Clear the canvas
	this.canvas.width = this.canvas.width;

	this.uiOverlay.update();

	var csize = Math.min(this.curWinWidth, this.curWinHeight);
	this.iconScale = csize/768;
	if (this.iconScale > 1) {
		this.iconScale = 1;
    }

	this.minimap.draw(this.ctx, this.canvas.width, this.canvas.height);

    var i, len;
	for (i = 0, len = this.targets.length; i < len; ++i) {
		this.targets[i].draw();
    }
	// skip local player
	for (i = 0; i < this.num_players; ++i) {
		if (i != this.localPlayerIdx) {
			this.players[i].draw();
        }
	}
	for (i = 0; i < this.num_vehicles; ++i) {
		this.vehicles[i].draw();
    }
    for (i = 0, len = this.chainlinks.length; i < len; ++i) {
        this.chainlinks[i].draw();
    }

    // Order received for CP?
    if (bs.orderAnimation) {
        bs.orderAnimation.draw();
    }

	// Draw local player last
	if (this.localPlayerIdx != -1)
		this.players[this.localPlayerIdx].draw();
}
BattleScreen.prototype.pageToCanvasPos = function(mX, mY) {
	var relative = this.canvas;
	while (relative) {
		mX -= relative.offsetLeft;
		mY -= relative.offsetTop;
		relative = relative.offsetParent;
	}
	return [mX, mY];
}
BattleScreen.prototype.touchStart = function(ev) {
	if (!this.isPanning && ev.touches.length>1) {
		this.isPanning = true;
		this.minimap.beginPan();
	}
	this.grabX = 0;
	this.grabY = 0;
	for (var i = 0; i < ev.touches.length; ++i) {
		var pos = this.pageToCanvasPos(ev.touches[i].pageX, ev.touches[i].pageY);
		this.grabX += pos[0];
		this.grabY += pos[1];
	}
	this.grabX /= ev.touches.length;
	this.grabY /= ev.touches.length;
	this.zoomDist = 0;
	if (ev.touches.length == 2) {
		var dX = ev.touches[1].pageX - ev.touches[0].pageX;
		var dY = ev.touches[1].pageY - ev.touches[0].pageY;
		this.zoomDist = Math.sqrt(dX*dX+dY*dY);
	}
	ev.preventDefault();
};
BattleScreen.prototype.touchEnd = function(ev) {
	if (ev.touches.length == 0 && ev.changedTouches.length == 1 && !this.isPanning) {
		var pos = this.pageToCanvasPos(ev.changedTouches[0].pageX, ev.changedTouches[0].pageY);
		for (var t = 0; t < this.targets.length; ++t) {
			var target = this.targets[t];
			var tPos = this.minimap.minimapToCanvasPos([target.xpos, target.ypos]);
			if (Math.abs(pos[0]-tPos[0]) < 20 &&
				Math.abs(pos[1]-tPos[1]) < 20)
				this.setTarget(t);
		}
	} else {
		this.grabX = 0;
		this.grabY = 0;
		for (var i = 0; i < ev.touches.length; ++i) {
			var pos = this.pageToCanvasPos(ev.touches[i].pageX, ev.touches[i].pageY);
			this.grabX += pos[0];
			this.grabY += pos[1];
		}
		this.grabX /= ev.touches.length;
		this.grabY /= ev.touches.length;
		if (ev.touches.length == 2) {
			var dX = ev.touches[1].pageX - ev.touches[0].pageX;
			var dY = ev.touches[1].pageY - ev.touches[0].pageY;
			this.zoomDist = Math.sqrt(dX*dX+dY*dY);
		}
	}
	if (ev.touches.length == 0 && this.isPanning) {
		this.minimap.endPan();
		this.isPanning = false;
	}
	ev.preventDefault();
};
BattleScreen.prototype.touchMove = function(ev) {
	var cX = 0;
	var cY = 0;
	for (var i = 0; i < ev.touches.length; ++i) {
		var pos = this.pageToCanvasPos(ev.touches[i].pageX, ev.touches[i].pageY);
		cX += pos[0];
		cY += pos[1];
	}
	cX /= ev.touches.length;
	cY /= ev.touches.length;
	if (!this.isPanning && (Math.abs(this.grabX-cX) > 3 ||
		Math.abs(this.grabY-cY) > 3)) {
		this.isPanning = true;
		this.minimap.beginPan();
	}
	if (this.isPanning) {
		this.minimap.pan(this.grabX-cX, this.grabY-cY);
		this.grabX = cX;
		this.grabY = cY;
	}
	if (ev.touches.length == 2) {
		var dX = ev.touches[1].pageX - ev.touches[0].pageX;
		var dY = ev.touches[1].pageY - ev.touches[0].pageY;
		var zoomDist = Math.sqrt(dX*dX+dY*dY);
		if (this.zoomDist < 1)
			this.zoomDist = 1;
		this.minimap.zoom(cX, cY, zoomDist/this.zoomDist - 1);
		this.zoomDist = zoomDist;
	}
	ev.preventDefault();
};
BattleScreen.prototype.mouseDown = function(ev) {
	if (ev.button != 0 || ev.target.tagName.toLowerCase() == "input")
		return;
	var pos = this.pageToCanvasPos(ev.pageX, ev.pageY);
	this.grabX = pos[0];
	this.grabY = pos[1];
	this.isPanning = false;
	ev.preventDefault();
	//document.addEventListener("mousemove", this.mouseMove.bind(this), false);
	//document.addEventListener("mouseup", this.mouseUp.bind(this), false);
	document.onmousemove = this.mouseMove.bind(this);
	document.onmouseup = this.mouseUp.bind(this);
	if (ev.target.setCapture)
		ev.target.setCapture();
};
BattleScreen.prototype.mouseUp = function(ev) {
	if (ev.button != 0)
		return;
	var pos = this.pageToCanvasPos(ev.pageX, ev.pageY);
	var mX = pos[0];
	var mY = pos[1];
	if (!this.isPanning) {
		for (var t = 0; t < this.targets.length; ++t) {
			var target = this.targets[t];
			var tPos = this.minimap.minimapToCanvasPos([target.xpos, target.ypos]);
			if (Math.abs(mX-tPos[0]) < 20 &&
				Math.abs(mY-tPos[1]) < 20)
				this.setTarget(t);
		}
	} else
		this.minimap.endPan();
	ev.preventDefault();
	//document.removeEventListener("mousemove", this.mouseMove.bind(this), false);
	//document.removeEventListener("mouseup", this.mouseUp.bind(this), false);
	document.onmousemove = null;
	document.onmouseup = null;
	if (ev.target.releaseCapture)
		ev.target.releaseCapture();
};
BattleScreen.prototype.mouseMove = function(ev) {
	var pos = this.pageToCanvasPos(ev.pageX, ev.pageY);
	var mX = pos[0];
	var mY = pos[1];
	if (!this.isPanning && (Math.abs(this.grabX-mX) > 3 ||
		Math.abs(this.grabY-mY) > 3)) {
		this.isPanning = true;
		this.minimap.beginPan();
	}
	if (this.isPanning) {
		this.minimap.pan(this.grabX-mX, this.grabY-mY);
		this.grabX = mX;
		this.grabY = mY;
	}
	ev.preventDefault();
};
BattleScreen.prototype.mouseWheel = function(ev) {
	var pos = this.pageToCanvasPos(ev.pageX, ev.pageY);
	var mX = pos[0];
	var mY = pos[1];
	// 600 here maps 120 (normal step size) to +/- 20%
	this.minimap.zoom(mX, mY, (600+ev.wheelDelta)/600 - 1);
	ev.preventDefault();
};
BattleScreen.prototype.setTarget = function (t) {
	var json = "{ \"type\" : \"target\", \"target\" : " + t + "}";
	this.connection.send(json);
}
BattleScreen.prototype.requestOrder = function() {
	this.connection.send({"type" : "requestorder"});
}
BattleScreen.prototype.requestAsset = function(ass) {
	this.connection.send({"type" : "requestasset", "asset" : ass});
}

function showRemoteView(gtype, gname)
{
	var json = "{ \"type\" : \"remoterendering\", \"gadgettype\" : " + gtype + ", \"gadgetname\" : \"" + gname + "\" }";
	bs.connection.send(json);
}

function initBattleScreen(minimapUrlPrefix) {
	bs = new BattleScreen(minimapUrlPrefix);
	window.requestAnimationFrame(bs.render.bind(bs));
}

function detachBattleScreen() {
    if (bs) {
        bs.removeEventListeners();
        bs.connection.disconnectWebSocket();
        bs = null;
    }
}

function connectBattleScreen(minimapUrlPrefix) {
    if (bs) {
        if (!bs.connection.isConnected) {
            bs.connection.connectionDetails = bs.connection.getConnectionDetails();
            bs.connection.connectWebSocket();
        }
    }
    else {
        initBattleScreen(minimapUrlPrefix);
    }
}
;function MinimapTile(gridSize, images, parentTile, rootTile) {
    this.parentTile = parentTile;
    if (rootTile)
        this.rootTile = rootTile;
    else
        this.rootTile = this;
    this.image = null;
    this.failed = false;
    this.loading = false;
    this.loadingCount = 0;
    if (images.length > 1) {
        this.dataURL = null;
        this.children = new Array(4);
        var childImages = new Array(gridSize*gridSize/4);
        for (var yp = 0; yp < gridSize/2; ++yp) {
            for (var xp = 0; xp < gridSize/2; ++xp) {
                childImages[yp*gridSize/2+xp] = images[yp*gridSize+xp];
            }
        }
        this.children[0] = new MinimapTile(Math.floor(gridSize/2), childImages, this, this.rootTile);
        for (var yp = 0; yp < gridSize/2; ++yp) {
            for (var xp = 0; xp < gridSize/2; ++xp) {
                childImages[yp*gridSize/2+xp] = images[yp*gridSize+xp+gridSize/2];
            }
        }
        this.children[1] = new MinimapTile(Math.floor(gridSize/2), childImages, this, this.rootTile);
        for (var yp = 0; yp < gridSize/2; ++yp) {
            for (var xp = 0; xp < gridSize/2; ++xp) {
                childImages[yp*gridSize/2+xp] = images[(yp+gridSize/2)*gridSize+xp];
            }
        }
        this.children[2] = new MinimapTile(Math.floor(gridSize/2), childImages, this, this.rootTile);
        for (var yp = 0; yp < gridSize/2; ++yp) {
            for (var xp = 0; xp < gridSize/2; ++xp) {
                childImages[yp*gridSize/2+xp] = images[(yp+gridSize/2)*gridSize+xp+gridSize/2];
            }
        }
        this.children[3] = new MinimapTile(Math.floor(gridSize/2), childImages, this, this.rootTile);
    } else {
        this.dataURL = images[0];
        this.children = null;
    }
}
MinimapTile.prototype.addDetailLevel = function(images) {
    if (images.length == 4) {
        // Create new children
        this.children = new Array(4);
        for (var ch = 0; ch < 4; ++ch) {
            this.children[ch] = new MinimapTile(1, images.slice(ch, ch+1), this, this.rootTile);
        }
    } else if (this.children) {
        var childImg = new Array(images.length/4);
        var size = Math.floor(Math.sqrt(images.length));
        for (var ch = 0; ch < 4; ++ch) {
            var xofs = (ch==1||ch==3)?size/2:0;
            var yofs = (ch>1)?size/2:0;
            for (var yp = 0; yp < size/2; ++yp) {
                for (var xp = 0; xp < size/2; ++xp) {
                    childImg[yp*size/2+xp] = images[(yp+yofs)*size+xp+xofs];
                }
            }
            this.children[ch].addDetailLevel(childImg);
        }
    }
}
MinimapTile.prototype.triggerLoad = function() {

    var processNow = false;
    if (this.loadingCount++ > 30) {
        this.loading = false;
        this.loadingCount = 0;
        processNow = true;

    }
    if (this.image || this.failed || this.loading || this.dataURL == null)
        return;

    this.loading = true;
    var loadImg = new Image();
    loadImg.tile = this;
    loadImg.onload = function(){this.tile.processImage(this);};
    loadImg.onerror = function(){this.tile.processImage(null);};
    if (this.dataURL.indexOf('data:image') > 0) {
        this.dataURL = this.dataURL.substring(this.dataURL.indexOf('data:image'));
    }


    loadImg.src = this.dataURL;
    if(processNow) {
        this.image = loadImg;
    }


};
MinimapTile.prototype.processImage = function(img) {

    if (!img)
        this.failed = true;
    else
        this.image = img;

    this.loading = false;
    this.loadingCount = 0;

};
MinimapTile.prototype.canDraw = function(ctx, x, y, w, h, rotation) {
    var virtualWidth, virtualHeight;
    if (rotation == 90 || rotation == 270) {
        virtualWidth = ctx.canvas.height;
        virtualHeight = ctx.canvas.width;
    } else {
        virtualWidth = ctx.canvas.width;
        virtualHeight = ctx.canvas.height;
    }
    if (x >= virtualWidth || y >= virtualHeight || x+w <= 0 || y+h <= 0)
        return true;
    var tileW = Math.round(w/2);
    var tileH = Math.round(h/2);
    if (this.image)
        return true;
    return this.children &&
        this.children[0].canDraw(ctx, x, y, tileW, tileH, rotation) &&
        this.children[1].canDraw(ctx, x+tileW, y, w-tileW, tileH, rotation) &&
        this.children[2].canDraw(ctx, x, y+tileH, tileW, h-tileH, rotation) &&
        this.children[3].canDraw(ctx, x+tileW, y+tileH, w-tileW, h-tileH, rotation);
};
MinimapTile.prototype.draw = function(ctx, x, y, w, h, rotation) {

    var virtualWidth, virtualHeight;
    if (rotation == 90 || rotation == 270) {
        virtualWidth = ctx.canvas.height;
        virtualHeight = ctx.canvas.width;
    } else {
        virtualWidth = ctx.canvas.width;
        virtualHeight = ctx.canvas.height;
    }
    if (x >= virtualWidth || y >= virtualHeight || x+w <= 0 || y+h <= 0)
        return;
    var tileW = Math.round(w/2);
    var tileH = Math.round(h/2);

    if (!this.image) {
        var _this = this;
        $(document).ready(function() {
            _this.triggerLoad();
        }) ;


    }
    if (this.children && ((this.image && this.image.width < w) || !this.dataURL || this.failed)) {
        if (!this.children[0].canDraw(ctx, x, y, tileW, tileH, rotation) ||
            !this.children[1].canDraw(ctx, x+tileW, y, w-tileW, tileH, rotation) ||
            !this.children[2].canDraw(ctx, x, y+tileH, tileW, h-tileH, rotation) ||
            !this.children[3].canDraw(ctx, x+tileW, y+tileH, w-tileW, h-tileH, rotation)) {
            if (this.image)
                ctx.drawImage(this.image, x, y, w, h);
        }
        this.children[0].draw(ctx, x, y, tileW, tileH, rotation);
        this.children[1].draw(ctx, x+tileW, y, w-tileW, tileH, rotation);
        this.children[2].draw(ctx, x, y+tileH, tileW, h-tileH, rotation);
        this.children[3].draw(ctx, x+tileW, y+tileH, w-tileW, h-tileH, rotation);
    } else if (this.image) {
        ctx.drawImage(this.image, x, y, w, h);
    }
};

function Minimap() {
    this.rootTile = null;
    // The part of the minimap which is visible, top-left and bottom-right
    this.visibleRect = [0,0,1,1];
    // Margins for left, top, right, bottom
    this.margins = [100, 0, 100, 0];
    // Rect in canvas pixels where the full minimap should be drawn, top,left,width,height
    this.destRect = [0, 0, 0, 0];

    this.destRectBounds = [0, 0, 0, 0];
    this.maxZoom = 4;

    this.rotation = 0;

    this.patches = {"patchEnabled": [], "patchCenter": [], "patchSize": []};
    this.patchImages = [];
    this.combatAreaX = [];
    this.combatAreaY = [];
    this.combatAreaCW = true;
}

Minimap.prototype.load = function(newState) {
    this.visibleRect = newState.visibleRect;
    this.rotation = Math.round(newState.rotation / 90) * 90;

    this.calculateBounds();
};

Minimap.prototype.loadImage = function(newState) {
    var gridSize = newState.gridSize || 2;
    if (gridSize > 0) {
        var curSize = gridSize;
        var offset = 0;
        while (curSize*curSize < newState.dataURL.length-offset) {
            offset += curSize*curSize;
            curSize /= 2;
        }
        this.rootTile = new MinimapTile(curSize, newState.dataURL.slice(offset), null, null);
        while (offset > 0) {
            curSize *= 2;
            offset -= curSize*curSize;
            this.rootTile.addDetailLevel(newState.dataURL.slice(offset, offset+curSize*curSize));
        }
    } else
        this.rootTile = null;
};

Minimap.prototype.loadPatch = function(newState) {
    this.patches = newState;
};

Minimap.prototype.loadPatchImage = function(newState) {
    this.patchImages = [];
    for (var patch = 0; patch < newState.dataURL.length; ++patch)
    {
        var gridSize = newState.gridSize;
        if (gridSize > 0) {
            var curSize = gridSize;
            var offset = 0;
            while (curSize*curSize < newState.dataURL[patch].length-offset) {
                offset += curSize*curSize;
                curSize /= 2;
            }
            this.patchImages[patch] = new MinimapTile(curSize, newState.dataURL[patch].slice(offset), null, null);
            while (offset > 0) {
                curSize *= 2;
                offset -= curSize*curSize;
                this.patchImages[patch].addDetailLevel(newState.dataURL[patch].slice(offset, offset+curSize*curSize));
            }
        } else
            this.patchImages[patch] = null;
    }
};

Minimap.prototype.setCombatArea = function(newState) {
    this.combatAreaX = newState.x;
    this.combatAreaY = newState.y;
    var checkY = (this.combatAreaY[0] + this.combatAreaY[1]) / 2;
    var isCW = true;
    var minX = this.combatAreaX[0] + this.combatAreaX[1];
    for (var i = 0; i < this.combatAreaX.length; ++i) {
        var ni = (i+1) % this.combatAreaX.length;
        if (this.combatAreaY[i] <= checkY && this.combatAreaY[ni] >= checkY && this.combatAreaY[i] != this.combatAreaY[ni]) {
            var offset = (checkY-this.combatAreaY[i]) / (this.combatAreaY[ni]-this.combatAreaY[i]);
            var x = this.combatAreaX[i] + (this.combatAreaX[ni]-this.combatAreaX[i]) * offset;
            if (x < minX) {
                minX = x;
                isCW = false;
            }
        } else if (this.combatAreaY[i] >= checkY && this.combatAreaY[ni] <= checkY && this.combatAreaY[i] != this.combatAreaY[ni]) {
            var offset = (checkY-this.combatAreaY[ni]) / (this.combatAreaY[i]-this.combatAreaY[ni]);
            var x = this.combatAreaX[ni] + (this.combatAreaX[i]-this.combatAreaX[ni]) * offset;
            if (x < minX) {
                minX = x;
                isCW = true;
            }
        }
    }
    for (var i = 0; i < this.combatAreaX.length; ++i) {
        this.combatAreaX[i] /= newState.pixelresolution;
        this.combatAreaY[i] /= newState.pixelresolution;
    }
    this.combatAreaCW = isCW;
};

Minimap.prototype.zoom = function(x, y, delta) {
    var oldx = x;
    var oldy = y;
    switch (this.rotation) {
        case 90:
            x = y;
            y = bs.canvas.width - oldx;
            break;
        case 180:
            x = bs.canvas.width - x;
            y = bs.canvas.height - y;
            break;
        case 270:
            x = bs.canvas.height - y;
            y = oldx;
            break;
    }

    var deltaX = delta * this.destRect[2];
    var deltaY = delta * this.destRect[3];
    var rawDeltaX = deltaX;
    var rawDeltaY = deltaY;
    if (this.destRect[2]+deltaX < this.destRectBounds[2])
        deltaX = this.destRectBounds[2]-this.destRect[2];
    if (this.destRect[3]+deltaY < this.destRectBounds[3])
        deltaY = this.destRectBounds[3]-this.destRect[3];
    if (this.destRect[2]+deltaX > this.destRectBounds[2]*this.maxZoom)
        deltaX = this.destRectBounds[2]*this.maxZoom-this.destRect[2];
    if (this.destRect[3]+deltaY > this.destRectBounds[3]*this.maxZoom)
        deltaY = this.destRectBounds[3]*this.maxZoom-this.destRect[3];
    if (deltaX != rawDeltaX)
        return this.zoom(oldx, oldy, deltaX / this.destRect[2]);
    if (deltaY != rawDeltaY)
        return this.zoom(oldx, oldy, deltaY / this.destRect[3]);
    // Find center point to zoom in on
    var cX = x-this.destRect[0];
    var cY = y-this.destRect[1];
    var leftWeight = cX / this.destRect[2];
    var topWeight = cY / this.destRect[3];
    this.destRect[0] -= leftWeight*deltaX;
    this.destRect[1] -= topWeight*deltaY;
    this.destRect[2] += deltaX;
    this.destRect[3] += deltaY;
    this.constrainPos(false);
    this.beginPan();
};
Minimap.prototype.beginPan = function() {
    this.panX = this.destRect[0];
    this.panY = this.destRect[1];
};
Minimap.prototype.endPan = function() {
    this.constrainPos(false);
};
Minimap.prototype.pan = function(dx, dy) {
    var olddx = dx;
    switch (this.rotation) {
        case 90:
            dx = dy;
            dy = -olddx;
            break;
        case 180:
            dx = -dx;
            dy = -dy;
            break;
        case 270:
            dx = -dy;
            dy = olddx;
            break;
    }

    this.panX -= dx;
    this.panY -= dy;
    this.destRect[0] = this.panX;
    this.destRect[1] = this.panY;
    this.constrainPos(true);
};

////////// Bounds mapping //////////
function scaleOverflow(overflow) {
    var overflowScale = 10;
    var maxOverflow = 100*overflowScale;
    overflow = maxOverflow-Math.min(overflow, maxOverflow);
    overflow = overflow*overflow/(overflowScale*maxOverflow);
    overflow = maxOverflow/overflowScale-overflow;
    return overflow;
}
Minimap.prototype.constrainPos = function(isPan) {
    var virtualWidth, virtualHeight;
    if (this.rotation == 90 || this.rotation == 270) {
        virtualWidth = bs.canvas.height;
        virtualHeight = bs.canvas.width;
    } else {
        virtualWidth = bs.canvas.width;
        virtualHeight = bs.canvas.height;
    }
    var marginOffset = Math.round(this.rotation/90)%4;
    var scale = this.destRect[2] / this.destRectBounds[2];
    var leftMarginBound = (this.destRectBounds[0]-this.margins[marginOffset])*scale+this.margins[marginOffset];
    if (this.destRect[0] > leftMarginBound) {
        if (isPan)
            this.destRect[0] = leftMarginBound+scaleOverflow(this.destRect[0]-leftMarginBound);
        else
            this.destRect[0] = leftMarginBound;
    }
    var rightMarginBound = (this.destRectBounds[0]+this.destRectBounds[2]-virtualWidth+this.margins[(marginOffset+2)%4])*scale-this.margins[(marginOffset+2)%4];
    if (this.destRect[0]+this.destRect[2]-virtualWidth < rightMarginBound) {
        if (isPan)
            this.destRect[0] = rightMarginBound+virtualWidth-this.destRect[2]-scaleOverflow(rightMarginBound-(this.destRect[0]+this.destRect[2]-virtualWidth));
        else
            this.destRect[0] = rightMarginBound+virtualWidth-this.destRect[2];
    }
    var topMarginBound = (this.destRectBounds[1]-this.margins[(marginOffset+1)%4])*scale+this.margins[(marginOffset+1)%4];
    if (this.destRect[1] > topMarginBound) {
        if (isPan)
            this.destRect[1] = topMarginBound+scaleOverflow(this.destRect[1]-topMarginBound);
        else
            this.destRect[1] = topMarginBound;
    }
    var bottomMarginBound = (this.destRectBounds[1]+this.destRectBounds[3]-virtualHeight+this.margins[(marginOffset+3)%4])*scale-this.margins[(marginOffset+3)%4];
    if (this.destRect[1]+this.destRect[3]-virtualHeight < bottomMarginBound) {
        if (isPan)
            this.destRect[1] = bottomMarginBound+virtualHeight-this.destRect[3] - scaleOverflow(bottomMarginBound-(this.destRect[1]+this.destRect[3]-virtualHeight));
        else
            this.destRect[1] = bottomMarginBound+virtualHeight-this.destRect[3];
    }
};

// Map the minimap position (range 0..1) to the canvas range
Minimap.prototype.calculateBounds = function() {
    var virtualWidth, virtualHeight;
    if (this.rotation == 90 || this.rotation == 270) {
        virtualWidth = bs.canvas.height;
        virtualHeight = bs.canvas.width;
    } else {
        virtualWidth = bs.canvas.width;
        virtualHeight = bs.canvas.height;
    }
    var marginOffset = Math.round(this.rotation/90)%4;
    // Calculate which scale the minimap should be rendered in
    var availX = virtualWidth - this.margins[marginOffset] - this.margins[(marginOffset+2)%4];
    var availY = virtualHeight - this.margins[(marginOffset+1)%4] - this.margins[(marginOffset+3)%4];
    var visW = this.visibleRect[2]-this.visibleRect[0];
    var visH = this.visibleRect[3]-this.visibleRect[1];
    var scale = availX / visW;
    var scale2 = availY / visH;
    if (scale2 < scale)
        scale = scale2;
    // Calculate which minimap position should be in the center of the canvas
    var cX = (this.visibleRect[2]+this.visibleRect[0]) / 2;
    var cY = (this.visibleRect[3]+this.visibleRect[1]) / 2;

    // Calculate the canvas coordinates which the minimap should fill
    var mmLeft = (this.margins[marginOffset] + availX/2) - cX * scale;
    var mmTop = (this.margins[(marginOffset+1)%4] + availY/2) - cY * scale;
    var mmRight = virtualWidth - (this.margins[(marginOffset+2)%4] + availX/2) + (1-cX) * scale;
    var mmBottom = virtualHeight - (this.margins[(marginOffset+3)%4] + availY/2) + (1-cY) * scale;
    this.destRect[0] = Math.round(mmLeft);
    this.destRect[1] = Math.round(mmTop);
    this.destRect[2] = Math.round(mmRight-mmLeft);
    this.destRect[3] = Math.round(mmBottom-mmTop);
    this.destRectBounds[0] = this.destRect[0];
    this.destRectBounds[1] = this.destRect[1];
    this.destRectBounds[2] = this.destRect[2];
    this.destRectBounds[3] = this.destRect[3];

    var pixelSize = 1/(scale*this.maxZoom);
    var json = "{ \"type\" : \"pixelsize\", \"size\" : " + pixelSize + " }";
    bs.connection.send(json);
};

// Convert a minimap position in the range 0..1 to a canvas position
Minimap.prototype.minimapToCanvasPos = function(pos) {
    var xpos = (pos[0] * this.destRect[2] + this.destRect[0]);
    var ypos = (pos[1] * this.destRect[3] + this.destRect[1]);
    var oldx = xpos;
    switch (this.rotation) {
        case 90:
            xpos = bs.canvas.width - ypos;
            ypos = oldx;
            break;
        case 180:
            xpos = bs.canvas.width - xpos;
            ypos = bs.canvas.height - ypos;
            break;
        case 270:
            xpos = ypos;
            ypos = bs.canvas.height - oldx;
            break;
    }
    return [xpos, ypos];
};

////////// Rendering //////////

Minimap.prototype.draw = function (ctx, w, h) {
    if (this.rootTile) {
        ctx.save();
        if (this.rotation == 90) {
            ctx.translate(ctx.canvas.width, 0);
        } else if (this.rotation == 180) {
            ctx.translate(ctx.canvas.width, ctx.canvas.height);
        } else if (this.rotation == 270) {
            ctx.translate(0, ctx.canvas.height);
        }
        ctx.rotate(this.rotation * Math.PI / 180);
        this.rootTile.draw(ctx, this.destRect[0], this.destRect[1], this.destRect[2], this.destRect[3], this.rotation);

        var visW = this.visibleRect[2]-this.visibleRect[0];
        var visH = this.visibleRect[3]-this.visibleRect[1];

        for (var patch = 0; patch < this.patches.patchEnabled.length && patch < this.patchImages.length; ++patch) {
            if (this.patchImages[patch] && this.patches.patchEnabled[patch]) {
                var xpos = Math.round(this.patches.patchCenter[patch*2] * this.destRect[2] + this.destRect[0]);
                var ypos = Math.round(this.patches.patchCenter[patch*2+1] * this.destRect[3] + this.destRect[1]);
                var w = this.patches.patchSize[patch] * this.destRect[2];
                var h = this.patches.patchSize[patch] * this.destRect[3];
                this.patchImages[patch].draw(ctx, xpos-w/2, ypos-h/2, w, h, this.rotation);
            }
        }
        ctx.restore();
        if (this.combatAreaX.length) {
            var pos = this.minimapToCanvasPos([this.combatAreaX[0], this.combatAreaY[0]]);
            ctx.beginPath();
            ctx.moveTo(pos[0], pos[1]);
            for (var i = 0; i < this.combatAreaX.length; ++i) {
                var p = this.minimapToCanvasPos([this.combatAreaX[i], this.combatAreaY[i]]);
                ctx.lineTo(p[0], p[1]);
            }
            ctx.lineTo(pos[0], pos[1]);
            ctx.closePath();
            var tl = this.minimapToCanvasPos([-1, -1]);
            var tr = this.minimapToCanvasPos([2, -1]);
            var bl = this.minimapToCanvasPos([-1, 2]);
            var br = this.minimapToCanvasPos([2, 2]);
            ctx.moveTo(tl[0], tl[1]);
            if (this.combatAreaCW) {
                ctx.lineTo(bl[0], bl[1]);
                ctx.lineTo(br[0], br[1]);
                ctx.lineTo(tr[0], tr[1]);
            } else {
                ctx.lineTo(tr[0], tr[1]);
                ctx.lineTo(br[0], br[1]);
                ctx.lineTo(bl[0], bl[1]);
            }
            ctx.lineTo(tl[0], tl[1]);
            ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(pos[0], pos[1]);
            for (var i = 0; i < this.combatAreaX.length; ++i) {
                var p = this.minimapToCanvasPos([this.combatAreaX[i], this.combatAreaY[i]]);
                ctx.lineTo(p[0], p[1]);
            }
            ctx.lineTo(pos[0], pos[1]);
            ctx.closePath();
            ctx.strokeStyle = "rgba(255, 255, 255, 0.5)";
            ctx.stroke();
        }
    }
};

;(function(t,e,i){function n(i,s){if(!e[i]){if(!t[i]){var a="function"==typeof require&&require;if(!s&&a)return a(i,!0);if(o)return o(i,!0);throw Error("Cannot find module '"+i+"'")}var r=e[i]={exports:{}};t[i][0].call(r.exports,function(e){var o=t[i][1][e];return n(o?o:e)},r,r.exports)}return e[i].exports}for(var o="function"==typeof require&&require,s=0;i.length>s;s++)n(i[s]);return n})({1:[function(t){t("./leaflet"),t("./mapbox")},{"./leaflet":2,"./mapbox":3}],2:[function(t){window.L=t("leaflet/dist/leaflet-src")},{"leaflet/dist/leaflet-src":4}],5:[function(t,e){e.exports={author:"MapBox",name:"mapbox.js",description:"mapbox javascript api",version:"1.3.1",homepage:"http://mapbox.com/",repository:{type:"git",url:"git://github.com/mapbox/mapbox.js.git"},main:"index.js",dependencies:{leaflet:"0.6.2",mustache:"~0.7.2",corslite:"0.0.3",json3:"~3.2.5"},scripts:{test:"mocha-phantomjs test/index.html"},devDependencies:{"leaflet-hash":"git://github.com/mlevans/leaflet-hash.git#b039a3aa4e2492a5c7448075172ac26769e601d6","leaflet-fullscreen":"0.0.0","uglify-js":"~2.2.5",mocha:"~1.9","expect.js":"~0.2.0",sinon:"~1.7.3","mocha-phantomjs":"~1.1.1",happen:"~0.1.2",browserify:"~2.22.0"},optionalDependencies:{},engines:{node:"*"}}},{}],6:[function(t,e){"use strict";e.exports={HTTP_URLS:["http://a.tiles.mapbox.com/v3/","http://b.tiles.mapbox.com/v3/","http://c.tiles.mapbox.com/v3/","http://d.tiles.mapbox.com/v3/"],FORCE_HTTPS:!1,HTTPS_URLS:["https://a.tiles.mapbox.com/v3/","https://b.tiles.mapbox.com/v3/","https://c.tiles.mapbox.com/v3/","https://d.tiles.mapbox.com/v3/"]}},{}],4:[function(t,e){(function(){(function(t,i,n){var o=t.L,s={};s.version="0.6.2","object"==typeof e&&"object"==typeof e.exports?e.exports=s:"function"==typeof define&&define.amd&&define(s),s.noConflict=function(){return t.L=o,this},t.L=s,s.Util={extend:function(t){var e,i,n,o,s=Array.prototype.slice.call(arguments,1);for(i=0,n=s.length;n>i;i++){o=s[i]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,o;if("object"==typeof t){o=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(o));return!0}return!1},limitExecByInterval:function(t,e,i){var o,s;return function a(){var r=arguments;return o?(s=!0,n):(o=!0,setTimeout(function(){o=!1,s&&(a.apply(i,r),s=!1)},e),t.apply(i,r),n)}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return s.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=s.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,i){var o=e[i];if(o===n)throw Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,o=["webkit","moz","o","ms"];for(i=0;o.length>i&&!n;i++)n=t[o[i]+e];return n}function i(e){var i=+new Date,n=Math.max(0,16-(i-o));return o=i+n,t.setTimeout(e,n)}var o=0,a=t.requestAnimationFrame||e("RequestAnimationFrame")||i,r=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};s.Util.requestAnimFrame=function(e,o,r,l){return e=s.bind(e,o),r&&a===i?(e(),n):a.call(t,e,l)},s.Util.cancelAnimFrame=function(e){e&&r.call(t,e)}}(),s.extend=s.Util.extend,s.bind=s.Util.bind,s.stamp=s.Util.stamp,s.setOptions=s.Util.setOptions,s.Class=function(){},s.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var o in this)this.hasOwnProperty(o)&&"prototype"!==o&&(e[o]=this[o]);t.statics&&(s.extend(e,t.statics),delete t.statics),t.includes&&(s.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=s.extend({},n.options,t.options)),s.extend(n,t),n._initHooks=[];var a=this;return e.__super__=a.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){a.prototype.callInitHooks&&a.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},s.Class.include=function(t){s.extend(this.prototype,t)},s.Class.mergeOptions=function(t){s.extend(this.prototype.options,t)},s.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var a="_leaflet_events";s.Mixin={},s.Mixin.Events={addEventListener:function(t,e,i){if(s.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,o,r,l,h,c,u,p=this[a]=this[a]||{},d=i&&s.stamp(i);for(t=s.Util.splitWords(t),n=0,o=t.length;o>n;n++)r={action:e,context:i||this},l=t[n],i?(h=l+"_idx",c=h+"_len",u=p[h]=p[h]||{},u[d]||(u[d]=[],p[c]=(p[c]||0)+1),u[d].push(r)):(p[l]=p[l]||[],p[l].push(r));return this},hasEventListeners:function(t){var e=this[a];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[a])return this;if(!t)return this.clearAllEventListeners();if(s.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,o,r,l,h,c,u,p,d,m=this[a],f=i&&s.stamp(i);for(t=s.Util.splitWords(t),n=0,o=t.length;o>n;n++)if(r=t[n],c=r+"_idx",u=c+"_len",p=m[c],e){if(l=i&&p?p[f]:m[r]){for(h=l.length-1;h>=0;h--)l[h].action!==e||i&&l[h].context!==i||(d=l.splice(h,1),d[0].action=s.Util.falseFn);i&&p&&0===l.length&&(delete p[f],m[u]--)}}else delete m[r],delete m[c];return this},clearAllEventListeners:function(){return delete this[a],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,o,r,l,h=s.Util.extend({},e,{type:t,target:this}),c=this[a];if(c[t])for(i=c[t].slice(),n=0,o=i.length;o>n;n++)i[n].action.call(i[n].context||this,h);r=c[t+"_idx"];for(l in r)if(i=r[l].slice())for(n=0,o=i.length;o>n;n++)i[n].action.call(i[n].context||this,h);return this},addOneTimeEventListener:function(t,e,i){if(s.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=s.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},s.Mixin.Events.on=s.Mixin.Events.addEventListener,s.Mixin.Events.off=s.Mixin.Events.removeEventListener,s.Mixin.Events.once=s.Mixin.Events.addOneTimeEventListener,s.Mixin.Events.fire=s.Mixin.Events.fireEvent,function(){var e=!!t.ActiveXObject,o=e&&!t.XMLHttpRequest,a=e&&!i.querySelector,r=e&&!i.addEventListener,l=navigator.userAgent.toLowerCase(),h=-1!==l.indexOf("webkit"),c=-1!==l.indexOf("chrome"),u=-1!==l.indexOf("phantom"),p=-1!==l.indexOf("android"),d=-1!==l.search("android [23]"),m=typeof orientation!=n+"",f=t.navigator&&t.navigator.msPointerEnabled&&t.navigator.msMaxTouchPoints,_="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,g=i.documentElement,v=e&&"transition"in g.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix,L="MozPerspective"in g.style,T="OTransition"in g.style,b=!t.L_DISABLE_3D&&(v||y||L||T)&&!u,P=!t.L_NO_TOUCH&&!u&&function(){var t="ontouchstart";if(f||t in g)return!0;var e=i.createElement("div"),n=!1;return e.setAttribute?(e.setAttribute(t,"return;"),"function"==typeof e[t]&&(n=!0),e.removeAttribute(t),e=null,n):!1}();s.Browser={ie:e,ie6:o,ie7:a,ielt9:r,webkit:h,android:p,android23:d,chrome:c,ie3d:v,webkit3d:y,gecko3d:L,opera3d:T,any3d:b,mobile:m,mobileWebkit:m&&h,mobileWebkit3d:m&&y,mobileOpera:m&&t.opera,touch:P,msTouch:f,retina:_}}(),s.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},s.Point.prototype={clone:function(){return new s.Point(this.x,this.y)},add:function(t){return this.clone()._add(s.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(s.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=s.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=s.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=s.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+s.Util.formatNum(this.x)+", "+s.Util.formatNum(this.y)+")"}},s.point=function(t,e,i){return t instanceof s.Point?t:s.Util.isArray(t)?new s.Point(t[0],t[1]):t===n||null===t?t:new s.Point(t,e,i)},s.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},s.Bounds.prototype={extend:function(t){return t=s.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new s.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new s.Point(this.min.x,this.max.y)},getTopRight:function(){return new s.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof s.Point?s.point(t):s.bounds(t),t instanceof s.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=s.bounds(t);var e=this.min,i=this.max,n=t.min,o=t.max,a=o.x>=e.x&&n.x<=i.x,r=o.y>=e.y&&n.y<=i.y;return a&&r},isValid:function(){return!(!this.min||!this.max)}},s.bounds=function(t,e){return!t||t instanceof s.Bounds?t:new s.Bounds(t,e)},s.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},s.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new s.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},s.DomUtil={get:function(t){return"string"==typeof t?i.getElementById(t):t},getStyle:function(t,e){var n=t.style[e];if(!n&&t.currentStyle&&(n=t.currentStyle[e]),(!n||"auto"===n)&&i.defaultView){var o=i.defaultView.getComputedStyle(t,null);n=o?o[e]:null}return"auto"===n?null:n},getViewportOffset:function(t){var e,n=0,o=0,a=t,r=i.body,l=i.documentElement,h=s.Browser.ie7;do{if(n+=a.offsetTop||0,o+=a.offsetLeft||0,n+=parseInt(s.DomUtil.getStyle(a,"borderTopWidth"),10)||0,o+=parseInt(s.DomUtil.getStyle(a,"borderLeftWidth"),10)||0,e=s.DomUtil.getStyle(a,"position"),a.offsetParent===r&&"absolute"===e)break;if("fixed"===e){n+=r.scrollTop||l.scrollTop||0,o+=r.scrollLeft||l.scrollLeft||0;break}if("relative"===e&&!a.offsetLeft){var c=s.DomUtil.getStyle(a,"width"),u=s.DomUtil.getStyle(a,"max-width"),p=a.getBoundingClientRect();("none"!==c||"none"!==u)&&(o+=p.left+a.clientLeft),n+=p.top+(r.scrollTop||l.scrollTop||0);break}a=a.offsetParent}while(a);a=t;do{if(a===r)break;n-=a.scrollTop||0,o-=a.scrollLeft||0,s.DomUtil.documentIsLtr()||!s.Browser.webkit&&!h||(o+=a.scrollWidth-a.clientWidth,h&&"hidden"!==s.DomUtil.getStyle(a,"overflow-y")&&"hidden"!==s.DomUtil.getStyle(a,"overflow")&&(o+=17)),a=a.parentNode}while(a);return new s.Point(o,n)},documentIsLtr:function(){return s.DomUtil._docIsLtrCached||(s.DomUtil._docIsLtrCached=!0,s.DomUtil._docIsLtr="ltr"===s.DomUtil.getStyle(i.body,"direction")),s.DomUtil._docIsLtr},create:function(t,e,n){var o=i.createElement(t);return o.className=e,n&&n.appendChild(o),o},hasClass:function(t,e){return t.className.length>0&&RegExp("(^|\\s)"+e+"(\\s|$)").test(t.className)},addClass:function(t,e){s.DomUtil.hasClass(t,e)||(t.className+=(t.className?" ":"")+e)},removeClass:function(t,e){t.className=s.Util.trim((" "+t.className+" ").replace(" "+e+" "," "))},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(o){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var e=i.documentElement.style,n=0;t.length>n;n++)if(t[n]in e)return t[n];return!1},getTranslateString:function(t){var e=s.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=s.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&s.Browser.any3d?(t.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(e),s.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden")):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},s.DomUtil.TRANSFORM=s.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),s.DomUtil.TRANSITION=s.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),s.DomUtil.TRANSITION_END="webkitTransition"===s.DomUtil.TRANSITION||"OTransition"===s.DomUtil.TRANSITION?s.DomUtil.TRANSITION+"End":"transitionend",function(){var e=s.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),n=s.DomUtil.testProp(["userDrag","WebkitUserDrag","OUserDrag","MozUserDrag","msUserDrag"]);s.extend(s.DomUtil,{disableTextSelection:function(){if(e){var n=i.documentElement.style;this._userSelect=n[e],n[e]="none"}else s.DomEvent.on(t,"selectstart",s.DomEvent.stop)},enableTextSelection:function(){e?(i.documentElement.style[e]=this._userSelect,delete this._userSelect):s.DomEvent.off(t,"selectstart",s.DomEvent.stop)},disableImageDrag:function(){if(n){var e=i.documentElement.style;this._userDrag=e[n],e[n]="none"}else s.DomEvent.on(t,"dragstart",s.DomEvent.stop)},enableImageDrag:function(){n?(i.documentElement.style[n]=this._userDrag,delete this._userDrag):s.DomEvent.off(t,"dragstart",s.DomEvent.stop)}})}(),s.LatLng=function(t,e){var i=parseFloat(t),n=parseFloat(e);if(isNaN(i)||isNaN(n))throw Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=i,this.lng=n},s.extend(s.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),s.LatLng.prototype={equals:function(t){if(!t)return!1;t=s.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return s.LatLng.MAX_MARGIN>=e},toString:function(t){return"LatLng("+s.Util.formatNum(this.lat,t)+", "+s.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=s.latLng(t);var e=6378137,i=s.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,o=(t.lng-this.lng)*i,a=this.lat*i,r=t.lat*i,l=Math.sin(n/2),h=Math.sin(o/2),c=l*l+h*h*Math.cos(a)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new s.LatLng(this.lat,i)}},s.latLng=function(t,e){return t instanceof s.LatLng?t:s.Util.isArray(t)?new s.LatLng(t[0],t[1]):t===n||null===t?t:"object"==typeof t&&"lat"in t?new s.LatLng(t.lat,"lng"in t?t.lng:t.lon):new s.LatLng(t,e)},s.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},s.LatLngBounds.prototype={extend:function(t){return t?(t="number"==typeof t[0]||"string"==typeof t[0]||t instanceof s.LatLng?s.latLng(t):s.latLngBounds(t),t instanceof s.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new s.LatLng(t.lat,t.lng),this._northEast=new s.LatLng(t.lat,t.lng)):t instanceof s.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this):this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,o=Math.abs(e.lng-i.lng)*t;return new s.LatLngBounds(new s.LatLng(e.lat-n,e.lng-o),new s.LatLng(i.lat+n,i.lng+o))},getCenter:function(){return new s.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new s.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new s.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof s.LatLng?s.latLng(t):s.latLngBounds(t);var e,i,n=this._southWest,o=this._northEast;return t instanceof s.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=o.lat&&e.lng>=n.lng&&i.lng<=o.lng},intersects:function(t){t=s.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),a=o.lat>=e.lat&&n.lat<=i.lat,r=o.lng>=e.lng&&n.lng<=i.lng;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=s.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},s.latLngBounds=function(t,e){return!t||t instanceof s.LatLngBounds?t:new s.LatLngBounds(t,e)},s.Projection={},s.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=s.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),o=t.lng*e,a=n*e;return a=Math.log(Math.tan(Math.PI/4+a/2)),new s.Point(o,a)},unproject:function(t){var e=s.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new s.LatLng(n,i)}},s.Projection.LonLat={project:function(t){return new s.Point(t.lng,t.lat)},unproject:function(t){return new s.LatLng(t.y,t.x)}},s.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)}},s.CRS.Simple=s.extend({},s.CRS,{projection:s.Projection.LonLat,transformation:new s.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),s.CRS.EPSG3857=s.extend({},s.CRS,{code:"EPSG:3857",projection:s.Projection.SphericalMercator,transformation:new s.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),s.CRS.EPSG900913=s.extend({},s.CRS.EPSG3857,{code:"EPSG:900913"}),s.CRS.EPSG4326=s.extend({},s.CRS,{code:"EPSG:4326",projection:s.Projection.LonLat,transformation:new s.Transformation(1/360,.5,-1/360,.5)}),s.Map=s.Class.extend({includes:s.Mixin.Events,options:{crs:s.CRS.EPSG3857,fadeAnimation:s.DomUtil.TRANSITION&&!s.Browser.android23,trackResize:!0,markerZoomAnimation:s.DomUtil.TRANSITION&&s.Browser.any3d},initialize:function(t,e){e=s.setOptions(this,e),this._initContainer(t),this._initLayout(),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==n&&this.setView(s.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return this._resetView(s.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this.setView(this.getCenter(),t,{zoom:e})},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),o=this.getSize().divideBy(2),a=t instanceof s.Point?t:this.latLngToContainerPoint(t),r=a.subtract(o).multiplyBy(1-1/n),l=this.containerPointToLatLng(o.add(r));return this.setView(l,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():s.latLngBounds(t);var i=s.point(e.paddingTopLeft||e.padding||[0,0]),n=s.point(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,i.add(n)),a=n.subtract(i).divideBy(2),r=this.project(t.getSouthWest(),o),l=this.project(t.getNorthEast(),o),h=this.unproject(r.add(l).divideBy(2).add(a),o);return this.setView(h,o,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(s.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){if(t=s.latLngBounds(t),this.options.maxBounds=t,!t)return this._boundsMinZoom=null,this.off("moveend",this._panInsideMaxBounds,this),this;var e=this.getBoundsZoom(t,!0);return this._boundsMinZoom=e,this._loaded&&(e>this._zoom?this.setView(t.getCenter(),e):this.panInsideBounds(t)),this.on("moveend",this._panInsideMaxBounds,this),this},panInsideBounds:function(t){t=s.latLngBounds(t);var e=this.getPixelBounds(),i=e.getBottomLeft(),n=e.getTopRight(),o=this.project(t.getSouthWest()),a=this.project(t.getNorthEast()),r=0,l=0;return n.y<a.y&&(l=Math.ceil(a.y-n.y)),n.x>a.x&&(r=Math.floor(a.x-n.x)),i.y>o.y&&(l=Math.floor(o.y-i.y)),i.x<o.x&&(r=Math.ceil(o.x-i.x)),r||l?this.panBy([r,l]):this},addLayer:function(t){var e=s.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&s.TileLayer&&t instanceof s.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=s.stamp(t);if(this._layers[e])return this._loaded&&(t.onRemove(this),this.fire("layerremove",{layer:t})),delete this._layers[e],this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&s.TileLayer&&t instanceof s.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this},hasLayer:function(t){return t?s.stamp(t)in this._layers:!1},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){t=s.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();if(this._sizeChanged=!0,this.options.maxBounds&&this.setMaxBounds(this.options.maxBounds),!this._loaded)return this;var i=this.getSize(),n=e.subtract(i).divideBy(2).round();return n.x||n.y?(t.animate&&t.pan?this.panBy(n):(t.pan&&this._rawPanBy(n),this.fire("move"),clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(s.bind(this.fire,this,"moveend"),200)),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(e){var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this}},remove:function(){return this._loaded&&this.fire("unload"),this._initEvents("off"),delete this._container._leaflet,this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._moved()?this.layerPointToLatLng(this._getCenterLayerPoint()):this._initialCenter},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new s.LatLngBounds(e,i)},getMinZoom:function(){var t=this.options.minZoom||0,e=this._layersMinZoom||0,i=this._boundsMinZoom||0;return Math.max(t,e,i)},getMaxZoom:function(){var t=this.options.maxZoom===n?1/0:this.options.maxZoom,e=this._layersMaxZoom===n?1/0:this._layersMaxZoom;return Math.min(t,e)},getBoundsZoom:function(t,e,i){t=s.latLngBounds(t);var n,o=this.getMinZoom()-(e?1:0),a=this.getMaxZoom(),r=this.getSize(),l=t.getNorthWest(),h=t.getSouthEast(),c=!0;i=s.point(i||[0,0]);do o++,n=this.project(h,o).subtract(this.project(l,o)).add(i),c=e?n.x<r.x||n.y<r.y:r.contains(n);while(c&&a>=o);return c&&e?null:e?o:o-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new s.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new s.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===n?this._zoom:e,this.options.crs.latLngToPoint(s.latLng(t),e)},unproject:function(t,e){return e=e===n?this._zoom:e,this.options.crs.pointToLatLng(s.point(t),e)},layerPointToLatLng:function(t){var e=s.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(s.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return s.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return s.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(s.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(s.latLng(t)))},mouseEventToContainerPoint:function(t){return s.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=s.DomUtil.get(t);if(!e)throw Error("Map container not found.");if(e._leaflet)throw Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;s.DomUtil.addClass(t,"leaflet-container"+(s.Browser.touch?" leaflet-touch":"")+(s.Browser.retina?" leaflet-retina":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=s.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(s.DomUtil.addClass(t.markerPane,e),s.DomUtil.addClass(t.shadowPane,e),s.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return s.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?s.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var o=this._zoom!==e;n||(this.fire("movestart"),o&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):s.DomUtil.setPosition(this._mapPane,new s.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=!0,a&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("viewreset",{hard:!i}),this.fire("move"),(o||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){s.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,i=-1/0,o=this._getZoomSpan();for(t in this._zoomBoundLayers){var s=this._zoomBoundLayers[t];isNaN(s.options.minZoom)||(e=Math.min(e,s.options.minZoom)),isNaN(s.options.maxZoom)||(i=Math.max(i,s.options.maxZoom))}t===n?this._layersMaxZoom=this._layersMinZoom=n:(this._layersMaxZoom=i,this._layersMinZoom=e),o!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw Error("Set map center and zoom first.")},_initEvents:function(e){if(s.DomEvent){e=e||"on",s.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,o=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=o.length;n>i;i++)s.DomEvent[e](this._container,o[i],this._fireMouseEvent,this);this.options.trackResize&&s.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){s.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=s.Util.requestAnimFrame(this.invalidateSize,this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&this.dragging&&this.dragging.moved()||t._leaflet_stop||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!t._leaflet_stop){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&s.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),o=this.layerPointToLatLng(n);this.fire(e,{latlng:o,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;e>t;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return s.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),s.map=function(t,e){return new s.Map(t,e)},s.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=s.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),o=this.R_MAJOR,a=this.R_MINOR,r=t.lng*e*o,l=n*e,h=a/o,c=Math.sqrt(1-h*h),u=c*Math.sin(l);
u=Math.pow((1-u)/(1+u),.5*c);var p=Math.tan(.5*(.5*Math.PI-l))/u;return l=-o*Math.log(p),new s.Point(r,l)},unproject:function(t){for(var e,i=s.LatLng.RAD_TO_DEG,n=this.R_MAJOR,o=this.R_MINOR,a=t.x*i/n,r=o/n,l=Math.sqrt(1-r*r),h=Math.exp(-t.y/n),c=Math.PI/2-2*Math.atan(h),u=15,p=1e-7,d=u,m=.1;Math.abs(m)>p&&--d>0;)e=l*Math.sin(c),m=Math.PI/2-2*Math.atan(h*Math.pow((1-e)/(1+e),.5*l))-c,c+=m;return new s.LatLng(c*i,a)}},s.CRS.EPSG3395=s.extend({},s.CRS,{code:"EPSG:3395",projection:s.Projection.Mercator,transformation:function(){var t=s.Projection.Mercator,e=t.R_MAJOR,i=t.R_MINOR;return new s.Transformation(.5/(Math.PI*e),.5,-.5/(Math.PI*i),.5)}()}),s.TileLayer=s.Class.extend({includes:s.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:s.Browser.mobile,updateWhenIdle:s.Browser.mobile},initialize:function(t,e){e=s.setOptions(this,e),e.detectRetina&&s.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=s.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),this._createTileProto(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=s.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==n&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,o,s=t.children,a=-e(1/0,-1/0);for(n=0,o=s.length;o>n;n++)s[n]!==this._container&&(i=parseInt(s[n].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(s.Browser.ielt9)for(t in e)s.DomUtil.setOpacity(e[t],this.options.opacity);else s.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=s.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container leaflet-zoom-animated";this._bgBuffer=s.DomUtil.create("div",e,this._container),this._tileContainer=s.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),1>this.options.opacity&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_update:function(){if(this._map){var t=this._map.getPixelBounds(),e=this._map.getZoom(),i=this.options.tileSize;if(!(e>this.options.maxZoom||this.options.minZoom>e)){var n=s.bounds(t.min.divideBy(i)._floor(),t.max.divideBy(i)._floor());this._addTilesFromCenterOut(n),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(n)}}},_addTilesFromCenterOut:function(t){var e,n,o,a=[],r=t.getCenter();for(e=t.min.y;t.max.y>=e;e++)for(n=t.min.x;t.max.x>=n;n++)o=new s.Point(n,e),this._tileShouldBeLoaded(o)&&a.push(o);var l=a.length;if(0!==l){a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)});var h=i.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=l,n=0;l>n;n++)this._addTile(a[n],h);this._tileContainer.appendChild(h)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(0>t.x||t.x>=i)||0>t.y||t.y>=i)return!1}if(e.bounds){var n=e.tileSize,o=t.multiplyBy(n),s=o.add([n,n]),a=this._map.unproject(o),r=this._map.unproject(s);if(e.continuousWorld||e.noWrap||(a=a.wrap(),r=r.wrap()),!e.bounds.intersects([a,r]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,o;for(o in this._tiles)e=o.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(t.min.x>i||i>t.max.x||t.min.y>n||n>t.max.y)&&this._removeTile(o)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(s.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),s.Browser.android||(e.onload=null,e.src=s.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();s.DomUtil.setPosition(n,i,s.Browser.chrome||s.Browser.android23),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+t.zoomOffset},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this.options.tileSize;return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return s.Util.template(this._url,s.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){return Math.pow(2,this._getZoomForUrl())},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e+e)%e),this.options.tms&&(t.y=e-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_createTileProto:function(){var t=this._tileImg=s.DomUtil.create("img","leaflet-tile");t.style.width=t.style.height=this.options.tileSize+"px",t.galleryimg="no"},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=this._tileImg.cloneNode(!1);return t.onselectstart=t.onmousemove=s.Util.falseFn,s.Browser.ielt9&&this.options.opacity!==n&&s.DomUtil.setOpacity(t,this.options.opacity),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e)},_tileLoaded:function(){this._tilesToLoad--,this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(s.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==s.Util.emptyImageUrl&&(s.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),s.tileLayer=function(t,e){return new s.TileLayer(t,e)},s.TileLayer.WMS=s.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=s.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;i.width=i.height=e.detectRetina&&s.Browser.retina?2*n:n;for(var o in e)this.options.hasOwnProperty(o)||"crs"===o||(i[o]=e[o]);this.wmsParams=i,s.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs;var e=parseFloat(this.wmsParams.version)>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,s.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t,e){var i=this._map,n=this.options.tileSize,o=t.multiplyBy(n),a=o.add([n,n]),r=this._crs.project(i.unproject(o,e)),l=this._crs.project(i.unproject(a,e)),h=[r.x,l.y,l.x,r.y].join(","),c=s.Util.template(this._url,{s:this._getSubdomain(t)});return c+s.Util.getParamString(this.wmsParams,c,!0)+"&BBOX="+h},setParams:function(t,e){return s.extend(this.wmsParams,t),e||this.redraw(),this}}),s.tileLayer.wms=function(t,e){return new s.TileLayer.WMS(t,e)},s.TileLayer.Canvas=s.TileLayer.extend({options:{async:!1},initialize:function(t){s.setOptions(this,t)},redraw:function(){for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTileProto:function(){var t=this._canvasProto=s.DomUtil.create("canvas","leaflet-tile");t.width=t.height=this.options.tileSize},_createTile:function(){var t=this._canvasProto.cloneNode(!1);return t.onselectstart=t.onmousemove=s.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),s.tileLayer.canvas=function(t){return new s.TileLayer.Canvas(t)},s.ImageOverlay=s.Class.extend({includes:s.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=s.latLngBounds(e),s.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&s.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},_initImage:function(){this._image=s.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&s.Browser.any3d?s.DomUtil.addClass(this._image,"leaflet-zoom-animated"):s.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),s.extend(this._image,{galleryimg:"no",onselectstart:s.Util.falseFn,onmousemove:s.Util.falseFn,onload:s.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),o=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),r=e._latLngToNewLayerPoint(o,t.zoom,t.center),l=e._latLngToNewLayerPoint(a,t.zoom,t.center)._subtract(r),h=r._add(l._multiplyBy(.5*(1-1/n)));i.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(h)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);s.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){s.DomUtil.setOpacity(this._image,this.options.opacity)}}),s.imageOverlay=function(t,e,i){return new s.ImageOverlay(t,e,i)},s.Icon=s.Class.extend({options:{className:""},initialize:function(t){s.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,o=s.point(n[e+"Size"]);i="shadow"===e?s.point(n.shadowAnchor||n.iconAnchor):s.point(n.iconAnchor),!i&&o&&(i=o.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,e){return s.Browser.ie6?(e||(e=i.createElement("div")),e.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+t+'")'):(e||(e=i.createElement("img")),e.src=t),e},_getIconUrl:function(t){return s.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),s.icon=function(t){return new s.Icon(t)},s.Icon.Default=s.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];s.Browser.retina&&"icon"===t&&(t+="-2x");var i=s.Icon.Default.imagePath;if(!i)throw Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),s.Icon.Default.imagePath=function(){var t,e,n,o,s,a=i.getElementsByTagName("script"),r=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,e=a.length;e>t;t++)if(n=a[t].src,o=n.match(r))return s=n.split(r)[0],(s?s+"/":"")+"images"}(),s.Marker=s.Class.extend({includes:s.Mixin.Events,options:{icon:new s.Icon.Default,title:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){s.setOptions(this,e),this._latlng=s.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=s.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",o=t.icon.createIcon(this._icon),a=!1;o!==this._icon&&(this._icon&&this._removeIcon(),a=!0,t.title&&(o.title=t.title)),s.DomUtil.addClass(o,n),t.keyboard&&(o.tabIndex="0"),this._icon=o,this._initInteraction(),t.riseOnHover&&s.DomEvent.on(o,"mouseover",this._bringToFront,this).on(o,"mouseout",this._resetZIndex,this);var r=t.icon.createShadow(this._shadow),l=!1;r!==this._shadow&&(this._removeShadow(),l=!0,r&&s.DomUtil.addClass(r,n)),this._shadow=r,1>t.opacity&&this._updateOpacity();var h=this._map._panes;a&&h.markerPane.appendChild(this._icon),r&&l&&h.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&s.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){s.DomUtil.setPosition(this._icon,t),this._shadow&&s.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];s.DomUtil.addClass(t,"leaflet-clickable"),s.DomEvent.on(t,"click",this._onMouseClick,this),s.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;e.length>i;i++)s.DomEvent.on(t,e[i],this._fireMouseEvent,this);s.Handler.MarkerDrag&&(this.dragging=new s.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&s.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&s.DomEvent.preventDefault(t),"mousedown"!==t.type?s.DomEvent.stopPropagation(t):s.DomEvent.preventDefault(t)},setOpacity:function(t){this.options.opacity=t,this._map&&this._updateOpacity()},_updateOpacity:function(){s.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&s.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),s.marker=function(t,e){return new s.Marker(t,e)},s.DivIcon=s.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:i.createElement("div"),n=this.options;return e.innerHTML=n.html!==!1?n.html:"",n.bgPos&&(e.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(e,"icon"),e},createShadow:function(){return null}}),s.divIcon=function(t){return new s.DivIcon(t)},s.Map.mergeOptions({closePopupOnClick:!0}),s.Popup=s.Class.extend({includes:s.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){s.setOptions(this,t),this._source=e,this._animated=s.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout(),this._updateContent();var e=t.options.fadeAnimation;e&&s.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this._update(),e&&s.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),s.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&s.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},setLatLng:function(t){return this._latlng=s.latLng(t),this._update(),this},setContent:function(t){return this._content=t,this._update(),this},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=s.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=s.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",s.DomEvent.disableClickPropagation(t),s.DomEvent.on(t,"click",this._onCloseButtonClick,this));var o=this._wrapper=s.DomUtil.create("div",e+"-content-wrapper",n);s.DomEvent.disableClickPropagation(o),this._contentNode=s.DomUtil.create("div",e+"-content",o),s.DomEvent.on(this._contentNode,"mousewheel",s.DomEvent.stopPropagation),s.DomEvent.on(o,"contextmenu",s.DomEvent.stopPropagation),this._tipContainer=s.DomUtil.create("div",e+"-tip-container",n),this._tip=s.DomUtil.create("div",e+"-tip",this._tipContainer)},_update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,o=this.options.maxHeight,a="leaflet-popup-scrolled";o&&n>o?(e.height=o+"px",s.DomUtil.addClass(t,a)):s.DomUtil.removeClass(t,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=s.point(this.options.offset);e&&s.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);s.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new s.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(s.DomUtil.getPosition(this._container));var o=t.layerPointToContainerPoint(n),a=s.point(this.options.autoPanPadding),r=t.getSize(),l=0,h=0;o.x+i>r.x&&(l=o.x+i-r.x+a.x),0>o.x-l&&(l=o.x-a.x),o.y+e>r.y&&(h=o.y+e-r.y+a.y),0>o.y-h&&(h=o.y-a.y),(l||h)&&t.fire("autopanstart").panBy([l,h])}},_onCloseButtonClick:function(t){this._close(),s.DomEvent.stop(t)}}),s.popup=function(t,e){return new s.Popup(t,e)},s.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof s.Popup)){var n=t;t=new s.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),s.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=s.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(s.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=s.extend({offset:i},e),this._popup||this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),t instanceof s.Popup?(s.setOptions(t,e),this._popup=t):this._popup=new s.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup).off("remove",this.closePopup).off("move",this._movePopup)),this},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),s.LayerGroup=s.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return t?t in this._layers||this.getLayerId(t)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return s.stamp(t)}}),s.layerGroup=function(t){return new s.LayerGroup(t)},s.FeatureGroup=s.LayerGroup.extend({includes:s.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:(t.on(s.FeatureGroup.EVENTS,this._propagateEvent,this),s.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return t in this._layers&&(t=this._layers[t]),t.off(s.FeatureGroup.EVENTS,this._propagateEvent,this),s.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new s.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof s.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t.layer||(t.layer=t.target),t.target=this,this.fire(t.type,t)}}),s.featureGroup=function(t){return new s.FeatureGroup(t)},s.Path=s.Class.extend({includes:[s.Mixin.Events],statics:{CLIP_PADDING:s.Browser.mobile?Math.max(0,Math.min(.5,(1280/Math.max(t.innerWidth,t.innerHeight)-1)/2)):.5},options:{stroke:!0,color:"#0033ff",dashArray:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){s.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,s.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return s.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),s.Map.include({_updatePathViewport:function(){var t=s.Path.CLIP_PADDING,e=this.getSize(),i=s.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),o=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new s.Bounds(n,o)}}),s.Path.SVG_NS="http://www.w3.org/2000/svg",s.Browser.svg=!(!i.createElementNS||!i.createElementNS(s.Path.SVG_NS,"svg").createSVGRect),s.Path=s.Path.extend({statics:{SVG:s.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return i.createElementNS(s.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray")):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(s.Browser.svg||!s.Browser.vml)&&this._path.setAttribute("class","leaflet-clickable"),s.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;t.length>e;e++)s.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),o=e.layerPointToLatLng(n);this.fire(t.type,{latlng:o,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&s.DomEvent.preventDefault(t),"mousemove"!==t.type&&s.DomEvent.stopPropagation(t)}}}),s.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=s.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&s.Browser.any3d?(this._pathRoot.setAttribute("class"," leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):this._pathRoot.setAttribute("class"," leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[s.DomUtil.TRANSFORM]=s.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,o=i.y-e.y,a=this._pathRoot,r=this._panes.overlayPane;s.Browser.mobileWebkit&&r.removeChild(a),s.DomUtil.setPosition(a,e),a.setAttribute("width",n),a.setAttribute("height",o),a.setAttribute("viewBox",[e.x,e.y,n,o].join(" ")),s.Browser.mobileWebkit&&r.appendChild(a)
}}}),s.Path.include({bindPopup:function(t,e){return t instanceof s.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new s.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),s.Browser.vml=!s.Browser.svg&&function(){try{var t=i.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(n){return!1}}(),s.Path=s.Browser.svg||!s.Browser.vml?s.Path:s.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return i.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return i.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return i.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");s.DomUtil.addClass(t,"leaflet-vml-shape"),this.options.clickable&&s.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,t.dashStyle=i.dashArray?i.dashArray instanceof Array?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):""):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),s.Map.include(s.Browser.svg||!s.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=i.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),s.Browser.canvas=function(){return!!i.createElement("canvas").getContext}(),s.Path=s.Path.SVG&&!t.L_PREFER_CANVAS||!s.Browser.canvas?s.Path:s.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return s.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this._map=null},_requestUpdate:function(){this._map&&!s.Path._updateRequest&&(s.Path._updateRequest=s.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){s.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color)},_drawPath:function(){var t,e,i,n,o,a;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,n=this._parts[t].length;n>e;e++)o=this._parts[t][e],a=(0===e?"move":"line")+"To",this._ctx[a](o.x,o.y);this instanceof s.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill()),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(t){this._containsPoint(t.layerPoint)&&this.fire("click",t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),s.Map.include(s.Path.SVG&&!t.L_PREFER_CANVAS||!s.Browser.canvas?{}:{_initPathRoot:function(){var t,e=this._pathRoot;e||(e=this._pathRoot=i.createElement("canvas"),e.style.position="absolute",t=this._canvasCtx=e.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(e),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;s.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),s.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var i=t.length,o=typeof Uint8Array!=n+""?Uint8Array:Array,s=new o(i);s[0]=s[i-1]=1,this._simplifyDPStep(t,s,e,0,i-1);var a,r=[];for(a=0;i>a;a++)s[a]&&r.push(t[a]);return r},_simplifyDPStep:function(t,e,i,n,o){var s,a,r,l=0;for(a=n+1;o-1>=a;a++)r=this._sqClosestPointOnSegment(t[a],t[n],t[o],!0),r>l&&(s=a,l=r);l>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;s>n;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return s-1>o&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n){var o,s,a,r=n?this._lastCode:this._getBitCode(t,i),l=this._getBitCode(e,i);for(this._lastCode=l;;){if(!(r|l))return[t,e];if(r&l)return!1;o=r||l,s=this._getEdgeIntersection(t,e,o,i),a=this._getBitCode(s,i),o===r?(t=s,r=a):(e=s,l=a)}},_getEdgeIntersection:function(t,e,i,o){var a=e.x-t.x,r=e.y-t.y,l=o.min,h=o.max;return 8&i?new s.Point(t.x+a*(h.y-t.y)/r,h.y):4&i?new s.Point(t.x+a*(l.y-t.y)/r,l.y):2&i?new s.Point(h.x,t.y+r*(h.x-t.x)/a):1&i?new s.Point(l.x,t.y+r*(l.x-t.x)/a):n},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var o,a=e.x,r=e.y,l=i.x-a,h=i.y-r,c=l*l+h*h;return c>0&&(o=((t.x-a)*l+(t.y-r)*h)/c,o>1?(a=i.x,r=i.y):o>0&&(a+=l*o,r+=h*o)),l=t.x-a,h=t.y-r,n?l*l+h*h:new s.Point(a,r)}},s.Polyline=s.Path.extend({initialize:function(t,e){s.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(s.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,o=this._parts,a=null,r=0,l=o.length;l>r;r++)for(var h=o[r],c=1,u=h.length;u>c;c++){e=h[c-1],i=h[c];var p=s.LineUtil._sqClosestPointOnSegment(t,e,i,!0);n>p&&(n=p,a=s.LineUtil._sqClosestPointOnSegment(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getBounds:function(){return new s.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,o=e?t:[];for(i=0,n=t.length;n>i;i++){if(s.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;o[i]=s.latLng(t[i])}return o},_initEvents:function(){s.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=s.Path.VML,n=0,o=t.length,a="";o>n;n++)e=t[n],i&&e._round(),a+=(n?"L":"M")+e.x+" "+e.y;return a},_clipPoints:function(){var t,e,i,o=this._originalPoints,a=o.length;if(this.options.noClip)return this._parts=[o],n;this._parts=[];var r=this._parts,l=this._map._pathViewport,h=s.LineUtil;for(t=0,e=0;a-1>t;t++)i=h.clipSegment(o[t],o[t+1],l,t),i&&(r[e]=r[e]||[],r[e].push(i[0]),(i[1]!==o[t+1]||t===a-2)&&(r[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=s.LineUtil,i=0,n=t.length;n>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),s.Path.prototype._updatePath.call(this))}}),s.polyline=function(t,e){return new s.Polyline(t,e)},s.PolyUtil={},s.PolyUtil.clipPolygon=function(t,e){var i,n,o,a,r,l,h,c,u,p=[1,4,2,8],d=s.LineUtil;for(n=0,h=t.length;h>n;n++)t[n]._code=d._getBitCode(t[n],e);for(a=0;4>a;a++){for(c=p[a],i=[],n=0,h=t.length,o=h-1;h>n;o=n++)r=t[n],l=t[o],r._code&c?l._code&c||(u=d._getEdgeIntersection(l,r,c,e),u._code=d._getBitCode(u,e),i.push(u)):(l._code&c&&(u=d._getEdgeIntersection(l,r,c,e),u._code=d._getBitCode(u,e),i.push(u)),i.push(r));t=i}return t},s.Polygon=s.Polyline.extend({options:{fill:!0},initialize:function(t,e){var i,n,o;if(s.Polyline.prototype.initialize.call(this,t,e),t&&s.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),i=0,n=this._holes.length;n>i;i++)o=this._holes[i]=this._convertLatLngs(this._holes[i]),o[0].equals(o[o.length-1])&&o.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(s.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;n>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;n>i;i++){var o=s.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);o.length&&e.push(o)}this._parts=e}},_getPathPartStr:function(t){var e=s.Polyline.prototype._getPathPartStr.call(this,t);return e+(s.Browser.svg?"z":"x")}}),s.polygon=function(t,e){return new s.Polygon(t,e)},function(){function t(t){return s.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this}})}s.MultiPolyline=t(s.Polyline),s.MultiPolygon=t(s.Polygon),s.multiPolyline=function(t,e){return new s.MultiPolyline(t,e)},s.multiPolygon=function(t,e){return new s.MultiPolygon(t,e)}}(),s.Rectangle=s.Polygon.extend({initialize:function(t,e){s.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=s.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),s.rectangle=function(t,e){return new s.Rectangle(t,e)},s.Circle=s.Path.extend({initialize:function(t,e,i){s.Path.prototype.initialize.call(this,i),this._latlng=s.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=s.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=360*(this._mRadius/40075017),i=this._latlng;return new s.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":s.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,"+23592600)},getRadius:function(){return this._mRadius},_getLatRadius:function(){return 360*(this._mRadius/40075017)},_getLngRadius:function(){return this._getLatRadius()/Math.cos(s.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),s.circle=function(t,e,i){return new s.Circle(t,e,i)},s.CircleMarker=s.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){s.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){s.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()}}),s.circleMarker=function(t,e){return new s.CircleMarker(t,e)},s.Polyline.include(s.Path.CANVAS?{_containsPoint:function(t,e){var i,n,o,a,r,l,h,c=this.options.weight/2;for(s.Browser.touch&&(c+=10),i=0,a=this._parts.length;a>i;i++)for(h=this._parts[i],n=0,r=h.length,o=r-1;r>n;o=n++)if((e||0!==n)&&(l=s.LineUtil.pointToSegmentDistance(t,h[o],h[n]),c>=l))return!0;return!1}}:{}),s.Polygon.include(s.Path.CANVAS?{_containsPoint:function(t){var e,i,n,o,a,r,l,h,c=!1;if(s.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(o=0,l=this._parts.length;l>o;o++)for(e=this._parts[o],a=0,h=e.length,r=h-1;h>a;r=a++)i=e[a],n=e[r],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(c=!c);return c}}:{}),s.Circle.include(s.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),s.CircleMarker.include(s.Path.CANVAS?{_updateStyle:function(){s.Path.prototype._updateStyle.call(this)}}:{}),s.GeoJSON=s.FeatureGroup.extend({initialize:function(t,e){s.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n=s.Util.isArray(t)?t:t.features;if(n){for(e=0,i=n.length;i>e;e++)(n[e].geometries||n[e].geometry||n[e].features)&&this.addData(n[e]);return this}var o=this.options;if(!o.filter||o.filter(t)){var a=s.GeoJSON.geometryToLayer(t,o.pointToLayer,o.coordsToLatLng);return a.feature=s.GeoJSON.asFeature(t),a.defaultOptions=a.options,this.resetStyle(a),o.onEachFeature&&o.onEachFeature(t,a),this.addLayer(a)}},resetStyle:function(t){var e=this.options.style;e&&(s.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),s.extend(s.GeoJSON,{geometryToLayer:function(t,e,i){var n,o,a,r,l,h="Feature"===t.type?t.geometry:t,c=h.coordinates,u=[];switch(i=i||this.coordsToLatLng,h.type){case"Point":return n=i(c),e?e(t,n):new s.Marker(n);case"MultiPoint":for(a=0,r=c.length;r>a;a++)n=i(c[a]),l=e?e(t,n):new s.Marker(n),u.push(l);return new s.FeatureGroup(u);case"LineString":return o=this.coordsToLatLngs(c,0,i),new s.Polyline(o);case"Polygon":return o=this.coordsToLatLngs(c,1,i),new s.Polygon(o);case"MultiLineString":return o=this.coordsToLatLngs(c,1,i),new s.MultiPolyline(o);case"MultiPolygon":return o=this.coordsToLatLngs(c,2,i),new s.MultiPolygon(o);case"GeometryCollection":for(a=0,r=h.geometries.length;r>a;a++)l=this.geometryToLayer({geometry:h.geometries[a],type:"Feature",properties:t.properties},e,i),u.push(l);return new s.FeatureGroup(u);default:throw Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new s.LatLng(t[1],t[0])},coordsToLatLngs:function(t,e,i){var n,o,s,a=[];for(o=0,s=t.length;s>o;o++)n=e?this.coordsToLatLngs(t[o],e-1,i):(i||this.coordsToLatLng)(t[o]),a.push(n);return a},latLngToCoords:function(t){return[t.lng,t.lat]},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(s.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?s.extend({},t.feature,{geometry:e}):s.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var r={toGeoJSON:function(){return s.GeoJSON.getFeature(this,{type:"Point",coordinates:s.GeoJSON.latLngToCoords(this.getLatLng())})}};s.Marker.include(r),s.Circle.include(r),s.CircleMarker.include(r),s.Polyline.include({toGeoJSON:function(){return s.GeoJSON.getFeature(this,{type:"LineString",coordinates:s.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),s.Polygon.include({toGeoJSON:function(){var t,e,i,n=[s.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;e>t;t++)i=s.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return s.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t,e){t.include({toGeoJSON:function(){var t=[];return this.eachLayer(function(e){t.push(e.toGeoJSON().geometry.coordinates)}),s.GeoJSON.getFeature(this,{type:e,coordinates:t})}})}t(s.MultiPolyline,"MultiLineString"),t(s.MultiPolygon,"MultiPolygon")}(),s.LayerGroup.include({toGeoJSON:function(){var t=[];return this.eachLayer(function(e){e.toGeoJSON&&t.push(s.GeoJSON.asFeature(e.toGeoJSON()))}),{type:"FeatureCollection",features:t}}}),s.geoJson=function(t,e){return new s.GeoJSON(t,e)},s.DomEvent={addListener:function(t,e,i,o){var a,r,l,h=s.stamp(i),c="_leaflet_"+e+h;return t[c]?this:(a=function(e){return i.call(o||t,e||s.DomEvent._getEvent())},s.Browser.msTouch&&0===e.indexOf("touch")?this.addMsTouchListener(t,e,a,h):(s.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,a,h),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",a,!1),t.addEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?(r=a,l="mouseenter"===e?"mouseover":"mouseout",a=function(e){return s.DomEvent._checkMouse(t,e)?r(e):n},t.addEventListener(l,a,!1)):"click"===e&&s.Browser.android?(r=a,a=function(t){return s.DomEvent._filterClick(t,r)},t.addEventListener(e,a,!1)):t.addEventListener(e,a,!1):"attachEvent"in t&&t.attachEvent("on"+e,a),t[c]=a,this))},removeListener:function(t,e,i){var n=s.stamp(i),o="_leaflet_"+e+n,a=t[o];return a?(s.Browser.msTouch&&0===e.indexOf("touch")?this.removeMsTouchListener(t,e,n):s.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",a,!1),t.removeEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1):t.removeEventListener(e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[o]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this},disableClickPropagation:function(t){for(var e=s.DomEvent.stopPropagation,i=s.Draggable.START.length-1;i>=0;i--)s.DomEvent.addListener(t,s.Draggable.START[i],e);return s.DomEvent.addListener(t,"click",s.DomEvent._fakeStop).addListener(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return s.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){var n=i.body,o=i.documentElement,a=t.pageX?t.pageX:t.clientX+n.scrollLeft+o.scrollLeft,r=t.pageY?t.pageY:t.clientY+n.scrollTop+o.scrollTop,l=new s.Point(a,r);return e?l._subtract(s.DomUtil.getViewportOffset(e)):l},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_fakeStop:function(t){t._leaflet_stop=!0},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,o=s.DomEvent._lastClick&&i-s.DomEvent._lastClick;return o&&o>100&&1e3>o||t.target._simulatedClick&&!t._simulated?(s.DomEvent.stop(t),n):(s.DomEvent._lastClick=i,e(t))}},s.DomEvent.on=s.DomEvent.addListener,s.DomEvent.off=s.DomEvent.removeListener,s.Draggable=s.Class.extend({includes:s.Mixin.Events,statics:{START:s.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=s.Draggable.START.length-1;t>=0;t--)s.DomEvent.on(this._dragStartTarget,s.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=s.Draggable.START.length-1;t>=0;t--)s.DomEvent.off(this._dragStartTarget,s.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(!t.shiftKey&&(1===t.which||1===t.button||t.touches)&&(s.DomEvent.stopPropagation(t),!s.Draggable._disabled)){s.DomUtil.disableImageDrag(),s.DomUtil.disableTextSelection();var e=t.touches?t.touches[0]:t,n=e.target;s.Browser.touch&&"a"===n.tagName.toLowerCase()&&s.DomUtil.addClass(n,"leaflet-active"),this._moved=!1,this._moving||(this._startPoint=new s.Point(e.clientX,e.clientY),this._startPos=this._newPos=s.DomUtil.getPosition(this._element),s.DomEvent.on(i,s.Draggable.MOVE[t.type],this._onMove,this).on(i,s.Draggable.END[t.type],this._onUp,this))}},_onMove:function(t){if(!(t.touches&&t.touches.length>1)){var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new s.Point(e.clientX,e.clientY),o=n.subtract(this._startPoint);(o.x||o.y)&&(s.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=s.DomUtil.getPosition(this._element).subtract(o),s.Browser.touch||s.DomUtil.addClass(i.body,"leaflet-dragging")),this._newPos=this._startPos.add(o),this._moving=!0,s.Util.cancelAnimFrame(this._animRequest),this._animRequest=s.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget))}},_updatePosition:function(){this.fire("predrag"),s.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){s.Browser.touch||s.DomUtil.removeClass(i.body,"leaflet-dragging");for(var t in s.Draggable.MOVE)s.DomEvent.off(i,s.Draggable.MOVE[t],this._onMove).off(i,s.Draggable.END[t],this._onUp);s.DomUtil.enableImageDrag(),s.DomUtil.enableTextSelection(),this._moved&&(s.Util.cancelAnimFrame(this._animRequest),this.fire("dragend")),this._moving=!1}}),s.Handler=s.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),s.Map.mergeOptions({dragging:!0,inertia:!s.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:s.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),s.Map.Drag=s.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new s.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,a=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._newPos.x=a},_onDragEnd:function(){var t=this._map,e=t.options,i=+new Date-this._lastTime,n=!e.inertia||i>e.inertiaThreshold||!this._positions[0];if(t.fire("dragend"),n)t.fire("moveend");else{var o=this._lastPos.subtract(this._positions[0]),a=(this._lastTime+i-this._times[0])/1e3,r=e.easeLinearity,l=o.multiplyBy(r/a),h=l.distanceTo([0,0]),c=Math.min(e.inertiaMaxSpeed,h),u=l.multiplyBy(c/h),p=c/(e.inertiaDeceleration*r),d=u.multiplyBy(-p/2).round();d.x&&d.y?s.Util.requestAnimFrame(function(){t.panBy(d,{duration:p,easeLinearity:r,noMoveStart:!0})}):t.fire("moveend")}}}),s.Map.addInitHook("addHandler","dragging",s.Map.Drag),s.Map.mergeOptions({doubleClickZoom:!0}),s.Map.DoubleClickZoom=s.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick)},_onDoubleClick:function(t){this.setZoomAround(t.containerPoint,this._zoom+1)}}),s.Map.addInitHook("addHandler","doubleClickZoom",s.Map.DoubleClickZoom),s.Map.mergeOptions({scrollWheelZoom:!0}),s.Map.ScrollWheelZoom=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),s.DomEvent.on(this._map._container,"MozMousePixelScroll",s.DomEvent.preventDefault),this._delta=0},removeHooks:function(){s.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),s.DomEvent.off(this._map._container,"MozMousePixelScroll",s.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=s.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(s.bind(this._performZoom,this),i),s.DomEvent.preventDefault(t),s.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&t.setZoomAround(this._lastMousePos,i+e)}}),s.Map.addInitHook("addHandler","scrollWheelZoom",s.Map.ScrollWheelZoom),s.extend(s.DomEvent,{_touchstart:s.Browser.msTouch?"MSPointerDown":"touchstart",_touchend:s.Browser.msTouch?"MSPointerUp":"touchend",addDoubleTapListener:function(t,e,n){function o(t){var e;if(s.Browser.msTouch?(m.push(t.pointerId),e=m.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(r||i);l=t.touches?t.touches[0]:t,h=n>0&&c>=n,r=i}}function a(t){if(s.Browser.msTouch){var i=m.indexOf(t.pointerId);if(-1===i)return;m.splice(i,1)}if(h){if(s.Browser.msTouch){var n,o={};for(var a in l)n=l[a],o[a]="function"==typeof n?n.bind(l):n;l=o}l.type="dblclick",e(l),r=null}}var r,l,h=!1,c=250,u="_leaflet_",p=this._touchstart,d=this._touchend,m=[];t[u+p+n]=o,t[u+d+n]=a;var f=s.Browser.msTouch?i.documentElement:t;return t.addEventListener(p,o,!1),f.addEventListener(d,a,!1),s.Browser.msTouch&&f.addEventListener("MSPointerCancel",a,!1),this},removeDoubleTapListener:function(t,e){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+e],!1),(s.Browser.msTouch?i.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+e],!1),s.Browser.msTouch&&i.documentElement.removeEventListener("MSPointerCancel",t[n+this._touchend+e],!1),this}}),s.extend(s.DomEvent,{_msTouches:[],_msDocumentListener:!1,addMsTouchListener:function(t,e,i,n){switch(e){case"touchstart":return this.addMsTouchListenerStart(t,e,i,n);case"touchend":return this.addMsTouchListenerEnd(t,e,i,n);case"touchmove":return this.addMsTouchListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(t,e,n,o){var s="_leaflet_",a=this._msTouches,r=function(t){for(var e=!1,i=0;a.length>i;i++)if(a[i].pointerId===t.pointerId){e=!0;break}e||a.push(t),t.touches=a.slice(),t.changedTouches=[t],n(t)};if(t[s+"touchstart"+o]=r,t.addEventListener("MSPointerDown",r,!1),!this._msDocumentListener){var l=function(t){for(var e=0;a.length>e;e++)if(a[e].pointerId===t.pointerId){a.splice(e,1);break}};i.documentElement.addEventListener("MSPointerUp",l,!1),i.documentElement.addEventListener("MSPointerCancel",l,!1),this._msDocumentListener=!0}return this},addMsTouchListenerMove:function(t,e,i,n){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE||0!==t.buttons){for(var e=0;a.length>e;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],i(t)}}var s="_leaflet_",a=this._msTouches;return t[s+"touchmove"+n]=o,t.addEventListener("MSPointerMove",o,!1),this},addMsTouchListenerEnd:function(t,e,i,n){var o="_leaflet_",s=this._msTouches,a=function(t){for(var e=0;s.length>e;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}t.touches=s.slice(),t.changedTouches=[t],i(t)};return t[o+"touchend"+n]=a,t.addEventListener("MSPointerUp",a,!1),t.addEventListener("MSPointerCancel",a,!1),this},removeMsTouchListener:function(t,e,i){var n="_leaflet_",o=t[n+e+i];switch(e){case"touchstart":t.removeEventListener("MSPointerDown",o,!1);break;case"touchmove":t.removeEventListener("MSPointerMove",o,!1);break;case"touchend":t.removeEventListener("MSPointerUp",o,!1),t.removeEventListener("MSPointerCancel",o,!1)}return this}}),s.Map.mergeOptions({touchZoom:s.Browser.touch&&!s.Browser.android23}),s.Map.TouchZoom=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){s.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToLayerPoint(t.touches[0]),o=e.mouseEventToLayerPoint(t.touches[1]),a=e._getCenterLayerPoint();this._startCenter=n.add(o)._divideBy(2),this._startDist=n.distanceTo(o),this._moved=!1,this._zooming=!0,this._centerOffset=a.subtract(this._startCenter),e._panAnim&&e._panAnim.stop(),s.DomEvent.on(i,"touchmove",this._onTouchMove,this).on(i,"touchend",this._onTouchEnd,this),s.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(this._moved||(s.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),s.Util.cancelAnimFrame(this._animRequest),this._animRequest=s.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),s.DomEvent.preventDefault(t))
}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return this._zooming=!1,n;var t=this._map;this._zooming=!1,s.DomUtil.removeClass(t._mapPane,"leaflet-touching"),s.Util.cancelAnimFrame(this._animRequest),s.DomEvent.off(i,"touchmove",this._onTouchMove).off(i,"touchend",this._onTouchEnd);var e=this._getScaleOrigin(),o=t.layerPointToLatLng(e),a=t.getZoom(),r=t.getScaleZoom(this._scale)-a,l=r>0?Math.ceil(r):Math.floor(r),h=t._limitZoom(a+l),c=t.getZoomScale(h)/this._scale;t._animateZoom(o,h,e,c)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),s.Map.addInitHook("addHandler","touchZoom",s.Map.TouchZoom),s.Map.mergeOptions({tap:!0,tapTolerance:15}),s.Map.Tap=s.Handler.extend({addHooks:function(){s.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){s.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(s.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,clearTimeout(this._holdTimeout),n;var e=t.touches[0],o=e.target;this._startPos=this._newPos=new s.Point(e.clientX,e.clientY),"a"===o.tagName.toLowerCase()&&s.DomUtil.addClass(o,"leaflet-active"),this._holdTimeout=setTimeout(s.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),s.DomEvent.on(i,"touchmove",this._onMove,this).on(i,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),s.DomEvent.off(i,"touchmove",this._onMove,this).off(i,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],n=e.target;"a"===n.tagName.toLowerCase()&&s.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new s.Point(e.clientX,e.clientY)},_simulateEvent:function(e,n){var o=i.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(e,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),s.Browser.touch&&!s.Browser.msTouch&&s.Map.addInitHook("addHandler","tap",s.Map.Tap),s.Map.mergeOptions({boxZoom:!0}),s.Map.BoxZoom=s.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){s.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){s.DomEvent.off(this._container,"mousedown",this._onMouseDown)},_onMouseDown:function(t){return!t.shiftKey||1!==t.which&&1!==t.button?!1:(s.DomUtil.disableTextSelection(),s.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),this._box=s.DomUtil.create("div","leaflet-zoom-box",this._pane),s.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",s.DomEvent.on(i,"mousemove",this._onMouseMove,this).on(i,"mouseup",this._onMouseUp,this).on(i,"keydown",this._onKeyDown,this),this._map.fire("boxzoomstart"),n)},_onMouseMove:function(t){var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),o=n.subtract(e),a=new s.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));s.DomUtil.setPosition(i,a),i.style.width=Math.max(0,Math.abs(o.x)-4)+"px",i.style.height=Math.max(0,Math.abs(o.y)-4)+"px"},_finish:function(){this._pane.removeChild(this._box),this._container.style.cursor="",s.DomUtil.enableTextSelection(),s.DomUtil.enableImageDrag(),s.DomEvent.off(i,"mousemove",this._onMouseMove).off(i,"mouseup",this._onMouseUp).off(i,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new s.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),s.Map.addInitHook("addHandler","boxZoom",s.Map.BoxZoom),s.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),s.Map.Keyboard=s.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),s.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;s.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var e=i.body,n=i.documentElement,o=e.scrollTop||n.scrollTop,s=e.scrollTop||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;i>e;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;i>e;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;i>e;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;i>e;e++)n[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;i>e;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;i>e;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){s.DomEvent.on(i,"keydown",this._onKeyDown,this)},_removeHooks:function(){s.DomEvent.off(i,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}s.DomEvent.stop(t)}}),s.Map.addInitHook("addHandler","keyboard",s.Map.Keyboard),s.Handler.MarkerDrag=s.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new s.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable()},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=s.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&s.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(){this._marker.fire("moveend").fire("dragend")}}),s.Control=s.Class.extend({options:{position:"topright"},initialize:function(t){s.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return s.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this}}),s.control=function(t){return new s.Control(t)},s.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,o){var a=i+t+" "+i+o;e[t+o]=s.DomUtil.create("div",a,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=s.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),s.Control.Zoom=s.Control.extend({options:{position:"topleft"},onAdd:function(t){var e="leaflet-control-zoom",i=s.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton("+","Zoom in",e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton("-","Zoom out",e+"-out",i,this._zoomOut,this),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,o,a){var r=s.DomUtil.create("a",i,n);r.innerHTML=t,r.href="#",r.title=e;var l=s.DomEvent.stopPropagation;return s.DomEvent.on(r,"click",l).on(r,"mousedown",l).on(r,"dblclick",l).on(r,"click",s.DomEvent.preventDefault).on(r,"click",o,a),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";s.DomUtil.removeClass(this._zoomInButton,e),s.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&s.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&s.DomUtil.addClass(this._zoomInButton,e)}}),s.Map.mergeOptions({zoomControl:!0}),s.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new s.Control.Zoom,this.addControl(this.zoomControl))}),s.control.zoom=function(t){return new s.Control.Zoom(t)},s.Control.Attribution=s.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){s.setOptions(this,t),this._attributions={}},onAdd:function(t){return this._container=s.DomUtil.create("div","leaflet-control-attribution"),s.DomEvent.disableClickPropagation(this._container),t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):n},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):n},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),s.Map.mergeOptions({attributionControl:!0}),s.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new s.Control.Attribution).addTo(this))}),s.control.attribution=function(t){return new s.Control.Attribution(t)},s.Control.Scale=s.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=s.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=s.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=s.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),s=this.options,a=0;o.x>0&&(a=n*(s.maxWidth/o.x)),this._updateScales(s,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,o=3.2808399*t,s=this._iScale;o>5280?(e=o/5280,i=this._getRoundNum(e),s.style.width=this._getScaleWidth(i/e)+"px",s.innerHTML=i+" mi"):(n=this._getRoundNum(o),s.style.width=this._getScaleWidth(n/o)+"px",s.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),s.control.scale=function(t){return new s.Control.Scale(t)},s.Control.Layers=s.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){s.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=s.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=s.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),s.Browser.touch?s.DomEvent.on(e,"click",s.DomEvent.stopPropagation):(s.DomEvent.disableClickPropagation(e),s.DomEvent.on(e,"mousewheel",s.DomEvent.stopPropagation));var i=this._form=s.DomUtil.create("form",t+"-list");if(this.options.collapsed){s.Browser.android||s.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=s.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",s.Browser.touch?s.DomEvent.on(n,"click",s.DomEvent.stop).on(n,"click",this._expand,this):s.DomEvent.on(n,"focus",this._expand,this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=s.DomUtil.create("div",t+"-base",i),this._separator=s.DomUtil.create("div",t+"-separator",i),this._overlaysList=s.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=s.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[s.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';e&&(n+=' checked="checked"'),n+="/>";var o=i.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var e,n=i.createElement("label"),o=this._map.hasLayer(t.layer);t.overlay?(e=i.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=o):e=this._createRadioElement("leaflet-base-layers",o),e.layerId=s.stamp(t.layer),s.DomEvent.on(e,"click",this._onInputClick,this);var a=i.createElement("span");a.innerHTML=" "+t.name,n.appendChild(e),n.appendChild(a);var r=t.overlay?this._overlaysList:this._baseLayersList;return r.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=n.length;for(this._handlingClick=!0,t=0;o>t;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1},_expand:function(){s.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),s.control.layers=function(t,e,i){return new s.Control.Layers(t,e,i)},s.PosAnimation=s.Class.extend({includes:s.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[s.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",s.DomEvent.on(t,s.DomUtil.TRANSITION_END,this._onTransitionEnd,this),s.DomUtil.setPosition(t,e),s.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(s.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(s.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),s.Util.falseFn(this._el.offsetWidth))},_onStep:function(){this._el._leaflet_pos=this._getPos(),this.fire("step")},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,o=this._el,a=t.getComputedStyle(o);return s.Browser.any3d?(n=a[s.DomUtil.TRANSFORM].match(this._transformRe),e=n?parseFloat(n[1]):0,i=n?parseFloat(n[2]):0):(e=parseFloat(a.left),i=parseFloat(a.top)),new s.Point(e,i,!0)},_onTransitionEnd:function(){s.DomEvent.off(this._el,s.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[s.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),s.Map.include({setView:function(t,e,i){if(e=this._limitZoom(e),t=s.latLng(t),i=i||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!i.reset&&i!==!0){i.animate!==n&&(i.zoom=s.extend({animate:i.animate},i.zoom),i.pan=s.extend({animate:i.animate},i.pan));var o=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,i.zoom):this._tryAnimatedPan(t,i.pan);if(o)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=s.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new s.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){s.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){s.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return(e&&e.animate)===!0||this.getSize().contains(i)?(this.panBy(i,e),!0):!1}}),s.PosAnimation=s.DomUtil.TRANSITION?s.PosAnimation:s.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=s.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=s.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));s.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){s.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),s.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),s.DomUtil.TRANSITION&&s.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&s.DomUtil.TRANSITION&&s.Browser.any3d&&!s.Browser.android23&&!s.Browser.mobileOpera,this._zoomAnimated&&s.DomEvent.on(this._mapPane,s.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),s.Map.include(s.DomUtil.TRANSITION?{_catchTransitionEnd:function(){this._animatingZoom&&this._onZoomTransitionEnd()},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/n),s=this._getCenterLayerPoint()._add(o);return i.animate===!0||this.getSize().contains(o)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,s,n,null,!0),!0):!1},_animateZoom:function(t,e,i,n,o,a){this._animatingZoom=!0,s.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,s.Draggable&&(s.Draggable._disabled=!0),this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:o,backwards:a})},_onZoomTransitionEnd:function(){this._animatingZoom=!1,s.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),s.Draggable&&(s.Draggable._disabled=!1)}}:{}),s.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=s.DomUtil.TRANSFORM,n=t.delta?s.DomUtil.getTranslateString(t.delta):e.style[i],o=s.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?o+" "+n:n+" "+o},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),s.Util.falseFn(e.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[s.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),o=this._getLoadedTilesPercentage(t);return e&&i>.5&&.5>o?(t.style.visibility="hidden",this._stopLoadingImages(t),n):(e.style.visibility="hidden",e.style[s.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),clearTimeout(this._clearBgBufferTimer),n)},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),o=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&o++;return o/i},_stopLoadingImages:function(t){var e,i,n,o=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=o.length;i>e;e++)n=o[e],n.complete||(n.onload=s.Util.falseFn,n.onerror=s.Util.falseFn,n.src=s.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),s.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=s.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=s.bind(this._handleGeolocationResponse,this),i=s.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new s.LatLng(e,i),o=180*t.coords.accuracy/40075017,a=o/Math.cos(s.LatLng.DEG_TO_RAD*e),r=s.latLngBounds([e-o,i-a],[e+o,i+a]),l=this._locateOptions;if(l.setView){var h=Math.min(this.getBoundsZoom(r),l.maxZoom);this.setView(n,h)}var c={latlng:n,bounds:r};for(var u in t.coords)"number"==typeof t.coords[u]&&(c[u]=t.coords[u]);this.fire("locationfound",c)}})})(window,document)})()},{}],3:[function(t,e){window.L.Icon.Default.imagePath="//api.tiles.mapbox.com/mapbox.js/v"+t("./package.json").version+"/images",L.mapbox=e.exports={VERSION:t("./package.json").version,geocoder:t("./src/geocoder"),marker:t("./src/marker"),tileLayer:t("./src/tile_layer"),shareControl:t("./src/share_control"),legendControl:t("./src/legend_control"),geocoderControl:t("./src/geocoder_control"),gridControl:t("./src/grid_control"),gridLayer:t("./src/grid_layer"),markerLayer:t("./src/marker_layer"),map:t("./src/map"),config:t("./src/config"),sanitize:t("./src/sanitize"),template:t("mustache").to_html}},{"./package.json":5,"./src/config":6,"./src/geocoder":7,"./src/geocoder_control":12,"./src/grid_control":13,"./src/grid_layer":14,"./src/legend_control":11,"./src/map":16,"./src/marker":8,"./src/marker_layer":15,"./src/sanitize":17,"./src/share_control":10,"./src/tile_layer":9,mustache:18}],17:[function(t,e){"use strict";function i(t){return/^https?/.test(t.getScheme())?""+t:"data"==t.getScheme()&&/^image/.test(t.getPath())?""+t:void 0}function n(t){return t}var o=t("../ext/sanitizer/html-sanitizer-bundle.js");e.exports=function(t){return t?o(t,i,n):""}},{"../ext/sanitizer/html-sanitizer-bundle.js":19}],18:[function(t,e,i){(function(){(function(t,n){"object"==typeof i&&i?e.exports=n:"function"==typeof define&&define.amd?define(n):t.Mustache=n})(this,function(){function t(t,e){return RegExp.prototype.test.call(t,e)}function e(e){return!t(m,e)}function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function n(t){return(t+"").replace(/[&<>"'\/]/g,function(t){return y[t]})}function o(t){this.string=t,this.tail=t,this.pos=0}function s(t,e){this.view=t,this.parent=e,this.clearCache()}function a(){this.clearCache()}function r(t){function e(t,e,n){if(!i[t]){var o=r(e);i[t]=function(t,e){return o(t,e,n)}}return i[t]}var i={};return function(i,n,o){for(var s,a,r="",l=0,h=t.length;h>l;++l)switch(s=t[l],s[0]){case"#":a=o.slice(s[3],s[5]),r+=i._section(s[1],n,a,e(l,s[4],o));break;case"^":r+=i._inverted(s[1],n,e(l,s[4],o));break;case">":r+=i._partial(s[1],n);break;case"&":r+=i._name(s[1],n);break;case"name":r+=i._escaped(s[1],n);break;case"text":r+=s[1]}return r}}function l(t){for(var e,i=[],n=i,o=[],s=0,a=t.length;a>s;++s)switch(e=t[s],e[0]){case"#":case"^":o.push(e),n.push(e),n=e[4]=[];break;case"/":var r=o.pop();r[5]=e[2],n=o.length>0?o[o.length-1][4]:i;break;default:n.push(e)}return i}function h(t){for(var e,i,n=[],o=0,s=t.length;s>o;++o)e=t[o],"text"===e[0]&&i&&"text"===i[0]?(i[1]+=e[1],i[3]=e[3]):(i=e,n.push(e));return n}function c(t){return[RegExp(i(t[0])+"\\s*"),RegExp("\\s*"+i(t[1]))]}var u={};u.name="mustache.js",u.version="0.7.2",u.tags=["{{","}}"],u.Scanner=o,u.Context=s,u.Writer=a;var p=/\s*/,d=/\s+/,m=/\S/,f=/\s*=/,_=/\s*\}/,g=/#|\^|\/|>|\{|&|=|!/,v=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};u.escape=n,o.prototype.eos=function(){return""===this.tail},o.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},o.prototype.scanUntil=function(t){var e,i=this.tail.search(t);switch(i){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,i),this.tail=this.tail.substring(i),this.pos+=i}return e},s.make=function(t){return t instanceof s?t:new s(t)},s.prototype.clearCache=function(){this._cache={}},s.prototype.push=function(t){return new s(t,this)},s.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."===t)e=this.view;else for(var i=this;i;){if(t.indexOf(".")>0){var n=t.split("."),o=0;for(e=i.view;e&&n.length>o;)e=e[n[o++]]}else e=i.view[t];if(null!=e)break;i=i.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(t,e){var i=this._cache[t];if(!i){var n=u.parse(t,e);i=this._cache[t]=this.compileTokens(n,t)}return i},a.prototype.compilePartial=function(t,e,i){var n=this.compile(e,i);return this._partialCache[t]=n,n},a.prototype.compileTokens=function(t,e){var i=r(t),n=this;return function(t,o){if(o)if("function"==typeof o)n._loadPartial=o;else for(var a in o)n.compilePartial(a,o[a]);return i(n,s.make(t),e)}},a.prototype.render=function(t,e,i){return this.compile(t)(e,i)},a.prototype._section=function(t,e,i,n){var o=e.lookup(t);switch(typeof o){case"object":if(v(o)){for(var s="",a=0,r=o.length;r>a;++a)s+=n(this,e.push(o[a]));return s}return o?n(this,e.push(o)):"";case"function":var l=this,h=function(t){return l.render(t,e)},c=o.call(e.view,i,h);return null!=c?c:"";default:if(o)return n(this,e)}return""},a.prototype._inverted=function(t,e,i){var n=e.lookup(t);return!n||v(n)&&0===n.length?i(this,e):""},a.prototype._partial=function(t,e){t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t));var i=this._partialCache[t];return i?i(e):""},a.prototype._name=function(t,e){var i=e.lookup(t);return"function"==typeof i&&(i=i.call(e.view)),null==i?"":i+""},a.prototype._escaped=function(t,e){return u.escape(this._name(t,e))},u.parse=function(t,n){function s(){if(E&&!x)for(;P.length;)b.splice(P.pop(),1);else P=[];E=!1,x=!1}if(t=t||"",n=n||u.tags,"string"==typeof n&&(n=n.split(d)),2!==n.length)throw Error("Invalid tags: "+n.join(", "));for(var a,r,m,v,y=c(n),L=new o(t),T=[],b=[],P=[],E=!1,x=!1;!L.eos();){if(a=L.pos,m=L.scanUntil(y[0]))for(var w=0,M=m.length;M>w;++w)v=m.charAt(w),e(v)?P.push(b.length):x=!0,b.push(["text",v,a,a+1]),a+=1,"\n"===v&&s();if(a=L.pos,!L.scan(y[0]))break;if(E=!0,r=L.scan(g)||"name",L.scan(p),"="===r)m=L.scanUntil(f),L.scan(f),L.scanUntil(y[1]);else if("{"===r){var D=RegExp("\\s*"+i("}"+n[1]));m=L.scanUntil(D),L.scan(_),L.scanUntil(y[1]),r="&"}else m=L.scanUntil(y[1]);if(!L.scan(y[1]))throw Error("Unclosed tag at "+L.pos);if("/"===r){if(0===T.length)throw Error('Unopened section "'+m+'" at '+a);var C=T.pop();if(C[1]!==m)throw Error('Unclosed section "'+C[1]+'" at '+a)}var S=[r,m,a,L.pos];if(b.push(S),"#"===r||"^"===r)T.push(S);else if("name"===r||"{"===r||"&"===r)x=!0;else if("="===r){if(n=m.split(d),2!==n.length)throw Error("Invalid tags at "+a+": "+n.join(", "));y=c(n)}}var C=T.pop();if(C)throw Error('Unclosed section "'+C[1]+'" at '+L.pos);return l(h(b))};var L=new a;return u.clearCache=function(){return L.clearCache()},u.compile=function(t,e){return L.compile(t,e)},u.compilePartial=function(t,e,i){return L.compilePartial(t,e,i)},u.compileTokens=function(t,e){return L.compileTokens(t,e)},u.render=function(t,e,i){return L.render(t,e,i)},u.to_html=function(t,e,i,n){var o=u.render(t,e,i);return"function"!=typeof n?o:(n(o),void 0)},u}())})()},{}],7:[function(t,e){"use strict";var i=t("./util"),n=t("./url"),o=t("./request");e.exports=function(t){var e,s={};return s.getURL=function(){return e},s.setURL=function(t){return e=n.jsonify(t),s},s.setID=function(t){return i.strict(t,"string"),s.setURL(n.base()+t+"/geocode/{query}.json"),s},s.setTileJSON=function(t){return i.strict(t,"object"),s.setURL(t.geocoder),s},s.queryURL=function(t){if(i.strict(t,"string"),!s.getURL())throw Error("Geocoding map ID not set");return L.Util.template(s.getURL(),{query:encodeURIComponent(t)})},s.query=function(t,e){return i.strict(t,"string"),i.strict(e,"function"),o(s.queryURL(t),function(t,n){if(n&&n.results&&n.results.length){var o={results:n.results,latlng:[n.results[0][0].lat,n.results[0][0].lon]};
void 0!==n.results[0][0].bounds&&(o.bounds=n.results[0][0].bounds,o.lbounds=i.lbounds(o.bounds)),e(null,o)}else e(t||!0)}),s},s.reverseQuery=function(t,e){function i(t){return void 0!==t.lat&&void 0!==t.lng?t.lng+","+t.lat:void 0!==t.lat&&void 0!==t.lon?t.lon+","+t.lat:t[0]+","+t[1]}var n="";if(t.length&&t[0].length){for(var a=0,r=[];t.length>a;a++)r.push(i(t[a]));n=r.join(";")}else n=i(t);return o(s.queryURL(n),function(t,i){e(t,i)}),s},"string"==typeof t?-1==t.indexOf("/")?s.setID(t):s.setURL(t):"object"==typeof t&&s.setTileJSON(t),s}},{"./request":21,"./url":22,"./util":20}],8:[function(t,e){"use strict";function i(t){t=t||{};var e={small:[20,50],medium:[30,70],large:[35,90]},i=t["marker-size"]||"medium",n=t["marker-symbol"]?"-"+t["marker-symbol"]:"",o=(t["marker-color"]||"7e7e7e").replace("#","");return L.icon({iconUrl:s.base()+"marker/"+"pin-"+i.charAt(0)+n+"+"+o+(L.Browser.retina?"@2x":"")+".png",iconSize:e[i],iconAnchor:[e[i][0]/2,e[i][1]/2],popupAnchor:[0,-e[i][1]/2]})}function n(t,e){return L.marker(e,{icon:i(t.properties),title:t.properties.title})}function o(t,e){if(!t||!t.properties)return"";var i="";return t.properties.title&&(i+='<div class="marker-title">'+t.properties.title+"</div>"),t.properties.description&&(i+='<div class="marker-description">'+t.properties.description+"</div>"),(e||a)(i)}var s=t("./url"),a=t("./sanitize");e.exports={icon:i,style:n,createPopup:o}},{"./sanitize":17,"./url":22}],9:[function(t,e){"use strict";var i=t("./util");t("./url");var n=L.TileLayer.extend({includes:[t("./load_tilejson")],options:{format:"png"},formats:["png","png32","png64","png128","png256","jpg70","jpg80","jpg90"],initialize:function(t,e){L.TileLayer.prototype.initialize.call(this,void 0,e),this._tilejson={},e&&e.detectRetina&&L.Browser.retina&&e.retinaVersion&&(t=e.retinaVersion),e&&e.format&&i.strict_oneof(e.format,this.formats),this._loadTileJSON(t)},setFormat:function(t){return i.strict(t,"string"),this.options.format=t,this.redraw(),this},setUrl:null,_setTileJSON:function(t){return i.strict(t,"object"),L.extend(this.options,{tiles:t.tiles,attribution:t.attribution,minZoom:t.minzoom,maxZoom:t.maxzoom,tms:"tms"===t.scheme,bounds:t.bounds&&i.lbounds(t.bounds)}),this._tilejson=t,this.redraw(),this},getTileJSON:function(){return this._tilejson},getTileUrl:function(t){var e=this.options.tiles,i=Math.abs(t.x+t.y)%e.length,n=e[i],o=L.Util.template(n,t);return o?o.replace(".png","."+this.options.format):o},_update:function(){this.options.tiles&&L.TileLayer.prototype._update.call(this)}});e.exports=function(t,e){return new n(t,e)}},{"./load_tilejson":23,"./url":22,"./util":20}],11:[function(t,e){"use strict";var i=L.Control.extend({options:{position:"bottomright",sanitizer:t("./sanitize")},initialize:function(t){L.setOptions(this,t),this._legends={}},onAdd:function(){return this._container=L.DomUtil.create("div","map-legends wax-legends"),L.DomEvent.disableClickPropagation(this._container),this._update(),this._container},addLegend:function(t){return t?(this._legends[t]||(this._legends[t]=0),this._legends[t]++,this._update()):this},removeLegend:function(t){return t?(this._legends[t]&&this._legends[t]--,this._update()):this},_update:function(){if(!this._map)return this;this._container.innerHTML="";var t="none";for(var e in this._legends)if(this._legends.hasOwnProperty(e)&&this._legends[e]){var i=this._container.appendChild(document.createElement("div"));i.className="map-legend wax-legend",i.innerHTML=this.options.sanitizer(e),t="block"}return this._container.style.display=t,this}});e.exports=function(t){return new i(t)}},{"./sanitize":17}],12:[function(t,e){"use strict";var i=t("./geocoder"),n=L.Control.extend({includes:L.Mixin.Events,options:{position:"topleft"},initialize:function(t){this.geocoder=i(t)},setURL:function(t){return this.geocoder.setURL(t),this},getURL:function(){return this.geocoder.getURL()},setID:function(t){return this.geocoder.setID(t),this},setTileJSON:function(t){return this.geocoder.setTileJSON(t),this},_toggle:function(t){t&&L.DomEvent.stop(t),L.DomUtil.hasClass(this._container,"active")?(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur()):(L.DomUtil.addClass(this._container,"active"),this._input.focus(),this._input.select())},_closeIfOpen:function(){L.DomUtil.hasClass(this._container,"active")&&(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur())},onAdd:function(t){var e=L.DomUtil.create("div","leaflet-control-mapbox-geocoder leaflet-bar leaflet-control"),i=L.DomUtil.create("a","leaflet-control-mapbox-geocoder-toggle mapbox-icon mapbox-icon-geocoder",e),n=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-results",e),o=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-wrap",e),s=L.DomUtil.create("form","leaflet-control-mapbox-geocoder-form",o),a=L.DomUtil.create("input","",s);return i.href="#",i.innerHTML="&nbsp;",a.type="text",a.setAttribute("placeholder","Search"),L.DomEvent.addListener(i,"click",this._toggle,this),L.DomEvent.addListener(s,"submit",this._geocode,this),L.DomEvent.disableClickPropagation(e),this._map=t,this._results=n,this._input=a,this._form=s,this._map.on("click",this._closeIfOpen,this),e},_geocode:function(t){L.DomEvent.preventDefault(t),L.DomUtil.addClass(this._container,"searching");var e=this._map;this.geocoder.query(this._input.value,L.bind(function(t,i){if(L.DomUtil.removeClass(this._container,"searching"),!t&&i&&i.results&&i.results.length){if(this._results.innerHTML="",1===i.results.length&&i.lbounds)this._map.fitBounds(i.lbounds),this._closeIfOpen();else{for(var n=0,o=Math.min(i.results.length,5);o>n;n++){for(var s=[],a=0;i.results[n].length>a;a++)i.results[n][a].name&&s.push(i.results[n][a].name);if(s.length){var r=L.DomUtil.create("a","",this._results);r.innerHTML=s.join(", "),r.href="#",function(t){L.DomEvent.addListener(r,"click",function(i){var n=t[0].bounds;e.fitBounds(L.latLngBounds([[n[1],n[0]],[n[3],n[2]]])),L.DomEvent.stop(i)})}(i.results[n])}}if(i.results.length>5){var l=L.DomUtil.create("span","",this._results);l.innerHTML="Top 5 of "+i.results.length+"  results"}}this.fire("found",i)}else this.fire("error",{error:t})},this))}});e.exports=function(t){return new n(t)}},{"./geocoder":7}],10:[function(t,e){"use strict";var i=L.Control.extend({includes:[t("./load_tilejson")],options:{position:"topleft",url:""},initialize:function(t,e){L.setOptions(this,e),this._loadTileJSON(t)},_setTileJSON:function(t){this._tilejson=t},onAdd:function(t){this._map=t;var e=L.DomUtil.create("div","leaflet-control-mapbox-share leaflet-bar"),i=L.DomUtil.create("a","mapbox-share mapbox-icon mapbox-icon-share",e);return i.href="#",L.DomEvent.addListener(i,"click",this._share,this),L.DomEvent.disableClickPropagation(e),this._map.on("mousedown",this._clickOut,this),e},_clickOut:function(){return this._popup?(this._map.removeLayer(this._popup),this._popup=null,void 0):void 0},_share:function(t){function e(t){if(t.originalEvent&&"TEXTAREA"===t.originalEvent.target.nodeName){var e=t.originalEvent.target;e.focus(),e.select()}else t.originalEvent&&"#close"===t.originalEvent.target.getAttribute("href")&&this._clickOut(t);L.DomEvent.stop(t.originalEvent)}L.DomEvent.stop(t);var i=this._tilejson||this._map._tilejson||{},n="http://twitter.com/intent/tweet?status="+encodeURIComponent(i.name+"\n"+(i.webpage||window.location)),o="https://www.facebook.com/sharer.php?u="+encodeURIComponent(this.options.url||i.webpage||window.location)+"&t="+encodeURIComponent(i.name),s="<a class='leaflet-popup-close-button' href='#close'>Ã—</a>"+"<h3>Share this map</h3><div class='mapbox-share-buttons'><a class='mapbox-share-facebook mapbox-icon mapbox-icon-facebook' target='_blank' href='{{facebook}}'>Facebook</a><a class='mapbox-share-twitter mapbox-icon mapbox-icon-twitter' target='_blank' href='{{twitter}}'>Twitter</a></div>".replace("{{twitter}}",n).replace("{{facebook}}",o)+"<h3>Get the embed code</h3><small>Copy and paste this HTML into your website or blog.</small>"+"<textarea rows=4>{{value}}</textarea>".replace("{{value}}","&lt;iframe width='500' height='300' frameBorder='0' src='{{embed}}'&gt;&lt;/iframe&gt;".replace("{{embed}}",i.embed||window.location));this._popup=L.marker(this._map.getCenter(),{zIndexOffset:1e4,icon:L.divIcon({className:"mapbox-share-popup",iconSize:L.point(360,240),iconAnchor:L.point(180,120),html:s})}).on("mousedown",function(t){L.DomEvent.stopPropagation(t.originalEvent)}).on("click",e,this).addTo(this._map)}});e.exports=function(t,e){return new i(t,e)}},{"./load_tilejson":23}],14:[function(t,e){"use strict";var i=t("./util"),n=(t("./url"),t("./request")),o=t("./grid"),s=L.Class.extend({includes:[L.Mixin.Events,t("./load_tilejson")],options:{template:function(){return""}},_mouseOn:null,_tilejson:{},_cache:{},initialize:function(t,e){L.Util.setOptions(this,e),this._loadTileJSON(t)},_setTileJSON:function(t){return i.strict(t,"object"),L.extend(this.options,{grids:t.grids,minZoom:t.minzoom,maxZoom:t.maxzoom,bounds:t.bounds&&i.lbounds(t.bounds)}),this._tilejson=t,this._cache={},this._update(),this},getTileJSON:function(){return this._tilejson},active:function(){return!!(this._map&&this.options.grids&&this.options.grids.length)},addTo:function(t){return t.addLayer(this),this},onAdd:function(t){this._map=t,this._update(),this._map.on("click",this._click,this).on("mousemove",this._move,this).on("moveend",this._update,this)},onRemove:function(){this._map.off("click",this._click,this).off("mousemove",this._move,this).off("moveend",this._update,this)},getData:function(t,e){if(this.active()){var i=this._map,n=i.project(t),o=256,s=4,a=Math.floor(n.x/o),r=Math.floor(n.y/o),l=i.options.crs.scale(i.getZoom())/o;return a=(a+l)%l,r=(r+l)%l,this._getTile(i.getZoom(),a,r,function(t){var i=Math.floor((n.x-a*o)/s),l=Math.floor((n.y-r*o)/s);e(t(i,l))}),this}},_click:function(t){this.getData(t.latlng,L.bind(function(e){this.fire("click",{latLng:t.latlng,data:e})},this))},_move:function(t){this.getData(t.latlng,L.bind(function(e){e!==this._mouseOn?(this._mouseOn&&this.fire("mouseout",{latLng:t.latlng,data:this._mouseOn}),this.fire("mouseover",{latLng:t.latlng,data:e}),this._mouseOn=e):this.fire("mousemove",{latLng:t.latlng,data:e})},this))},_getTileURL:function(t){var e=this.options.grids,i=(t.x+t.y)%e.length,n=e[i];return L.Util.template(n,t)},_update:function(){if(this.active()){var t=this._map.getPixelBounds(),e=this._map.getZoom(),i=256;if(!(e>this.options.maxZoom||this.options.minZoom>e))for(var n=new L.Point(Math.floor(t.min.x/i),Math.floor(t.min.y/i)),o=new L.Point(Math.floor(t.max.x/i),Math.floor(t.max.y/i)),s=this._map.options.crs.scale(e)/i,a=n.x;o.x>=a;a++)for(var r=n.y;o.y>=r;r++){var l=(a+s)%s,h=(r+s)%s;this._getTile(e,l,h)}}},_getTile:function(t,e,i,s){var a=t+"_"+e+"_"+i,r=L.point(e,i);if(r.z=t,this._tileShouldBeLoaded(r)){if(a in this._cache){if(!s)return;return"function"==typeof this._cache[a]?s(this._cache[a]):this._cache[a].push(s),void 0}this._cache[a]=[],s&&this._cache[a].push(s),n(this._getTileURL(r),L.bind(function(t,e){var i=this._cache[a];this._cache[a]=o(e);for(var n=0;i.length>n;++n)i[n](this._cache[a])},this))}},_tileShouldBeLoaded:function(t){if(t.z>this.options.maxZoom||t.z<this.options.minZoom)return!1;if(this.options.bounds){var e=256,i=t.multiplyBy(e),n=i.add(new L.Point(e,e)),o=this._map.unproject(i),s=this._map.unproject(n),a=new L.LatLngBounds([o,s]);if(!this.options.bounds.intersects(a))return!1}return!0}});e.exports=function(t,e){return new s(t,e)}},{"./grid":24,"./load_tilejson":23,"./request":21,"./url":22,"./util":20}],15:[function(t,e){"use strict";var i=t("./util"),n=t("./url"),o=t("./request"),s=t("./marker"),a=L.FeatureGroup.extend({options:{filter:function(){return!0},sanitizer:t("./sanitize")},initialize:function(t,e){L.setOptions(this,e),this._layers={},"string"==typeof t?i.idUrl(t,this):t&&"object"==typeof t&&this.setGeoJSON(t)},setGeoJSON:function(t){this._geojson=t,this.clearLayers(),this._initialize(t)},getGeoJSON:function(){return this._geojson},loadURL:function(t){return t=n.jsonify(t),o(t,L.bind(function(e,n){e?(i.log("could not load markers at "+t),this.fire("error",{error:e})):n&&(this.setGeoJSON(n),this.fire("ready"))},this)),this},loadID:function(t){return this.loadURL(n.base()+t+"/markers.geojson")},setFilter:function(t){return this.options.filter=t,this._geojson&&(this.clearLayers(),this._initialize(this._geojson)),this},getFilter:function(){return this.options.filter},_initialize:function(t){var e,i,n=L.Util.isArray(t)?t:t.features;if(n)for(e=0,i=n.length;i>e;e++)(n[e].geometries||n[e].geometry||n[e].features)&&this._initialize(n[e]);else if(this.options.filter(t)){var o=L.GeoJSON.geometryToLayer(t,s.style),a=s.createPopup(t,this.options.sanitizer);o.feature=t,a&&o.bindPopup(a,{closeButton:!1}),this.addLayer(o)}}});e.exports=function(t,e){return new a(t,e)}},{"./marker":8,"./request":21,"./sanitize":17,"./url":22,"./util":20}],16:[function(t,e){"use strict";var i=(t("./util"),t("./tile_layer")),n=t("./marker_layer"),o=t("./grid_layer"),s=t("./grid_control"),a=t("./legend_control"),r=L.Map.extend({includes:[t("./load_tilejson")],options:{tileLayer:{},markerLayer:{},gridLayer:{},legendControl:{},gridControl:{}},_tilejson:{},initialize:function(t,e,r){L.Map.prototype.initialize.call(this,t,r),this.attributionControl&&this.attributionControl.setPrefix(""),this.options.tileLayer&&(this.tileLayer=i(void 0,this.options.tileLayer),this.addLayer(this.tileLayer)),this.options.markerLayer&&(this.markerLayer=n(void 0,this.options.markerLayer),this.addLayer(this.markerLayer)),this.options.gridLayer&&(this.gridLayer=o(void 0,this.options.gridLayer),this.addLayer(this.gridLayer)),this.options.gridLayer&&this.options.gridControl&&(this.gridControl=s(this.gridLayer,this.options.gridControl),this.addControl(this.gridControl)),this.options.legendControl&&(this.legendControl=a(this.options.legendControl),this.addControl(this.legendControl)),this._loadTileJSON(e)},addLayer:function(t){return"on"in t&&t.on("ready",L.bind(function(){this._updateLayer(t)},this)),L.Map.prototype.addLayer.call(this,t)},_setTileJSON:function(t){return this._tilejson=t,this._initialize(t),this},getTileJSON:function(){return this._tilejson},_initialize:function(t){if(this.tileLayer&&(this.tileLayer._setTileJSON(t),this._updateLayer(this.tileLayer)),this.markerLayer&&!this.markerLayer.getGeoJSON()&&t.data&&t.data[0]&&this.markerLayer.loadURL(t.data[0]),this.gridLayer&&(this.gridLayer._setTileJSON(t),this._updateLayer(this.gridLayer)),this.legendControl&&t.legend&&this.legendControl.addLegend(t.legend),!this._loaded){var e=t.center[2],i=L.latLng(t.center[1],t.center[0]);this.setView(i,e)}},_updateLayer:function(t){t.options&&(this.attributionControl&&this._loaded&&this.attributionControl.addAttribution(t.options.attribution),L.stamp(t)in this._zoomBoundLayers||!t.options.maxZoom&&!t.options.minZoom||(this._zoomBoundLayers[L.stamp(t)]=t),this._updateZoomLevels())}});e.exports=function(t,e,i){return new r(t,e,i)}},{"./grid_control":13,"./grid_layer":14,"./legend_control":11,"./load_tilejson":23,"./marker_layer":15,"./tile_layer":9,"./util":20}],20:[function(t,e){"use strict";e.exports={idUrl:function(t,e){-1==t.indexOf("/")?e.loadID(t):e.loadURL(t)},log:function(t){console&&"function"==typeof console.error&&console.error(t)},strict:function(t,e){if(typeof t!==e)throw Error("Invalid argument: "+e+" expected")},strict_instance:function(t,e,i){if(!(t instanceof e))throw Error("Invalid argument: "+i+" expected")},strict_oneof:function(t,e){if(-1==e.indexOf(t))throw Error("Invalid argument: "+t+" given, valid values are "+e.join(", "))},lbounds:function(t){return new L.LatLngBounds([[t[1],t[0]],[t[3],t[2]]])}}},{}],19:[function(t,e){(function(){var t=function(){function t(t){var e=(""+t).match(d);return e?new l(h(e[1]),h(e[2]),h(e[3]),h(e[4]),h(e[5]),h(e[6]),h(e[7])):null}function e(t,e,s,a,r,h,c){var u=new l(n(t,m),n(e,m),i(s),a>0?""+a:null,n(r,f),null,i(c));return h&&("string"==typeof h?u.setRawQuery(h.replace(/[^?&=0-9A-Za-z_\-~.%]/g,o)):u.setAllParameters(h)),u}function i(t){return"string"==typeof t?encodeURIComponent(t):null}function n(t,e){return"string"==typeof t?encodeURI(t).replace(e,o):null}function o(t){var e=t.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(15&e>>4)+"0123456789ABCDEF".charAt(15&e)}function s(t){return t.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function a(t){if(null===t)return null;for(var e,i=s(t),n=u;(e=i.replace(n,"$1"))!=i;i=e);return i}function r(t,e){var i=t.clone(),n=e.hasScheme();n?i.setRawScheme(e.getRawScheme()):n=e.hasCredentials(),n?i.setRawCredentials(e.getRawCredentials()):n=e.hasDomain(),n?i.setRawDomain(e.getRawDomain()):n=e.hasPort();var o=e.getRawPath(),s=a(o);if(n)i.setPort(e.getPort()),s=s&&s.replace(p,"");else if(n=!!o){if(47!==s.charCodeAt(0)){var r=a(i.getRawPath()||"").replace(p,""),l=r.lastIndexOf("/")+1;s=a((l?r.substring(0,l):"")+a(o)).replace(p,"")}}else s=s&&s.replace(p,""),s!==o&&i.setRawPath(s);return n?i.setRawPath(s):n=e.hasQuery(),n?i.setRawQuery(e.getRawQuery()):n=e.hasFragment(),n&&i.setRawFragment(e.getRawFragment()),i}function l(t,e,i,n,o,s,a){this.scheme_=t,this.credentials_=e,this.domain_=i,this.port_=n,this.path_=o,this.query_=s,this.fragment_=a,this.paramCache_=null}function h(t){return"string"==typeof t&&t.length>0?t:null}var c=RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),u=RegExp(c),p=/^(?:\.\.\/)*(?:\.\.$)?/;l.prototype.toString=function(){var t=[];return null!==this.scheme_&&t.push(this.scheme_,":"),null!==this.domain_&&(t.push("//"),null!==this.credentials_&&t.push(this.credentials_,"@"),t.push(this.domain_),null!==this.port_&&t.push(":",""+this.port_)),null!==this.path_&&t.push(this.path_),null!==this.query_&&t.push("?",this.query_),null!==this.fragment_&&t.push("#",this.fragment_),t.join("")},l.prototype.clone=function(){return new l(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},l.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},l.prototype.getRawScheme=function(){return this.scheme_},l.prototype.setScheme=function(t){return this.scheme_=n(t,m),this},l.prototype.setRawScheme=function(t){return this.scheme_=t?t:null,this},l.prototype.hasScheme=function(){return null!==this.scheme_},l.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},l.prototype.getRawCredentials=function(){return this.credentials_},l.prototype.setCredentials=function(t){return this.credentials_=n(t,m),this},l.prototype.setRawCredentials=function(t){return this.credentials_=t?t:null,this},l.prototype.hasCredentials=function(){return null!==this.credentials_},l.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},l.prototype.getRawDomain=function(){return this.domain_},l.prototype.setDomain=function(t){return this.setRawDomain(t&&encodeURIComponent(t))},l.prototype.setRawDomain=function(t){return this.domain_=t?t:null,this.setRawPath(this.path_)},l.prototype.hasDomain=function(){return null!==this.domain_},l.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},l.prototype.setPort=function(t){if(t){if(t=Number(t),t!==(65535&t))throw Error("Bad port number "+t);this.port_=""+t}else this.port_=null;return this},l.prototype.hasPort=function(){return null!==this.port_},l.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},l.prototype.getRawPath=function(){return this.path_},l.prototype.setPath=function(t){return this.setRawPath(n(t,f))},l.prototype.setRawPath=function(t){return t?(t+="",this.path_=!this.domain_||/^\//.test(t)?t:"/"+t):this.path_=null,this},l.prototype.hasPath=function(){return null!==this.path_},l.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},l.prototype.getRawQuery=function(){return this.query_},l.prototype.setQuery=function(t){return this.paramCache_=null,this.query_=i(t),this},l.prototype.setRawQuery=function(t){return this.paramCache_=null,this.query_=t?t:null,this},l.prototype.hasQuery=function(){return null!==this.query_},l.prototype.setAllParameters=function(t){if("object"==typeof t&&!(t instanceof Array)&&(t instanceof Object||"[object Array]"!==Object.prototype.toString.call(t))){var e=[],i=-1;for(var n in t){var o=t[n];"string"==typeof o&&(e[++i]=n,e[++i]=o)}t=e}this.paramCache_=null;for(var s=[],a="",r=0;t.length>r;){var n=t[r++],o=t[r++];s.push(a,encodeURIComponent(""+n)),a="&",o&&s.push("=",encodeURIComponent(""+o))}return this.query_=s.join(""),this},l.prototype.checkParameterCache_=function(){if(!this.paramCache_){var t=this.query_;if(t){for(var e=t.split(/[&\?]/),i=[],n=-1,o=0;e.length>o;++o){var s=e[o].match(/^([^=]*)(?:=(.*))?$/);i[++n]=decodeURIComponent(s[1]).replace(/\+/g," "),i[++n]=decodeURIComponent(s[2]||"").replace(/\+/g," ")}this.paramCache_=i}else this.paramCache_=[]}},l.prototype.setParameterValues=function(t,e){"string"==typeof e&&(e=[e]),this.checkParameterCache_();for(var i=0,n=this.paramCache_,o=[],s=0;n.length>s;s+=2)t===n[s]?e.length>i&&o.push(t,e[i++]):o.push(n[s],n[s+1]);for(;e.length>i;)o.push(t,e[i++]);return this.setAllParameters(o),this},l.prototype.removeParameter=function(t){return this.setParameterValues(t,[])},l.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},l.prototype.getParameterValues=function(t){this.checkParameterCache_();for(var e=[],i=0;this.paramCache_.length>i;i+=2)t===this.paramCache_[i]&&e.push(this.paramCache_[i+1]);return e},l.prototype.getParameterMap=function(){this.checkParameterCache_();for(var t={},e=0;this.paramCache_.length>e;e+=2){var i=this.paramCache_[e++],n=this.paramCache_[e++];i in t?t[i].push(n):t[i]=[n]}return t},l.prototype.getParameterValue=function(t){this.checkParameterCache_();for(var e=0;this.paramCache_.length>e;e+=2)if(t===this.paramCache_[e])return this.paramCache_[e+1];return null},l.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},l.prototype.getRawFragment=function(){return this.fragment_},l.prototype.setFragment=function(t){return this.fragment_=t?encodeURIComponent(t):null,this},l.prototype.setRawFragment=function(t){return this.fragment_=t?t:null,this},l.prototype.hasFragment=function(){return null!==this.fragment_};var d=RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),m=/[#\/\?@]/g,f=/[\#\?]/g;return l.parse=t,l.create=e,l.resolve=r,l.collapse_dots=a,l.utils={mimeTypeOf:function(e){var i=t(e);return/\.html$/.test(i.getPath())?"text/html":"application/javascript"},resolve:function(e,i){return e?""+r(t(e),t(i)):""+i}},l}(),i={};if(i.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13},i.atype=i.atype,i.ATTRIBS={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"select::tabindex":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::tabindex":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::width":0},i.ATTRIBS=i.ATTRIBS,i.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256},i.eflags=i.eflags,i.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2},i.ELEMENTS=i.ELEMENTS,i.ELEMENT_DOM_INTERFACES={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"},i.ELEMENT_DOM_INTERFACES=i.ELEMENT_DOM_INTERFACES,i.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},i.ueffects=i.ueffects,i.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1},i.URIEFFECTS=i.URIEFFECTS,i.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},i.ltypes=i.ltypes,i.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1},i.LOADERTYPES=i.LOADERTYPES,"i"!=="I".toLowerCase())throw"I/i problem";
var n=function(e){function i(t){if(k.hasOwnProperty(t))return k[t];var e=t.match(A);if(e)return String.fromCharCode(parseInt(e[1],10));if(e=t.match(U))return String.fromCharCode(parseInt(e[1],16));if(I&&O.test(t)){I.innerHTML="&"+t+";";var i=I.textContent;return k[t]=i,i}return"&"+t+";"}function n(t,e){return i(e)}function o(t){return t.replace(B,"")}function s(t){return t.replace(R,n)}function a(t){return(""+t).replace(N,"&amp;").replace(j,"&lt;").replace(Z,"&gt;").replace(F,"&#34;")}function r(t){return t.replace(H,"&amp;$1").replace(j,"&lt;").replace(Z,"&gt;")}function l(t){var e={cdata:t.cdata||t.cdata,comment:t.comment||t.comment,endDoc:t.endDoc||t.endDoc,endTag:t.endTag||t.endTag,pcdata:t.pcdata||t.pcdata,rcdata:t.rcdata||t.rcdata,startDoc:t.startDoc||t.startDoc,startTag:t.startTag||t.startTag};return function(t,i){return h(t,e,i)}}function h(t,e,i){var n=p(t),o={noMoreGT:!1,noMoreEndComments:!1};u(e,n,0,o,i)}function c(t,e,i,n,o){return function(){u(t,e,i,n,o)}}function u(t,i,n,o,s){try{t.startDoc&&0==n&&t.startDoc(s);for(var a,r,l,h=n,u=i.length;u>h;){var p=i[h++],_=i[h];switch(p){case"&":z.test(_)?(t.pcdata&&t.pcdata("&"+_,s,V,c(t,i,h,o,s)),h++):t.pcdata&&t.pcdata("&amp;",s,V,c(t,i,h,o,s));break;case"</":(a=/^([-\w:]+)[^\'\"]*/.exec(_))?a[0].length===_.length&&">"===i[h+1]?(h+=2,l=a[1].toLowerCase(),t.endTag&&t.endTag(l,s,V,c(t,i,h,o,s))):h=d(i,h,t,s,V,o):t.pcdata&&t.pcdata("&lt;/",s,V,c(t,i,h,o,s));break;case"<":if(a=/^([-\w:]+)\s*\/?/.exec(_))if(a[0].length===_.length&&">"===i[h+1]){h+=2,l=a[1].toLowerCase(),t.startTag&&t.startTag(l,[],s,V,c(t,i,h,o,s));var g=e.ELEMENTS[l];if(g&q){var v={name:l,next:h,eflags:g};h=f(i,v,t,s,V,o)}}else h=m(i,h,t,s,V,o);else t.pcdata&&t.pcdata("&lt;",s,V,c(t,i,h,o,s));break;case"<!--":if(!o.noMoreEndComments){for(r=h+1;u>r&&(">"!==i[r]||!/--$/.test(i[r-1]));r++);if(u>r){if(t.comment){var y=i.slice(h,r).join("");t.comment(y.substr(0,y.length-2),s,V,c(t,i,r+1,o,s))}h=r+1}else o.noMoreEndComments=!0}o.noMoreEndComments&&t.pcdata&&t.pcdata("&lt;!--",s,V,c(t,i,h,o,s));break;case"<!":if(/^\w/.test(_)){if(!o.noMoreGT){for(r=h+1;u>r&&">"!==i[r];r++);u>r?h=r+1:o.noMoreGT=!0}o.noMoreGT&&t.pcdata&&t.pcdata("&lt;!",s,V,c(t,i,h,o,s))}else t.pcdata&&t.pcdata("&lt;!",s,V,c(t,i,h,o,s));break;case"<?":if(!o.noMoreGT){for(r=h+1;u>r&&">"!==i[r];r++);u>r?h=r+1:o.noMoreGT=!0}o.noMoreGT&&t.pcdata&&t.pcdata("&lt;?",s,V,c(t,i,h,o,s));break;case">":t.pcdata&&t.pcdata("&gt;",s,V,c(t,i,h,o,s));break;case"":break;default:t.pcdata&&t.pcdata(p,s,V,c(t,i,h,o,s))}}t.endDoc&&t.endDoc(s)}catch(L){if(L!==V)throw L}}function p(t){var e=/(<\/|<\!--|<[!?]|[&<>])/g;if(t+="",G)return t.split(e);for(var i,n=[],o=0;null!==(i=e.exec(t));)n.push(t.substring(o,i.index)),n.push(i[0]),o=i.index+i[0].length;return n.push(t.substring(o)),n}function d(t,e,i,n,o,s){var a=_(t,e);return a?(i.endTag&&i.endTag(a.name,n,o,c(i,t,e,s,n)),a.next):t.length}function m(t,e,i,n,o,s){var a=_(t,e);return a?(i.startTag&&i.startTag(a.name,a.attrs,n,o,c(i,t,a.next,s,n)),a.eflags&q?f(t,a,i,n,o,s):a.next):t.length}function f(t,i,n,o,s,a){var l=t.length;J.hasOwnProperty(i.name)||(J[i.name]=RegExp("^"+i.name+"(?:[\\s\\/]|$)","i"));for(var h=J[i.name],u=i.next,p=i.next+1;l>p&&("</"!==t[p-1]||!h.test(t[p]));p++);l>p&&(p-=1);var d=t.slice(u,p).join("");if(i.eflags&e.eflags.CDATA)n.cdata&&n.cdata(d,o,s,c(n,t,p,a,o));else{if(!(i.eflags&e.eflags.RCDATA))throw Error("bug");n.rcdata&&n.rcdata(r(d),o,s,c(n,t,p,a,o))}return p}function _(t,i){var n=/^([-\w:]+)/.exec(t[i]),o={};o.name=n[1].toLowerCase(),o.eflags=e.ELEMENTS[o.name];for(var s=t[i].substr(n[0].length),a=i+1,r=t.length;r>a&&">"!==t[a];a++)s+=t[a];if(a>=r)return void 0;for(var l=[];""!==s;)if(n=W.exec(s)){if(n[4]&&!n[5]||n[6]&&!n[7]){for(var h=n[4]||n[6],c=!1,u=[s,t[a++]];r>a;a++){if(c){if(">"===t[a])break}else t[a].indexOf(h)>=0&&(c=!0);u.push(t[a])}if(a>=r)break;s=u.join("");continue}var p=n[1].toLowerCase(),d=n[2]?g(n[3]):"";l.push(p,d),s=s.substr(n[0].length)}else s=s.replace(/^[\s\S][^a-z\s]*/,"");return o.attrs=l,o.next=a+1,o}function g(t){var e=t.charCodeAt(0);return(34===e||39===e)&&(t=t.substr(1,t.length-2)),s(o(t))}function v(t){var i,n,o=function(t,e){n||e.push(t)};return l({startDoc:function(){i=[],n=!1},startTag:function(o,s,r){if(!n&&e.ELEMENTS.hasOwnProperty(o)){var l=e.ELEMENTS[o];if(!(l&e.eflags.FOLDABLE)){var h=t(o,s);if(!h)return n=!(l&e.eflags.EMPTY),void 0;if("object"!=typeof h)throw Error("tagPolicy did not return object (old API?)");if(!("attribs"in h))throw Error("tagPolicy gave no attribs");s=h.attribs;var c,u;if("tagName"in h?(u=h.tagName,c=e.ELEMENTS[u]):(u=o,c=l),l&e.eflags.OPTIONAL_ENDTAG){var p=i[i.length-1];!p||p.orig!==o||p.rep===u&&o===u||r.push("</",p.rep,">")}l&e.eflags.EMPTY||i.push({orig:o,rep:u}),r.push("<",u);for(var d=0,m=s.length;m>d;d+=2){var f=s[d],_=s[d+1];null!==_&&void 0!==_&&r.push(" ",f,'="',a(_),'"')}r.push(">"),l&e.eflags.EMPTY&&!(c&e.eflags.EMPTY)&&r.push("</",u,">")}}},endTag:function(t,o){if(n)return n=!1,void 0;if(e.ELEMENTS.hasOwnProperty(t)){var s=e.ELEMENTS[t];if(!(s&(e.eflags.EMPTY|e.eflags.FOLDABLE))){var a;if(s&e.eflags.OPTIONAL_ENDTAG)for(a=i.length;--a>=0;){var r=i[a].orig;if(r===t)break;if(!(e.ELEMENTS[r]&e.eflags.OPTIONAL_ENDTAG))return}else for(a=i.length;--a>=0&&i[a].orig!==t;);if(0>a)return;for(var l=i.length;--l>a;){var h=i[l].rep;e.ELEMENTS[h]&e.eflags.OPTIONAL_ENDTAG||o.push("</",h,">")}i.length>a&&(t=i[a].rep),i.length=a,o.push("</",t,">")}}},pcdata:o,rcdata:o,cdata:o,endDoc:function(t){for(;i.length;i.length--)t.push("</",i[i.length-1].rep,">")}})}function y(e,i,n,o,s){if(!s)return null;try{var a=t.parse(""+e);if(a&&(!a.hasScheme()||X.test(a.getScheme()))){var r=s(a,i,n,o);return r?""+r:null}}catch(l){return null}return null}function L(t,e,i,n,o){if(i||t(e+" removed",{change:"removed",tagName:e}),n!==o){var s="changed";n&&!o?s="removed":!n&&o&&(s="added"),t(e+"."+i+" "+s,{change:s,tagName:e,attribName:i,oldValue:n,newValue:o})}}function T(t,e,i){var n;return n=e+"::"+i,t.hasOwnProperty(n)?t[n]:(n="*::"+i,t.hasOwnProperty(n)?t[n]:void 0)}function b(t,i){return T(e.LOADERTYPES,t,i)}function P(t,i){return T(e.URIEFFECTS,t,i)}function E(t,i,n,o,s){for(var a=0;i.length>a;a+=2){var r,l=i[a],h=i[a+1],c=h,u=null;if(r=t+"::"+l,(e.ATTRIBS.hasOwnProperty(r)||(r="*::"+l,e.ATTRIBS.hasOwnProperty(r)))&&(u=e.ATTRIBS[r]),null!==u)switch(u){case e.atype.NONE:break;case e.atype.SCRIPT:h=null,s&&L(s,t,l,c,h);break;case e.atype.STYLE:if(D===void 0){h=null,s&&L(s,t,l,c,h);break}var p=[];D(h,{declaration:function(t,i){var o=t.toLowerCase(),s=S[o];s&&(C(o,s,i,n?function(t){return y(t,e.ueffects.SAME_DOCUMENT,e.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:o},n)}:null),p.push(t+": "+i.join(" ")))}}),h=p.length>0?p.join(" ; "):null,s&&L(s,t,l,c,h);break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:h=o?o(h):h,s&&L(s,t,l,c,h);break;case e.atype.URI:h=y(h,P(t,l),b(t,l),{TYPE:"MARKUP",XML_ATTR:l,XML_TAG:t},n),s&&L(s,t,l,c,h);break;case e.atype.URI_FRAGMENT:h&&"#"===h.charAt(0)?(h=h.substring(1),h=o?o(h):h,null!==h&&void 0!==h&&(h="#"+h)):h=null,s&&L(s,t,l,c,h);break;default:h=null,s&&L(s,t,l,c,h)}else h=null,s&&L(s,t,l,c,h);i[a+1]=h}return i}function x(t,i,n){return function(o,s){return e.ELEMENTS[o]&e.eflags.UNSAFE?(n&&L(n,o,void 0,void 0,void 0),void 0):{attribs:E(o,s,t,i,n)}}}function w(t,e){var i=[];return v(e)(t,i),i.join("")}function M(t,e,i,n){var o=x(e,i,n);return w(t,o)}var D,C,S;"undefined"!=typeof window&&(D=window.parseCssDeclarations,C=window.sanitizeCssProperty,S=window.cssSchema);var k={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:"Â "},A=/^#(\d+)$/,U=/^#x([0-9A-Fa-f]+)$/,O=/^[A-Za-z][A-za-z0-9]+$/,I="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,B=/\0/g,R=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,z=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,N=/&/g,H=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,j=/[<]/g,Z=/>/g,F=/\"/g,W=RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),G=3==="a,b".split(/(,)/).length,q=e.eflags.CDATA|e.eflags.RCDATA,V={},J={},X=/^(?:https?|mailto|data)$/i,$={};return $.escapeAttrib=$.escapeAttrib=a,$.makeHtmlSanitizer=$.makeHtmlSanitizer=v,$.makeSaxParser=$.makeSaxParser=l,$.makeTagPolicy=$.makeTagPolicy=x,$.normalizeRCData=$.normalizeRCData=r,$.sanitize=$.sanitize=M,$.sanitizeAttribs=$.sanitizeAttribs=E,$.sanitizeWithPolicy=$.sanitizeWithPolicy=w,$.unescapeEntities=$.unescapeEntities=s,$}(i),o=n.sanitize;i.ATTRIBS["*::style"]=0,i.ELEMENTS.style=0,i.ATTRIBS["a::target"]=0,i.ELEMENTS.video=0,i.ATTRIBS["video::src"]=0,i.ATTRIBS["video::poster"]=0,i.ATTRIBS["video::controls"]=0,i.ELEMENTS.audio=0,i.ATTRIBS["audio::src"]=0,i.ATTRIBS["video::autoplay"]=0,i.ATTRIBS["video::controls"]=0,e!==void 0&&(e.exports=o)})()},{}],24:[function(t,e){"use strict";function i(t){return t>=93&&t--,t>=35&&t--,t-32}e.exports=function(t){return function(e,n){if(t){var o=i(t.grid[n].charCodeAt(e)),s=t.keys[o];return t.data[s]}}}},{}],22:[function(t,e){"use strict";var i=t("./config");e.exports={isSSL:function(){return"https:"===document.location.protocol||i.FORCE_HTTPS},base:function(t){var e=this.isSSL()?i.HTTPS_URLS:i.HTTP_URLS;return void 0===t||"number"!=typeof t?e[0]:e[t%e.length]},secureFlag:function(t){return this.isSSL()?t.match(/(\?|&)secure/)?t:-1!==t.indexOf("?")?t+"&secure":t+"?secure":t},jsonify:function(t){return t.replace(/\.(geo)?jsonp(?=$|\?)/,".$1json")}}},{"./config":6}],23:[function(t,e){"use strict";var i=t("./request"),n=t("./url"),o=t("./util");e.exports={_loadTileJSON:function(t){"string"==typeof t?(-1==t.indexOf("/")&&(t=n.base()+t+".json"),i(n.secureFlag(t),L.bind(function(e,i){e?(o.log("could not load TileJSON at "+t),this.fire("error",{error:e})):i&&(this._setTileJSON(i),this.fire("ready"))},this))):t&&"object"==typeof t&&this._setTileJSON(t)}}},{"./request":21,"./url":22,"./util":20}],13:[function(t,e){"use strict";var i=t("./util"),n=t("mustache"),o=L.Control.extend({options:{pinnable:!0,follow:!1,sanitizer:t("./sanitize"),touchTeaser:!0,location:!0},_currentContent:"",_pinned:!1,initialize:function(t,e){L.Util.setOptions(this,e),i.strict_instance(t,L.Class,"L.mapbox.gridLayer"),this._layer=t},setTemplate:function(t){this.options.template=t},_template:function(t,e){if(e){var i=this.options.template||this._layer.getTileJSON().template;if(i){var o={};return o["__"+t+"__"]=!0,this.options.sanitizer(n.to_html(i,L.extend(o,e)))}}},_show:function(t,e){t!==this._currentContent&&(this._currentContent=t,this.options.follow?(this._popup.setContent(t).setLatLng(e.latLng),this._map._popup!==this._popup&&this._popup.openOn(this._map)):(this._container.style.display="block",this._contentWrapper.innerHTML=t))},_hide:function(){this._pinned=!1,this._currentContent="",this._map.closePopup(),this._container.style.display="none",this._contentWrapper.innerHTML="",L.DomUtil.removeClass(this._container,"closable")},_mouseover:function(t){if(t.data?L.DomUtil.addClass(this._map._container,"map-clickable"):L.DomUtil.removeClass(this._map._container,"map-clickable"),!this._pinned){var e=this._template("teaser",t.data);e?this._show(e,t):this._hide()}},_mousemove:function(t){this._pinned||this.options.follow&&this._popup.setLatLng(t.latLng)},_navigateTo:function(t){window.top.location.href=t},_click:function(t){var e=this._template("location",t.data);if(this.options.location&&e&&0===e.search(/^https?:/))return this._navigateTo(this._template("location",t.data));if(this.options.pinnable){var i=this._template("full",t.data);!i&&this.options.touchTeaser&&L.Browser.touch&&(i=this._template("teaser",t.data)),i?(L.DomUtil.addClass(this._container,"closable"),this._pinned=!0,this._show(i,t)):this._pinned&&(L.DomUtil.removeClass(this._container,"closable"),this._pinned=!1,this._hide())}},_onPopupClose:function(){this._currentContent=null,this._pinned=!1},_createClosebutton:function(t,e){var i=L.DomUtil.create("a","close",t);return i.innerHTML="close",i.href="#",i.title="close",L.DomEvent.on(i,"click",L.DomEvent.stopPropagation).on(i,"mousedown",L.DomEvent.stopPropagation).on(i,"dblclick",L.DomEvent.stopPropagation).on(i,"click",L.DomEvent.preventDefault).on(i,"click",e,this),i},onAdd:function(t){this._map=t;var e="leaflet-control-grid map-tooltip",i=L.DomUtil.create("div",e),n=L.DomUtil.create("div","map-tooltip-content");return i.style.display="none",this._createClosebutton(i,this._hide),i.appendChild(n),this._contentWrapper=n,this._popup=new L.Popup({autoPan:!1,closeOnClick:!1}),t.on("popupclose",this._onPopupClose,this),L.DomEvent.disableClickPropagation(i).addListener(i,"mousewheel",L.DomEvent.stopPropagation),this._layer.on("mouseover",this._mouseover,this).on("mousemove",this._mousemove,this).on("click",this._click,this),i},onRemove:function(t){t.off("popupclose",this._onPopupClose,this),this._layer.off("mouseover",this._mouseover,this).off("mousemove",this._mousemove,this).off("click",this._click,this)}});e.exports=function(t,e){return new o(t,e)}},{"./sanitize":17,"./util":20,mustache:18}],21:[function(t,e){"use strict";var i=t("corslite"),n=t("json3"),o=t("./util").strict;e.exports=function(t,e){o(t,"string"),o(e,"function"),i(t,function(t,i){!t&&i&&(i="g"==i.responseText[0]?n.parse(i.responseText.substring(5,i.responseText.length-2)):n.parse(i.responseText)),e(t,i)})}},{"./util":20,corslite:25,json3:26}],25:[function(t,e){function i(t,e,n){function o(t){return t>=200&&300>t||304===t}function s(){void 0===r.status||o(r.status)?e.call(r,null,r):e.call(r,r,null)}if(window.XMLHttpRequest===void 0)return e(Error("Browser not supported"));if(n===void 0){var a=t.match(/^\s*https?:\/\/[^\/]*/);n=a&&a[0]!==location.protocol+"//"+location.domain+(location.port?":"+location.port:"")}var r;return r=!n||"object"!=typeof window.XDomainRequest&&"function"!=typeof window.XDomainRequest?new window.XMLHttpRequest:new window.XDomainRequest,"onload"in r?r.onload=s:r.onreadystatechange=function(){4===r.readyState&&s()},r.onerror=function(t){e.call(this,t,null),e=function(){}},r.onprogress=function(){},r.ontimeout=function(t){e.call(this,t,null),e=function(){}},r.onabort=function(t){e.call(this,t,null),e=function(){}},r.open("GET",t,!0),r.send(null),i}e!==void 0&&(e.exports=i)},{}],26:[function(t,e,i){(function(t){function e(t){if("bug-string-char-index"==t)return"a"!="a"[0];var e,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}',n="json"==t;if(n||"json-stringify"==t||"json-parse"==t){if("json-stringify"==t||n){var o=l.stringify,r="function"==typeof o&&h;if(r){(e=function(){return 1}).toJSON=e;try{r="0"===o(0)&&"0"===o(new Number)&&'""'==o(new String)&&o(a)===s&&o(s)===s&&o()===s&&"1"===o(e)&&"[1]"==o([e])&&"[null]"==o([s])&&"null"==o(null)&&"[null,null,null]"==o([s,a,null])&&o({a:[e,!0,!1,null,"\0\b\n\f\r	"]})==i&&"1"===o(null,e)&&"[\n 1,\n 2\n]"==o([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==o(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==o(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==o(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==o(new Date(-1))}catch(c){r=!1}}if(!n)return r}if("json-parse"==t||n){var u=l.parse;if("function"==typeof u)try{if(0===u("0")&&!u(!1)){e=u(i);var p=5==e.a.length&&1===e.a[0];if(p){try{p=!u('"	"')}catch(c){}if(p)try{p=1!==u("01")}catch(c){}}}}catch(c){p=!1}if(!n)return p}return r&&p}}var n,o,s,a={}.toString,r="function"==typeof define&&define.amd,l="object"==typeof i&&i;l||r?"object"==typeof JSON&&JSON?l?(l.stringify=JSON.stringify,l.parse=JSON.parse):l=JSON:r&&(l=t.JSON={}):l=t.JSON||(t.JSON={});var h=new Date(-0xc782b5b800cec);try{h=-109252==h.getUTCFullYear()&&0===h.getUTCMonth()&&1===h.getUTCDate()&&10==h.getUTCHours()&&37==h.getUTCMinutes()&&6==h.getUTCSeconds()&&708==h.getUTCMilliseconds()}catch(c){}if(!e("json")){var u="[object Function]",p="[object Date]",d="[object Number]",m="[object String]",f="[object Array]",_="[object Boolean]",g=e("bug-string-char-index");if(!h)var v=Math.floor,y=[0,31,59,90,120,151,181,212,243,273,304,334],L=function(t,e){return y[e]+365*(t-1970)+v((t-1969+(e=+(e>1)))/4)-v((t-1901+e)/100)+v((t-1601+e)/400)};(n={}.hasOwnProperty)||(n=function(t){var e,i={};return(i.__proto__=null,i.__proto__={toString:1},i).toString!=a?n=function(t){var e=this.__proto__,i=(this.__proto__=null,t in this);return this.__proto__=e,i}:(e=i.constructor,n=function(t){var i=(this.constructor||e).prototype;return t in this&&!(t in i&&this[t]===i[t])}),i=null,n.call(this,t)});var T={"boolean":1,number:1,string:1,undefined:1},b=function(t,e){var i=typeof t[e];return"object"==i?!!t[e]:!T[i]};if(o=function(t,e){var i,o,s,r,l=0;(i=function(){this.valueOf=0}).prototype.valueOf=0,o=new i;for(s in o)n.call(o,s)&&l++;return i=o=null,l?r=2==l?function(t,e){var i,o={},s=a.call(t)==u;for(i in t)s&&"prototype"==i||n.call(o,i)||!(o[i]=1)||!n.call(t,i)||e(i)}:function(t,e){var i,o,s=a.call(t)==u;for(i in t)s&&"prototype"==i||!n.call(t,i)||(o="constructor"===i)||e(i);(o||n.call(t,i="constructor"))&&e(i)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],r=function(t,e){var i,s,r=a.call(t)==u,l=!r&&"function"!=typeof t.constructor&&b(t,"hasOwnProperty")?t.hasOwnProperty:n;for(i in t)r&&"prototype"==i||!l.call(t,i)||e(i);for(s=o.length;i=o[--s];l.call(t,i)&&e(i));}),r(t,e)},!e("json-stringify")){var P={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},E="000000",x=function(t,e){return(E+(e||0)).slice(-t)},w="\\u00",M=function(t){var e,i='"',n=0,o=t.length,s=o>10&&g;for(s&&(e=t.split(""));o>n;n++){var a=t.charCodeAt(n);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:i+=P[a];break;default:if(32>a){i+=w+x(2,a.toString(16));break}i+=s?e[n]:g?t.charAt(n):t[n]}}return i+'"'},D=function(t,e,i,r,l,h,c){var u,g,y,T,b,P,E,w,C,S,k,A,U,O,I,B,R=e[t];try{R=e[t]}catch(z){}if("object"==typeof R&&R)if(u=a.call(R),u!=p||n.call(R,"toJSON"))"function"==typeof R.toJSON&&(u!=d&&u!=m&&u!=f||n.call(R,"toJSON"))&&(R=R.toJSON(t));else if(R>-1/0&&1/0>R){if(L){for(T=v(R/864e5),g=v(T/365.2425)+1970-1;T>=L(g+1,0);g++);for(y=v((T-L(g,0))/30.42);T>=L(g,y+1);y++);T=1+T-L(g,y),b=(R%864e5+864e5)%864e5,P=v(b/36e5)%24,E=v(b/6e4)%60,w=v(b/1e3)%60,C=b%1e3}else g=R.getUTCFullYear(),y=R.getUTCMonth(),T=R.getUTCDate(),P=R.getUTCHours(),E=R.getUTCMinutes(),w=R.getUTCSeconds(),C=R.getUTCMilliseconds();R=(0>=g||g>=1e4?(0>g?"-":"+")+x(6,0>g?-g:g):x(4,g))+"-"+x(2,y+1)+"-"+x(2,T)+"T"+x(2,P)+":"+x(2,E)+":"+x(2,w)+"."+x(3,C)+"Z"}else R=null;if(i&&(R=i.call(e,t,R)),null===R)return"null";if(u=a.call(R),u==_)return""+R;if(u==d)return R>-1/0&&1/0>R?""+R:"null";if(u==m)return M(""+R);if("object"==typeof R){for(U=c.length;U--;)if(c[U]===R)throw TypeError();if(c.push(R),S=[],O=h,h+=l,u==f){for(A=0,U=R.length;U>A;I||(I=!0),A++)k=D(A,R,i,r,l,h,c),S.push(k===s?"null":k);B=I?l?"[\n"+h+S.join(",\n"+h)+"\n"+O+"]":"["+S.join(",")+"]":"[]"}else o(r||R,function(t){var e=D(t,R,i,r,l,h,c);e!==s&&S.push(M(t)+":"+(l?" ":"")+e),I||(I=!0)}),B=I?l?"{\n"+h+S.join(",\n"+h)+"\n"+O+"}":"{"+S.join(",")+"}":"{}";return c.pop(),B}};l.stringify=function(t,e,i){var n,o,s;if("function"==typeof e||"object"==typeof e&&e)if(a.call(e)==u)o=e;else if(a.call(e)==f){s={};for(var r,l=0,h=e.length;h>l;r=e[l++],(a.call(r)==m||a.call(r)==d)&&(s[r]=1));}if(i)if(a.call(i)==d){if((i-=i%1)>0)for(n="",i>10&&(i=10);i>n.length;n+=" ");}else a.call(i)==m&&(n=10>=i.length?i:i.slice(0,10));return D("",(r={},r[""]=t,r),o,s,n,"",[])}}if(!e("json-parse")){var C,S,k=String.fromCharCode,A={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},U=function(){throw C=S=null,SyntaxError()},O=function(){for(var t,e,i,n,o,s=S,a=s.length;a>C;)switch(o=s.charCodeAt(C)){case 9:case 10:case 13:case 32:C++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=g?s.charAt(C):s[C],C++,t;case 34:for(t="@",C++;a>C;)if(o=s.charCodeAt(C),32>o)U();else if(92==o)switch(o=s.charCodeAt(++C)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=A[o],C++;break;case 117:for(e=++C,i=C+4;i>C;C++)o=s.charCodeAt(C),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||U();t+=k("0x"+s.slice(e,C));break;default:U()}else{if(34==o)break;for(o=s.charCodeAt(C),e=C;o>=32&&92!=o&&34!=o;)o=s.charCodeAt(++C);t+=s.slice(e,C)}if(34==s.charCodeAt(C))return C++,t;U();default:if(e=C,45==o&&(n=!0,o=s.charCodeAt(++C)),o>=48&&57>=o){for(48==o&&(o=s.charCodeAt(C+1),o>=48&&57>=o)&&U(),n=!1;a>C&&(o=s.charCodeAt(C),o>=48&&57>=o);C++);if(46==s.charCodeAt(C)){for(i=++C;a>i&&(o=s.charCodeAt(i),o>=48&&57>=o);i++);i==C&&U(),C=i}if(o=s.charCodeAt(C),101==o||69==o){for(o=s.charCodeAt(++C),(43==o||45==o)&&C++,i=C;a>i&&(o=s.charCodeAt(i),o>=48&&57>=o);i++);i==C&&U(),C=i}return+s.slice(e,C)}if(n&&U(),"true"==s.slice(C,C+4))return C+=4,!0;if("false"==s.slice(C,C+5))return C+=5,!1;if("null"==s.slice(C,C+4))return C+=4,null;U()}return"$"},I=function(t){var e,i;if("$"==t&&U(),"string"==typeof t){if("@"==(g?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=O(),"]"!=t;i||(i=!0))i&&(","==t?(t=O(),"]"==t&&U()):U()),","==t&&U(),e.push(I(t));return e}if("{"==t){for(e={};t=O(),"}"!=t;i||(i=!0))i&&(","==t?(t=O(),"}"==t&&U()):U()),(","==t||"string"!=typeof t||"@"!=(g?t.charAt(0):t[0])||":"!=O())&&U(),e[t.slice(1)]=I(O());return e}U()}return t},B=function(t,e,i){var n=R(t,e,i);n===s?delete t[e]:t[e]=n},R=function(t,e,i){var n,s=t[e];if("object"==typeof s&&s)if(a.call(s)==f)for(n=s.length;n--;)B(s,n,i);else o(s,function(t){B(s,t,i)});return i.call(t,e,s)};l.parse=function(t,e){var i,n;return C=0,S=""+t,i=I(O()),"$"!=O()&&U(),C=S=null,e&&a.call(e)==u?R((n={},n[""]=i,n),"",e):i}}}r&&define(function(){return l})})(this)},{}]},{},[1]);
;/*
 Leaflet.markercluster, Provides Beautiful Animated Marker Clustering functionality for Leaflet, a JS library for interactive maps.
 https://github.com/Leaflet/Leaflet.markercluster
 (c) 2012-2013, Dave Leaver, smartrak
*/
(function (window, document, undefined) {
/*
 * L.MarkerClusterGroup extends L.FeatureGroup by clustering the markers contained within
 */

L.MarkerClusterGroup = L.FeatureGroup.extend({

	options: {
		maxClusterRadius: 80, //A cluster will cover at most this many pixels from its center
		iconCreateFunction: null,

		spiderfyOnMaxZoom: true,
		showCoverageOnHover: true,
		zoomToBoundsOnClick: true,
		singleMarkerMode: false,

		disableClusteringAtZoom: null,

		// Setting this to false prevents the removal of any clusters outside of the viewpoint, which
		// is the default behaviour for performance reasons.
		removeOutsideVisibleBounds: true,

		//Whether to animate adding markers after adding the MarkerClusterGroup to the map
		// If you are adding individual markers set to true, if adding bulk markers leave false for massive performance gains.
		animateAddingMarkers: false,

		//Increase to increase the distance away that spiderfied markers appear from the center
		spiderfyDistanceMultiplier: 1,

		//Options to pass to the L.Polygon constructor
		polygonOptions: {}
	},

	initialize: function (options) {
		L.Util.setOptions(this, options);
		if (!this.options.iconCreateFunction) {
			this.options.iconCreateFunction = this._defaultIconCreateFunction;
		}

		this._featureGroup = L.featureGroup();
		this._featureGroup.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);

		this._nonPointGroup = L.featureGroup();
		this._nonPointGroup.on(L.FeatureGroup.EVENTS, this._propagateEvent, this);

		this._inZoomAnimation = 0;
		this._needsClustering = [];
		this._needsRemoving = []; //Markers removed while we aren't on the map need to be kept track of
		//The bounds of the currently shown area (from _getExpandedVisibleBounds) Updated on zoom/move
		this._currentShownBounds = null;
	},

	addLayer: function (layer) {

		if (layer instanceof L.LayerGroup) {
			var array = [];
			for (var i in layer._layers) {
				array.push(layer._layers[i]);
			}
			return this.addLayers(array);
		}

		//Don't cluster non point data
		if (!layer.getLatLng) {
			this._nonPointGroup.addLayer(layer);
			return this;
		}

		if (!this._map) {
			this._needsClustering.push(layer);
			return this;
		}

		if (this.hasLayer(layer)) {
			return this;
		}


		//If we have already clustered we'll need to add this one to a cluster

		if (this._unspiderfy) {
			this._unspiderfy();
		}

		this._addLayer(layer, this._maxZoom);

		//Work out what is visible
		var visibleLayer = layer,
			currentZoom = this._map.getZoom();
		if (layer.__parent) {
			while (visibleLayer.__parent._zoom >= currentZoom) {
				visibleLayer = visibleLayer.__parent;
			}
		}

		if (this._currentShownBounds.contains(visibleLayer.getLatLng())) {
			if (this.options.animateAddingMarkers) {
				this._animationAddLayer(layer, visibleLayer);
			} else {
				this._animationAddLayerNonAnimated(layer, visibleLayer);
			}
		}
		return this;
	},

	removeLayer: function (layer) {

		if (layer instanceof L.LayerGroup)
		{
			var array = [];
			for (var i in layer._layers) {
				array.push(layer._layers[i]);
			}
			return this.removeLayers(array);
		}

		//Non point layers
		if (!layer.getLatLng) {
			this._nonPointGroup.removeLayer(layer);
			return this;
		}

		if (!this._map) {
			if (!this._arraySplice(this._needsClustering, layer) && this.hasLayer(layer)) {
				this._needsRemoving.push(layer);
			}
			return this;
		}

		if (!layer.__parent) {
			return this;
		}

		if (this._unspiderfy) {
			this._unspiderfy();
			this._unspiderfyLayer(layer);
		}

		//Remove the marker from clusters
		this._removeLayer(layer, true);

		if (this._featureGroup.hasLayer(layer)) {
			this._featureGroup.removeLayer(layer);
			if (layer.setOpacity) {
				layer.setOpacity(1);
			}
		}

		return this;
	},

	//Takes an array of markers and adds them in bulk
	addLayers: function (layersArray) {
		var i, l, m,
			onMap = this._map,
			fg = this._featureGroup,
			npg = this._nonPointGroup;

		for (i = 0, l = layersArray.length; i < l; i++) {
			m = layersArray[i];

			//Not point data, can't be clustered
			if (!m.getLatLng) {
				npg.addLayer(m);
				continue;
			}

			if (this.hasLayer(m)) {
				continue;
			}

			if (!onMap) {
				this._needsClustering.push(m);
				continue;
			}

			this._addLayer(m, this._maxZoom);

			//If we just made a cluster of size 2 then we need to remove the other marker from the map (if it is) or we never will
			if (m.__parent) {
				if (m.__parent.getChildCount() === 2) {
					var markers = m.__parent.getAllChildMarkers(),
						otherMarker = markers[0] === m ? markers[1] : markers[0];
					fg.removeLayer(otherMarker);
				}
			}
		}

		if (onMap) {
			//Update the icons of all those visible clusters that were affected
			fg.eachLayer(function (c) {
				if (c instanceof L.MarkerCluster && c._iconNeedsUpdate) {
					c._updateIcon();
				}
			});

			this._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, this._currentShownBounds);
		}

		return this;
	},

	//Takes an array of markers and removes them in bulk
	removeLayers: function (layersArray) {
		var i, l, m,
			fg = this._featureGroup,
			npg = this._nonPointGroup;

		if (!this._map) {
			for (i = 0, l = layersArray.length; i < l; i++) {
				m = layersArray[i];
				this._arraySplice(this._needsClustering, m);
				npg.removeLayer(m);
			}
			return this;
		}

		for (i = 0, l = layersArray.length; i < l; i++) {
			m = layersArray[i];

			if (!m.__parent) {
				npg.removeLayer(m);
				continue;
			}

			this._removeLayer(m, true, true);

			if (fg.hasLayer(m)) {
				fg.removeLayer(m);
				if (m.setOpacity) {
					m.setOpacity(1);
				}
			}
		}

		//Fix up the clusters and markers on the map
		this._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, this._currentShownBounds);

		fg.eachLayer(function (c) {
			if (c instanceof L.MarkerCluster) {
				c._updateIcon();
			}
		});

		return this;
	},

	//Removes all layers from the MarkerClusterGroup
	clearLayers: function () {
		//Need our own special implementation as the LayerGroup one doesn't work for us

		//If we aren't on the map (yet), blow away the markers we know of
		if (!this._map) {
			this._needsClustering = [];
			delete this._gridClusters;
			delete this._gridUnclustered;
		}

		if (this._noanimationUnspiderfy) {
			this._noanimationUnspiderfy();
		}

		//Remove all the visible layers
		this._featureGroup.clearLayers();
		this._nonPointGroup.clearLayers();

		this.eachLayer(function (marker) {
			delete marker.__parent;
		});

		if (this._map) {
			//Reset _topClusterLevel and the DistanceGrids
			this._generateInitialClusters();
		}

		return this;
	},

	//Override FeatureGroup.getBounds as it doesn't work
	getBounds: function () {
		var bounds = new L.LatLngBounds();
		if (this._topClusterLevel) {
			bounds.extend(this._topClusterLevel._bounds);
		} else {
			for (var i = this._needsClustering.length - 1; i >= 0; i--) {
				bounds.extend(this._needsClustering[i].getLatLng());
			}
		}

		//TODO: Can remove this isValid test when leaflet 0.6 is released
		var nonPointBounds = this._nonPointGroup.getBounds();
		if (nonPointBounds.isValid()) {
			bounds.extend(nonPointBounds);
		}

		return bounds;
	},

	//Overrides LayerGroup.eachLayer
	eachLayer: function (method, context) {
		var markers = this._needsClustering.slice(),
		    i;

		if (this._topClusterLevel) {
			this._topClusterLevel.getAllChildMarkers(markers);
		}

		for (i = markers.length - 1; i >= 0; i--) {
			method.call(context, markers[i]);
		}

		this._nonPointGroup.eachLayer(method, context);
	},

	//Returns true if the given layer is in this MarkerClusterGroup
	hasLayer: function (layer) {
		if (!layer) {
			return false;
		}

		var i, anArray = this._needsClustering;

		for (i = anArray.length - 1; i >= 0; i--) {
			if (anArray[i] === layer) {
				return true;
			}
		}

		anArray = this._needsRemoving;
		for (i = anArray.length - 1; i >= 0; i--) {
			if (anArray[i] === layer) {
				return false;
			}
		}

		return !!(layer.__parent && layer.__parent._group === this) || this._nonPointGroup.hasLayer(layer);
	},

	//Zoom down to show the given layer (spiderfying if necessary) then calls the callback
	zoomToShowLayer: function (layer, callback) {

		var showMarker = function () {
			if ((layer._icon || layer.__parent._icon) && !this._inZoomAnimation) {
				this._map.off('moveend', showMarker, this);
				this.off('animationend', showMarker, this);

				if (layer._icon) {
					callback();
				} else if (layer.__parent._icon) {
					var afterSpiderfy = function () {
						this.off('spiderfied', afterSpiderfy, this);
						callback();
					};

					this.on('spiderfied', afterSpiderfy, this);
					layer.__parent.spiderfy();
				}
			}
		};

		if (layer._icon) {
			callback();
		} else if (layer.__parent._zoom < this._map.getZoom()) {
			//Layer should be visible now but isn't on screen, just pan over to it
			this._map.on('moveend', showMarker, this);
			if (!layer._icon) {
				this._map.panTo(layer.getLatLng());
			}
		} else {
			this._map.on('moveend', showMarker, this);
			this.on('animationend', showMarker, this);
			this._map.setView(layer.getLatLng(), layer.__parent._zoom + 1);
			layer.__parent.zoomToBounds();
		}
	},

	//Overrides FeatureGroup.onAdd
	onAdd: function (map) {
		this._map = map;
		var i, l, layer;

		if (!isFinite(this._map.getMaxZoom())) {
			throw "Map has no maxZoom specified";
		}

		this._featureGroup.onAdd(map);
		this._nonPointGroup.onAdd(map);

		if (!this._gridClusters) {
			this._generateInitialClusters();
		}

		for (i = 0, l = this._needsRemoving.length; i < l; i++) {
			layer = this._needsRemoving[i];
			this._removeLayer(layer, true);
		}
		this._needsRemoving = [];

		for (i = 0, l = this._needsClustering.length; i < l; i++) {
			layer = this._needsClustering[i];

			//If the layer doesn't have a getLatLng then we can't cluster it, so add it to our child featureGroup
			if (!layer.getLatLng) {
				this._featureGroup.addLayer(layer);
				continue;
			}


			if (layer.__parent) {
				continue;
			}
			this._addLayer(layer, this._maxZoom);
		}
		this._needsClustering = [];


		this._map.on('zoomend', this._zoomEnd, this);
		this._map.on('moveend', this._moveEnd, this);

		if (this._spiderfierOnAdd) { //TODO FIXME: Not sure how to have spiderfier add something on here nicely
			this._spiderfierOnAdd();
		}

		this._bindEvents();


		//Actually add our markers to the map:

		//Remember the current zoom level and bounds
		this._zoom = this._map.getZoom();
		this._currentShownBounds = this._getExpandedVisibleBounds();

		//Make things appear on the map
		this._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, this._currentShownBounds);
	},

	//Overrides FeatureGroup.onRemove
	onRemove: function (map) {
		map.off('zoomend', this._zoomEnd, this);
		map.off('moveend', this._moveEnd, this);

		this._unbindEvents();

		//In case we are in a cluster animation
		this._map._mapPane.className = this._map._mapPane.className.replace(' leaflet-cluster-anim', '');

		if (this._spiderfierOnRemove) { //TODO FIXME: Not sure how to have spiderfier add something on here nicely
			this._spiderfierOnRemove();
		}

		//Clean up all the layers we added to the map
		this._featureGroup.onRemove(map);
		this._nonPointGroup.onRemove(map);

		this._featureGroup.clearLayers();

		this._map = null;
	},

	getVisibleParent: function (marker) {
		var vMarker = marker;
		while (vMarker !== null && !vMarker._icon) {
			vMarker = vMarker.__parent;
		}
		return vMarker;
	},

	//Remove the given object from the given array
	_arraySplice: function (anArray, obj) {
		for (var i = anArray.length - 1; i >= 0; i--) {
			if (anArray[i] === obj) {
				anArray.splice(i, 1);
				return true;
			}
		}
	},

	//Internal function for removing a marker from everything.
	//dontUpdateMap: set to true if you will handle updating the map manually (for bulk functions)
	_removeLayer: function (marker, removeFromDistanceGrid, dontUpdateMap) {
		var gridClusters = this._gridClusters,
			gridUnclustered = this._gridUnclustered,
			fg = this._featureGroup,
			map = this._map;

		//Remove the marker from distance clusters it might be in
		if (removeFromDistanceGrid) {
			for (var z = this._maxZoom; z >= 0; z--) {
				if (!gridUnclustered[z].removeObject(marker, map.project(marker.getLatLng(), z))) {
					break;
				}
			}
		}

		//Work our way up the clusters removing them as we go if required
		var cluster = marker.__parent,
			markers = cluster._markers,
			otherMarker;

		//Remove the marker from the immediate parents marker list
		this._arraySplice(markers, marker);

		while (cluster) {
			cluster._childCount--;

			if (cluster._zoom < 0) {
				//Top level, do nothing
				break;
			} else if (removeFromDistanceGrid && cluster._childCount <= 1) { //Cluster no longer required
				//We need to push the other marker up to the parent
				otherMarker = cluster._markers[0] === marker ? cluster._markers[1] : cluster._markers[0];

				//Update distance grid
				gridClusters[cluster._zoom].removeObject(cluster, map.project(cluster._cLatLng, cluster._zoom));
				gridUnclustered[cluster._zoom].addObject(otherMarker, map.project(otherMarker.getLatLng(), cluster._zoom));

				//Move otherMarker up to parent
				this._arraySplice(cluster.__parent._childClusters, cluster);
				cluster.__parent._markers.push(otherMarker);
				otherMarker.__parent = cluster.__parent;

				if (cluster._icon) {
					//Cluster is currently on the map, need to put the marker on the map instead
					fg.removeLayer(cluster);
					if (!dontUpdateMap) {
						fg.addLayer(otherMarker);
					}
				}
			} else {
				cluster._recalculateBounds();
				if (!dontUpdateMap || !cluster._icon) {
					cluster._updateIcon();
				}
			}

			cluster = cluster.__parent;
		}

		delete marker.__parent;
	},

	_propagateEvent: function (e) {
		if (e.layer instanceof L.MarkerCluster) {
			e.type = 'cluster' + e.type;
		}

		this.fire(e.type, e);
	},

	//Default functionality
	_defaultIconCreateFunction: function (cluster) {
		var childCount = cluster.getChildCount();

		var c = ' marker-cluster-';
		if (childCount < 10) {
			c += 'small';
		} else if (childCount < 100) {
			c += 'medium';
		} else {
			c += 'large';
		}

		return new L.DivIcon({ html: '<div><span>' + childCount + '</span></div>', className: 'marker-cluster' + c, iconSize: new L.Point(40, 40) });
	},

	_bindEvents: function () {
		var map = this._map,
		    spiderfyOnMaxZoom = this.options.spiderfyOnMaxZoom,
		    showCoverageOnHover = this.options.showCoverageOnHover,
		    zoomToBoundsOnClick = this.options.zoomToBoundsOnClick;

		//Zoom on cluster click or spiderfy if we are at the lowest level
		if (spiderfyOnMaxZoom || zoomToBoundsOnClick) {
			this.on('clusterclick', this._zoomOrSpiderfy, this);
		}

		//Show convex hull (boundary) polygon on mouse over
		if (showCoverageOnHover) {
			this.on('clustermouseover', this._showCoverage, this);
			this.on('clustermouseout', this._hideCoverage, this);
			map.on('zoomend', this._hideCoverage, this);
			map.on('layerremove', this._hideCoverageOnRemove, this);
		}
	},

	_zoomOrSpiderfy: function (e) {
		var map = this._map;
		if (map.getMaxZoom() === map.getZoom()) {
			if (this.options.spiderfyOnMaxZoom) {
				e.layer.spiderfy();
			}
		} else if (this.options.zoomToBoundsOnClick) {
			e.layer.zoomToBounds();
		}
	},

	_showCoverage: function (e) {
		var map = this._map;
		if (this._inZoomAnimation) {
			return;
		}
		if (this._shownPolygon) {
			map.removeLayer(this._shownPolygon);
		}
		if (e.layer.getChildCount() > 2 && e.layer !== this._spiderfied) {
			this._shownPolygon = new L.Polygon(e.layer.getConvexHull(), this.options.polygonOptions);
			map.addLayer(this._shownPolygon);
		}
	},

	_hideCoverage: function () {
		if (this._shownPolygon) {
			this._map.removeLayer(this._shownPolygon);
			this._shownPolygon = null;
		}
	},

	_hideCoverageOnRemove: function (e) {
		if (e.layer === this) {
			this._hideCoverage();
		}
	},

	_unbindEvents: function () {
		var spiderfyOnMaxZoom = this.options.spiderfyOnMaxZoom,
			showCoverageOnHover = this.options.showCoverageOnHover,
			zoomToBoundsOnClick = this.options.zoomToBoundsOnClick,
			map = this._map;

		if (spiderfyOnMaxZoom || zoomToBoundsOnClick) {
			this.off('clusterclick', this._zoomOrSpiderfy, this);
		}
		if (showCoverageOnHover) {
			this.off('clustermouseover', this._showCoverage, this);
			this.off('clustermouseout', this._hideCoverage, this);
			map.off('zoomend', this._hideCoverage, this);
			map.off('layerremove', this._hideCoverageOnRemove, this);
		}
	},

	_zoomEnd: function () {
		if (!this._map) { //May have been removed from the map by a zoomEnd handler
			return;
		}
		this._mergeSplitClusters();

		this._zoom = this._map._zoom;
		this._currentShownBounds = this._getExpandedVisibleBounds();
	},

	_moveEnd: function () {
		if (this._inZoomAnimation) {
			return;
		}

		var newBounds = this._getExpandedVisibleBounds();

		this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, this._zoom, newBounds);
		this._topClusterLevel._recursivelyAddChildrenToMap(null, this._zoom, newBounds);

		this._currentShownBounds = newBounds;
		return;
	},

	_generateInitialClusters: function () {
		var maxZoom = this._map.getMaxZoom(),
			radius = this.options.maxClusterRadius;

		if (this.options.disableClusteringAtZoom) {
			maxZoom = this.options.disableClusteringAtZoom - 1;
		}
		this._maxZoom = maxZoom;
		this._gridClusters = {};
		this._gridUnclustered = {};

		//Set up DistanceGrids for each zoom
		for (var zoom = maxZoom; zoom >= 0; zoom--) {
			this._gridClusters[zoom] = new L.DistanceGrid(radius);
			this._gridUnclustered[zoom] = new L.DistanceGrid(radius);
		}

		this._topClusterLevel = new L.MarkerCluster(this, -1);
	},

	//Zoom: Zoom to start adding at (Pass this._maxZoom to start at the bottom)
	_addLayer: function (layer, zoom) {
		var gridClusters = this._gridClusters,
		    gridUnclustered = this._gridUnclustered,
		    markerPoint, z;

		if (this.options.singleMarkerMode) {
			layer.options.icon = this.options.iconCreateFunction({
				getChildCount: function () {
					return 1;
				},
				getAllChildMarkers: function () {
					return [layer];
				}
			});
		}

		//Find the lowest zoom level to slot this one in
		for (; zoom >= 0; zoom--) {
			markerPoint = this._map.project(layer.getLatLng(), zoom); // calculate pixel position

			//Try find a cluster close by
			var closest = gridClusters[zoom].getNearObject(markerPoint);
			if (closest) {
				closest._addChild(layer);
				layer.__parent = closest;
				return;
			}

			//Try find a marker close by to form a new cluster with
			closest = gridUnclustered[zoom].getNearObject(markerPoint);
			if (closest) {
				var parent = closest.__parent;
				if (parent) {
					this._removeLayer(closest, false);
				}

				//Create new cluster with these 2 in it

				var newCluster = new L.MarkerCluster(this, zoom, closest, layer);
				gridClusters[zoom].addObject(newCluster, this._map.project(newCluster._cLatLng, zoom));
				closest.__parent = newCluster;
				layer.__parent = newCluster;

				//First create any new intermediate parent clusters that don't exist
				var lastParent = newCluster;
				for (z = zoom - 1; z > parent._zoom; z--) {
					lastParent = new L.MarkerCluster(this, z, lastParent);
					gridClusters[z].addObject(lastParent, this._map.project(closest.getLatLng(), z));
				}
				parent._addChild(lastParent);

				//Remove closest from this zoom level and any above that it is in, replace with newCluster
				for (z = zoom; z >= 0; z--) {
					if (!gridUnclustered[z].removeObject(closest, this._map.project(closest.getLatLng(), z))) {
						break;
					}
				}

				return;
			}

			//Didn't manage to cluster in at this zoom, record us as a marker here and continue upwards
			gridUnclustered[zoom].addObject(layer, markerPoint);
		}

		//Didn't get in anything, add us to the top
		this._topClusterLevel._addChild(layer);
		layer.__parent = this._topClusterLevel;
		return;
	},

	//Merge and split any existing clusters that are too big or small
	_mergeSplitClusters: function () {
		if (this._zoom < this._map._zoom) { //Zoom in, split
			this._animationStart();
			//Remove clusters now off screen
			this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, this._zoom, this._getExpandedVisibleBounds());

			this._animationZoomIn(this._zoom, this._map._zoom);

		} else if (this._zoom > this._map._zoom) { //Zoom out, merge
			this._animationStart();

			this._animationZoomOut(this._zoom, this._map._zoom);
		} else {
			this._moveEnd();
		}
	},

	//Gets the maps visible bounds expanded in each direction by the size of the screen (so the user cannot see an area we do not cover in one pan)
	_getExpandedVisibleBounds: function () {
		if (!this.options.removeOutsideVisibleBounds) {
			return this.getBounds();
		}

		var map = this._map,
			bounds = map.getBounds(),
			sw = bounds._southWest,
			ne = bounds._northEast,
			latDiff = L.Browser.mobile ? 0 : Math.abs(sw.lat - ne.lat),
			lngDiff = L.Browser.mobile ? 0 : Math.abs(sw.lng - ne.lng);

		return new L.LatLngBounds(
			new L.LatLng(sw.lat - latDiff, sw.lng - lngDiff, true),
			new L.LatLng(ne.lat + latDiff, ne.lng + lngDiff, true));
	},

	//Shared animation code
	_animationAddLayerNonAnimated: function (layer, newCluster) {
		if (newCluster === layer) {
			this._featureGroup.addLayer(layer);
		} else if (newCluster._childCount === 2) {
			newCluster._addToMap();

			var markers = newCluster.getAllChildMarkers();
			this._featureGroup.removeLayer(markers[0]);
			this._featureGroup.removeLayer(markers[1]);
		} else {
			newCluster._updateIcon();
		}
	}
});

L.MarkerClusterGroup.include(!L.DomUtil.TRANSITION ? {

	//Non Animated versions of everything
	_animationStart: function () {
		//Do nothing...
	},
	_animationZoomIn: function (previousZoomLevel, newZoomLevel) {
		this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel);
		this._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());
	},
	_animationZoomOut: function (previousZoomLevel, newZoomLevel) {
		this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel);
		this._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());
	},
	_animationAddLayer: function (layer, newCluster) {
		this._animationAddLayerNonAnimated(layer, newCluster);
	}
} : {

	//Animated versions here
	_animationStart: function () {
		this._map._mapPane.className += ' leaflet-cluster-anim';
		this._inZoomAnimation++;
	},
	_animationEnd: function () {
		if (this._map) {
			this._map._mapPane.className = this._map._mapPane.className.replace(' leaflet-cluster-anim', '');
		}
		this._inZoomAnimation--;
		this.fire('animationend');
	},
	_animationZoomIn: function (previousZoomLevel, newZoomLevel) {
		var me = this,
		    bounds = this._getExpandedVisibleBounds(),
			fg = this._featureGroup,
		    i;

		//Add all children of current clusters to map and remove those clusters from map
		this._topClusterLevel._recursively(bounds, previousZoomLevel, 0, function (c) {
			var startPos = c._latlng,
				markers = c._markers,
				m;

			if (!bounds.contains(startPos)) {
				startPos = null;
			}

			if (c._isSingleParent() && previousZoomLevel + 1 === newZoomLevel) { //Immediately add the new child and remove us
				fg.removeLayer(c);
				c._recursivelyAddChildrenToMap(null, newZoomLevel, bounds);
			} else {
				//Fade out old cluster
				c.setOpacity(0);
				c._recursivelyAddChildrenToMap(startPos, newZoomLevel, bounds);
			}

			//Remove all markers that aren't visible any more
			//TODO: Do we actually need to do this on the higher levels too?
			for (i = markers.length - 1; i >= 0; i--) {
				m = markers[i];
				if (!bounds.contains(m._latlng)) {
					fg.removeLayer(m);
				}
			}

		});

		this._forceLayout();

		//Update opacities
		me._topClusterLevel._recursivelyBecomeVisible(bounds, newZoomLevel);
		//TODO Maybe? Update markers in _recursivelyBecomeVisible
		fg.eachLayer(function (n) {
			if (!(n instanceof L.MarkerCluster) && n._icon) {
				n.setOpacity(1);
			}
		});

		//update the positions of the just added clusters/markers
		me._topClusterLevel._recursively(bounds, previousZoomLevel, newZoomLevel, function (c) {
			c._recursivelyRestoreChildPositions(newZoomLevel);
		});

		//Remove the old clusters and close the zoom animation

		setTimeout(function () {
			//update the positions of the just added clusters/markers
			me._topClusterLevel._recursively(bounds, previousZoomLevel, 0, function (c) {
				fg.removeLayer(c);
				c.setOpacity(1);
			});

			me._animationEnd();
		}, 200);
	},

	_animationZoomOut: function (previousZoomLevel, newZoomLevel) {
		this._animationZoomOutSingle(this._topClusterLevel, previousZoomLevel - 1, newZoomLevel);

		//Need to add markers for those that weren't on the map before but are now
		this._topClusterLevel._recursivelyAddChildrenToMap(null, newZoomLevel, this._getExpandedVisibleBounds());
		//Remove markers that were on the map before but won't be now
		this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds, previousZoomLevel, this._getExpandedVisibleBounds());
	},
	_animationZoomOutSingle: function (cluster, previousZoomLevel, newZoomLevel) {
		var bounds = this._getExpandedVisibleBounds();

		//Animate all of the markers in the clusters to move to their cluster center point
		cluster._recursivelyAnimateChildrenInAndAddSelfToMap(bounds, previousZoomLevel + 1, newZoomLevel);

		var me = this;

		//Update the opacity (If we immediately set it they won't animate)
		this._forceLayout();
		cluster._recursivelyBecomeVisible(bounds, newZoomLevel);

		//TODO: Maybe use the transition timing stuff to make this more reliable
		//When the animations are done, tidy up
		setTimeout(function () {

			//This cluster stopped being a cluster before the timeout fired
			if (cluster._childCount === 1) {
				var m = cluster._markers[0];
				//If we were in a cluster animation at the time then the opacity and position of our child could be wrong now, so fix it
				m.setLatLng(m.getLatLng());
				m.setOpacity(1);
			} else {
				cluster._recursively(bounds, newZoomLevel, 0, function (c) {
					c._recursivelyRemoveChildrenFromMap(bounds, previousZoomLevel + 1);
				});
			}
			me._animationEnd();
		}, 200);
	},
	_animationAddLayer: function (layer, newCluster) {
		var me = this,
			fg = this._featureGroup;

		fg.addLayer(layer);
		if (newCluster !== layer) {
			if (newCluster._childCount > 2) { //Was already a cluster

				newCluster._updateIcon();
				this._forceLayout();
				this._animationStart();

				layer._setPos(this._map.latLngToLayerPoint(newCluster.getLatLng()));
				layer.setOpacity(0);

				setTimeout(function () {
					fg.removeLayer(layer);
					layer.setOpacity(1);

					me._animationEnd();
				}, 200);

			} else { //Just became a cluster
				this._forceLayout();

				me._animationStart();
				me._animationZoomOutSingle(newCluster, this._map.getMaxZoom(), this._map.getZoom());
			}
		}
	},

	//Force a browser layout of stuff in the map
	// Should apply the current opacity and location to all elements so we can update them again for an animation
	_forceLayout: function () {
		//In my testing this works, infact offsetWidth of any element seems to work.
		//Could loop all this._layers and do this for each _icon if it stops working

		L.Util.falseFn(document.body.offsetWidth);
	}
});

L.markerClusterGroup = function (options) {
	return new L.MarkerClusterGroup(options);
};


L.MarkerCluster = L.Marker.extend({
	initialize: function (group, zoom, a, b) {

		L.Marker.prototype.initialize.call(this, a ? (a._cLatLng || a.getLatLng()) : new L.LatLng(0, 0), { icon: this });


		this._group = group;
		this._zoom = zoom;

		this._markers = [];
		this._childClusters = [];
		this._childCount = 0;
		this._iconNeedsUpdate = true;

		this._bounds = new L.LatLngBounds();

		if (a) {
			this._addChild(a);
		}
		if (b) {
			this._addChild(b);
		}
	},

	//Recursively retrieve all child markers of this cluster
	getAllChildMarkers: function (storageArray) {
		storageArray = storageArray || [];

		for (var i = this._childClusters.length - 1; i >= 0; i--) {
			this._childClusters[i].getAllChildMarkers(storageArray);
		}

		for (var j = this._markers.length - 1; j >= 0; j--) {
			storageArray.push(this._markers[j]);
		}

		return storageArray;
	},

	//Returns the count of how many child markers we have
	getChildCount: function () {
		return this._childCount;
	},

	//Zoom to the extents of this cluster
	zoomToBounds: function () {
		this._group._map.fitBounds(this._bounds);
	},

	getBounds: function () {
		var bounds = new L.LatLngBounds();
		bounds.extend(this._bounds);
		return bounds;
	},

	_updateIcon: function () {
		this._iconNeedsUpdate = true;
		if (this._icon) {
			this.setIcon(this);
		}
	},

	//Cludge for Icon, we pretend to be an icon for performance
	createIcon: function () {
		if (this._iconNeedsUpdate) {
			this._iconObj = this._group.options.iconCreateFunction(this);
			this._iconNeedsUpdate = false;
		}
		return this._iconObj.createIcon();
	},
	createShadow: function () {
		return this._iconObj.createShadow();
	},


	_addChild: function (new1, isNotificationFromChild) {

		this._iconNeedsUpdate = true;
		this._expandBounds(new1);

		if (new1 instanceof L.MarkerCluster) {
			if (!isNotificationFromChild) {
				this._childClusters.push(new1);
				new1.__parent = this;
			}
			this._childCount += new1._childCount;
		} else {
			if (!isNotificationFromChild) {
				this._markers.push(new1);
			}
			this._childCount++;
		}

		if (this.__parent) {
			this.__parent._addChild(new1, true);
		}
	},

	//Expand our bounds and tell our parent to
	_expandBounds: function (marker) {
		var addedCount,
		    addedLatLng = marker._wLatLng || marker._latlng;

		if (marker instanceof L.MarkerCluster) {
			this._bounds.extend(marker._bounds);
			addedCount = marker._childCount;
		} else {
			this._bounds.extend(addedLatLng);
			addedCount = 1;
		}

		if (!this._cLatLng) {
			// when clustering, take position of the first point as the cluster center
			this._cLatLng = marker._cLatLng || addedLatLng;
		}

		// when showing clusters, take weighted average of all points as cluster center
		var totalCount = this._childCount + addedCount;

		//Calculate weighted latlng for display
		if (!this._wLatLng) {
			this._latlng = this._wLatLng = new L.LatLng(addedLatLng.lat, addedLatLng.lng);
		} else {
			this._wLatLng.lat = (addedLatLng.lat * addedCount + this._wLatLng.lat * this._childCount) / totalCount;
			this._wLatLng.lng = (addedLatLng.lng * addedCount + this._wLatLng.lng * this._childCount) / totalCount;
		}
	},

	//Set our markers position as given and add it to the map
	_addToMap: function (startPos) {
		if (startPos) {
			this._backupLatlng = this._latlng;
			this.setLatLng(startPos);
		}
		this._group._featureGroup.addLayer(this);
	},

	_recursivelyAnimateChildrenIn: function (bounds, center, maxZoom) {
		this._recursively(bounds, 0, maxZoom - 1,
			function (c) {
				var markers = c._markers,
					i, m;
				for (i = markers.length - 1; i >= 0; i--) {
					m = markers[i];

					//Only do it if the icon is still on the map
					if (m._icon) {
						m._setPos(center);
						m.setOpacity(0);
					}
				}
			},
			function (c) {
				var childClusters = c._childClusters,
					j, cm;
				for (j = childClusters.length - 1; j >= 0; j--) {
					cm = childClusters[j];
					if (cm._icon) {
						cm._setPos(center);
						cm.setOpacity(0);
					}
				}
			}
		);
	},

	_recursivelyAnimateChildrenInAndAddSelfToMap: function (bounds, previousZoomLevel, newZoomLevel) {
		this._recursively(bounds, newZoomLevel, 0,
			function (c) {
				c._recursivelyAnimateChildrenIn(bounds, c._group._map.latLngToLayerPoint(c.getLatLng()).round(), previousZoomLevel);

				//TODO: depthToAnimateIn affects _isSingleParent, if there is a multizoom we may/may not be.
				//As a hack we only do a animation free zoom on a single level zoom, if someone does multiple levels then we always animate
				if (c._isSingleParent() && previousZoomLevel - 1 === newZoomLevel) {
					c.setOpacity(1);
					c._recursivelyRemoveChildrenFromMap(bounds, previousZoomLevel); //Immediately remove our children as we are replacing them. TODO previousBounds not bounds
				} else {
					c.setOpacity(0);
				}

				c._addToMap();
			}
		);
	},

	_recursivelyBecomeVisible: function (bounds, zoomLevel) {
		this._recursively(bounds, 0, zoomLevel, null, function (c) {
			c.setOpacity(1);
		});
	},

	_recursivelyAddChildrenToMap: function (startPos, zoomLevel, bounds) {
		this._recursively(bounds, -1, zoomLevel,
			function (c) {
				if (zoomLevel === c._zoom) {
					return;
				}

				//Add our child markers at startPos (so they can be animated out)
				for (var i = c._markers.length - 1; i >= 0; i--) {
					var nm = c._markers[i];

					if (!bounds.contains(nm._latlng)) {
						continue;
					}

					if (startPos) {
						nm._backupLatlng = nm.getLatLng();

						nm.setLatLng(startPos);
						if (nm.setOpacity) {
							nm.setOpacity(0);
						}
					}

					c._group._featureGroup.addLayer(nm);
				}
			},
			function (c) {
				c._addToMap(startPos);
			}
		);
	},

	_recursivelyRestoreChildPositions: function (zoomLevel) {
		//Fix positions of child markers
		for (var i = this._markers.length - 1; i >= 0; i--) {
			var nm = this._markers[i];
			if (nm._backupLatlng) {
				nm.setLatLng(nm._backupLatlng);
				delete nm._backupLatlng;
			}
		}

		if (zoomLevel - 1 === this._zoom) {
			//Reposition child clusters
			for (var j = this._childClusters.length - 1; j >= 0; j--) {
				this._childClusters[j]._restorePosition();
			}
		} else {
			for (var k = this._childClusters.length - 1; k >= 0; k--) {
				this._childClusters[k]._recursivelyRestoreChildPositions(zoomLevel);
			}
		}
	},

	_restorePosition: function () {
		if (this._backupLatlng) {
			this.setLatLng(this._backupLatlng);
			delete this._backupLatlng;
		}
	},

	//exceptBounds: If set, don't remove any markers/clusters in it
	_recursivelyRemoveChildrenFromMap: function (previousBounds, zoomLevel, exceptBounds) {
		var m, i;
		this._recursively(previousBounds, -1, zoomLevel - 1,
			function (c) {
				//Remove markers at every level
				for (i = c._markers.length - 1; i >= 0; i--) {
					m = c._markers[i];
					if (!exceptBounds || !exceptBounds.contains(m._latlng)) {
						c._group._featureGroup.removeLayer(m);
						if (m.setOpacity) {
							m.setOpacity(1);
						}
					}
				}
			},
			function (c) {
				//Remove child clusters at just the bottom level
				for (i = c._childClusters.length - 1; i >= 0; i--) {
					m = c._childClusters[i];
					if (!exceptBounds || !exceptBounds.contains(m._latlng)) {
						c._group._featureGroup.removeLayer(m);
						if (m.setOpacity) {
							m.setOpacity(1);
						}
					}
				}
			}
		);
	},

	//Run the given functions recursively to this and child clusters
	// boundsToApplyTo: a L.LatLngBounds representing the bounds of what clusters to recurse in to
	// zoomLevelToStart: zoom level to start running functions (inclusive)
	// zoomLevelToStop: zoom level to stop running functions (inclusive)
	// runAtEveryLevel: function that takes an L.MarkerCluster as an argument that should be applied on every level
	// runAtBottomLevel: function that takes an L.MarkerCluster as an argument that should be applied at only the bottom level
	_recursively: function (boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel) {
		var childClusters = this._childClusters,
		    zoom = this._zoom,
			i, c;

		if (zoomLevelToStart > zoom) { //Still going down to required depth, just recurse to child clusters
			for (i = childClusters.length - 1; i >= 0; i--) {
				c = childClusters[i];
				if (boundsToApplyTo.intersects(c._bounds)) {
					c._recursively(boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel);
				}
			}
		} else { //In required depth

			if (runAtEveryLevel) {
				runAtEveryLevel(this);
			}
			if (runAtBottomLevel && this._zoom === zoomLevelToStop) {
				runAtBottomLevel(this);
			}

			//TODO: This loop is almost the same as above
			if (zoomLevelToStop > zoom) {
				for (i = childClusters.length - 1; i >= 0; i--) {
					c = childClusters[i];
					if (boundsToApplyTo.intersects(c._bounds)) {
						c._recursively(boundsToApplyTo, zoomLevelToStart, zoomLevelToStop, runAtEveryLevel, runAtBottomLevel);
					}
				}
			}
		}
	},

	_recalculateBounds: function () {
		var markers = this._markers,
			childClusters = this._childClusters,
			i;

		this._bounds = new L.LatLngBounds();
		delete this._wLatLng;

		for (i = markers.length - 1; i >= 0; i--) {
			this._expandBounds(markers[i]);
		}
		for (i = childClusters.length - 1; i >= 0; i--) {
			this._expandBounds(childClusters[i]);
		}
	},


	//Returns true if we are the parent of only one cluster and that cluster is the same as us
	_isSingleParent: function () {
		//Don't need to check this._markers as the rest won't work if there are any
		return this._childClusters.length > 0 && this._childClusters[0]._childCount === this._childCount;
	}
});



L.DistanceGrid = function (cellSize) {
	this._cellSize = cellSize;
	this._sqCellSize = cellSize * cellSize;
	this._grid = {};
	this._objectPoint = { };
};

L.DistanceGrid.prototype = {

	addObject: function (obj, point) {
		var x = this._getCoord(point.x),
		    y = this._getCoord(point.y),
		    grid = this._grid,
		    row = grid[y] = grid[y] || {},
		    cell = row[x] = row[x] || [],
		    stamp = L.Util.stamp(obj);

		this._objectPoint[stamp] = point;

		cell.push(obj);
	},

	updateObject: function (obj, point) {
		this.removeObject(obj);
		this.addObject(obj, point);
	},

	//Returns true if the object was found
	removeObject: function (obj, point) {
		var x = this._getCoord(point.x),
		    y = this._getCoord(point.y),
		    grid = this._grid,
		    row = grid[y] = grid[y] || {},
		    cell = row[x] = row[x] || [],
		    i, len;

		delete this._objectPoint[L.Util.stamp(obj)];

		for (i = 0, len = cell.length; i < len; i++) {
			if (cell[i] === obj) {

				cell.splice(i, 1);

				if (len === 1) {
					delete row[x];
				}

				return true;
			}
		}

	},

	eachObject: function (fn, context) {
		var i, j, k, len, row, cell, removed,
		    grid = this._grid;

		for (i in grid) {
			row = grid[i];

			for (j in row) {
				cell = row[j];

				for (k = 0, len = cell.length; k < len; k++) {
					removed = fn.call(context, cell[k]);
					if (removed) {
						k--;
						len--;
					}
				}
			}
		}
	},

	getNearObject: function (point) {
		var x = this._getCoord(point.x),
		    y = this._getCoord(point.y),
		    i, j, k, row, cell, len, obj, dist,
		    objectPoint = this._objectPoint,
		    closestDistSq = this._sqCellSize,
		    closest = null;

		for (i = y - 1; i <= y + 1; i++) {
			row = this._grid[i];
			if (row) {

				for (j = x - 1; j <= x + 1; j++) {
					cell = row[j];
					if (cell) {

						for (k = 0, len = cell.length; k < len; k++) {
							obj = cell[k];
							dist = this._sqDist(objectPoint[L.Util.stamp(obj)], point);
							if (dist < closestDistSq) {
								closestDistSq = dist;
								closest = obj;
							}
						}
					}
				}
			}
		}
		return closest;
	},

	_getCoord: function (x) {
		return Math.floor(x / this._cellSize);
	},

	_sqDist: function (p, p2) {
		var dx = p2.x - p.x,
		    dy = p2.y - p.y;
		return dx * dx + dy * dy;
	}
};


/* Copyright (c) 2012 the authors listed at the following URL, and/or
the authors of referenced articles or incorporated external code:
http://en.literateprograms.org/Quickhull_(Javascript)?action=history&offset=20120410175256

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

Retrieved from: http://en.literateprograms.org/Quickhull_(Javascript)?oldid=18434
*/

(function () {
	L.QuickHull = {
		getDistant: function (cpt, bl) {
			var vY = bl[1].lat - bl[0].lat,
				vX = bl[0].lng - bl[1].lng;
			return (vX * (cpt.lat - bl[0].lat) + vY * (cpt.lng - bl[0].lng));
		},


		findMostDistantPointFromBaseLine: function (baseLine, latLngs) {
			var maxD = 0,
				maxPt = null,
				newPoints = [],
				i, pt, d;

			for (i = latLngs.length - 1; i >= 0; i--) {
				pt = latLngs[i];
				d = this.getDistant(pt, baseLine);

				if (d > 0) {
					newPoints.push(pt);
				} else {
					continue;
				}

				if (d > maxD) {
					maxD = d;
					maxPt = pt;
				}

			}
			return { 'maxPoint': maxPt, 'newPoints': newPoints };
		},

		buildConvexHull: function (baseLine, latLngs) {
			var convexHullBaseLines = [],
				t = this.findMostDistantPointFromBaseLine(baseLine, latLngs);

			if (t.maxPoint) { // if there is still a point "outside" the base line
				convexHullBaseLines =
					convexHullBaseLines.concat(
						this.buildConvexHull([baseLine[0], t.maxPoint], t.newPoints)
					);
				convexHullBaseLines =
					convexHullBaseLines.concat(
						this.buildConvexHull([t.maxPoint, baseLine[1]], t.newPoints)
					);
				return convexHullBaseLines;
			} else {  // if there is no more point "outside" the base line, the current base line is part of the convex hull
				return [baseLine];
			}
		},

		getConvexHull: function (latLngs) {
			//find first baseline
			var maxLat = false, minLat = false,
				maxPt = null, minPt = null,
				i;

			for (i = latLngs.length - 1; i >= 0; i--) {
				var pt = latLngs[i];
				if (maxLat === false || pt.lat > maxLat) {
					maxPt = pt;
					maxLat = pt.lat;
				}
				if (minLat === false || pt.lat < minLat) {
					minPt = pt;
					minLat = pt.lat;
				}
			}
			var ch = [].concat(this.buildConvexHull([minPt, maxPt], latLngs),
								this.buildConvexHull([maxPt, minPt], latLngs));
			return ch;
		}
	};
}());

L.MarkerCluster.include({
	getConvexHull: function () {
		var childMarkers = this.getAllChildMarkers(),
			points = [],
			hullLatLng = [],
			hull, p, i;

		for (i = childMarkers.length - 1; i >= 0; i--) {
			p = childMarkers[i].getLatLng();
			points.push(p);
		}

		hull = L.QuickHull.getConvexHull(points);

		for (i = hull.length - 1; i >= 0; i--) {
			hullLatLng.push(hull[i][0]);
		}

		return hullLatLng;
	}
});

//This code is 100% based on https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
//Huge thanks to jawj for implementing it first to make my job easy :-)

L.MarkerCluster.include({

	_2PI: Math.PI * 2,
	_circleFootSeparation: 25, //related to circumference of circle
	_circleStartAngle: Math.PI / 6,

	_spiralFootSeparation:  28, //related to size of spiral (experiment!)
	_spiralLengthStart: 11,
	_spiralLengthFactor: 5,

	_circleSpiralSwitchover: 9, //show spiral instead of circle from this marker count upwards.
								// 0 -> always spiral; Infinity -> always circle

	spiderfy: function () {
		if (this._group._spiderfied === this || this._group._inZoomAnimation) {
			return;
		}

		var childMarkers = this.getAllChildMarkers(),
			group = this._group,
			map = group._map,
			center = map.latLngToLayerPoint(this._latlng),
			positions;

		this._group._unspiderfy();
		this._group._spiderfied = this;

		//TODO Maybe: childMarkers order by distance to center

		if (childMarkers.length >= this._circleSpiralSwitchover) {
			positions = this._generatePointsSpiral(childMarkers.length, center);
		} else {
			center.y += 10; //Otherwise circles look wrong
			positions = this._generatePointsCircle(childMarkers.length, center);
		}

		this._animationSpiderfy(childMarkers, positions);
	},

	unspiderfy: function (zoomDetails) {
		/// <param Name="zoomDetails">Argument from zoomanim if being called in a zoom animation or null otherwise</param>
		if (this._group._inZoomAnimation) {
			return;
		}
		this._animationUnspiderfy(zoomDetails);

		this._group._spiderfied = null;
	},

	_generatePointsCircle: function (count, centerPt) {
		var circumference = this._group.options.spiderfyDistanceMultiplier * this._circleFootSeparation * (2 + count),
			legLength = circumference / this._2PI,  //radius from circumference
			angleStep = this._2PI / count,
			res = [],
			i, angle;

		res.length = count;

		for (i = count - 1; i >= 0; i--) {
			angle = this._circleStartAngle + i * angleStep;
			res[i] = new L.Point(centerPt.x + legLength * Math.cos(angle), centerPt.y + legLength * Math.sin(angle))._round();
		}

		return res;
	},

	_generatePointsSpiral: function (count, centerPt) {
		var legLength = this._group.options.spiderfyDistanceMultiplier * this._spiralLengthStart,
			separation = this._group.options.spiderfyDistanceMultiplier * this._spiralFootSeparation,
			lengthFactor = this._group.options.spiderfyDistanceMultiplier * this._spiralLengthFactor,
			angle = 0,
			res = [],
			i;

		res.length = count;

		for (i = count - 1; i >= 0; i--) {
			angle += separation / legLength + i * 0.0005;
			res[i] = new L.Point(centerPt.x + legLength * Math.cos(angle), centerPt.y + legLength * Math.sin(angle))._round();
			legLength += this._2PI * lengthFactor / angle;
		}
		return res;
	},

	_noanimationUnspiderfy: function () {
		var group = this._group,
			map = group._map,
			fg = group._featureGroup,
			childMarkers = this.getAllChildMarkers(),
			m, i;

		this.setOpacity(1);
		for (i = childMarkers.length - 1; i >= 0; i--) {
			m = childMarkers[i];

			fg.removeLayer(m);

			if (m._preSpiderfyLatlng) {
				m.setLatLng(m._preSpiderfyLatlng);
				delete m._preSpiderfyLatlng;
			}
			if (m.setZIndexOffset) {
				m.setZIndexOffset(0);
			}

			if (m._spiderLeg) {
				map.removeLayer(m._spiderLeg);
				delete m._spiderLeg;
			}
		}
	}
});

L.MarkerCluster.include(!L.DomUtil.TRANSITION ? {
	//Non Animated versions of everything
	_animationSpiderfy: function (childMarkers, positions) {
		var group = this._group,
			map = group._map,
			fg = group._featureGroup,
			i, m, leg, newPos;

		for (i = childMarkers.length - 1; i >= 0; i--) {
			newPos = map.layerPointToLatLng(positions[i]);
			m = childMarkers[i];

			m._preSpiderfyLatlng = m._latlng;
			m.setLatLng(newPos);
			if (m.setZIndexOffset) {
				m.setZIndexOffset(1000000); //Make these appear on top of EVERYTHING
			}

			fg.addLayer(m);


			leg = new L.Polyline([this._latlng, newPos], { weight: 1.5, color: '#222' });
			map.addLayer(leg);
			m._spiderLeg = leg;
		}
		this.setOpacity(0.3);
		group.fire('spiderfied');
	},

	_animationUnspiderfy: function () {
		this._noanimationUnspiderfy();
	}
} : {
	//Animated versions here
	SVG_ANIMATION: (function () {
		return document.createElementNS('http://www.w3.org/2000/svg', 'animate').toString().indexOf('SVGAnimate') > -1;
	}()),

	_animationSpiderfy: function (childMarkers, positions) {
		var me = this,
			group = this._group,
			map = group._map,
			fg = group._featureGroup,
			thisLayerPos = map.latLngToLayerPoint(this._latlng),
			i, m, leg, newPos;

		//Add markers to map hidden at our center point
		for (i = childMarkers.length - 1; i >= 0; i--) {
			m = childMarkers[i];

			//If it is a marker, add it now and we'll animate it out
			if (m.setOpacity) {
				m.setZIndexOffset(1000000); //Make these appear on top of EVERYTHING
				m.setOpacity(0);
			
				fg.addLayer(m);

				m._setPos(thisLayerPos);
			} else {
				//Vectors just get immediately added
				fg.addLayer(m);
			}
		}

		group._forceLayout();
		group._animationStart();

		var initialLegOpacity = L.Path.SVG ? 0 : 0.3,
			xmlns = L.Path.SVG_NS;


		for (i = childMarkers.length - 1; i >= 0; i--) {
			newPos = map.layerPointToLatLng(positions[i]);
			m = childMarkers[i];

			//Move marker to new position
			m._preSpiderfyLatlng = m._latlng;
			m.setLatLng(newPos);
			
			if (m.setOpacity) {
				m.setOpacity(1);
			}


			//Add Legs.
			leg = new L.Polyline([me._latlng, newPos], { weight: 1.5, color: '#222', opacity: initialLegOpacity });
			map.addLayer(leg);
			m._spiderLeg = leg;

			//Following animations don't work for canvas
			if (!L.Path.SVG || !this.SVG_ANIMATION) {
				continue;
			}

			//How this works:
			//http://stackoverflow.com/questions/5924238/how-do-you-animate-an-svg-path-in-ios
			//http://dev.opera.com/articles/view/advanced-svg-animation-techniques/

			//Animate length
			var length = leg._path.getTotalLength();
			leg._path.setAttribute("stroke-dasharray", length + "," + length);

			var anim = document.createElementNS(xmlns, "animate");
			anim.setAttribute("attributeName", "stroke-dashoffset");
			anim.setAttribute("begin", "indefinite");
			anim.setAttribute("from", length);
			anim.setAttribute("to", 0);
			anim.setAttribute("dur", 0.25);
			leg._path.appendChild(anim);
			anim.beginElement();

			//Animate opacity
			anim = document.createElementNS(xmlns, "animate");
			anim.setAttribute("attributeName", "stroke-opacity");
			anim.setAttribute("attributeName", "stroke-opacity");
			anim.setAttribute("begin", "indefinite");
			anim.setAttribute("from", 0);
			anim.setAttribute("to", 0.5);
			anim.setAttribute("dur", 0.25);
			leg._path.appendChild(anim);
			anim.beginElement();
		}
		me.setOpacity(0.3);

		//Set the opacity of the spiderLegs back to their correct value
		// The animations above override this until they complete.
		// If the initial opacity of the spiderlegs isn't 0 then they appear before the animation starts.
		if (L.Path.SVG) {
			this._group._forceLayout();

			for (i = childMarkers.length - 1; i >= 0; i--) {
				m = childMarkers[i]._spiderLeg;

				m.options.opacity = 0.5;
				m._path.setAttribute('stroke-opacity', 0.5);
			}
		}

		setTimeout(function () {
			group._animationEnd();
			group.fire('spiderfied');
		}, 200);
	},

	_animationUnspiderfy: function (zoomDetails) {
		var group = this._group,
			map = group._map,
			fg = group._featureGroup,
			thisLayerPos = zoomDetails ? map._latLngToNewLayerPoint(this._latlng, zoomDetails.zoom, zoomDetails.center) : map.latLngToLayerPoint(this._latlng),
			childMarkers = this.getAllChildMarkers(),
			svg = L.Path.SVG && this.SVG_ANIMATION,
			m, i, a;

		group._animationStart();

		//Make us visible and bring the child markers back in
		this.setOpacity(1);
		for (i = childMarkers.length - 1; i >= 0; i--) {
			m = childMarkers[i];

			//Marker was added to us after we were spidified
			if (!m._preSpiderfyLatlng) {
				continue;
			}

			//Fix up the location to the real one
			m.setLatLng(m._preSpiderfyLatlng);
			delete m._preSpiderfyLatlng;
			//Hack override the location to be our center
			if (m.setOpacity) {
				m._setPos(thisLayerPos);
				m.setOpacity(0);
			} else {
				fg.removeLayer(m);
			}

			//Animate the spider legs back in
			if (svg) {
				a = m._spiderLeg._path.childNodes[0];
				a.setAttribute('to', a.getAttribute('from'));
				a.setAttribute('from', 0);
				a.beginElement();

				a = m._spiderLeg._path.childNodes[1];
				a.setAttribute('from', 0.5);
				a.setAttribute('to', 0);
				a.setAttribute('stroke-opacity', 0);
				a.beginElement();

				m._spiderLeg._path.setAttribute('stroke-opacity', 0);
			}
		}

		setTimeout(function () {
			//If we have only <= one child left then that marker will be shown on the map so don't remove it!
			var stillThereChildCount = 0;
			for (i = childMarkers.length - 1; i >= 0; i--) {
				m = childMarkers[i];
				if (m._spiderLeg) {
					stillThereChildCount++;
				}
			}


			for (i = childMarkers.length - 1; i >= 0; i--) {
				m = childMarkers[i];

				if (!m._spiderLeg) { //Has already been unspiderfied
					continue;
				}


				if (m.setOpacity) {
					m.setOpacity(1);
					m.setZIndexOffset(0);
				}

				if (stillThereChildCount > 1) {
					fg.removeLayer(m);
				}

				map.removeLayer(m._spiderLeg);
				delete m._spiderLeg;
			}
			group._animationEnd();
		}, 200);
	}
});


L.MarkerClusterGroup.include({
	//The MarkerCluster currently spiderfied (if any)
	_spiderfied: null,

	_spiderfierOnAdd: function () {
		this._map.on('click', this._unspiderfyWrapper, this);

		if (this._map.options.zoomAnimation) {
			this._map.on('zoomstart', this._unspiderfyZoomStart, this);
		} else {
			//Browsers without zoomAnimation don't fire zoomstart
			this._map.on('zoomend', this._unspiderfyWrapper, this);
		}

		if (L.Path.SVG && !L.Browser.touch) {
			this._map._initPathRoot();
			//Needs to happen in the pageload, not after, or animations don't work in webkit
			//  http://stackoverflow.com/questions/8455200/svg-animate-with-dynamically-added-elements
			//Disable on touch browsers as the animation messes up on a touch zoom and isn't very noticable
		}
	},

	_spiderfierOnRemove: function () {
		this._map.off('click', this._unspiderfyWrapper, this);
		this._map.off('zoomstart', this._unspiderfyZoomStart, this);
		this._map.off('zoomanim', this._unspiderfyZoomAnim, this);

		this._unspiderfy(); //Ensure that markers are back where they should be
	},


	//On zoom start we add a zoomanim handler so that we are guaranteed to be last (after markers are animated)
	//This means we can define the animation they do rather than Markers doing an animation to their actual location
	_unspiderfyZoomStart: function () {
		if (!this._map) { //May have been removed from the map by a zoomEnd handler
			return;
		}

		this._map.on('zoomanim', this._unspiderfyZoomAnim, this);
	},
	_unspiderfyZoomAnim: function (zoomDetails) {
		//Wait until the first zoomanim after the user has finished touch-zooming before running the animation
		if (L.DomUtil.hasClass(this._map._mapPane, 'leaflet-touching')) {
			return;
		}

		this._map.off('zoomanim', this._unspiderfyZoomAnim, this);
		this._unspiderfy(zoomDetails);
	},


	_unspiderfyWrapper: function () {
		/// <summary>_unspiderfy but passes no arguments</summary>
		this._unspiderfy();
	},

	_unspiderfy: function (zoomDetails) {
		if (this._spiderfied) {
			this._spiderfied.unspiderfy(zoomDetails);
		}
	},

	_noanimationUnspiderfy: function () {
		if (this._spiderfied) {
			this._spiderfied._noanimationUnspiderfy();
		}
	},

	//If the given layer is currently being spiderfied then we unspiderfy it so it isn't on the map anymore etc
	_unspiderfyLayer: function (layer) {
		if (layer._spiderLeg) {
			this._featureGroup.removeLayer(layer);

			layer.setOpacity(1);
			//Position will be fixed up immediately in _animationUnspiderfy
			layer.setZIndexOffset(0);

			this._map.removeLayer(layer._spiderLeg);
			delete layer._spiderLeg;
		}
	}
});


}(window, document));;var block_serverguide_functions = new Surface.BlockConfig('', {});
Surface.initComponent('serverguide');
serverguide.addTemplate(new Surface.Template('functions'));
serverguide.functions.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverguide_functions;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverguide');
	Surface.Renderer.addUsedTemplate('serverguide.functions');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return c.join('');
}
;
serverguide.function_showAbsoluteServerUrlByServer = function(l_server, b, kwargs) {
	var o = {};
	var c = [];
	var l_url;
	var l_host;
	if (S.compat.eq(Surface.globalContext.staticContext.sslStrategy, "all")) {
		l_host = Surface.globalContext.staticContext.currentHostSecure;
	}
	else {
		l_host = Surface.globalContext.staticContext.currentHost;
	}
	l_url = S.Modifier.concat(l_host, $S.callFunction("common.showServerUrlByServer", l_server, b, kwargs));
	return l_url;
}
;
serverguide.function_showAbsoluteServerUrl = function(l_guid, l_name, b, kwargs) {
	var o = {};
	var c = [];
	var l_url;
	var l_host;
	if (S.compat.eq(Surface.globalContext.staticContext.sslStrategy, "all")) {
		l_host = Surface.globalContext.staticContext.currentHostSecure;
	}
	else {
		l_host = Surface.globalContext.staticContext.currentHost;
	}
	l_url = S.Modifier.concat(l_host, S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": l_guid, "slug": S.Modifier.slugify(l_name)}));
	return l_url;
}
;
serverguide.function_gameServerPresetStringLocalized = function(l_gameServerPreset, b, kwargs) {
	var o = {};
	var c = [];
	if (S.compat.eq(l_gameServerPreset, 1)) {
		return "ノーマル";
	}
	else if (S.compat.eq(l_gameServerPreset, 2)) {
		return "ハードコア";
	}
	else if (S.compat.eq(l_gameServerPreset, 4)) {
		return "歩兵のみ";
	}
	else if (S.compat.eq(l_gameServerPreset, 8)) {
		return "カスタム";
	}
	else if (S.compat.eq(l_gameServerPreset, 16)) {
		return "イマーシブ";
	}
	return "--";
}
;
serverguide.function_gameServerPresetStringNoLocalization = function(l_gameServerPreset, b, kwargs) {
	var o = {};
	var c = [];
	var l_name;
	l_name = "unknown";
	if (S.compat.eq(l_gameServerPreset, 1)) {
		l_name = "normal";
	}
	else if (S.compat.eq(l_gameServerPreset, 2)) {
		l_name = "hardcore";
	}
	else if (S.compat.eq(l_gameServerPreset, 4)) {
		l_name = "infantry";
	}
	else if (S.compat.eq(l_gameServerPreset, 8)) {
		l_name = "custom";
	}
	return l_name;
}
;
serverguide.function_getServerRegionLocalized = function(l_serverRegion, b, kwargs) {
	var o = {};
	var c = [];
	var l_regionLocalized;
	l_regionLocalized = "不明";
	if (S.compat.eq(l_serverRegion, 1)) {
		l_regionLocalized = "北米";
	}
	else if (S.compat.eq(l_serverRegion, 2)) {
		l_regionLocalized = "南アメリカ";
	}
	else if (S.compat.eq(l_serverRegion, 4)) {
		l_regionLocalized = "南極";
	}
	else if (S.compat.eq(l_serverRegion, 8)) {
		l_regionLocalized = "アフリカ";
	}
	else if (S.compat.eq(l_serverRegion, 16)) {
		l_regionLocalized = "ヨーロッパ";
	}
	else if (S.compat.eq(l_serverRegion, 32)) {
		l_regionLocalized = "アジア";
	}
	else if (S.compat.eq(l_serverRegion, 64)) {
		l_regionLocalized = "オセアニア";
	}
	return l_regionLocalized;
}
;
serverguide.function_gameServerModeStringLocalizedLegacy = function(l_gameMode, b, kwargs) {
	var o = {};
	var c = [];
	var l_localized;
	var l_gameModeStrings;
	l_gameModeStrings = {1: "コンクエスト", 1024: "ドミネーション", 1048576: "危険地帯", 128: "コンクエストアサルト（大）", 131072: "タンク・シューペリオリティ", 16: "オンスロート", 16384: "セクター制圧", 2: "ラッシュ", 2048: "チームデスマッチ・クロースクオーターズ", 2097152: "オブリタレーション", 256: "コンクエストアサルト", 262144: "オブジェクティブ・レイド", 32: "チームデスマッチ", 32768: "ファイアチームサバイバー", 4: "分隊ラッシュ", 4096: "チームデスマッチ・ファイアチーム", 4194304: "スカベンジャー", 512: "ガンマスター", 524288: "キャプチャー・ザ・フラッグ", 64: "コンクエスト（大）", 65536: "ホームラン", 8: "分隊デスマッチ", 8192: "コンバットミッション", 8388608: "エア・シューペリオリティ"};
	l_localized = S.Modifier.get(l_gameModeStrings, l_gameMode);
	if (l_localized) {
		return l_localized;
	}
	return "不明";
}
;
serverguide.function_gameServerModeStringLocalized = function(l_gameMode, l_game, b, kwargs) {
	var o = {};
	var c = [];
	var l_gameModeTypeString;
	var l_gameModeLookup;
	if (((S.compat.eq(l_game, null) || S.compat.eq(l_game, 2)) || S.compat.eq(l_game, 4096))) {
		return $S.callFunction("serverguide.gameServerModeStringLocalizedLegacy", l_gameMode, b, kwargs);
	}
	l_gameModeLookup = S.Modifier.get($S.callFunction("gamedata.get", l_game, "gameserver", b, kwargs), "serverGamemodeLookup");
	l_gameModeTypeString = S.Modifier.get(l_gameModeLookup, l_gameMode);
	return l_gameModeTypeString ? (S.translations[l_gameModeTypeString] || l_gameModeTypeString) : $S.callFunction("serverguide.gameServerModeStringLocalizedLegacy", l_gameMode, b, kwargs);
}
;
serverguide.function_playlistStringLocalized = function(l_playlist, b, kwargs) {
	var o = {};
	var c = [];
	var l_playlistLocalized;
	l_playlistLocalized = S.Modifier.concat("ID_WEB_SERVERGUIDE_PLAYLIST_", l_playlist);
	return (S.translations[l_playlistLocalized] || l_playlistLocalized);
}
;
serverguide.function_gameServerExperienceString = function(l_game, l_gameServerExperience, b, kwargs) {
	var o = {};
	var c = [];
	var l_gameServerExperienceString;
	var l_experienceLookup;
	l_experienceLookup = S.Modifier.get($S.callFunction("gamedata.get", l_game, "gameserver", b, kwargs), "experienceLookup");
	l_gameServerExperienceString = S.Modifier.get(S.Modifier.get(l_experienceLookup, l_gameServerExperience), "name");
	return (S.translations[l_gameServerExperienceString] || l_gameServerExperienceString);
}
;
serverguide.function_enableJoinButton = function(l_gameServer, b, kwargs) {
	var o = {};
	var c = [];
	var l_experienceName;
	l_experienceName = "";
	if (((typeof(l_gameServer) != "undefined" && l_gameServer !== null && typeof(l_gameServer.experience) != "undefined" && l_gameServer.experience !== null) ? l_gameServer.experience : false)) {
		l_experienceName = $S.callFunction("serverguide.gameServerExperienceString", l_gameServer.game, l_gameServer.experience, b, kwargs);
	}
	if (!((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.session) != "undefined" && Surface.globalContext.session !== null && typeof(Surface.globalContext.session.user) != "undefined" && Surface.globalContext.session.user !== null && typeof(Surface.globalContext.session.user.presence) != "undefined" && Surface.globalContext.session.user.presence !== null))) {
		return false;
	}
	else if (S.compat.eq(S.Modifier.upper(l_experienceName), "CONQUEST_LADDER")) {
		return false;
	}
	return $S.callFunction("serverguide.presenceJoinButton", l_gameServer, Surface.globalContext.session.user.presence, b, kwargs);
}
;
serverguide.function_enableSpectateButton = function(l_gameServer, b, kwargs) {
	var o = {};
	var c = [];
	if (!((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.session) != "undefined" && Surface.globalContext.session !== null && typeof(Surface.globalContext.session.user) != "undefined" && Surface.globalContext.session.user !== null && typeof(Surface.globalContext.session.user.presence) != "undefined" && Surface.globalContext.session.user.presence !== null))) {
		return false;
	}
	return $S.callFunction("serverguide.presenceJoinButton", l_gameServer, Surface.globalContext.session.user.presence, b, kwargs);
}
;
serverguide.function_presenceJoinButton = function(l_gameServer, l_userPresence, b, kwargs) {
	var o = {};
	var c = [];
	if (!((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.session) != "undefined" && Surface.globalContext.session !== null && typeof(Surface.globalContext.session.user) != "undefined" && Surface.globalContext.session.user !== null && typeof(Surface.globalContext.session.user.presence) != "undefined" && Surface.globalContext.session.user.presence !== null))) {
		return false;
	}
	return $S.callFunction("serverguide.presenceSoldierJoinButton", l_gameServer, Surface.globalContext.session.user.presence, Surface.globalContext.staticContext.activePersona, b, kwargs);
}
;
serverguide.function_presenceSoldierJoinButton = function(l_gameServer, l_userPresence, l_activeSoldier, b, kwargs) {
	var o = {};
	var c = [];
	var l_isMobile;
	var l_activeSoldier;
	var l_userPresence;
	var l_isPCOnly;
	if (((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.session) != "undefined" && Surface.globalContext.session !== null && typeof(Surface.globalContext.session.temporaryDisableJoin) != "undefined" && Surface.globalContext.session.temporaryDisableJoin !== null) ? Surface.globalContext.session.temporaryDisableJoin : false)) {
		return true;
	}
	l_isMobile = Surface.globalContext.staticContext.detectedBrowser.isTouchDevice;
	l_userPresence = ((typeof(l_userPresence) != "undefined" && l_userPresence !== null) ? l_userPresence : ((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.session) != "undefined" && Surface.globalContext.session !== null && typeof(Surface.globalContext.session.user) != "undefined" && Surface.globalContext.session.user !== null && typeof(Surface.globalContext.session.user.presence) != "undefined" && Surface.globalContext.session.user.presence !== null) ? Surface.globalContext.session.user.presence : null));
	l_activeSoldier = ((typeof(l_activeSoldier) != "undefined" && l_activeSoldier !== null) ? l_activeSoldier : Surface.globalContext.staticContext.activePersona);
	if (!(l_activeSoldier)) {
		return false;
	}
	l_isPCOnly = ((S.compat.eq(l_gameServer.game, 8192) || S.compat.eq(l_gameServer.game, 2)) || S.compat.eq(l_gameServer.game, 4096));
	if (((S.compat.neq(l_gameServer.platform, 1) && l_isPCOnly) && S.compat.neq(l_activeSoldier.platform, 1))) {
		return false;
	}
	else if (((S.compat.eq(l_gameServer.platform, 1) && !(l_isMobile)) && S.compat.eq(l_activeSoldier.platform, 1))) {
		return true;
	}
	if ($S.callFunction("comcenter.isOnlineGame", l_userPresence, b, kwargs)) {
		if (((S.compat.eq(l_userPresence.onlineGame.game, l_gameServer.game) && S.compat.eq(l_userPresence.onlineGame.platform, l_gameServer.platform)) && S.compat.eq(l_activeSoldier.platform, l_userPresence.onlineGame.platform))) {
			return true;
		}
	}
	return false;
}
;
serverguide.function_getServerSlots = function(l_server, l_slotType, b, kwargs) {
	var o = {};
	var c = [];
	var l_slotCurrent;
	var l_slots;
	var l_slotMax;
	l_slotCurrent = 0;
	l_slotMax = 0;
	if ((typeof(l_server) != "undefined" && l_server !== null && typeof(l_server.slots) != "undefined" && l_server.slots !== null)) {
		l_slots = S.Modifier.get(l_server.slots, l_slotType);
		if ((typeof(l_slots) != "undefined" && l_slots !== null)) {
			l_slotCurrent = l_slots.current;
			l_slotMax = l_slots.max;
		}
	}
	return {"current": l_slotCurrent, "max": l_slotMax};
}
;
serverguide.function_hasServerSlotType = function(l_server, l_slotType, b, kwargs) {
	var o = {};
	var c = [];
	var l_slots;
	if (!((typeof(l_server) != "undefined" && l_server !== null && typeof(l_server.slots) != "undefined" && l_server.slots !== null))) {
		return false;
	}
	l_slots = S.Modifier.get(l_server.slots, l_slotType);
	if ((typeof(l_slots) != "undefined" && l_slots !== null)) {
		return S.compat.neq(l_slots.max, 0);
	}
	else {
		return false;
	}
}
;
serverguide.function_showJoinButton = function(l_gameServer, b, kwargs) {
	var o = {};
	var c = [];
	if (S.compat.eq(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : null), l_gameServer.platform)) {
		if ((S.compat.eq(((typeof(l_gameServer) != "undefined" && l_gameServer !== null && typeof(l_gameServer.game) != "undefined" && l_gameServer.game !== null) ? l_gameServer.game : 0), 8192) && S.compat.neq(l_gameServer.platform, 1))) {
			return false;
		}
		return true;
	}
	return false;
}
;
serverguide.function_remoteJoinEnabled = function(b, kwargs) {
	var o = {};
	var c = [];
	if (((Surface.globalContext.staticContext.activePersona && S.compat.eq(Surface.globalContext.staticContext.activePersona.game, 8192)) && S.compat.neq(Surface.globalContext.staticContext.activePersona.platform, 1))) {
		return false;
	}
	return true;
}
;
serverguide.function_liveScoreboardEnabled = function(l_game, l_platform, b, kwargs) {
	var o = {};
	var c = [];
	if (Surface.globalContext.staticContext.detectedBrowser.isTouchDevice) {
		return false;
	}
	if (((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.liveScoreboardEnabled) != "undefined" && Surface.globalContext.staticContext.liveScoreboardEnabled !== null) && S.Modifier.get(S.Modifier.get(Surface.globalContext.staticContext.liveScoreboardEnabled, l_game, {}), l_platform, false))) {
		return true;
	}
	return false;
}
;
;var block_serverguide_joinfriendform = new Surface.BlockConfig('', {});
Surface.initComponent('serverguide');
serverguide.addTemplate(new Surface.Template('joinfriendform'));
serverguide.joinfriendform.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverguide_joinfriendform;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverguide');
	Surface.Renderer.addUsedTemplate('serverguide.joinfriendform');
	var l_buttonValue;
	var l_joinBtnClass;
	var l_realm;
	var l_btnClass;
	var l_classes;
	c.push("\n");
	l_realm = S.Modifier.get(Surface.globalContext, "realm");
	c.push("\n");
	if (($S.callFunction("comcenter.isPlayingMp", o.presence, b, kwargs) && $S.callFunction("serverguide.showJoinButton", o.presence.playingMp, b, kwargs))) {
		if ((typeof(o) != "undefined" && o !== null && typeof(o.label) != "undefined" && o.label !== null)) {
			l_buttonValue = o.label;
		}
		else {
			l_buttonValue = "参加";
		}
		l_btnClass = "";
		l_joinBtnClass = "";
		if (S.compat.eq(l_realm.game, 2048)) {
			l_btnClass = "btn btn-tiny btn-primary ";
		}
		else if (S.compat.eq(l_realm.game, 8192)) {
			l_btnClass = "btn btn-tiny btn-primary ";
			l_joinBtnClass = "btn-primary ";
		}
		else {
			l_joinBtnClass = "btn-primary ";
		}
		c.push("\n");
		l_classes = "";
		if (((typeof(o) != "undefined" && o !== null && typeof(o.friendJoinButton) != "undefined" && o.friendJoinButton !== null) ? o.friendJoinButton : false)) {
			l_classes = S.compat.add(l_joinBtnClass, " btn btn-small join-friend-submit-link join-friend join-friendcomcenter-interact-playing");
			l_buttonValue = "<i class=\"icon-join-friend\"></i>";
		}
		else if (((typeof(o) != "undefined" && o !== null && typeof(o.textButton) != "undefined" && o.textButton !== null) ? o.textButton : false)) {
			l_classes = "join-friend-submit-link";
		}
		else if (((typeof(o) != "undefined" && o !== null && typeof(o.profileButton) != "undefined" && o.profileButton !== null) ? o.profileButton : false)) {
			l_classes = "base-button-arrow-large";
		}
		else if (((typeof(o) != "undefined" && o !== null && typeof(o.buttonSecondaryLarge) != "undefined" && o.buttonSecondaryLarge !== null) ? o.buttonSecondaryLarge : false)) {
			l_classes = "btn btn-secondary btn-large";
		}
		else {
			l_classes = S.compat.add("base-button-arrow-tiny ", l_btnClass);
		}
		c.push("\n");
		if ((typeof(S.Modifier.get(o.presence.playingMp, "serverGuid")) != "undefined" && S.Modifier.get(o.presence.playingMp, "serverGuid") !== null)) {
			l_classes = S.compat.add(S.compat.add(l_classes, " "), ((typeof(o) != "undefined" && o !== null && typeof(o.extraClass) != "undefined" && o.extraClass !== null) ? o.extraClass : ""));
			c.push(" <button\n class=\"join-friend-generic-button ");
			c.push(Surface.valOut(l_classes));
			c.push(" ");
			if (!($S.callFunction("comcenter.isFriendJoinable", o.presence, b, kwargs))) {
				c.push(" disabled");
			}
			c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-role=\"");
			c.push(Surface.valOut(1));
			c.push("\"\n data-guid=\"");
			c.push(Surface.valOut(S.Modifier.get(o.presence.playingMp, "serverGuid")));
			c.push("\"\n data-game=\"");
			c.push(Surface.valOut(o.presence.playingMp.game));
			c.push("\"\n data-platform=\"");
			c.push(Surface.valOut(o.presence.playingMp.platform));
			c.push("\"\n data-friendPersonaId=\"");
			c.push(Surface.valOut(o.friendPersonaId));
			c.push("\"\n data-telemetry-action=\"");
			c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.telemetryAction) != "undefined" && o.telemetryAction !== null) ? o.telemetryAction : "")));
			c.push("\"\n data-track=\"friend.playing.server.join\">\n ");
			c.push(l_buttonValue);
			c.push("\n </button>\n");
		}
	}
	return c.join('');
}
;
;Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('advanced'));
;var block_serverbrowserwarsaw_base = new Surface.BlockConfig('base.ajaxindex', {'content': 'serverbrowserwarsaw.base.block_content', 'titleComponent': 'serverbrowserwarsaw.base.block_titleComponent', 'recommendedServers': 'serverbrowserwarsaw.base.block_recommendedServers', 'serverBrowserTitle': 'serverbrowserwarsaw.base.block_serverBrowserTitle', 'mainContent': 'serverbrowserwarsaw.base.block_mainContent', 'filters': 'serverbrowserwarsaw.base.block_filters', 'tabs': 'serverbrowserwarsaw.base.block_tabs'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('base'));
serverbrowserwarsaw.base.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_base;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.base');
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('base.ajaxindex', o, b, kwargs);
}
;
serverbrowserwarsaw.base.block_titleComponent = new Surface.Block('serverbrowserwarsaw.base.block_titleComponent');
serverbrowserwarsaw.base.block_titleComponent.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("マルチプレイヤー"));
	c.push(" - ");
	return c.join("");
}
;
serverbrowserwarsaw.base.block_serverBrowserTitle = new Surface.Block('serverbrowserwarsaw.base.block_serverBrowserTitle');
serverbrowserwarsaw.base.block_serverBrowserTitle.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("マルチプレイヤー"));
	return c.join("");
}
;
serverbrowserwarsaw.base.surface_31_13 = new Surface.SingleSurface("serverbrowserwarsaw.base.surface_31_13");
serverbrowserwarsaw.base.surface_31_13.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_base;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.base');
	c.push("<surf:container id=\"serverbrowser-recommended-servers\"");
	c.push(" ");
	c.push("data-url");
	c.push("=\"");
	c.push(S.Modifier.urlformat("/{_section}/{_language}/servers/recommendedServers/{platform}/", Surface.urlContext, {"platform": $S.callFunction("common.platformIntToPlatform", S.Modifier.get(S.Modifier.get(Surface.globalContext.staticContext, "activePersona", {}), "platform", 1), b, kwargs)}));
	c.push("\"");
	c.push(">");
	c.push("\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showContent) != "undefined" && o.showContent !== null) ? o.showContent : false)) {
		c.push("\n");
		c.push(" <section class=\"box main-header\">\n <div class=\"row-tight main-quickmatch-row show-recommended\">\n <div class=\"span2 no-border\">\n <div class=\"gradientbg\"></div>\n <div class=\"main-quickmatch-map-image\" style=\"background-image: url(/public/base/bfh/map_images/335x160/mp_downtown-f96f7952.jpg); background-size: cover; background-position: center center;\"></div>\n <div class=\"main-quickmatch-data\">\n <div class=\"title\">");
		c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.serverName) != "undefined" && o.server.serverName !== null) ? o.server.serverName : "No server name")));
		c.push("</div>\n <div class=\"gamemode\">\n ");
		c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", o.server.gameMode, o.server.game, b, kwargs)));
		c.push("\n </div>\n <div class=\"players\">\n ");
		c.push(Surface.importTemplate(("base" + ("." + "userlist")), {"users": o.server.friends, "avatarOnly": true, "size": 30, "maxIterations": 5, "capFriends": true, "showMoreFriendsLink": false}, null, kwargs));
		c.push("\n </div>\n <div class=\"joinbutton\">\n <button class=\"btn btn-primary\n ");
		if (!($S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs))) {
			c.push(" disabled");
		}
		c.push("\"\n data-track=\"main.recommendedserver.join\"\n data-bind-action=\"join-mp-gameserver\"\n data-guid=\"");
		c.push(Surface.valOut(o.server.serverGuid));
		c.push("\"\n data-game=\"");
		c.push(Surface.valOut(o.server.game));
		c.push("\"\n data-platform=\"");
		c.push(Surface.valOut(o.server.platform));
		c.push("\"\n data-role=\"");
		c.push(Surface.valOut(1));
		c.push("\">\n ");
		c.push(Surface.valOut("参加"));
		c.push("\n </button>\n </div>\n </div>\n </div>\n </div>\n </section>\n ");
	}
	c.push("\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.base", "surface_31_13", "serverbrowser-recommended-servers", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.base.block_tabs = new Surface.Block('serverbrowserwarsaw.base.block_tabs');
serverbrowserwarsaw.base.block_tabs.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_serverbrowserTab;
	var l_session;
	l_session = S.Modifier.get(Surface.globalContext, "session");
	l_serverbrowserTab = S.Modifier.get(Surface.globalContext, "serverbrowserTab");
	c.push("\n <nav class=\"submenu spacing-bottom-small\" data-active=\"");
	c.push(Surface.valOut(l_serverbrowserTab));
	c.push("\">\n <ul>\n");
	if (((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false)) {
		c.push(" <li class=\"");
		if (S.compat.eq(l_serverbrowserTab, "index")) {
			c.push("active");
		}
		c.push("\">\n <a href=\"");
		c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
		c.push("\">\n ");
		c.push(Surface.valOut("サーバーブラウザー"));
		c.push("\n </a>\n </li>\n");
		if ((!(Surface.globalContext.staticContext.detectedBrowser.isTouchDevice) && S.compat.neq(Surface.globalContext.realm.section, 8192))) {
			c.push(" <li class=\"");
			if (S.compat.eq(l_serverbrowserTab, "playnow")) {
				c.push("active");
			}
			c.push("\">\n <a href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/playnow/{platform}/{gameMode}/", Surface.urlContext, {"platform": o.platformString})));
			c.push("\">\n");
			if (S.compat.eq(((typeof(o) != "undefined" && o !== null && typeof(o.platform) != "undefined" && o.platform !== null) ? o.platform : 0), 1)) {
				c.push(" ");
				c.push(Surface.valOut("今すぐプレイ"));
				c.push("\n");
			}
			else {
				c.push(" ");
				c.push(Surface.valOut("ゲームモード"));
				c.push("\n");
			}
			c.push(" </a>\n </li>\n");
		}
		c.push("\n");
		if (S.compat.eq(S.Modifier.get(S.Modifier.get(Surface.globalContext.staticContext, "activePersona", {}), "platform", ""), 1)) {
			c.push(" <li class=\"");
			if (S.compat.eq(l_serverbrowserTab, "favourites")) {
				c.push("active");
			}
			c.push("\">\n <a href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/favourites/{platform}/", Surface.urlContext, {"platform": o.platformString})));
			c.push("\">\n ");
			c.push(Surface.valOut("お気に入り"));
			c.push("\n </a>\n </li>\n <li class=\"");
			if (S.compat.eq(l_serverbrowserTab, "history")) {
				c.push("active");
			}
			c.push("\">\n <a href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/history/{platform}/", Surface.urlContext, {"platform": o.platformString})));
			c.push("\">\n ");
			c.push(Surface.valOut("履歴"));
			c.push("\n </a>\n </li>\n");
		}
		c.push("\n");
		if ((S.compat.eq(Surface.globalContext.realm.section, 8192) && !(((typeof(0) != "undefined" && 0 !== null) ? 0 : false)))) {
			c.push(" <li class=\"");
			if (S.compat.eq(l_serverbrowserTab, "quickmatch")) {
				c.push("active");
			}
			c.push("\">\n <a href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/quickmatch/{platform}/", Surface.urlContext, {"platform": o.platformString})));
			c.push("\">\n ");
			c.push(Surface.valOut("クイックマッチ"));
			c.push("\n </a>\n </li>\n");
		}
		c.push(" ");
	}
	c.push("\n </ul>\n </nav>\n");
	c.push(" ");
	return c.join("");
}
;
serverbrowserwarsaw.base.block_recommendedServers = new Surface.Block('serverbrowserwarsaw.base.block_recommendedServers');
serverbrowserwarsaw.base.block_recommendedServers.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.base.block_filters = new Surface.Block('serverbrowserwarsaw.base.block_filters');
serverbrowserwarsaw.base.block_filters.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.base.block_content = new Surface.Block('serverbrowserwarsaw.base.block_content');
serverbrowserwarsaw.base.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.base.block_mainContent = new Surface.Block('serverbrowserwarsaw.base.block_mainContent');
serverbrowserwarsaw.base.block_mainContent.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("popup" + ("." + "showIntro")), {"section": "serverbrowser"}, null, kwargs));
	c.push("\n");
	c.push("\n <div class=\"sitenotification grid-container\">\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.notification) != "undefined" && o.notification !== null) ? o.notification : 0)) {
		c.push(" ");
		c.push(Surface.importTemplate(("main" + ("." + "notice")), {"notification": o.notification}, null, kwargs));
		c.push("\n");
	}
	c.push("\n");
	c.push(Surface.importTemplate(("main" + ("." + "xpboostnotice")), {"onGoingXpEvent": o.onGoingXpEvent}, null, kwargs));
	c.push("\n </div>\n <section id=\"serverbrowser\" class=\"grid-container\">\n <header class=\"clearfix\">\n <div class=\"pull-left\">\n <h1>");
	c.push(b.get('serverBrowserTitle')(o, b, kwargs));
	c.push("</h1>\n </div>\n </header>\n");
	if (((S.compat.eq(Surface.globalContext.realm.section, 8192) && ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : false)) && S.compat.gt(S.Modifier.count(o.server.friends), 0))) {
		c.push(serverbrowserwarsaw.base.surface_31_13.render({"server": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : null), "showContent": ((typeof(o) != "undefined" && o !== null && typeof(o.showContent) != "undefined" && o.showContent !== null) ? o.showContent : null)}, b, kwargs));
		c.push("\n");
	}
	c.push("\n");
	c.push(b.get('tabs')(o, b, kwargs));
	c.push("\n");
	if (S.compat.neq(Surface.globalContext.realm.section, 8192)) {
		c.push(b.get('recommendedServers')(o, b, kwargs));
	}
	c.push("\n <input type=\"hidden\" id=\"serverbrowser-show-url\"\n value=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": "%GUID%", "platform": o.platformString})));
	c.push("?json=1\"/>\n <input type=\"hidden\" id=\"serverbrowser-numplayers-url\"\n value=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/getNumPlayersOnServer/{platform}/{guid}/", Surface.urlContext, {"guid": "%GUID%", "platform": o.platformString})));
	c.push("\"/>\n <input type=\"hidden\" id=\"serverbrowser-players-url\"\n value=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/getPlayersOnServer/{platform}/{guid}/", Surface.urlContext, {"guid": "%GUID%", "platform": o.platformString})));
	c.push("\"/>\n");
	c.push(b.get('filters')(o, b, kwargs));
	c.push(b.get('content')(o, b, kwargs));
	c.push("\n </section>\n <div style=\"margin-bottom:10px;top:0px;\" class=\"base-usermsg-general base-usermsg-");
	c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.userMessageBox) != "undefined" && o.userMessageBox !== null && typeof(o.userMessageBox.type) != "undefined" && o.userMessageBox.type !== null) ? o.userMessageBox.type : "information")));
	if (((typeof(o) != "undefined" && o !== null && typeof(o.userMessageBox) != "undefined" && o.userMessageBox !== null) && o.userMessageBox)) {
		c.push(" base-show");
	}
	c.push("\">\n <p>");
	c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.userMessageBox) != "undefined" && o.userMessageBox !== null && typeof(o.userMessageBox.message) != "undefined" && o.userMessageBox.message !== null) ? o.userMessageBox.message : "")));
	c.push("</p>\n </div>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_bf3filters = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bf3filters'));
serverbrowserwarsaw.bf3filters.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bf3filters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bf3filters');
	var l_forceExpandedFilter;
	c.push("\n");
	l_forceExpandedFilter = S.Modifier.get(Surface.globalContext, "forceExpandedFilter");
	c.push("\n");
	if ((S.compat.gt(S.Modifier.count(o.servers), 0) && S.compat.neq(l_forceExpandedFilter, 1))) {
		o.showFilters = 0;
	}
	else {
		o.showFilters = 1;
	}
	c.push("<input type=\"hidden\" id=\"serverbrowser-autobrowse-url\"\n value=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/getAutoBrowseServers/{platform}/", Surface.urlContext, {"platform": o.platform})));
	c.push("\" />\n<input type=\"hidden\" id=\"serverbrowser-show-url\"\n value=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": "%GUID%", "platform": o.platform})));
	c.push("?json=1\" />\n<form id=\"serverbrowser-filter-form\"\n ");
	if (!(o.showFilters)) {
		c.push("class=\"serverbrowser-filter-form-contracted\"");
	}
	c.push(" method=\"GET\"\n action=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platform})));
	c.push("\">\n<input type=\"hidden\" name=\"filtered\" value=\"1\" />\n<input type=\"hidden\" name=\"expand\" value=\"");
	c.push(Surface.valOut(o.showFilters));
	c.push("\" />\n");
	c.push(Surface.importTemplate(("common" + ("." + "focusbar")), o, block_serverbrowserwarsaw_bf3filters_use_21_5, kwargs));
	c.push("\n</form>");
	return c.join('');
}
;
var block_serverbrowserwarsaw_bf3filters_use_21_5 = new Surface.BlockConfig('common.focusbar', {'content': 'serverbrowserwarsaw.bf3filters._use_21_5_block_content', 'extraInnerClass': 'serverbrowserwarsaw.bf3filters._use_21_5_block_extraInnerClass', 'extraClass': 'serverbrowserwarsaw.bf3filters._use_21_5_block_extraClass'});
serverbrowserwarsaw.bf3filters._use_21_5_block_extraClass = new Surface.Block('serverbrowserwarsaw.bf3filters._use_21_5_block_extraClass');
serverbrowserwarsaw.bf3filters._use_21_5_block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverbrowser-filter-width");
	return c.join("");
}
;
serverbrowserwarsaw.bf3filters._use_21_5_block_extraInnerClass = new Surface.Block('serverbrowserwarsaw.bf3filters._use_21_5_block_extraInnerClass');
serverbrowserwarsaw.bf3filters._use_21_5_block_extraInnerClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverbrowser-filter-inner");
	return c.join("");
}
;
serverbrowserwarsaw.bf3filters.surface_32_17 = new Surface.SingleSurface("serverbrowserwarsaw.bf3filters.surface_32_17");
serverbrowserwarsaw.bf3filters.surface_32_17.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bf3filters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bf3filters');
	c.push("<surf:container id=\"serverbrowser-filterstring\"");
	c.push(">");
	var l_defaultServerBrowserFilter;
	l_defaultServerBrowserFilter = S.Modifier.get(Surface.globalContext, "defaultServerBrowserFilter");
	c.push("\n <div class=\"serverbrowser-filterlist-generic\">\n <div id=\"custom-filter-list\">\n <em>");
	c.push(Surface.valOut("サーバー検索"));
	c.push(" :</em>\n <div id=\"custom-filter-list-content\"></div>\n <a class=\"serverbrowser-reset-filter-button\"\n href=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/clearFilter/{platform}/", Surface.urlContext, {"platform": o.platform})));
	c.push("\"\n ");
	if (((typeof(l_defaultServerBrowserFilter) != "undefined" && l_defaultServerBrowserFilter !== null) ? l_defaultServerBrowserFilter : false)) {
		c.push("style=\"display:none;\" ");
	}
	c.push(">\n ");
	c.push(Surface.valOut("フィルターのリセット"));
	c.push("\n </a>\n </div>\n </div>\n <span class=\"serverbrowser-toggler\"></span>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bf3filters", "surface_32_17", "serverbrowser-filterstring", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.bf3filters._use_21_5_block_content = new Surface.Block('serverbrowserwarsaw.bf3filters._use_21_5_block_content');
serverbrowserwarsaw.bf3filters._use_21_5_block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_serverFilterOptions;
	c.push("\n");
	l_serverFilterOptions = $S.callFunction("gamedata.get", 2, "gameserver", b, kwargs);
	c.push("\n <div id=\"serverbrowser-filtertoggle\" class=\"serverbrowser-filtertoggle-");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilters) != "undefined" && o.showFilters !== null) ? o.showFilters : 1)) {
		c.push("expanded");
	}
	else {
		c.push("contracted");
	}
	c.push("\">\n");
	c.push(serverbrowserwarsaw.bf3filters.surface_32_17.render({"defaultServerBrowserFilter": ((typeof(o) != "undefined" && o !== null && typeof(o.defaultServerBrowserFilter) != "undefined" && o.defaultServerBrowserFilter !== null) ? o.defaultServerBrowserFilter : null), "platform": ((typeof(o) != "undefined" && o !== null && typeof(o.platform) != "undefined" && o.platform !== null) ? o.platform : null)}, b, kwargs));
	c.push(" <div class=\"serverbrowser-header-refresh-button\">\n ");
	c.push(Surface.importTemplate(("common" + ("." + "button")), {"title": "フィルターの更新と保存", "type": "submit", "style": "medium-grey", "extraClass": "serverbrowser-apply-filter-button"}, null, kwargs));
	c.push("\n </div>\n </div>\n <div id=\"serverbrowser-filters-container\">\n <div id=\"serverbrowser-filters\" ");
	if (!(o.showFilters)) {
		c.push("style=\"display:none;\"");
	}
	c.push(">\n <div class=\"filter-col span1\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergameexpansion")), {"gameexpansions": S.Modifier.get(l_serverFilterOptions, "gameexpansions"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterregion")), {"regions": S.Modifier.get(l_serverFilterOptions, "regions"), "platform": o.platform, "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterfreetext")), o, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1\">\n <!-- float: left; width:184px; padding-left: 16px; background: #ffc; -->\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterpresets")), {"gamepresets": S.Modifier.get(l_serverFilterOptions, "gamepresets"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterdetails")), {"gamedetails": S.Modifier.get(l_serverFilterOptions, "gamedetails"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteradvanced")), {"filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1 pull1\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamesize")), {"gamesize": S.Modifier.get(l_serverFilterOptions, "gamesize"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergameslots")), {"gameslots": S.Modifier.get(l_serverFilterOptions, "gameslots"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span2 push1\">\n <!-- style=\"float: left; width:374px; padding-left: 16px; background: #cff;\" -->\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamemode")), {"gamemodes": S.Modifier.get(l_serverFilterOptions, "gamemodes"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtermaps")), {"maps": S.Modifier.get(l_serverFilterOptions, "maps"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n </div>\n <input type=\"hidden\" name=\"settings\" id=\"serverbrowser-filter-settings-input\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.settings) != "undefined" && o.filter.settings !== null) ? o.filter.settings : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"regions\" id=\"serverbrowser-filter-regions-input\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.regions) != "undefined" && o.filter.regions !== null) ? o.filter.regions : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"country\" id=\"serverbrowser-filter-countries-input\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.country) != "undefined" && o.filter.country !== null) ? o.filter.country : []), "|")));
	c.push("\" />\n <div id=\"serverbrowser-apply-filters\" ");
	if (!(o.showFilters)) {
		c.push("style=\"display:none;\"");
	}
	c.push(">\n ");
	c.push(Surface.importTemplate(("common" + ("." + "button")), {"title": "フィルターの更新と保存", "type": "submit", "style": "medium-grey", "extraClass": "serverbrowser-apply-filter-button"}, null, kwargs));
	c.push("\n <div id=\"serverbrowser-filter-count\">\n ");
	c.push(Surface.valOut("見つかりました"));
	c.push(" <span class=\"serverbrowser-filter-count-amount\">1337</span> ");
	c.push(Surface.valOut("サーバー"));
	c.push("\n </div>\n <div id=\"serverbrowser-filter-saved\">");
	c.push(Surface.valOut("フィルターをセーブしました！"));
	c.push("</div>\n </div>\n ");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_bf3index = new Surface.BlockConfig('serverbrowserwarsaw.index', {'settings': 'serverbrowserwarsaw.bf3index.block_settings', 'filters': 'serverbrowserwarsaw.bf3index.block_filters'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bf3index'));
serverbrowserwarsaw.bf3index.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bf3index;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bf3index');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.index', o, b, kwargs);
}
;
serverbrowserwarsaw.bf3index.block_filters = new Surface.Block('serverbrowserwarsaw.bf3index.block_filters');
serverbrowserwarsaw.bf3index.block_filters.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilter) != "undefined" && o.showFilter !== null) ? o.showFilter : true)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "bf3filters")), o, null, kwargs));
		c.push("\n");
	}
	else {
		c.push(" <div style=\"position: relative;clear:both;padding:16px 0\">\n <a href=\"");
		c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
		c.push("\"\n style=\"font-weight:normal; font-size:12px;\" >\n ");
		c.push(Surface.valOut("全サーバーを表示"));
		c.push("\n </a>\n </div>\n");
	}
	return c.join("");
}
;
serverbrowserwarsaw.bf3index.block_settings = new Surface.Block('serverbrowserwarsaw.bf3index.block_settings');
serverbrowserwarsaw.bf3index.block_settings.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "bf3serverinfo")), o, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_bf3serverinfo = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bf3serverinfo'));
serverbrowserwarsaw.bf3serverinfo.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bf3serverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bf3serverinfo');
	c.push("\n<div id=\"serverbrowser-show-column-rail\" class=\"base-secondary-right-column\">\n<div id=\"serverbrowser-show-column\">\n");
	c.push(serverbrowserwarsaw.bf3serverinfo.surface_4_2.render({"favGuids": ((typeof(o) != "undefined" && o !== null && typeof(o.favGuids) != "undefined" && o.favGuids !== null) ? o.favGuids : null), "friends": ((typeof(o) != "undefined" && o !== null && typeof(o.friends) != "undefined" && o.friends !== null) ? o.friends : null), "loading": ((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : null), "platformString": ((typeof(o) != "undefined" && o !== null && typeof(o.platformString) != "undefined" && o.platformString !== null) ? o.platformString : null), "players": ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : null), "serverinfo": ((typeof(o) != "undefined" && o !== null && typeof(o.serverinfo) != "undefined" && o.serverinfo !== null) ? o.serverinfo : null), "session": {"isLoggedIn": ((typeof(o) != "undefined" && o !== null && typeof(o.session) != "undefined" && o.session !== null && typeof(o.session.isLoggedIn) != "undefined" && o.session.isLoggedIn !== null) ? o.session.isLoggedIn : null)}, "soldierSlotsCurrent": ((typeof(o) != "undefined" && o !== null && typeof(o.soldierSlotsCurrent) != "undefined" && o.soldierSlotsCurrent !== null) ? o.soldierSlotsCurrent : null), "soldierSlotsMax": ((typeof(o) != "undefined" && o !== null && typeof(o.soldierSlotsMax) != "undefined" && o.soldierSlotsMax !== null) ? o.soldierSlotsMax : null)}, b, kwargs));
	c.push("\n</div>\n</div>\n");
	return c.join('');
}
;
var block_serverbrowserwarsaw_bf3serverinfo_use_138_22 = new Surface.BlockConfig('common.secondarycontent', {'content': 'serverbrowserwarsaw.bf3serverinfo._use_138_22_block_content', 'title': 'serverbrowserwarsaw.bf3serverinfo._use_138_22_block_title', 'extraClass': 'serverbrowserwarsaw.bf3serverinfo._use_138_22_block_extraClass'});
var block_serverbrowserwarsaw_bf3serverinfo_use_110_22 = new Surface.BlockConfig('common.secondarycontent', {'content': 'serverbrowserwarsaw.bf3serverinfo._use_110_22_block_content', 'title': 'serverbrowserwarsaw.bf3serverinfo._use_110_22_block_title', 'extraClass': 'serverbrowserwarsaw.bf3serverinfo._use_110_22_block_extraClass'});
serverbrowserwarsaw.bf3serverinfo.surface_4_2 = new Surface.SingleSurface("serverbrowserwarsaw.bf3serverinfo.surface_4_2");
serverbrowserwarsaw.bf3serverinfo._use_110_22_block_extraClass = new Surface.Block('serverbrowserwarsaw.bf3serverinfo._use_110_22_block_extraClass');
serverbrowserwarsaw.bf3serverinfo._use_110_22_block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverinfo-players-box");
	return c.join("");
}
;
serverbrowserwarsaw.bf3serverinfo._use_110_22_block_title = new Surface.Block('serverbrowserwarsaw.bf3serverinfo._use_110_22_block_title');
serverbrowserwarsaw.bf3serverinfo._use_110_22_block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut(S.Modifier.count(o.friends)));
	c.push(" ");
	c.push(Surface.valOut(S.Modifier.pluralize(S.Modifier.count(o.friends), "フレンド", "フレンド")));
	return c.join("");
}
;
serverbrowserwarsaw.bf3serverinfo._use_110_22_block_content = new Surface.Block('serverbrowserwarsaw.bf3serverinfo._use_110_22_block_content');
serverbrowserwarsaw.bf3serverinfo._use_110_22_block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_for_serverbrowserwarsaw_bf3serverinfo_117_30_iteration;
	var l_for_serverbrowserwarsaw_bf3serverinfo_117_30_isEven;
	var l_for_serverbrowserwarsaw_bf3serverinfo_117_30_isOdd;
	var l_for_serverbrowserwarsaw_bf3serverinfo_117_30_list;
	l_for_serverbrowserwarsaw_bf3serverinfo_117_30_list = o.friends;
	l_for_serverbrowserwarsaw_bf3serverinfo_117_30_iteration = 0;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bf3serverinfo_117_30_list), 0)) {
		for (var l_for_serverbrowserwarsaw_bf3serverinfo_117_30_key in l_for_serverbrowserwarsaw_bf3serverinfo_117_30_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bf3serverinfo_117_30_list[l_for_serverbrowserwarsaw_bf3serverinfo_117_30_key])) {
				continue;
			}
			var l_friend = l_for_serverbrowserwarsaw_bf3serverinfo_117_30_list[l_for_serverbrowserwarsaw_bf3serverinfo_117_30_key];
			l_for_serverbrowserwarsaw_bf3serverinfo_117_30_iteration = S.compat.add(l_for_serverbrowserwarsaw_bf3serverinfo_117_30_iteration, 1);
			l_for_serverbrowserwarsaw_bf3serverinfo_117_30_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_bf3serverinfo_117_30_iteration, 2), 0);
			l_for_serverbrowserwarsaw_bf3serverinfo_117_30_isOdd = !(l_for_serverbrowserwarsaw_bf3serverinfo_117_30_isEven);
			c.push(" <div class=\"serverbrowser-show-playerrow serverbrowser-show-friendrow\">\n <span ");
			if (l_for_serverbrowserwarsaw_bf3serverinfo_117_30_isOdd) {
				c.push("class=\"serverbrowser-show-player-odd\"");
			}
			c.push(">\n ");
			c.push(Surface.importTemplate(("ui" + ("." + "avatar")), {"user": l_friend, "size": 22}, null, kwargs));
			c.push("\n <div class=\"serverbrowser-show-player\">\n <div class=\"serverbrowser-show-playerlink-container\">\n <a class=\"serverbrowser-show-playerlink\" href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/user/{username}/", Surface.urlContext, {"username": l_friend.username})));
			c.push("\">");
			c.push(Surface.valOut(l_friend.username));
			c.push("</a>\n </div>\n </div>\n </span>\n </div>\n");
		}
	}
	c.push(" <div class=\"clear\"></div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.bf3serverinfo._use_138_22_block_extraClass = new Surface.Block('serverbrowserwarsaw.bf3serverinfo._use_138_22_block_extraClass');
serverbrowserwarsaw.bf3serverinfo._use_138_22_block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverinfo-players-box");
	return c.join("");
}
;
serverbrowserwarsaw.bf3serverinfo._use_138_22_block_title = new Surface.Block('serverbrowserwarsaw.bf3serverinfo._use_138_22_block_title');
serverbrowserwarsaw.bf3serverinfo._use_138_22_block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.bf3serverinfo._use_138_22_block_content = new Surface.Block('serverbrowserwarsaw.bf3serverinfo._use_138_22_block_content');
serverbrowserwarsaw.bf3serverinfo._use_138_22_block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_soldierSlots;
	l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.serverinfo, 2, b, kwargs);
	c.push(" <div id=\"serverinfo-players-all-wrapper\"></div>\n <div id=\"serverinfo-players-all-view\" class=\"base-link\" data-numPlayers=\"");
	c.push(Surface.valOut(l_soldierSlots.current));
	c.push("\" data=\"");
	c.push(Surface.valOut(o.serverinfo.guid));
	c.push("\">");
	c.push(Surface.valOut("表示"));
	c.push(" ");
	c.push(Surface.valOut(S.Modifier.pluralize(o.soldierSlotsCurrent, "プレイヤー", "全プレイヤー")));
	c.push("</div>\n <div id=\"serverinfo-players-all-hide\" class=\"base-link\">");
	c.push(Surface.valOut("非表示"));
	c.push(" ");
	c.push(Surface.valOut(S.Modifier.pluralize(l_soldierSlots.current, "プレイヤー", "全プレイヤー")));
	c.push("</div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.bf3serverinfo.surface_4_2.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bf3serverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bf3serverinfo');
	c.push("<surf:container id=\"serverbrowser-show\"");
	c.push(">");
	var l_url;
	var l_favGuids;
	var l_soldierSlots;
	var l_isFavorite;
	var l_session;
	var l_mapname;
	var l_mapinfo;
	o.players = o.players;
	c.push("\n <div class=\"serverbrowser-");
	if (!(((typeof(o) != "undefined" && o !== null && typeof(o.serverinfo) != "undefined" && o.serverinfo !== null && typeof(o.serverinfo.online) != "undefined" && o.serverinfo.online !== null) ? o.serverinfo.online : false))) {
		c.push("offline");
	}
	else {
		c.push("online");
	}
	c.push("-info\">\n");
	l_session = S.Modifier.get(Surface.globalContext, "session");
	l_favGuids = S.Modifier.get(Surface.globalContext, "favGuids");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : false)) {
		c.push(" <div class=\"loading\"></div>\n");
	}
	else {
		if ((typeof(o) != "undefined" && o !== null && typeof(o.serverinfo) != "undefined" && o.serverinfo !== null)) {
			l_isFavorite = S.Modifier.contains(l_favGuids, S.Modifier.get(o.serverinfo, "guid", ""));
			l_mapinfo = $S.callFunction("serverbrowserwarsaw.mapinfo", o.serverinfo.game, o.serverinfo.map, b, kwargs);
			l_mapname = S.Modifier.get(l_mapinfo, "name");
			c.push("\n");
			l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.serverinfo, 2, b, kwargs);
			c.push("\n <span class=\"");
			c.push(Surface.valOut($S.callFunction("common.getGameIconCSS", o.serverinfo.game, o.serverinfo.platform, o.serverinfo.gameExpansions, b, kwargs)));
			c.push("\"></span>\n <h1 id=\"selected-server-name\" class=\"wfont\">\n");
			l_url = S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": o.serverinfo.guid, "platform": o.platformString, "slug": S.Modifier.slugify(o.serverinfo.name)});
			c.push("\n <a href=\"");
			c.push(Surface.valOut(l_url));
			c.push("\">\n ");
			c.push(Surface.valOut(o.serverinfo.name));
			c.push("\n </a>\n </h1>\n <div class=\"clear\"></div>\n");
			if (o.serverinfo.online) {
				c.push(" <div id=\"serverbrowser-show-serverjoin\">\n <a href=\"");
				c.push(Surface.valOut($S.callFunction("common.showServerUrlByServer", o.serverinfo, b, kwargs)));
				c.push("\"\n class=\"base-button-arrow-almost-gigantic\n ");
				if (!($S.callFunction("serverguide.enableJoinButton", o.serverinfo, b, kwargs))) {
					c.push(" disabled");
				}
				c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-role=\"");
				c.push(Surface.valOut(1));
				c.push("\"\n data-guid=\"");
				c.push(Surface.valOut(o.serverinfo.guid));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(o.serverinfo.game));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(o.serverinfo.platform));
				c.push("\"\n data-gameid=\"");
				c.push(Surface.valOut(o.serverinfo.gameId));
				c.push("\"\n data-ip=\"");
				c.push(Surface.valOut(o.serverinfo.ip));
				c.push("\"\n data-port=\"");
				c.push(Surface.valOut(o.serverinfo.port));
				c.push("\"\n data-track=\"serverbrowser.server.selected.join\">\n ");
				c.push(Surface.valOut("サーバーに参加"));
				c.push("\n </a>\n <div class=\"base-clear\"></div>\n </div>\n <input type=\"text\" class=\"serverbrowser-server-link-field base-no-ajax\" value=\"");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.showAbsoluteServerUrl", o.serverinfo.guid, o.serverinfo.name, b, kwargs)));
				c.push("\" />\n <div class=\"clear\"></div>\n <div id=\"selected-server-mapimage\">\n <img src=\"");
				c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.get(l_mapinfo, "imageBig"), b, kwargs)));
				c.push("\" alt=\"");
				c.push(Surface.valOut(S.Modifier.get(l_mapinfo, "name")));
				c.push("\" width=146 height=79 />\n </div>\n <div class=\"selected-server-info-wrapper\">\n");
				if (((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false)) {
					c.push(" <div class=\"serverbrowser-add-favorite\">\n");
					l_url = S.Modifier.urlformat("/{_section}/{_language}/gameserverbookmark/toggleFavourite/", Surface.urlContext, {"platform": o.platformString});
					c.push(" <form action=\"");
					c.push(Surface.valOut(l_url));
					c.push("\">\n <input type=\"hidden\" name=\"guid\" value=\"");
					c.push(Surface.valOut(o.serverinfo.guid));
					c.push("\" />\n </form>\n <div class=\"serverbrowser-add-favorite-toggle ");
					if (l_isFavorite) {
						c.push("isFavorite");
					}
					c.push("\" ><span>");
					if (l_isFavorite) {
						c.push(Surface.valOut("お気に入り"));
					}
					else {
						c.push(Surface.valOut("お気に入りに追加"));
					}
					c.push("</span></div>\n <div class=\"serverbrowser-add-favorite-loading\">\n <img width=\"16\" height=\"16\" src=\"");
					c.push(Surface.valOut($S.callFunction("base.asset", "/public/base/shared/ajax-loader.gif", b, kwargs)));
					c.push("\" alt=\"");
					c.push(Surface.valOut("ロード中…"));
					c.push("\" />\n </div>\n </div>\n <div class=\"base-clear\"></div>\n");
				}
				c.push("\n <ul id=\"selected-server-info\">\n <li>");
				c.push(Surface.valOut(o.soldierSlotsCurrent));
				c.push(" / ");
				c.push(Surface.valOut(o.soldierSlotsMax));
				c.push(" ");
				c.push(Surface.valOut("プレイヤー"));
				c.push("</li>\n <li>");
				c.push(Surface.valOut((S.translations[l_mapname] || l_mapname)));
				c.push("</li>\n <li>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", o.serverinfo.mapMode, o.serverinfo.game, b, kwargs)));
				c.push("</li>\n </ul>\n </div>\n <div class=\"clear\"></div>\n");
				if (Surface.globalContext.staticContext.checkPlugin) {
					l_url = S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": o.serverinfo.guid, "platform": o.platformString, "slug": S.Modifier.slugify(o.serverinfo.name)});
					c.push("\n <a id=\"serverinfoscore-link\" href=\"");
					c.push(Surface.valOut(l_url));
					c.push("\">\n ");
					c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverinfoscore")), o, null, kwargs));
					c.push("\n </a>\n ");
				}
				c.push("\n <div class=\"clear\"></div>\n <div id=\"serverinfo-more-info\">\n <div id=\"selected-server-settings\">\n <h2>");
				c.push(Surface.valOut("サーバー設定"));
				c.push("</h2>\n <ul id=\"server-settings\">\n <li>");
				c.push(Surface.valOut("ランク"));
				c.push("<span class=\"selected-server-setting selected-server-setting-ranked selected-server-setting-ranked-");
				if (o.serverinfo.ranked) {
					c.push("on");
				}
				else {
					c.push("off");
				}
				c.push("\">");
				if (o.serverinfo.ranked) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</span></li>\n <li>");
				c.push(Surface.valOut("プリセット"));
				c.push("<span class=\"selected-server-setting selected-server-setting-type selected-server-setting-type-");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringNoLocalization", o.serverinfo.preset, b, kwargs)));
				c.push("\">");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", o.serverinfo.preset, b, kwargs)));
				c.push("</span></li>\n <li>Punkbuster<span class=\"selected-server-setting selected-server-setting-pb selected-server-setting-pb-");
				if (o.serverinfo.punkbuster) {
					c.push("on");
				}
				else {
					c.push("off");
				}
				c.push("\">");
				if (o.serverinfo.punkbuster) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</span></li>\n <li>");
				c.push(Surface.valOut("パスワード"));
				c.push("<span class=\"selected-server-setting selected-server-setting-password selected-server-setting-password-");
				if (o.serverinfo.hasPassword) {
					c.push("on");
				}
				else {
					c.push("off");
				}
				c.push("\">");
				if (o.serverinfo.hasPassword) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</span></li>\n </ul>\n </div>\n </div>\n <div class=\"clear\"></div>\n");
				if ((S.compat.gt(S.Modifier.count(o.friends), 0) && ((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false))) {
					c.push(Surface.importTemplate(("common" + ("." + "secondarycontent")), o, block_serverbrowserwarsaw_bf3serverinfo_use_110_22, kwargs));
				}
				c.push("\n");
				if (S.compat.gt(l_soldierSlots.current, 0)) {
					c.push(" <div class=\"clear\"></div>\n");
					c.push(Surface.importTemplate(("common" + ("." + "secondarycontent")), o, block_serverbrowserwarsaw_bf3serverinfo_use_138_22, kwargs));
				}
				c.push("\n <div class=\"clear\"></div>\n");
			}
			else {
				c.push(" <div class=\"common-secondary-column-line\"></div>\n <h1 id=\"serverinfo-serveroffline\">");
				c.push(Surface.valOut("サーバーはオフラインです"));
				c.push("</h1>\n");
				c.push(" <div class=\"common-secondary-column-line\"></div>\n");
			}
			c.push(" ");
		}
		c.push("\n");
	}
	c.push("\n </div>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bf3serverinfo", "surface_4_2", "serverbrowser-show", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_bf3show = new Surface.BlockConfig('serverbrowserwarsaw.show', {'mapRotation': 'serverbrowserwarsaw.bf3show.block_mapRotation', 'settings': 'serverbrowserwarsaw.bf3show.block_settings', 'shortInfo': 'serverbrowserwarsaw.bf3show.block_shortInfo', 'scoreBoard': 'serverbrowserwarsaw.bf3show.block_scoreBoard', 'header': 'serverbrowserwarsaw.bf3show.block_header'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bf3show'));
serverbrowserwarsaw.bf3show.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bf3show;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bf3show');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.show', o, b, kwargs);
}
;
serverbrowserwarsaw.bf3show.block_header = new Surface.Block('serverbrowserwarsaw.bf3show.block_header');
serverbrowserwarsaw.bf3show.block_header.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "showserverheader")), {"server": o.server}, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.bf3show.surface_25_35 = new Surface.SingleSurface("serverbrowserwarsaw.bf3show.surface_25_35");
serverbrowserwarsaw.bf3show.surface_25_35.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bf3show;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bf3show');
	c.push("<surf:container id=\"serverbrowser-show-info-ping\"");
	c.push(">");
	c.push(Surface.valOut(o.server.ping));
	c.push(" ms");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bf3show", "surface_25_35", "serverbrowser-show-info-ping", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.bf3show.block_shortInfo = new Surface.Block('serverbrowserwarsaw.bf3show.block_shortInfo');
serverbrowserwarsaw.bf3show.block_shortInfo.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_soldierSlots;
	var l_queueSlots;
	c.push(" <table id=\"server-info-short\">\n <thead>\n <tr>\n <th>");
	c.push(Surface.valOut("プレイヤー"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("PING"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("ランク"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("プリセット"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("Punkbuster"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("パスワード"));
	c.push("</th>\n </tr>\n </thead>\n <tbody>\n <tr>\n");
	l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
	l_queueSlots = $S.callFunction("serverguide.getServerSlots", o.server, 1, b, kwargs);
	c.push(" <td id=\"server-info-players\">");
	c.push(Surface.valOut(l_soldierSlots.current));
	c.push(" / ");
	c.push(Surface.valOut(l_soldierSlots.max));
	if (S.compat.gt(l_queueSlots.current, 0)) {
		c.push(" [<abbr title=\"");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push(" ");
		c.push(Surface.valOut("人待ち"));
		c.push("\">");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push("</abbr>]");
	}
	c.push("</td>\n <td id=\"server-info-ping\">");
	c.push(serverbrowserwarsaw.bf3show.surface_25_35.render({"server": {"ping": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.ping) != "undefined" && o.server.ping !== null) ? o.server.ping : null)}}, b, kwargs));
	c.push("</td>\n <td id=\"server-info-ranked\" ");
	if (!(o.server.ranked)) {
		c.push("class=\"server-info-off\"");
	}
	c.push(">");
	if (o.server.ranked) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n <td id=\"server-info-preset\"");
	if (S.compat.neq(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 0), 2)) {
		c.push(" class=\"server-info-off\"");
	}
	c.push(">");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 1), b, kwargs)));
	c.push("</td>\n <td id=\"server-info-punkbuster\"");
	if (!(o.server.punkbuster)) {
		c.push(" class=\"server-info-off\"");
	}
	c.push(">");
	if (o.server.punkbuster) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n <td id=\"server-info-password\" class=\"last");
	if (!(o.server.hasPassword)) {
		c.push(" server-info-off");
	}
	c.push("\">");
	if (o.server.hasPassword) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n </tr>\n </tbody>\n</table>\n");
	return c.join("");
}
;
serverbrowserwarsaw.bf3show.block_settings = new Surface.Block('serverbrowserwarsaw.bf3show.block_settings');
serverbrowserwarsaw.bf3show.block_settings.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serversettings")), {"server": o.server}, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.bf3show.block_mapRotation = new Surface.Block('serverbrowserwarsaw.bf3show.block_mapRotation');
serverbrowserwarsaw.bf3show.block_mapRotation.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "maprotation")), {"server": o.server}, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.bf3show.block_scoreBoard = new Surface.Block('serverbrowserwarsaw.bf3show.block_scoreBoard');
serverbrowserwarsaw.bf3show.block_scoreBoard.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" <div id=\"server-players-list\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "scoreboard")), {"server": o.server}, null, kwargs));
	c.push("\n </div>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_bfhfilters = new Surface.BlockConfig('', {'content': 'serverbrowserwarsaw.bfhfilters.block_content'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bfhfilters'));
serverbrowserwarsaw.bfhfilters.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhfilters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhfilters');
	var l_forceExpandedFilter;
	c.push("\n");
	l_forceExpandedFilter = S.Modifier.get(Surface.globalContext, "forceExpandedFilter");
	c.push("\n");
	if (S.compat.neq(l_forceExpandedFilter, 1)) {
		o.showFilters = 0;
	}
	else {
		o.showFilters = 1;
	}
	c.push("\n<form id=\"serverbrowser-filters\" class=\"box box-primary spacing-top ");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilters) != "undefined" && o.showFilters !== null) ? o.showFilters : false)) {
		c.push("\nexpanded");
	}
	c.push("\" method=\"GET\"\n action=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
	c.push("\">\n <input type=\"hidden\" name=\"filtered\" value=\"1\" />\n <input type=\"hidden\" name=\"expand\" value=\"");
	c.push(Surface.valOut(o.showFilters));
	c.push("\" id=\"serverbrowser-filter-expanded\" />\n");
	c.push(b.get('content')(o, b, kwargs));
	c.push("\n</form>");
	return c.join('');
}
;
serverbrowserwarsaw.bfhfilters.surface_46_17 = new Surface.SingleSurface("serverbrowserwarsaw.bfhfilters.surface_46_17");
serverbrowserwarsaw.bfhfilters.surface_46_17.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhfilters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhfilters');
	c.push("<surf:container id=\"serverbrowser-filterstring\"");
	c.push(">");
	c.push(" <em>");
	c.push(Surface.valOut("サーバー検索"));
	c.push(" :</em>\n <span id=\"custom-filter-list-content\"></span>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bfhfilters", "surface_46_17", "serverbrowser-filterstring", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.bfhfilters.block_content = new Surface.Block('serverbrowserwarsaw.bfhfilters.block_content');
serverbrowserwarsaw.bfhfilters.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_xpack;
	var l_for_serverbrowserwarsaw_bfhfilters_39_13_list;
	var l_for_serverbrowserwarsaw_bfhfilters_110_17_list;
	var l_xpackMaps;
	var l_allMaps;
	var l_maps;
	var l_allowedGameModes;
	var l_serverFilterOptions;
	var l_for_serverbrowserwarsaw_bfhfilters_110_17_iteration;
	var l_sizes;
	c.push(" <input type=\"hidden\"\n name=\"settings\"\n id=\"serverbrowser-filter-settings-input\"\n value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.settings) != "undefined" && o.filter.settings !== null) ? o.filter.settings : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"useLocation\" id=\"serverbrowser-filter-use-location\" value=\"1\" />\n <input type=\"hidden\"\n name=\"useAdvanced\"\n id=\"serverbrowser-filter-settings-use-advanced\"\n value=\"");
	c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.useAdvanced) != "undefined" && o.filter.useAdvanced !== null) ? o.filter.useAdvanced : -1)));
	c.push("\" />\n <header class=\"serverbrowser-refresh serverbrowser-apply-filter-button\">&#8635;</header>\n <header class=\"toggle swipe-glow swipe-slow\"\n");
	if (((typeof(S.Modifier.get(S.Modifier.get(Surface.globalContext.session, "npxExploration", {}), "serverfilters")) != "undefined" && S.Modifier.get(S.Modifier.get(Surface.globalContext.session, "npxExploration", {}), "serverfilters") !== null) && S.compat.eq(S.Modifier.get(S.Modifier.get(Surface.globalContext.session, "npxExploration"), "serverfilters"), false))) {
		c.push("\n data-bind-toggle=\"npx-exploration\" data-feature=\"serverfilters\"\n ");
	}
	c.push(">\n");
	l_serverFilterOptions = $S.callFunction("gamedata.get", 8192, "gameserver", b, kwargs);
	l_allMaps = S.Modifier.get(l_serverFilterOptions, "maps");
	l_maps = {};
	l_for_serverbrowserwarsaw_bfhfilters_39_13_list = l_allMaps;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhfilters_39_13_list), 0)) {
		for (var l_for_serverbrowserwarsaw_bfhfilters_39_13_key in l_for_serverbrowserwarsaw_bfhfilters_39_13_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhfilters_39_13_list[l_for_serverbrowserwarsaw_bfhfilters_39_13_key])) {
				continue;
			}
			var l_map = l_for_serverbrowserwarsaw_bfhfilters_39_13_list[l_for_serverbrowserwarsaw_bfhfilters_39_13_key];
			l_xpack = $S.callFunction("common.getXpackFromGameExpansion", l_map.gameExpansion, b, kwargs);
			l_xpackMaps = ((typeof(S.Modifier.get(l_maps, l_xpack)) != "undefined" && S.Modifier.get(l_maps, l_xpack) !== null) ? S.Modifier.get(l_maps, l_xpack) : []);
			l_xpackMaps = S.Modifier.append(l_xpackMaps, l_map);
			l_maps = S.Modifier.set(l_maps, l_xpack, l_xpackMaps);
		}
	}
	c.push(" <div class=\"serverbrowser-filterstring arrow-container\">\n");
	c.push(serverbrowserwarsaw.bfhfilters.surface_46_17.render({}, b, kwargs));
	c.push("\n <div class=\"outerarrow\">\n <div class=\"arrow\"></div>\n </div>\n </div>\n </header>\n <div class=\"filters-container\">\n <div class=\"row-tight spacing-top-tight\">\n <div class=\"filter-col span1-04 box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtermaps")), {"platform": o.platform, "maps": S.Modifier.get(l_maps, "core"), "filter": o.filter, "index": 0}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box-content\">\n");
	l_allowedGameModes = S.Modifier.get(l_serverFilterOptions, "gamemodes");
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamemode")), {"platform": o.platform, "gamemodes": l_allowedGameModes, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box-content\">\n");
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergameslots")), {"gameslots": S.Modifier.get(l_serverFilterOptions, "gameslots"), "commanderSlots": S.Modifier.get(l_serverFilterOptions, "commanderGameslots"), "spectatorSlots": S.Modifier.get(l_serverFilterOptions, "spectatorGameslots"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box-content\">\n");
	l_sizes = S.Modifier.get(l_serverFilterOptions, "gamesize");
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamesize")), {"gamesize": l_sizes, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterfreetext")), o, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterservertype")), {"serverTypeFilter": S.Modifier.get(l_serverFilterOptions, "serverTypeFilter"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtertickrate")), {"tickRates": S.Modifier.get(l_serverFilterOptions, "tickRates"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n <div class=\"row-tight spacing-top-tight\">\n");
	l_for_serverbrowserwarsaw_bfhfilters_110_17_list = ["bfhxp1", "bfhxp2", "bfhxp3", "bfhxp4"];
	l_for_serverbrowserwarsaw_bfhfilters_110_17_iteration = 0;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhfilters_110_17_list), 0)) {
		for (var l_for_serverbrowserwarsaw_bfhfilters_110_17_key in l_for_serverbrowserwarsaw_bfhfilters_110_17_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhfilters_110_17_list[l_for_serverbrowserwarsaw_bfhfilters_110_17_key])) {
				continue;
			}
			var l_xpack = l_for_serverbrowserwarsaw_bfhfilters_110_17_list[l_for_serverbrowserwarsaw_bfhfilters_110_17_key];
			l_for_serverbrowserwarsaw_bfhfilters_110_17_iteration = S.compat.add(l_for_serverbrowserwarsaw_bfhfilters_110_17_iteration, 1);
			c.push(" <div class=\"filter-col span1-05 box-content\">\n");
			if (S.Modifier.get(l_maps, l_xpack)) {
				c.push(" ");
				c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtermaps")), {"platform": o.platform, "maps": S.Modifier.get(l_maps, l_xpack), "filter": o.filter, "xpack": l_xpack, "index": l_for_serverbrowserwarsaw_bfhfilters_110_17_iteration}, null, kwargs));
				c.push("\n");
			}
			c.push("\n </div>\n ");
		}
	}
	c.push("\n </div>\n <div class=\"row-tight spacing-top-tight advanced-filters\">\n <div class=\"filter-col span1-04\">\n <div class=\"box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterpresets")), {"gamepresets": S.Modifier.get(l_serverFilterOptions, "gamepresets"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterextra")), {"filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n <div class=\"filter-col span1-04 box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterregion")), {"regions": S.Modifier.get(l_serverFilterOptions, "regions"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteradvanced")), {"advancedsettings": S.Modifier.get(l_serverFilterOptions, "advancedsettings"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span2 filter-player-settings\">\n <div class=\"box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterplayersettings")), {"playersettings": S.Modifier.get(l_serverFilterOptions, "playersettings"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterrules")), {"rules": S.Modifier.get(l_serverFilterOptions, "rules"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n </div>\n <div class=\"box box-content button-row spacing-top-tight\">\n <button type=\"button\" class=\"btn btn-small btn-invert pull-left toggle-advanced arrow-container\">");
	c.push(Surface.valOut("アドバンス"));
	c.push("\n </button>\n <button class=\"btn btn-small btn-primary pull-right\" type=\"submit\">");
	c.push(Surface.valOut("フィルターを適用"));
	c.push("</button>\n <a href=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/clearFilter/{platform}/", Surface.urlContext, {"platform": o.platformString})));
	c.push("\" class=\"btn btn-small pull-right reset-filters\">");
	c.push(Surface.valOut("リセット"));
	c.push("</a>\n </div>\n </div>\n ");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_bfhindex = new Surface.BlockConfig('serverbrowserwarsaw.index', {'sidebar': 'serverbrowserwarsaw.bfhindex.block_sidebar', 'filters': 'serverbrowserwarsaw.bfhindex.block_filters'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bfhindex'));
serverbrowserwarsaw.bfhindex.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhindex;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhindex');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.index', o, b, kwargs);
}
;
serverbrowserwarsaw.bfhindex.block_filters = new Surface.Block('serverbrowserwarsaw.bfhindex.block_filters');
serverbrowserwarsaw.bfhindex.block_filters.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilter) != "undefined" && o.showFilter !== null) ? o.showFilter : true)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "bfhfilters")), o, null, kwargs));
		c.push("\n");
	}
	else {
		c.push(" <a href=\"");
		c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
		c.push("\">\n ");
		c.push(Surface.valOut("全サーバーを表示"));
		c.push("\n </a>\n");
	}
	return c.join("");
}
;
serverbrowserwarsaw.bfhindex.block_sidebar = new Surface.Block('serverbrowserwarsaw.bfhindex.block_sidebar');
serverbrowserwarsaw.bfhindex.block_sidebar.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "bfhserverinfo")), o, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_bfhscore = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bfhscore'));
serverbrowserwarsaw.bfhscore.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhscore;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhscore');
	var l_gameServerMapModes;
	var l_gameModeCategories;
	c.push("\n");
	l_gameServerMapModes = $S.callFunction("battlereport.getGameServerMapModes", b, kwargs);
	l_gameModeCategories = $S.callFunction("battlereport.getBFHGameModeCategories", b, kwargs);
	c.push("\n");
	c.push(serverbrowserwarsaw.bfhscore.surface_5_1.render({"errormessage": ((typeof(o) != "undefined" && o !== null && typeof(o.errormessage) != "undefined" && o.errormessage !== null) ? o.errormessage : null), "gameModeCategories": {"reverseticket": ((typeof(l_gameModeCategories) != "undefined" && l_gameModeCategories !== null && typeof(l_gameModeCategories.reverseticket) != "undefined" && l_gameModeCategories.reverseticket !== null) ? l_gameModeCategories.reverseticket : null), "ticket": ((typeof(l_gameModeCategories) != "undefined" && l_gameModeCategories !== null && typeof(l_gameModeCategories.ticket) != "undefined" && l_gameModeCategories.ticket !== null) ? l_gameModeCategories.ticket : null)}, "gameServerMapModes": {"CAPTURETHEFLAG": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.CAPTURETHEFLAG) != "undefined" && l_gameServerMapModes.CAPTURETHEFLAG !== null) ? l_gameServerMapModes.CAPTURETHEFLAG : null), "HEIST": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.HEIST) != "undefined" && l_gameServerMapModes.HEIST !== null) ? l_gameServerMapModes.HEIST : null), "HOSTAGE": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.HOSTAGE) != "undefined" && l_gameServerMapModes.HOSTAGE !== null) ? l_gameServerMapModes.HOSTAGE : null)}, "scoreboard": ((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) ? o.scoreboard : null)}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.bfhscore.surface_5_1 = new Surface.SingleSurface("serverbrowserwarsaw.bfhscore.surface_5_1");
serverbrowserwarsaw.bfhscore.surface_5_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhscore;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhscore');
	c.push("<surf:container id=\"selected-server-scoreboard\"");
	c.push(">");
	var l_teamScore;
	var l_teamLocale;
	var l_for_serverbrowserwarsaw_bfhscore_19_9_list;
	var l_progressOptions;
	var l_robbers;
	var l_for_serverbrowserwarsaw_bfhscore_42_21_iteration;
	var l_teams;
	var l_gameMode;
	var l_maxFlags;
	var l_pullClass;
	var l_for_serverbrowserwarsaw_bfhscore_42_21_list;
	var l_for_serverbrowserwarsaw_bfhscore_113_21_iteration;
	var l_for_serverbrowserwarsaw_bfhscore_66_21_list;
	var l_cops;
	var l_for_serverbrowserwarsaw_bfhscore_113_21_list;
	var l_flags;
	var l_for_serverbrowserwarsaw_bfhscore_66_21_iteration;
	var l_isEven;
	var l_result;
	if ((typeof(o) != "undefined" && o !== null && typeof(o.errormessage) != "undefined" && o.errormessage !== null)) {
		c.push(" <div class=\"box\">\n <div class=\"box-content error\">\n ");
		c.push(Surface.valOut((S.translations[o.errormessage] || o.errormessage)));
		c.push("\n </div>\n </div>\n");
	}
	else if ((((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) && S.compat.eq(S.Modifier.get(o.scoreboard, "status"), "OK")) && (typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null && typeof(o.scoreboard.result) != "undefined" && o.scoreboard.result !== null))) {
		c.push("\n");
		l_result = o.scoreboard.result;
		l_teams = S.Modifier.get(l_result, "teams", []);
		l_gameMode = S.Modifier.get(l_result, "gameMode", 64);
		c.push("\n");
		l_for_serverbrowserwarsaw_bfhscore_19_9_list = S.Modifier.get(l_result, "teams", {});
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhscore_19_9_list), 0)) {
			for (var l_for_serverbrowserwarsaw_bfhscore_19_9_key in l_for_serverbrowserwarsaw_bfhscore_19_9_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhscore_19_9_list[l_for_serverbrowserwarsaw_bfhscore_19_9_key])) {
					continue;
				}
				var l_t = l_for_serverbrowserwarsaw_bfhscore_19_9_list[l_for_serverbrowserwarsaw_bfhscore_19_9_key];
				if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.faction) != "undefined" && l_t.status.faction !== null)) {
					l_t.name = $S.callFunction("battlereport.getBfhTeamFromFaction", l_t.status.faction, b, kwargs);
				}
				else if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.teamType) != "undefined" && l_t.status.teamType !== null)) {
					c.push("\n");
					l_t.name = l_t.status.teamType;
				}
				else {
					l_t.name = $S.callFunction("battlereport.getBfhTeamFromFaction", S.compat.sub(l_t.status.teamId, 1), b, kwargs);
				}
			}
		}
		c.push(" <div class=\"box\">\n <div class=\"box-content gamemode-");
		c.push(Surface.valOut(l_gameMode));
		c.push("\">\n");
		l_progressOptions = {"size": "thicker", "border": false, "percent": 30, "type": "home", "reverse": false, "extraClass": "home"};
		c.push("\n");
		if (S.Modifier.contains(o.gameModeCategories.ticket, l_gameMode)) {
			l_for_serverbrowserwarsaw_bfhscore_42_21_list = l_teams;
			l_for_serverbrowserwarsaw_bfhscore_42_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhscore_42_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_bfhscore_42_21_key in l_for_serverbrowserwarsaw_bfhscore_42_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhscore_42_21_list[l_for_serverbrowserwarsaw_bfhscore_42_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_bfhscore_42_21_list[l_for_serverbrowserwarsaw_bfhscore_42_21_key];
					l_for_serverbrowserwarsaw_bfhscore_42_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_bfhscore_42_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_bfhscore_42_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_bfhscore_42_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_teamScore = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "tickets", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					l_progressOptions.type = S.compat.eq(l_for_serverbrowserwarsaw_bfhscore_42_21_iteration, 1) ? "home" : "away";
					l_progressOptions.reverse = l_isEven ? false : true;
					l_progressOptions.extraClass = l_progressOptions.type;
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n");
					l_progressOptions.percent = S.compat.mul(S.compat.div(l_teamScore, S.Modifier.get(S.Modifier.get(l_team, "status", {}), "ticketsMax", l_teamScore)), 100);
					c.push(" <div class=\"pull-right\">");
					c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
					c.push("</div>\n </div>\n <p class=\"team-score\">");
					c.push(Surface.valOut(l_teamScore));
					c.push("</p>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.Modifier.contains(o.gameModeCategories.reverseticket, l_gameMode)) {
			l_for_serverbrowserwarsaw_bfhscore_66_21_list = l_teams;
			l_for_serverbrowserwarsaw_bfhscore_66_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhscore_66_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_bfhscore_66_21_key in l_for_serverbrowserwarsaw_bfhscore_66_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhscore_66_21_list[l_for_serverbrowserwarsaw_bfhscore_66_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_bfhscore_66_21_list[l_for_serverbrowserwarsaw_bfhscore_66_21_key];
					l_for_serverbrowserwarsaw_bfhscore_66_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_bfhscore_66_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_bfhscore_66_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_bfhscore_66_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_teamScore = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "tickets", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					l_progressOptions.type = S.compat.eq(l_for_serverbrowserwarsaw_bfhscore_66_21_iteration, 1) ? "home" : "away";
					l_progressOptions.extraClass = l_progressOptions.type;
					l_progressOptions.reverse = l_isEven ? false : true;
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <p class=\"team-score\">");
					c.push(Surface.valOut(l_teamScore));
					c.push("</p>\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n");
					l_progressOptions.percent = S.compat.mul(S.compat.div(l_teamScore, S.Modifier.get(S.Modifier.get(l_team, "status", {}), "ticketsMax", l_teamScore)), 100);
					c.push(" <div class=\"pull-right\">");
					c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
					c.push("</div>\n </div>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.HEIST)) {
			l_cops = S.Modifier.get(l_teams, 0);
			l_robbers = S.Modifier.get(l_teams, 1);
			c.push("\n");
			l_progressOptions.percent = S.compat.mul(S.compat.div(l_cops.status.tickets, l_cops.status.ticketsMax), 100);
			c.push(" <div class=\"clearfix\">\n <p class=\"team-score pull-left\">");
			c.push(Surface.valOut(l_cops.status.tickets));
			c.push("</p>\n <div class=\"pull-left\">");
			c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
			c.push("</div>\n <p class=\"team-score pull-right lspace\">");
			c.push(Surface.valOut(l_robbers.status.tickets));
			c.push("/");
			c.push(Surface.valOut(l_robbers.status.ticketsMax));
			c.push("</p>\n </div>\n <p class=\"team-name\">");
			c.push(Surface.valOut("犯罪者"));
			c.push("</p>\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.HOSTAGE)) {
			l_cops = S.Modifier.get(l_teams, 0);
			l_robbers = S.Modifier.get(l_teams, 1);
			c.push("\n");
			l_progressOptions.percent = S.compat.mul(S.compat.div(l_robbers.status.tickets, l_robbers.status.ticketsMax), 100);
			c.push(" <div class=\"clearfix\">\n <p class=\"team-score pull-left\">");
			c.push(Surface.valOut(l_robbers.status.tickets));
			c.push("</p>\n <div class=\"pull-left\">");
			c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
			c.push("</div>\n <p class=\"team-score pull-right lspace\">");
			c.push(Surface.valOut(l_cops.status.tickets));
			c.push("/");
			c.push(Surface.valOut(l_cops.status.ticketsMax));
			c.push("</p>\n </div>\n <p class=\"team-name\">");
			c.push(Surface.valOut("警官"));
			c.push("</p>\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.CAPTURETHEFLAG)) {
			l_for_serverbrowserwarsaw_bfhscore_113_21_list = l_teams;
			l_for_serverbrowserwarsaw_bfhscore_113_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhscore_113_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_bfhscore_113_21_key in l_for_serverbrowserwarsaw_bfhscore_113_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhscore_113_21_list[l_for_serverbrowserwarsaw_bfhscore_113_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_bfhscore_113_21_list[l_for_serverbrowserwarsaw_bfhscore_113_21_key];
					l_for_serverbrowserwarsaw_bfhscore_113_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_bfhscore_113_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_bfhscore_113_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_bfhscore_113_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_flags = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "flags", 0);
					l_maxFlags = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "flagsMax", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n </div>\n <p class=\"team-score lspace\">");
					c.push(Surface.valOut(l_flags));
					c.push("/");
					c.push(Surface.valOut(l_maxFlags));
					c.push("</p>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		c.push(" <div class=\"round-time\">\n ");
		c.push(Surface.valOut(S.Modifier.timer(l_result.roundTime)));
		c.push("\n </div>\n </div>\n </div>\n");
	}
	else {
		c.push(" <div class=\"box\">\n <div class=\"box-content center-text\">\n ");
		c.push(Surface.importTemplate(("ui" + ("." + "loader")), {"size": "small"}, null, kwargs));
		c.push("\n </div>\n </div>\n");
	}
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bfhscore", "surface_5_1", "selected-server-scoreboard", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_bfhserverinfo = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bfhserverinfo'));
serverbrowserwarsaw.bfhserverinfo.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhserverinfo');
	c.push("\n");
	c.push(serverbrowserwarsaw.bfhserverinfo.surface_2_1.render({"favGuids": ((typeof(o) != "undefined" && o !== null && typeof(o.favGuids) != "undefined" && o.favGuids !== null) ? o.favGuids : null), "friendsOnServer": ((typeof(o) != "undefined" && o !== null && typeof(o.friendsOnServer) != "undefined" && o.friendsOnServer !== null) ? o.friendsOnServer : null), "isHybridApp": ((typeof(o) != "undefined" && o !== null && typeof(o.isHybridApp) != "undefined" && o.isHybridApp !== null) ? o.isHybridApp : null), "isTouchDevice": ((typeof(o) != "undefined" && o !== null && typeof(o.isTouchDevice) != "undefined" && o.isTouchDevice !== null) ? o.isTouchDevice : null), "loading": ((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : null), "mapUrl": ((typeof(o) != "undefined" && o !== null && typeof(o.mapUrl) != "undefined" && o.mapUrl !== null) ? o.mapUrl : null), "players": ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : null), "server": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : null), "session": {"isLoggedIn": ((typeof(o) != "undefined" && o !== null && typeof(o.session) != "undefined" && o.session !== null && typeof(o.session.isLoggedIn) != "undefined" && o.session.isLoggedIn !== null) ? o.session.isLoggedIn : null)}}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.bfhserverinfo.surface_2_1 = new Surface.SingleSurface("serverbrowserwarsaw.bfhserverinfo.surface_2_1");
serverbrowserwarsaw.bfhserverinfo.surface_2_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhserverinfo');
	c.push("<surf:container id=\"serverbrowser-show\"");
	c.push(">");
	var l_spectatorSlot;
	var l_favGuids;
	var l_for_serverbrowserwarsaw_bfhserverinfo_27_29_count;
	var l_soldierSlots;
	var l_isFavorite;
	var l_commanderSlot;
	var l_session;
	var l_mapname;
	var l_for_serverbrowserwarsaw_bfhserverinfo_27_29_list;
	var l_canJoin;
	var l_for_serverbrowserwarsaw_bfhserverinfo_27_29_iteration;
	var l_platform;
	var l_mapinfo;
	o.players = o.players;
	o.isTouchDevice = Surface.globalContext.staticContext.detectedBrowser.isTouchDevice;
	o.isHybridApp = Surface.globalContext.staticContext.detectedBrowser.isHybridApp;
	c.push(" <div class=\"server-info\">\n");
	l_session = S.Modifier.get(Surface.globalContext, "session");
	l_favGuids = S.Modifier.get(Surface.globalContext, "favGuids");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : false)) {
		c.push(" <div class=\"loading\"></div>\n");
	}
	else {
		if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null)) {
			l_isFavorite = S.Modifier.contains(l_favGuids, S.Modifier.get(o.server, "guid", ""));
			l_mapinfo = $S.callFunction("common.mapinfo", o.server.game, o.server.map, b, kwargs);
			l_mapname = l_mapinfo.name;
			l_platform = o.server.platform;
			c.push("\n");
			l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
			c.push(" <div class=\"quick-info\" style=\"background-image: url('");
			c.push(Surface.valOut(l_mapinfo.image335x160));
			c.push("')\">\n");
			if (o.server.online) {
				c.push(" <div class=\"holder\">\n");
				if ((S.compat.gt(S.Modifier.count(o.friendsOnServer), 0) && ((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false))) {
					c.push(" <ul class=\"friends clearfix\">\n");
					l_for_serverbrowserwarsaw_bfhserverinfo_27_29_list = o.friendsOnServer;
					l_for_serverbrowserwarsaw_bfhserverinfo_27_29_count = S.Modifier.count(l_for_serverbrowserwarsaw_bfhserverinfo_27_29_list);
					l_for_serverbrowserwarsaw_bfhserverinfo_27_29_iteration = 0;
					if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhserverinfo_27_29_list), 0)) {
						for (var l_for_serverbrowserwarsaw_bfhserverinfo_27_29_key in l_for_serverbrowserwarsaw_bfhserverinfo_27_29_list) {
							if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhserverinfo_27_29_list[l_for_serverbrowserwarsaw_bfhserverinfo_27_29_key])) {
								continue;
							}
							var l_friend = l_for_serverbrowserwarsaw_bfhserverinfo_27_29_list[l_for_serverbrowserwarsaw_bfhserverinfo_27_29_key];
							l_for_serverbrowserwarsaw_bfhserverinfo_27_29_iteration = S.compat.add(l_for_serverbrowserwarsaw_bfhserverinfo_27_29_iteration, 1);
							c.push(" <li>\n <a href=\"");
							c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/user/{username}/", Surface.urlContext, {"username": l_friend.username})));
							c.push("\" data-tooltip=\"");
							c.push(Surface.valOut(l_friend.username));
							c.push("\">\n ");
							c.push(Surface.importTemplate(("ui" + ("." + "avatar")), {"user": l_friend, "size": 22}, null, kwargs));
							c.push("\n </a>\n </li>\n");
							if (S.compat.gt(l_for_serverbrowserwarsaw_bfhserverinfo_27_29_iteration, 4)) {
								c.push(" <li class=\"more\" data-tooltip=\"+");
								c.push(Surface.valOut(S.compat.sub(l_for_serverbrowserwarsaw_bfhserverinfo_27_29_count, l_for_serverbrowserwarsaw_bfhserverinfo_27_29_iteration)));
								c.push(" ");
								c.push(Surface.valOut("フレンド"));
								c.push("\">+");
								c.push(Surface.valOut(S.compat.sub(l_for_serverbrowserwarsaw_bfhserverinfo_27_29_count, l_for_serverbrowserwarsaw_bfhserverinfo_27_29_iteration)));
								c.push("</li>\n");
								break;
							}
						}
					}
					c.push(" </ul>\n");
				}
				c.push("\n <p class=\"player-count\">");
				c.push(Surface.valOut(l_soldierSlots.current));
				c.push(" / ");
				c.push(Surface.valOut(l_soldierSlots.max));
				c.push(" ");
				c.push(Surface.valOut("プレイヤー"));
				c.push("</p>\n <ul class=\"map-info\">\n");
				if ((((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.country) != "undefined" && o.server.country !== null) ? o.server.country : false) && S.compat.eq(o.server.platform, 1))) {
					c.push(" <li class=\"country-flag\">\n ");
					c.push(Surface.importTemplate(("common" + ("." + "countryflag")), {"countryCode": o.server.country}, null, kwargs));
					c.push("\n </li>\n");
				}
				c.push(" <li><span>");
				c.push(Surface.valOut(S.Modifier.capitalize((S.translations[l_mapname] || l_mapname))));
				c.push("</span></li>\n <li><span>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", o.server.mapMode, o.server.game, b, kwargs)));
				c.push("</span></li>\n </ul>\n </div>\n");
			}
			c.push(" </div>\n");
			if (o.server.online) {
				l_canJoin = $S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs);
				c.push(" <div class=\"action-buttons-container\">\n <button class=\"btn btn-primary btn-large btn-block join arrow ");
				if (!(l_canJoin)) {
					c.push("disabled");
				}
				c.push("\"\n data-track=\"serverbrowser.selected.join\"\n data-bind-action=\"join-mp-gameserver\"\n data-role=\"");
				c.push(Surface.valOut(1));
				c.push("\"\n data-guid=\"");
				c.push(Surface.valOut(o.server.guid));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(o.server.game));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(o.server.platform));
				c.push("\"\n data-gameid=\"");
				c.push(Surface.valOut(o.server.gameId));
				c.push("\"\n data-ip=\"");
				c.push(Surface.valOut(o.server.ip));
				c.push("\"\n data-port=\"");
				c.push(Surface.valOut(o.server.port));
				c.push("\"\n data-telemetry-action=\"serverbrowser\">\n <i></i>\n ");
				c.push(Surface.valOut("サーバーに参加"));
				c.push("\n </button>\n <div class=\"hidden-server-data\"\n data-role=\"");
				c.push(Surface.valOut(1));
				c.push("\"\n data-guid=\"");
				c.push(Surface.valOut(o.server.guid));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(o.server.game));
				c.push("\"\n data-map-mode=\"");
				c.push(Surface.valOut(o.server.mapMode));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(o.server.platform));
				c.push("\"\n data-gameid=\"");
				c.push(Surface.valOut(o.server.gameId));
				c.push("\"\n data-ip=\"");
				c.push(Surface.valOut(o.server.ip));
				c.push("\"\n data-port=\"");
				c.push(Surface.valOut(o.server.port));
				c.push("\">\n </div>\n");
				if ((S.compat.eq(l_platform, 1) && !(o.isTouchDevice))) {
					c.push("\n");
					if ($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs)) {
						c.push(" <button class=\"btn btn-small btn-block join arrow ");
						if (!(l_canJoin)) {
							c.push("disabled");
						}
						c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.selected.commander.join\"\n data-role=\"");
						c.push(Surface.valOut(2));
						c.push("\"\n data-guid=\"");
						c.push(Surface.valOut(o.server.guid));
						c.push("\"\n data-game=\"");
						c.push(Surface.valOut(o.server.game));
						c.push("\"\n data-platform=\"");
						c.push(Surface.valOut(o.server.platform));
						c.push("\">\n <i></i>\n ");
						c.push(Surface.valOut("ハッカー"));
						c.push("\n </button>\n");
					}
					c.push("\n");
					if ($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs)) {
						c.push(" <button class=\"btn btn-small btn-block spectator-join join arrow ");
						if (!(l_canJoin)) {
							c.push("disabled");
						}
						c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.selected.spectator.join\"\n data-role=\"");
						c.push(Surface.valOut(4));
						c.push("\"\n data-guid=\"");
						c.push(Surface.valOut(o.server.guid));
						c.push("\"\n data-game=\"");
						c.push(Surface.valOut(o.server.game));
						c.push("\"\n data-platform=\"");
						c.push(Surface.valOut(o.server.platform));
						c.push("\">\n <i></i>\n ");
						c.push(Surface.valOut("観戦者"));
						c.push("\n </button>\n");
					}
				}
				c.push("\n");
				if ((o.isTouchDevice && S.compat.eq(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : 0), 1))) {
					c.push(" <button class=\"btn btn-small btn-block favorite-toggle");
					if (l_isFavorite) {
						c.push(" starred");
					}
					c.push("\"\n data-guid=\"");
					c.push(Surface.valOut(o.server.guid));
					c.push("\"\n data-bind-toggle=\"favorite\"\n data-type=\"server\">\n <span class=\"add-text\">");
					c.push(Surface.valOut("お気に入りに追加"));
					c.push("</span>\n <span class=\"remove-text\">");
					c.push(Surface.valOut("お気に入り"));
					c.push("</span>\n </button>\n");
				}
				c.push(" </div>\n");
				if ($S.callFunction("serverguide.liveScoreboardEnabled", o.server.game, o.server.platform, b, kwargs)) {
					c.push(" ");
					c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "bfhscore")), o, null, kwargs));
					c.push("\n");
				}
				c.push("\n <div class=\"box details-container\">\n <div class=\"box-content\">\n <ul class=\"settings\">\n <li>");
				c.push(Surface.valOut("プリセット"));
				c.push("<b>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", o.server.preset, b, kwargs)));
				c.push("</b></li>\n");
				if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.serverType) != "undefined" && o.server.serverType !== null)) {
					c.push(" <li>");
					c.push(Surface.valOut("タイプ"));
					c.push("<b><span class=\"icon icon-servertype icon-servertype-");
					c.push(Surface.valOut(o.server.serverType));
					c.push("\"></span> ");
					c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerServerTypeString", o.server.serverType, b, kwargs)));
					c.push("</b></li>\n");
				}
				if (((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.experience) != "undefined" && o.server.experience !== null) && S.compat.neq(o.server.experience, "0"))) {
					c.push(" <li>");
					c.push(Surface.valOut("ゲームクラス"));
					c.push("<b>");
					c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerExperienceString", o.server.game, o.server.experience, b, kwargs)));
					c.push("</b></li>\n");
				}
				c.push(" <li>");
				c.push(Surface.valOut("チックレート"));
				c.push("<b>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerTickRateString", o.server.tickRate, b, kwargs)));
				c.push("</b></li>\n <li>");
				c.push(Surface.valOut("Punkbuster"));
				c.push("<b><span class=\"icon icon-punkbuster dark\"></span> ");
				if (o.server.punkbuster) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</b></li>\n <li>");
				c.push(Surface.valOut("FairFight"));
				c.push("<b>");
				if (o.server.fairfight) {
					c.push("<span class=\"icon icon-fairfight dark\"></span> ");
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push("<span class=\"icon icon-fairfight dark\"></span> ");
					c.push(Surface.valOut("オフ"));
				}
				c.push("</b></li>\n <li>");
				c.push(Surface.valOut("パスワード"));
				c.push("<b>");
				if (o.server.hasPassword) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</b></li>\n");
				if ($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs)) {
					l_spectatorSlot = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 8, b, kwargs);
					if (l_spectatorSlot) {
						c.push(" <li>");
						c.push(Surface.valOut("観戦者"));
						c.push("<b>");
						c.push(Surface.valOut(l_spectatorSlot));
						c.push("</b></li>\n");
					}
				}
				c.push("\n");
				if ($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs)) {
					l_commanderSlot = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 4, b, kwargs);
					if (l_commanderSlot) {
						if (S.compat.eq(o.server.game, 8192)) {
							c.push(" <li>");
							c.push(Surface.valOut("ハッカー"));
							c.push("<b>");
							c.push(Surface.valOut(l_commanderSlot));
							c.push("</b></li>\n");
						}
						else {
							c.push(" <li>");
							c.push(Surface.valOut("司令官"));
							c.push("<b>");
							c.push(Surface.valOut(l_commanderSlot));
							c.push("</b></li>\n");
						}
					}
				}
				c.push(" </ul>\n </div>\n <footer>\n <a class=\"btn btn-inverse btn-block\"\n href=\"");
				c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": o.server.guid, "platform": S.Modifier.lower($S.callFunction("base.platform", o.server.platform, b, kwargs)), "slug": S.Modifier.slugify(o.server.name)})));
				c.push("\">\n ");
				c.push(Surface.valOut("サーバーページを表示"));
				c.push("\n </a>\n </footer>\n </div>\n");
			}
			else {
				c.push(" <div class=\"box\">\n <div class=\"box-content\">\n <h1 id=\"serverinfo-serveroffline\">");
				c.push(Surface.valOut("サーバーはオフラインです"));
				c.push("</h1>\n </div>\n </div>\n");
			}
			c.push(" ");
		}
		c.push("\n");
	}
	c.push(" </div>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bfhserverinfo", "surface_2_1", "serverbrowser-show", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_bfhshow = new Surface.BlockConfig('serverbrowserwarsaw.show', {'mapRotation': 'serverbrowserwarsaw.bfhshow.block_mapRotation', 'joinButtons': 'serverbrowserwarsaw.bfhshow.block_joinButtons', 'settings': 'serverbrowserwarsaw.bfhshow.block_settings', 'shortInfo': 'serverbrowserwarsaw.bfhshow.block_shortInfo', 'scoreBoard': 'serverbrowserwarsaw.bfhshow.block_scoreBoard'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bfhshow'));
serverbrowserwarsaw.bfhshow.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhshow');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.show', o, b, kwargs);
}
;
serverbrowserwarsaw.bfhshow.surface_55_17 = new Surface.SingleSurface("serverbrowserwarsaw.bfhshow.surface_55_17");
serverbrowserwarsaw.bfhshow.surface_55_17.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhshow');
	c.push("<surf:container id=\"serverbrowser-show-info-ping\"");
	c.push(">");
	c.push(" <h5>");
	c.push(Surface.importTemplate(("ui" + ("." + "pingbar")), {"ping": o.server.ping, "size": "large"}, null, kwargs));
	c.push(Surface.valOut("ms"));
	c.push("</h5>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bfhshow", "surface_55_17", "serverbrowser-show-info-ping", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.bfhshow.block_shortInfo = new Surface.Block('serverbrowserwarsaw.bfhshow.block_shortInfo');
serverbrowserwarsaw.bfhshow.block_shortInfo.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_soldierSlots;
	var l_commanderSlots;
	var l_spectatorSlots;
	var l_spanClass;
	var l_queueSlots;
	c.push(" <div id=\"server-page-info\" class=\"row-tight\">\n");
	if ((o.server.experience && S.compat.neq(o.server.experience, 0))) {
		l_spanClass = "span1";
	}
	else {
		l_spanClass = "span1-05";
	}
	c.push("\n <div class=\"box ");
	c.push(Surface.valOut(l_spanClass));
	c.push("\">\n <header>\n <h1>");
	c.push(Surface.valOut("プレイヤー"));
	c.push("</h1>\n </header>\n <section class=\"box-content\">\n <h5>\n");
	l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
	l_queueSlots = $S.callFunction("serverguide.getServerSlots", o.server, 1, b, kwargs);
	c.push("\n");
	c.push(Surface.valOut(l_soldierSlots.current));
	c.push(" / ");
	c.push(Surface.valOut(l_soldierSlots.max));
	c.push("\n");
	if (((typeof(l_queueSlots) != "undefined" && l_queueSlots !== null) && S.compat.gt(l_queueSlots.current, 0))) {
		c.push(" [<abbr title=\"");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push(" ");
		c.push(Surface.valOut("人待ち"));
		c.push("\">");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push("</abbr>]\n");
	}
	c.push(" </h5>\n <div id=\"server-page-slot-info\" class=\"row-tight\">\n ");
	c.push("\n");
	if ($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs)) {
		l_spectatorSlots = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 8, b, kwargs);
		c.push(" <dl>\n <dt>");
		c.push(Surface.valOut("観戦者"));
		c.push("</dt>\n <dd>");
		c.push(Surface.valOut(l_spectatorSlots));
		c.push("</dd>\n </dl>\n");
	}
	if ($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs)) {
		l_commanderSlots = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 4, b, kwargs);
		c.push(" <dl>\n <dt>");
		c.push(Surface.valOut("ハッカー"));
		c.push("</dt>\n <dd>");
		c.push(Surface.valOut(l_commanderSlots));
		c.push("</dd>\n </dl>\n");
	}
	c.push("\n </div>\n </section>\n </div>\n <div class=\"box ");
	c.push(Surface.valOut(l_spanClass));
	c.push("\">\n <header>\n <h1>");
	c.push(Surface.valOut("PING"));
	c.push("</h1>\n </header>\n <section class=\"box-content\">\n");
	c.push(serverbrowserwarsaw.bfhshow.surface_55_17.render({"server": {"ping": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.ping) != "undefined" && o.server.ping !== null) ? o.server.ping : null)}}, b, kwargs));
	c.push(" </section>\n </div>\n <div class=\"box ");
	c.push(Surface.valOut(l_spanClass));
	c.push("\">\n <header>\n <h1>");
	c.push(Surface.valOut("プリセット"));
	c.push("</h1>\n </header>\n <section class=\"box-content\">\n <h5>");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 0), b, kwargs)));
	c.push("</h5>\n </section>\n </div>\n <div class=\"box ");
	c.push(Surface.valOut(l_spanClass));
	c.push("\">\n <header>\n <h1>");
	c.push(Surface.valOut("タイプ"));
	c.push("</h1>\n </header>\n <section class=\"box-content\">\n <h5><span class=\"icon-servertype-large icon-servertype-large-");
	c.push(Surface.valOut(o.server.serverType));
	c.push("\"></span> ");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerServerTypeString", o.server.serverType, b, kwargs)));
	c.push("</h5>\n </section>\n </div>\n");
	if ((o.server.experience && S.compat.neq(o.server.experience, 0))) {
		c.push(" <div class=\"box span2\">\n <header>\n <h1>");
		c.push(Surface.valOut("ゲームクラス"));
		c.push("</h1>\n </header>\n <section class=\"box-content\">\n <h5>");
		c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerExperienceString", o.server.game, o.server.experience, b, kwargs)));
		c.push("</h5>\n </section>\n </div>\n");
	}
	c.push("\n </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.bfhshow.block_joinButtons = new Surface.Block('serverbrowserwarsaw.bfhshow.block_joinButtons');
serverbrowserwarsaw.bfhshow.block_joinButtons.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n <div id=\"server-page-join-buttons\" class=\"box box-content spacing-top-tight\"\n data-guid=\"");
	c.push(Surface.valOut(o.server.guid));
	c.push("\"\n data-gameid=\"");
	c.push(Surface.valOut(o.server.gameId));
	c.push("\"\n data-ip=\"");
	c.push(Surface.valOut(o.server.ip));
	c.push("\"\n data-port=\"");
	c.push(Surface.valOut(o.server.port));
	c.push("\"\n data-game=\"");
	c.push(Surface.valOut(o.server.game));
	c.push("\"\n data-platform=\"");
	c.push(Surface.valOut(o.server.platform));
	c.push("\">\n");
	if ($S.callFunction("serverguide.showJoinButton", o.server, b, kwargs)) {
		c.push(" <button class=\"btn btn-primary btn-large large arrow\n ");
		if (!($S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs))) {
			c.push(" disabled");
		}
		c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.server.join\"\n data-role=\"");
		c.push(Surface.valOut(1));
		c.push("\"\n data-telemetry-action=\"serverbrowser\">\n <i></i>\n ");
		c.push(Surface.valOut("サーバーに参加"));
		c.push("\n </button>\n");
	}
	c.push("\n");
	if (S.compat.eq(o.server.platform, 1)) {
		if (($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs) && $S.callFunction("serverguide.showJoinButton", o.server, b, kwargs))) {
			c.push(" <button\n class=\"btn btn-large large arrow ");
			if (!($S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs))) {
				c.push(" disabled");
			}
			c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.server.commander.join\"\n data-role=\"");
			c.push(Surface.valOut(2));
			c.push("\">\n <i></i>\n ");
			c.push(Surface.valOut("ハッカー"));
			c.push("\n </button>\n");
		}
		c.push("\n");
		if (($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs) && $S.callFunction("serverguide.showJoinButton", o.server, b, kwargs))) {
			c.push(" <button class=\"btn btn-large large arrow\n ");
			if (!($S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs))) {
				c.push(" disabled");
			}
			c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.server.spectator.join\"\n data-role=\"");
			c.push(Surface.valOut(4));
			c.push("\">\n <i></i>\n ");
			c.push(Surface.valOut("観戦者"));
			c.push("\n </button>\n");
		}
	}
	c.push(" </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.bfhshow.block_mapRotation = new Surface.Block('serverbrowserwarsaw.bfhshow.block_mapRotation');
serverbrowserwarsaw.bfhshow.block_mapRotation.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_for_serverbrowserwarsaw_bfhshow_152_25_list;
	var l_mapName;
	var l_mapsOnServer;
	var l_mapClass;
	var l_mapInfo;
	c.push(" <div id=\"server-page-map-rotation\" class=\"box spacing-top\">\n <header>\n <h1>");
	c.push(Surface.valOut("マップローテーション"));
	c.push("</h1>\n </header>\n <div class=\"scroll-area\">\n <table class=\"table\">\n <tbody>\n <tr>\n");
	l_mapsOnServer = S.Modifier.get(o.server.maps, "maps", []);
	l_for_serverbrowserwarsaw_bfhshow_152_25_list = l_mapsOnServer;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhshow_152_25_list), 0)) {
		for (var l_i in l_for_serverbrowserwarsaw_bfhshow_152_25_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhshow_152_25_list[l_i])) {
				continue;
			}
			var l_mapRotation = l_for_serverbrowserwarsaw_bfhshow_152_25_list[l_i];
			l_mapInfo = $S.callFunction("common.mapinfo", o.server.game, l_mapRotation.map, b, kwargs);
			l_mapName = S.Modifier.get(l_mapInfo, "name");
			l_mapName = (S.translations[l_mapName] || l_mapName);
			if (S.compat.gt(((typeof(l_mapRotation) != "undefined" && l_mapRotation !== null && typeof(l_mapRotation.mapVariant) != "undefined" && l_mapRotation.mapVariant !== null) ? l_mapRotation.mapVariant : 0), 0)) {
				l_mapName = S.Modifier.concat(S.Modifier.concat(l_mapName, " #"), S.compat.add(l_mapRotation.mapVariant, 1));
			}
			l_mapClass = "";
			if (S.compat.eq(l_i, o.server.maps.currentMapIndex)) {
				l_mapClass = "active";
			}
			else if (S.compat.eq(l_i, o.server.maps.nextMapIndex)) {
				l_mapClass = "next";
			}
			c.push("\n <td class=\"");
			c.push(Surface.valOut(l_mapClass));
			c.push("\">\n <img src=\"");
			c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.get(l_mapInfo, "imageBig"), b, kwargs)));
			c.push("\" width=146 height=79 alt=\"");
			c.push(Surface.valOut(l_mapName));
			c.push("\" />\n <p>\n <strong>");
			c.push(Surface.valOut(S.Modifier.capitalize(l_mapName)));
			c.push("</strong><br>\n <span>\n ");
			c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", l_mapRotation.mapMode, o.server.game, b, kwargs)));
			c.push("\n </span>\n </p>\n");
			if (((S.compat.eq(l_mapClass, "active") && (typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.maps) != "undefined" && o.server.maps !== null && typeof(o.server.maps.numberMapRounds) != "undefined" && o.server.maps.numberMapRounds !== null)) && S.compat.gt(o.server.maps.numberMapRounds, 1))) {
				c.push(" <div class=\"round-status\">");
				c.push(Surface.valOut("ラウンド"));
				c.push(": ");
				c.push(Surface.valOut(S.compat.add(o.server.maps.currentMapRound, 1)));
				c.push(" / ");
				c.push(Surface.valOut(o.server.maps.numberMapRounds));
				c.push("</div>\n");
			}
			c.push(" </td>\n");
		}
	}
	else {
		c.push(" <td class=\"no-maps-rotation\">");
		c.push(Surface.valOut("マップローテーションにマップがありません"));
		c.push("</td>\n");
	}
	c.push(" <td class=\"empty\"></td>\n </tr>\n </tbody>\n </table>\n </div>\n </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.bfhshow.block_settings = new Surface.Block('serverbrowserwarsaw.bfhshow.block_settings');
serverbrowserwarsaw.bfhshow.block_settings.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" <div id=\"server-page-details\" class=\"box spacing-top\">\n <header>\n <h1>");
	c.push(Surface.valOut("サーバーの詳細"));
	c.push("</h1>\n </header>\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.extendedInfo) != "undefined" && o.server.extendedInfo !== null && typeof(o.server.extendedInfo.desc) != "undefined" && o.server.extendedInfo.desc !== null) ? o.server.extendedInfo.desc : "")) {
		c.push(" <div id=\"server-description\" class=\"box spacing-top-tight\">\n <div class=\"box-content\">\n <p>");
		c.push(S.Modifier.nl2br(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.extendedInfo) != "undefined" && o.server.extendedInfo !== null && typeof(o.server.extendedInfo.desc) != "undefined" && o.server.extendedInfo.desc !== null) ? o.server.extendedInfo.desc : "")));
		c.push("</p>\n </div>\n </div>\n");
	}
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serversettings")), o, null, kwargs));
	c.push("\n </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.function_formatForBfhTemplate = function(l_data, l_playersContext, b, kwargs) {
	var o = {};
	var c = [];
	var l_pDict;
	var l_for_serverbrowserwarsaw_bfhshow_241_13_list;
	var l_for_serverbrowserwarsaw_bfhshow_222_9_list;
	var l_team;
	var l_tpl;
	var l_p;
	var l_for_serverbrowserwarsaw_bfhshow_211_9_list;
	l_pDict = {};
	l_for_serverbrowserwarsaw_bfhshow_211_9_list = l_playersContext;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhshow_211_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_bfhshow_211_9_key in l_for_serverbrowserwarsaw_bfhshow_211_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhshow_211_9_list[l_for_serverbrowserwarsaw_bfhshow_211_9_key])) {
				continue;
			}
			var l_p = l_for_serverbrowserwarsaw_bfhshow_211_9_list[l_for_serverbrowserwarsaw_bfhshow_211_9_key];
			c.push(Surface.valOut(S.Modifier.set(l_pDict, l_p.personaId, l_p)));
		}
	}
	l_tpl = {};
	l_tpl.gameId = S.Modifier.get(l_data, "gameId");
	l_tpl.gameMode = S.Modifier.get(l_data, "gameMode");
	l_tpl.type = "live";
	l_for_serverbrowserwarsaw_bfhshow_222_9_list = S.Modifier.get(l_data, "teams", []);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhshow_222_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_bfhshow_222_9_key in l_for_serverbrowserwarsaw_bfhshow_222_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhshow_222_9_list[l_for_serverbrowserwarsaw_bfhshow_222_9_key])) {
				continue;
			}
			var l_t = l_for_serverbrowserwarsaw_bfhshow_222_9_list[l_for_serverbrowserwarsaw_bfhshow_222_9_key];
			l_team = {};
			l_team.id = l_t.status.teamId;
			if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.faction) != "undefined" && l_t.status.faction !== null)) {
				l_team.name = $S.callFunction("battlereport.getBfhTeamFromFaction", l_t.status.faction, b, kwargs);
			}
			else if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.teamType) != "undefined" && l_t.status.teamType !== null)) {
				l_team.name = l_t.status.teamType;
			}
			else {
				l_team.name = $S.callFunction("battlereport.getBfhTeamFromFaction", S.compat.sub(l_t.status.teamId, 1), b, kwargs);
			}
			l_team.score = l_t.status.tickets;
			l_team.scoreMax = l_t.status.ticketsMax;
			l_tpl.players = ((typeof(l_tpl) != "undefined" && l_tpl !== null && typeof(l_tpl.players) != "undefined" && l_tpl.players !== null) ? l_tpl.players : {});
			l_team.players = [];
			l_team.commanders = [];
			l_for_serverbrowserwarsaw_bfhshow_241_13_list = S.Modifier.get(l_t, "players", []);
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_bfhshow_241_13_list), 0)) {
				for (var l_for_serverbrowserwarsaw_bfhshow_241_13_key in l_for_serverbrowserwarsaw_bfhshow_241_13_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_bfhshow_241_13_list[l_for_serverbrowserwarsaw_bfhshow_241_13_key])) {
						continue;
					}
					var l_p = l_for_serverbrowserwarsaw_bfhshow_241_13_list[l_for_serverbrowserwarsaw_bfhshow_241_13_key];
					l_p = S.Modifier.set(l_p, "team", l_team.id);
					if (S.Modifier.get(l_pDict, l_p.personaId)) {
						l_p = S.Modifier.set(l_p, "persona", S.Modifier.get(S.Modifier.get(l_pDict, l_p.personaId), "persona"));
						l_p = S.Modifier.set(l_p, "user", S.Modifier.get(S.Modifier.get(S.Modifier.get(l_pDict, l_p.personaId), "persona", {}), "user"));
					}
					if (S.compat.eq(S.Modifier.get(l_p, "role", 1), 2)) {
						l_team.commanders = S.Modifier.append(l_team.commanders, l_p.personaId);
						l_p = S.Modifier.set(l_p, "commanderScore", S.Modifier.get(l_p, "score", 0));
					}
					else {
						l_team.players = S.Modifier.append(l_team.players, l_p.personaId);
						l_p = S.Modifier.set(l_p, "combatScore", S.Modifier.get(l_p, "score", 0));
					}
					l_tpl.players = S.Modifier.set(l_tpl.players, l_p.personaId, l_p);
				}
			}
			l_tpl.teams = ((typeof(l_tpl) != "undefined" && l_tpl !== null && typeof(l_tpl.teams) != "undefined" && l_tpl.teams !== null) ? l_tpl.teams : {});
			l_tpl.teams = S.Modifier.set(l_tpl.teams, l_team.id, l_team);
		}
	}
	return l_tpl;
}
;
serverbrowserwarsaw.bfhshow.surface_265_9 = new Surface.SingleSurface("serverbrowserwarsaw.bfhshow.surface_265_9");
serverbrowserwarsaw.bfhshow.surface_265_9.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bfhshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bfhshow');
	c.push("<surf:container id=\"serverbrowser-scoreboard\"");
	c.push(">");
	var l_mapName;
	var l_gameModeCategories;
	var l_gameModeLocale;
	var l_maxTickets;
	var l_mapInfo;
	var l_templateData;
	var l_result;
	if ($S.callFunction("serverguide.liveScoreboardEnabled", o.server.game, o.server.platform, b, kwargs)) {
		if (((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) && S.compat.eq(S.Modifier.get(o.scoreboard, "status"), "OK"))) {
			c.push(" <div id=\"live-header\" class=\"box\">\n <header class=\"clearfix\">\n <h1 class=\"pull-left\">");
			c.push(Surface.valOut("ライブスコアボード"));
			c.push("</h1>\n <div class=\"switch-container pull-right clearfix\">\n <div class=\"switch pull-left\">\n <input type=\"checkbox\" id=\"serverbrowser-edit-livescoreboard\" name=\"serverbrowser-edit-livescoreboard\" value=\"0\"");
			if (o.liveupdating) {
				c.push(" checked");
			}
			c.push("/>\n <div class=\"handle\"></div>\n </div>\n </div>\n </header>\n <div class=\"box-content center-text uppercase\">\n");
			l_result = S.Modifier.get(o.scoreboard, "result", {});
			l_mapInfo = $S.callFunction("common.mapinfo", o.server.game, l_result.mapName, b, kwargs);
			l_mapName = S.Modifier.get(l_mapInfo, "name");
			l_gameModeLocale = $S.callFunction("gamedata.localizedGameMode", o.server.game, l_result.gameMode, b, kwargs);
			l_gameModeCategories = $S.callFunction("battlereport.getGameModeCategories", b, kwargs);
			if ((S.Modifier.contains(l_gameModeCategories.ticket, l_result.gameMode) || S.Modifier.contains(l_gameModeCategories.kill, l_result.gameMode))) {
				l_maxTickets = S.Modifier.get(S.Modifier.get(S.Modifier.get(S.Modifier.get(l_result, "teams", []), 0), "status", {}), "ticketsMax", 0);
			}
			c.push(" ");
			c.push(Surface.valOut((S.translations[l_mapName] || l_mapName)));
			c.push(" - ");
			c.push(Surface.valOut((S.translations[l_gameModeLocale] || l_gameModeLocale)));
			if (S.compat.gt(((typeof(l_maxTickets) != "undefined" && l_maxTickets !== null) ? l_maxTickets : 0), 0)) {
				c.push(": ");
				c.push(Surface.valOut(l_maxTickets));
			}
			c.push(" - ");
			c.push(Surface.valOut("ラウンド時間"));
			c.push(": ");
			c.push(Surface.valOut(S.Modifier.timer(l_result.roundTime)));
			c.push("\n </div>\n </div>\n");
			l_templateData = $S.callFunction("serverbrowserwarsaw.formatForBfhTemplate", S.Modifier.get(o.scoreboard, "result"), o.players, b, kwargs);
			c.push(" ");
			c.push(Surface.importTemplate(("battlereport" + ("." + "bfhscoreboard")), l_templateData, null, kwargs));
			c.push("\n");
		}
		else if (o.showplayers) {
			c.push(" <div class=\"box\">\n <div class=\"box-content uppercase center-text players-unavailable\">\n ");
			c.push(Surface.valOut("サーバー上のプレイヤー情報を取得できませんでした"));
			c.push("\n </div>\n </div>\n");
		}
		else {
			c.push(" <div class=\"box\">\n <div class=\"box-content center-text uppercase\">\n ");
			c.push(Surface.importTemplate(("ui" + ("." + "loader")), o, null, kwargs));
			c.push("\n </div>\n </div>\n");
		}
	}
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.bfhshow", "surface_265_9", "serverbrowser-scoreboard", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.bfhshow.block_scoreBoard = new Surface.Block('serverbrowserwarsaw.bfhshow.block_scoreBoard');
serverbrowserwarsaw.bfhshow.block_scoreBoard.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n");
	c.push(" <div id=\"server-players-list\" data-livescore=\"false\">\n");
	c.push(serverbrowserwarsaw.bfhshow.surface_265_9.render({"liveupdating": ((typeof(o) != "undefined" && o !== null && typeof(o.liveupdating) != "undefined" && o.liveupdating !== null) ? o.liveupdating : null), "players": ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : null), "scoreboard": ((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) ? o.scoreboard : null), "server": {"game": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.game) != "undefined" && o.server.game !== null) ? o.server.game : null), "platform": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.platform) != "undefined" && o.server.platform !== null) ? o.server.platform : null)}, "showplayers": ((typeof(o) != "undefined" && o !== null && typeof(o.showplayers) != "undefined" && o.showplayers !== null) ? o.showplayers : null)}, b, kwargs));
	c.push(" </div>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_bonusexpbar = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('bonusexpbar'));
serverbrowserwarsaw.bonusexpbar.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_bonusexpbar;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.bonusexpbar');
	var l_realm;
	var l_forPremium;
	var l_hasPremium;
	c.push("\n");
	l_realm = S.Modifier.get(Surface.globalContext, "realm");
	l_forPremium = ((typeof(o) != "undefined" && o !== null && typeof(o.premium) != "undefined" && o.premium !== null) ? o.premium : false);
	if ((S.compat.eq(l_realm.section, 2) && (((typeof(o) != "undefined" && o !== null && typeof(o.user) != "undefined" && o.user !== null) ? o.user : false) || l_forPremium))) {
		l_hasPremium = $S.callFunction("common.ownsPremiumExpansionAsCurrentPersona", b, kwargs);
		c.push(" <div class=\"serverbrowser-premium-scoremultiplier\">\n <div id=\"serverbrowser-premium-scoremultiplier-icon\">\n </div>\n");
		if ((l_forPremium && !(l_hasPremium))) {
			c.push(" <a href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/premium/", Surface.urlContext)));
			c.push("\"></a>\n");
		}
		c.push(" <strong>\n");
		if (l_forPremium) {
			c.push(" ");
			c.push(Surface.valOut("プレミアム XP 2倍"));
			c.push("\n");
		}
		else {
			c.push(" ");
			c.push(Surface.valOut("XP 2倍"));
			c.push("\n");
		}
		c.push(" </strong>\n <span>");
		c.push(Surface.valOut("現在アクティブ"));
		c.push("</span>\n </div>\n");
	}
	return c.join('');
}
;
;var block_serverbrowserwarsaw_expand = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('expand'));
serverbrowserwarsaw.expand.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_expand;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.expand');
	var l_for_serverbrowserwarsaw_expand_31_29_iteration;
	var l_for_serverbrowserwarsaw_expand_52_17_iteration;
	var l_friendCount;
	var l_map;
	var l_session;
	var l_realm;
	var l_for_serverbrowserwarsaw_expand_31_29_list;
	var l_for_serverbrowserwarsaw_expand_31_29_hasNext;
	var l_for_serverbrowserwarsaw_expand_31_29_count;
	var l_MAX;
	var l_for_serverbrowserwarsaw_expand_52_17_list;
	c.push("\n");
	l_session = S.Modifier.get(Surface.globalContext, "session");
	l_realm = S.Modifier.get(Surface.globalContext, "realm");
	if (o.server.online) {
		l_map = $S.callFunction("common.mapinfo", l_realm.game, o.server.map, b, kwargs);
	}
	else {
		l_map = {"imageBig": "", "name": "オフライン"};
	}
	c.push("\n<div class=\"serverbrowser-expand\">\n <div class=\"serverbrowser-expand-map\">\n <img src=\"");
	c.push(Surface.valOut($S.callFunction("base.asset", l_map.imageBig, b, kwargs)));
	c.push("\" alt=\"");
	c.push(Surface.valOut(l_map.name));
	c.push("\" />\n <div></div>\n <h3>");
	c.push(Surface.valOut(l_map.name));
	c.push("</h3>\n </div>\n <div class=\"serverbrowser-expand-info\">\n <h1>");
	c.push(Surface.valOut(o.server.name));
	c.push("</h1>\n <div class=\"serverbrowser-expand-friends\">\n <div class=\"serverbrowser-expand-friendtext\">\n");
	if (!(o.server.online)) {
		c.push(" ");
		c.push(Surface.valOut("サーバーはオフラインです"));
		c.push("\n");
	}
	else {
		if (((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false)) {
			c.push("\n");
			l_friendCount = S.Modifier.count(o.friendsOnServer);
			if (S.compat.gt(l_friendCount, 0)) {
				l_MAX = 5;
				c.push(" ");
				c.push(Surface.valOut(l_friendCount));
				c.push(" ");
				c.push(Surface.valOut(S.Modifier.pluralize(l_friendCount, "フレンド", "フレンド")));
				c.push(" ");
				c.push(Surface.valOut("プレイ中："));
				c.push(":\n");
				l_for_serverbrowserwarsaw_expand_31_29_list = o.friendsOnServer;
				l_for_serverbrowserwarsaw_expand_31_29_count = S.Modifier.count(l_for_serverbrowserwarsaw_expand_31_29_list);
				l_for_serverbrowserwarsaw_expand_31_29_iteration = 0;
				if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_expand_31_29_list), 0)) {
					for (var l_for_serverbrowserwarsaw_expand_31_29_key in l_for_serverbrowserwarsaw_expand_31_29_list) {
						if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_expand_31_29_list[l_for_serverbrowserwarsaw_expand_31_29_key])) {
							continue;
						}
						var l_friend = l_for_serverbrowserwarsaw_expand_31_29_list[l_for_serverbrowserwarsaw_expand_31_29_key];
						l_for_serverbrowserwarsaw_expand_31_29_iteration = S.compat.add(l_for_serverbrowserwarsaw_expand_31_29_iteration, 1);
						l_for_serverbrowserwarsaw_expand_31_29_hasNext = S.compat.lt(l_for_serverbrowserwarsaw_expand_31_29_iteration, l_for_serverbrowserwarsaw_expand_31_29_count);
						if (S.compat.lt(l_for_serverbrowserwarsaw_expand_31_29_iteration, S.compat.add(l_MAX, 1))) {
							c.push(" <a class=\"base-link\" href=\"#\">");
							c.push(Surface.valOut(l_friend.username));
							c.push("</a>\n");
							if ((S.compat.eq(l_for_serverbrowserwarsaw_expand_31_29_iteration, l_MAX) || !(l_for_serverbrowserwarsaw_expand_31_29_hasNext))) {
								c.push("\n");
							}
							else if ((S.compat.eq(l_for_serverbrowserwarsaw_expand_31_29_iteration, S.compat.sub(l_friendCount, 1)) && S.compat.lt(l_friendCount, S.compat.add(l_MAX, 1)))) {
								c.push(" and\n");
							}
							else {
								c.push(" ,\n");
							}
						}
						else if (S.compat.eq(l_for_serverbrowserwarsaw_expand_31_29_iteration, S.compat.add(l_MAX, 1))) {
							c.push(" and ");
							c.push(Surface.valOut(S.compat.sub(S.Modifier.count(o.friendsOnServer), l_MAX)));
							c.push(" more\n");
						}
						c.push(" ");
					}
				}
				c.push("\n");
			}
			else {
				c.push(" ");
				c.push(Surface.valOut("プレイ中のフレンドなし"));
				c.push("\n");
			}
			c.push(" ");
		}
		c.push("\n");
	}
	c.push(" </div>\n <div class=\"serverbrowser-expand-friendavatars\">\n");
	l_for_serverbrowserwarsaw_expand_52_17_list = o.friendsOnServer;
	l_for_serverbrowserwarsaw_expand_52_17_iteration = 0;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_expand_52_17_list), 0)) {
		for (var l_for_serverbrowserwarsaw_expand_52_17_key in l_for_serverbrowserwarsaw_expand_52_17_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_expand_52_17_list[l_for_serverbrowserwarsaw_expand_52_17_key])) {
				continue;
			}
			var l_friend = l_for_serverbrowserwarsaw_expand_52_17_list[l_for_serverbrowserwarsaw_expand_52_17_key];
			l_for_serverbrowserwarsaw_expand_52_17_iteration = S.compat.add(l_for_serverbrowserwarsaw_expand_52_17_iteration, 1);
			if (S.compat.lt(l_for_serverbrowserwarsaw_expand_52_17_iteration, 16)) {
				c.push(" <div class=\"base-left\">");
				c.push(Surface.importTemplate(("ui" + ("." + "avatar")), {"user": l_friend, "size": 30}, null, kwargs));
				c.push("</div>\n");
			}
		}
	}
	c.push(" </div>\n </div>\n <div class=\"serverbrowser-expand-toolbar\">\n <div title=\"");
	c.push(Surface.valOut("情報の更新"));
	c.push("\" class=\"serverbrowser-expand-refresh\">\n </div>\n <div title=\"");
	c.push(Surface.valOut("お気に入りサーバーに設定する"));
	c.push("\" class=\"serverbrowser-expand-favorite");
	if (!(((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false))) {
		c.push("-disabled");
	}
	c.push("\">\n");
	if (((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false)) {
		c.push(" <form action=\"");
		c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/gameserverbookmark/toggleFavourite/", Surface.urlContext)));
		c.push("\">\n ");
		c.push(Surface.importTemplate(("base" + ("." + "postChecksum")), o, null, kwargs));
		c.push("\n <input type=\"hidden\" name=\"guid\" value=\"");
		c.push(Surface.valOut(o.server.guid));
		c.push("\" />\n </form>\n");
	}
	c.push(" </div>\n <div class=\"serverbrowser-expand-link\">\n <input type=\"text\" value=\"");
	c.push(Surface.valOut($S.callFunction("common.showServerUrlByServer", o.server, b, kwargs)));
	c.push("\" />\n </div>\n <div class=\"serverbrowser-expand-go\">\n </div>\n </div>\n </div>\n <div style=\"clear:both;\"></div>\n</div>\n");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_favourites = new Surface.BlockConfig('serverbrowserwarsaw.base', {'content': 'serverbrowserwarsaw.favourites.block_content', 'title': 'serverbrowserwarsaw.favourites.block_title', 'sidebar': 'serverbrowserwarsaw.favourites.block_sidebar', 'titleItem': 'serverbrowserwarsaw.favourites.block_titleItem'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('favourites'));
serverbrowserwarsaw.favourites.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_favourites;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.favourites');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.base', o, b, kwargs);
}
;
serverbrowserwarsaw.favourites.block_titleItem = new Surface.Block('serverbrowserwarsaw.favourites.block_titleItem');
serverbrowserwarsaw.favourites.block_titleItem.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("お気に入り"));
	c.push(" - ");
	return c.join("");
}
;
serverbrowserwarsaw.favourites.block_title = new Surface.Block('serverbrowserwarsaw.favourites.block_title');
serverbrowserwarsaw.favourites.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("お気に入り"));
	return c.join("");
}
;
serverbrowserwarsaw.favourites.block_sidebar = new Surface.Block('serverbrowserwarsaw.favourites.block_sidebar');
serverbrowserwarsaw.favourites.block_sidebar.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	if (S.compat.eq(Surface.globalContext.realm.section, 8192)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "bfhserverinfo")), o, null, kwargs));
		c.push("\n");
	}
	else {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "warsawserverinfo")), o, null, kwargs));
		c.push("\n");
	}
	return c.join("");
}
;
serverbrowserwarsaw.favourites.block_content = new Surface.Block('serverbrowserwarsaw.favourites.block_content');
serverbrowserwarsaw.favourites.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n <section id=\"favorites\" style=\"margin-top: 16px\" data-contain=\"sticky\">\n <div id=\"results-container\" class=\"row\" style=\"");
	if (S.compat.lte(S.Modifier.count(Surface.globalContext.servers), 0)) {
		c.push("display: none");
	}
	c.push("\">\n <div class=\"span9\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverlist")), {"servers": o.servers}, null, kwargs));
	c.push("\n </div>\n <aside class=\"span3\">\n");
	c.push(b.get('sidebar')(o, b, kwargs));
	c.push(" </aside>\n </div>\n <div id=\"no-results\" class=\"box no-results\" style=\"");
	if (S.compat.gt(S.Modifier.count(Surface.globalContext.servers), 0)) {
		c.push("display: none");
	}
	c.push("\">\n <div class=\"box-content\">\n <h3>");
	c.push(Surface.valOut("お気に入りのサーバーは未登録です"));
	c.push("</h3>\n <p>");
	c.push(Surface.valOut("リスト内の星をクリックするとサーバーをお気に入りに追加できます"));
	c.push("</p>\n </div>\n </div>\n </section>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_filteradvanced = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filteradvanced'));
serverbrowserwarsaw.filteradvanced.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filteradvanced;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filteradvanced');
	var l_settingKey;
	var l_nameSID;
	var l_gameServerSettingInfo;
	var l_settingsKeys;
	var l_for_serverbrowserwarsaw_filteradvanced_7_9_list;
	var l_setting;
	c.push("\n");
	l_settingsKeys = ["osls", "vvsa", "vffi", "vaba", "vkca", "v3ca", "v3sp", "vmsp", "vrhe", "vhud", "vmin", "vnta"];
	l_gameServerSettingInfo = S.Modifier.get($S.callFunction("gamedata.get", Surface.globalContext.realm.section, "gameserver", b, kwargs), "gameServerSettings");
	c.push("<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("アドバンス"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filteradvanced_7_9_list = ((typeof(l_settingsKeys) != "undefined" && l_settingsKeys !== null) ? l_settingsKeys : []);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filteradvanced_7_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filteradvanced_7_9_key in l_for_serverbrowserwarsaw_filteradvanced_7_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filteradvanced_7_9_list[l_for_serverbrowserwarsaw_filteradvanced_7_9_key])) {
				continue;
			}
			var l_key = l_for_serverbrowserwarsaw_filteradvanced_7_9_list[l_for_serverbrowserwarsaw_filteradvanced_7_9_key];
			l_settingKey = S.Modifier.get(l_gameServerSettingInfo, l_key);
			l_nameSID = S.Modifier.get(l_settingKey, "nameSID");
			l_setting = {"id": l_key, "label": (S.translations[l_nameSID] || l_nameSID), "name": l_key};
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_setting, "collection": "advanced", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterbool = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterbool'));
serverbrowserwarsaw.filterbool.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterbool;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterbool');
	var l_settingValue;
	var l_nameSID;
	var l_gameServerSettingInfo;
	var l_for_serverbrowserwarsaw_filterbool_5_1_list;
	c.push("\n<div class=\"serverbrowser-advanced-filter-name\">\n <h1>");
	c.push(Surface.valOut("ゲーム設定"));
	c.push("</h1>\n</div>\n");
	l_for_serverbrowserwarsaw_filterbool_5_1_list = o.filters.filters;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterbool_5_1_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterbool_5_1_key in l_for_serverbrowserwarsaw_filterbool_5_1_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterbool_5_1_list[l_for_serverbrowserwarsaw_filterbool_5_1_key])) {
				continue;
			}
			var l_filter = l_for_serverbrowserwarsaw_filterbool_5_1_list[l_for_serverbrowserwarsaw_filterbool_5_1_key];
			l_gameServerSettingInfo = l_filter;
			l_settingValue = S.Modifier.get(o.serverSettings, l_filter.key, false);
			l_nameSID = S.Modifier.get(l_gameServerSettingInfo, "nameSID");
			c.push(" <div id=\"serverbrowser-");
			c.push(Surface.valOut(l_filter.key));
			c.push("\" data-key=\"");
			c.push(Surface.valOut(l_filter.key));
			c.push("\" data-type=\"bool\" class=\"bool-filter popup-serveradvancedfilter-value serverbrowser-advancedfilter-selectable serverbrowser-selectable serverbrowser-selectable-multi ");
			if (S.Modifier.contains(l_settingValue, "1")) {
				c.push("serverbrowser-include");
			}
			else if (S.Modifier.contains(l_settingValue, "0")) {
				c.push("serverbrowser-noinclude");
			}
			else {
				c.push("serverbrowser-exclude");
			}
			c.push("\" filter=\"settings-");
			c.push(Surface.valOut(l_filter.key));
			c.push("\" value=\"1,0\">\n <div class=\"ticbox\"></div>\n <span>");
			c.push(Surface.valOut(S.Modifier.capitalize((S.translations[l_nameSID] || l_nameSID))));
			c.push("</span>\n <input type=\"hidden\" name=\"settings-");
			c.push(Surface.valOut(l_filter.key));
			c.push("\" value=\"");
			c.push(Surface.valOut(((typeof(S.Modifier.get(l_settingValue, "min")) != "undefined" && S.Modifier.get(l_settingValue, "min") !== null) ? S.Modifier.get(l_settingValue, "min") : "")));
			c.push("\" />\n <div class=\"base-clear\"></div>\n </div>\n");
		}
	}
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterdetails = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterdetails'));
serverbrowserwarsaw.filterdetails.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterdetails;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterdetails');
	var l_for_serverbrowserwarsaw_filterdetails_5_9_list;
	c.push("\n<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("詳細"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterdetails_5_9_list = o.gamedetails;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterdetails_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterdetails_5_9_key in l_for_serverbrowserwarsaw_filterdetails_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterdetails_5_9_list[l_for_serverbrowserwarsaw_filterdetails_5_9_key])) {
				continue;
			}
			var l_detail = l_for_serverbrowserwarsaw_filterdetails_5_9_list[l_for_serverbrowserwarsaw_filterdetails_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_detail, "collection": "gamedetails", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterexperience = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterexperience'));
serverbrowserwarsaw.filterexperience.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterexperience;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterexperience');
	var l_for_serverbrowserwarsaw_filterexperience_5_9_list;
	c.push("\n<section class=\"filter\">\n <h3><h3>");
	c.push(Surface.valOut(S.Modifier.upper("ゲームクラス")));
	c.push("</h3></h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterexperience_5_9_list = o.experienceFilter;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterexperience_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterexperience_5_9_key in l_for_serverbrowserwarsaw_filterexperience_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterexperience_5_9_list[l_for_serverbrowserwarsaw_filterexperience_5_9_key])) {
				continue;
			}
			var l_preset = l_for_serverbrowserwarsaw_filterexperience_5_9_list[l_for_serverbrowserwarsaw_filterexperience_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_preset, "collection": "experiences", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterextra = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterextra'));
serverbrowserwarsaw.filterextra.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterextra;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterextra');
	var l_gameServerSettingInfo;
	var l_for_serverbrowserwarsaw_filterextra_6_9_list;
	c.push("\n");
	l_gameServerSettingInfo = S.Modifier.get($S.callFunction("gamedata.get", Surface.globalContext.realm.section, "gameserver", b, kwargs), "gamedetails");
	c.push("<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("エクストラ"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterextra_6_9_list = ((typeof(l_gameServerSettingInfo) != "undefined" && l_gameServerSettingInfo !== null) ? l_gameServerSettingInfo : []);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterextra_6_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterextra_6_9_key in l_for_serverbrowserwarsaw_filterextra_6_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterextra_6_9_list[l_for_serverbrowserwarsaw_filterextra_6_9_key])) {
				continue;
			}
			var l_setting = l_for_serverbrowserwarsaw_filterextra_6_9_list[l_for_serverbrowserwarsaw_filterextra_6_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_setting, "collection": "extra", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterextravenice = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterextravenice'));
serverbrowserwarsaw.filterextravenice.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterextravenice;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterextravenice');
	var l_filterAdvancedSettings;
	c.push("\n");
	l_filterAdvancedSettings = S.Modifier.get(Surface.globalContext, "filterAdvancedSettings");
	c.push("<div class=\"serverbrowser-filter serverbrowser-filter-extra\">\n <div class=\"serverbrowser-filter-name\"><h1>");
	c.push(Surface.valOut("プリセット"));
	c.push("</h1></div>\n <div class=\"serverbrowser-filter-selectables\">\n <div id=\"serverbrowser-normal\" class=\"serverbrowser-selectable ");
	if (S.Modifier.contains(o.filter.gamepresets, "normal")) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gamepresets\" value=\"normal\" >\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("ノーマル"));
	c.push("</span>\n </div>\n <div id=\"serverbrowser-hardcore\" class=\"serverbrowser-selectable ");
	if (S.Modifier.contains(o.filter.gamepresets, "hardcore")) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gamepresets\" value=\"hardcore\" >\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("ハードコア"));
	c.push("</span>\n </div>\n <div id=\"serverbrowser-infantry\" class=\"serverbrowser-selectable ");
	if (S.Modifier.contains(o.filter.gamepresets, "infantry")) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gamepresets\" value=\"infantry\" >\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("ID_WEB_FILTEREXTRABF3_INFANTRY_ONLY"));
	c.push("</span>\n </div>\n <input type=\"hidden\" name=\"gamepresets\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.gamepresets) != "undefined" && o.filter.gamepresets !== null) ? o.filter.gamepresets : []), "|")));
	c.push("\" />\n </div>\n <div class=\"serverbrowser-filter-name\"><h1>");
	c.push(Surface.valOut("詳細"));
	c.push("</h1></div>\n <div class=\"serverbrowser-filter-selectables\">\n <div id=\"serverbrowser-ranked\" class=\"serverbrowser-selectable serverbrowser-selectable-multi ");
	if (S.Modifier.contains(o.filter.ranked, "On")) {
		c.push("serverbrowser-include");
	}
	else if (S.Modifier.contains(o.filter.ranked, "Off")) {
		c.push("serverbrowser-noinclude");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"ranked\" value=\"On,Off\" >\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("ランク"));
	c.push("</span>\n </div>\n <div id=\"serverbrowser-punkbuster\" class=\"serverbrowser-selectable serverbrowser-selectable-multi ");
	if (S.Modifier.contains(o.filter.punkbuster, "On")) {
		c.push("serverbrowser-include");
	}
	else if (S.Modifier.contains(o.filter.punkbuster, "Off")) {
		c.push("serverbrowser-noinclude");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"punkbuster\" value=\"On,Off\">\n <div class=\"ticbox\"></div>\n <span>Punkbuster</span>\n </div>\n <div id=\"serverbrowser-maprotation\" class=\"serverbrowser-selectable serverbrowser-selectable-multi ");
	if (S.Modifier.contains(o.filter.mapRotation, "On")) {
		c.push("serverbrowser-include");
	}
	else if (S.Modifier.contains(o.filter.mapRotation, "Off")) {
		c.push("serverbrowser-noinclude");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"mapRotation\" value=\"On,Off\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("マップローテーション"));
	c.push("</span>\n </div>\n <div id=\"serverbrowser-moderotation\" class=\"serverbrowser-selectable serverbrowser-selectable-multi ");
	if (S.Modifier.contains(o.filter.modeRotation, "On")) {
		c.push("serverbrowser-include");
	}
	else if (S.Modifier.contains(o.filter.modeRotation, "Off")) {
		c.push("serverbrowser-noinclude");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"modeRotation\" value=\"On,Off\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("ゲームモードローテーション"));
	c.push("</span>\n </div>\n <div id=\"serverbrowser-password\" class=\"serverbrowser-selectable serverbrowser-selectable-multi ");
	if (S.Modifier.contains(o.filter.password, "On")) {
		c.push("serverbrowser-include");
	}
	else if (S.Modifier.contains(o.filter.password, "Off")) {
		c.push("serverbrowser-noinclude");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"password\" value=\"On,Off\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("パスワード保護"));
	c.push("</span>\n </div>\n <input type=\"hidden\" name=\"ranked\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.ranked) != "undefined" && o.filter.ranked !== null) ? o.filter.ranked : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"punkbuster\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.punkbuster) != "undefined" && o.filter.punkbuster !== null) ? o.filter.punkbuster : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"mapRotation\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.mapRotation) != "undefined" && o.filter.mapRotation !== null) ? o.filter.mapRotation : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"modeRotation\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.modeRotation) != "undefined" && o.filter.modeRotation !== null) ? o.filter.modeRotation : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"password\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.password) != "undefined" && o.filter.password !== null) ? o.filter.password : []), "|")));
	c.push("\" />\n </div>\n <div class=\"serverbrowser-filter-name\"><h1>");
	c.push(Surface.valOut("上級設定"));
	c.push("</h1></div>\n <div class=\"serverbrowser-filter-selectables\">\n <div id=\"serverbrowser-advanced-settings-checkbox\" class=\"serverbrowser-selectable ");
	if (S.Modifier.contains(o.filter.useAdvanced, "On")) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"useAdvanced\" value=\"On\" >\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("フィルター"));
	c.push("</span>\n </div>\n <a id=\"serverbrowser-open-advanced-link\" class=\"serverbrowser-open-filter-box\">");
	if (S.Modifier.count(l_filterAdvancedSettings)) {
		c.push(Surface.valOut(S.Modifier.count(l_filterAdvancedSettings)));
		c.push(" ");
		c.push(Surface.valOut("詳細"));
		c.push(" - ");
		c.push(Surface.valOut("編集"));
	}
	else {
		c.push(Surface.valOut("設定"));
	}
	c.push("</a>\n <input type=\"hidden\" name=\"useAdvanced\" value=\"");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.useAdvanced) != "undefined" && o.filter.useAdvanced !== null)) {
		c.push(Surface.valOut(S.Modifier.join(o.filter.useAdvanced, "|")));
	}
	c.push("\" />\n </div>\n</div>\n");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterfreetext = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterfreetext'));
serverbrowserwarsaw.filterfreetext.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterfreetext;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterfreetext');
	c.push("\n<section class=\"filter\" id=\"freetext-filter\">\n <h3>");
	c.push(Surface.valOut("サーバー名でフィルター"));
	c.push("</h3>\n");
	if (!((typeof(o) != "undefined" && o !== null && typeof(o.searchQuery) != "undefined" && o.searchQuery !== null))) {
		o.searchQuery = "";
	}
	c.push(" <input id=\"serverbrowser-search-input\" type=\"text\" placeholder=\"");
	c.push(Surface.valOut("サーバー名"));
	c.push("\" name=\"q\" title=\"\" value=\"");
	c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.searchQuery) != "undefined" && o.searchQuery !== null) ? o.searchQuery : "")));
	c.push("\" autocomplete=\"off\" maxlength=\"100\" />\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filtergameexpansion = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filtergameexpansion'));
serverbrowserwarsaw.filtergameexpansion.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filtergameexpansion;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filtergameexpansion');
	var l_for_serverbrowserwarsaw_filtergameexpansion_5_9_list;
	c.push("\n<section class=\"filter gameexpansion-filter\">\n <h3>");
	c.push(Surface.valOut("ゲーム"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filtergameexpansion_5_9_list = o.gameexpansions;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtergameexpansion_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtergameexpansion_5_9_key in l_for_serverbrowserwarsaw_filtergameexpansion_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtergameexpansion_5_9_list[l_for_serverbrowserwarsaw_filtergameexpansion_5_9_key])) {
				continue;
			}
			var l_expansion = l_for_serverbrowserwarsaw_filtergameexpansion_5_9_list[l_for_serverbrowserwarsaw_filtergameexpansion_5_9_key];
			c.push(" <li>\n <input");
			if (S.Modifier.contains(o.filter.gameexpansions, l_expansion.id)) {
				c.push(" checked ");
			}
			c.push(" type=\"checkbox\" name=\"gameexpansions\" value=\"");
			c.push(Surface.valOut(l_expansion.id));
			c.push("\" id=\"gameexpansion-");
			c.push(Surface.valOut(l_expansion.id));
			c.push("\"> <label for=\"gameexpansion-");
			c.push(Surface.valOut(l_expansion.id));
			c.push("\"><img alt=\"");
			c.push(Surface.valOut(l_expansion.label));
			c.push("\" src=\"");
			c.push(Surface.valOut($S.callFunction("base.asset", S.compat.add(S.compat.add(S.compat.add(S.compat.add("/public/serverguide/", $S.callFunction("base.section", Surface.globalContext.realm.section, b, kwargs)), "/filter-"), S.Modifier.concat(l_expansion.id, "")), ".png"), b, kwargs)));
			c.push("\"></label>\n </li>\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filtergamemode = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filtergamemode'));
serverbrowserwarsaw.filtergamemode.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filtergamemode;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filtergamemode');
	var l_for_serverbrowserwarsaw_filtergamemode_5_9_list;
	c.push("\n<section class=\"filter split\">\n <h3>");
	c.push(Surface.valOut("モード"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filtergamemode_5_9_list = o.gamemodes;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtergamemode_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtergamemode_5_9_key in l_for_serverbrowserwarsaw_filtergamemode_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtergamemode_5_9_list[l_for_serverbrowserwarsaw_filtergamemode_5_9_key])) {
				continue;
			}
			var l_mode = l_for_serverbrowserwarsaw_filtergamemode_5_9_list[l_for_serverbrowserwarsaw_filtergamemode_5_9_key];
			if (((typeof(l_mode) != "undefined" && l_mode !== null && typeof(l_mode.platforms) != "undefined" && l_mode.platforms !== null) ? l_mode.platforms : false)) {
				if (!(S.Modifier.contains(l_mode.platforms, o.platform))) {
					continue;
				}
			}
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_mode, "collection": "gamemodes", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>\n");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filtergamesize = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filtergamesize'));
serverbrowserwarsaw.filtergamesize.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filtergamesize;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filtergamesize');
	var l_for_serverbrowserwarsaw_filtergamesize_5_9_list;
	c.push("\n<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("ゲームサイズ"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filtergamesize_5_9_list = o.gamesize;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtergamesize_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtergamesize_5_9_key in l_for_serverbrowserwarsaw_filtergamesize_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtergamesize_5_9_list[l_for_serverbrowserwarsaw_filtergamesize_5_9_key])) {
				continue;
			}
			var l_size = l_for_serverbrowserwarsaw_filtergamesize_5_9_list[l_for_serverbrowserwarsaw_filtergamesize_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_size, "collection": "gameSize", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filtergameslots = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filtergameslots'));
serverbrowserwarsaw.filtergameslots.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filtergameslots;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filtergameslots');
	var l_for_serverbrowserwarsaw_filtergameslots_5_9_list;
	var l_for_serverbrowserwarsaw_filtergameslots_15_9_list;
	var l_for_serverbrowserwarsaw_filtergameslots_10_9_list;
	c.push("\n<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("空きスロット"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filtergameslots_5_9_list = o.gameslots;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtergameslots_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtergameslots_5_9_key in l_for_serverbrowserwarsaw_filtergameslots_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtergameslots_5_9_list[l_for_serverbrowserwarsaw_filtergameslots_5_9_key])) {
				continue;
			}
			var l_slot = l_for_serverbrowserwarsaw_filtergameslots_5_9_list[l_for_serverbrowserwarsaw_filtergameslots_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_slot, "collection": "slots", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n <ul>\n");
	l_for_serverbrowserwarsaw_filtergameslots_10_9_list = o.commanderSlots;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtergameslots_10_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtergameslots_10_9_key in l_for_serverbrowserwarsaw_filtergameslots_10_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtergameslots_10_9_list[l_for_serverbrowserwarsaw_filtergameslots_10_9_key])) {
				continue;
			}
			var l_commanderSlot = l_for_serverbrowserwarsaw_filtergameslots_10_9_list[l_for_serverbrowserwarsaw_filtergameslots_10_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_commanderSlot, "collection": "commanderSlots", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n <ul>\n");
	l_for_serverbrowserwarsaw_filtergameslots_15_9_list = o.spectatorSlots;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtergameslots_15_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtergameslots_15_9_key in l_for_serverbrowserwarsaw_filtergameslots_15_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtergameslots_15_9_list[l_for_serverbrowserwarsaw_filtergameslots_15_9_key])) {
				continue;
			}
			var l_spectatorSlot = l_for_serverbrowserwarsaw_filtergameslots_15_9_list[l_for_serverbrowserwarsaw_filtergameslots_15_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_spectatorSlot, "collection": "spectatorSlots", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filtergametype = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filtergametype'));
serverbrowserwarsaw.filtergametype.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filtergametype;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filtergametype');
	c.push("\n<div class=\"serverbrowser-filter serverbrowser-filter-gametype\">\n <div class=\"serverbrowser-filter-name\"><h1>");
	c.push(Surface.valOut("オリジナルルール"));
	c.push("</h1></div>\n <div class=\"serverbrowser-filter-selectables\">\n <div id=\"serverbrowser-normal\" class=\"serverbrowser-selectable ");
	if (S.Modifier.contains(o.filter.gamepresets, "normal")) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gamepresets\" value=\"normal\" title=\"Normal\">\n <span>");
	c.push(Surface.valOut("ノーマル"));
	c.push("</span>\n </div>\n <div id=\"serverbrowser-hardcore\" class=\"serverbrowser-selectable ");
	if (S.Modifier.contains(o.filter.gamepresets, "hardcore")) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gamepresets\" value=\"hardcore\" title=\"Hardcore\">\n <span>");
	c.push(Surface.valOut("ハードコア"));
	c.push("</span>\n </div>\n </div>\n <input type=\"hidden\" name=\"gamepresets\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(o.filter.gamepresets, "|")));
	c.push("\" />\n</div>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filteritem = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filteritem'));
serverbrowserwarsaw.filteritem.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filteritem;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filteritem');
	var l_imgHeight;
	var l_checked;
	var l_className;
	var l_icons;
	var l_active;
	var l_imgsrc;
	var l_name;
	var l_values;
	var l_selected;
	var l_include;
	var l_currMax;
	var l_imgWidth;
	var l_exclude;
	var l_currMin;
	var l_for_serverbrowserwarsaw_filteritem_57_9_list;
	var l_max;
	var l_min;
	c.push("\n");
	o.filter = ((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null) ? o.filter : {});
	l_imgWidth = ((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.width) != "undefined" && o.item.width !== null) ? o.item.width : "30");
	l_imgHeight = ((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.height) != "undefined" && o.item.height !== null) ? o.item.height : "21");
	l_className = "";
	c.push("\n");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.name) != "undefined" && o.item.name !== null)) {
		l_selected = -1;
		if (S.compat.eq(o.collection, "advanced")) {
			if (S.Modifier.contains(S.Modifier.get(o.filter, "settings"), S.Modifier.join([o.item.id, "1", "1"], ","))) {
				l_selected = 1;
			}
			else if (S.Modifier.contains(S.Modifier.get(o.filter, "settings"), S.Modifier.join([o.item.id, "0", "0"], ","))) {
				l_selected = 0;
			}
		}
		else if (S.compat.eq(o.collection, "gameexpansion")) {
			l_include = S.Modifier.get(o.filter, "includeExpansions");
			l_exclude = S.Modifier.get(o.filter, "excludeExpansions");
			if (S.Modifier.contains(l_include, o.item.expansion)) {
				l_selected = 1;
			}
			else if (S.Modifier.contains(l_exclude, o.item.expansion)) {
				l_selected = 0;
			}
		}
		else {
			l_selected = S.Modifier.get(o.filter, o.item.name, -1);
		}
		c.push("\n");
		if (S.compat.eq(l_selected, 0)) {
			l_className = "off";
		}
		if (S.compat.eq(l_selected, 1)) {
			l_className = "on";
		}
		c.push("\n <li");
		if (S.compat.neq(l_className, "")) {
			c.push(" class=\"");
			c.push(Surface.valOut(l_className));
			c.push("\"");
		}
		c.push(" ");
		if (((typeof(o) != "undefined" && o !== null && typeof(o.toggleSection) != "undefined" && o.toggleSection !== null) ? o.toggleSection : false)) {
			c.push("data-toggle=\"section\"");
		}
		c.push(">\n <select name=\"");
		c.push(Surface.valOut(o.item.name));
		c.push("\" id=\"");
		c.push(Surface.valOut(o.collection));
		c.push("-");
		c.push(Surface.valOut(o.item.id));
		c.push("\" ");
		if (((typeof(o) != "undefined" && o !== null && typeof(o.disabled) != "undefined" && o.disabled !== null) ? o.disabled : false)) {
			c.push("disabled");
		}
		c.push(" ");
		if ((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.expansion) != "undefined" && o.item.expansion !== null)) {
			c.push("data-expansion=\"");
			c.push(Surface.valOut(o.item.expansion));
			c.push("\"");
		}
		c.push(">\n <option value=\"-1\"");
		if (S.compat.eq(l_selected, -1)) {
			c.push(" selected");
		}
		c.push(">-1</option>\n <option value=\"1\"");
		if (S.compat.eq(l_selected, 1)) {
			c.push(" selected");
		}
		c.push(">1</option>\n <option value=\"0\"");
		if (S.compat.eq(l_selected, 0)) {
			c.push(" selected");
		}
		c.push(">0</option>\n </select>\n <label for=\"");
		c.push(Surface.valOut(o.collection));
		c.push("-");
		c.push(Surface.valOut(o.item.id));
		c.push("\" class=\"");
		if (S.compat.eq(o.item.name, "premium")) {
			c.push("premium");
		}
		c.push("\">\n ");
		if ((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.icon) != "undefined" && o.item.icon !== null)) {
			c.push("<img class=\"icon\" width=\"");
			c.push(Surface.valOut(l_imgWidth));
			c.push("\" height=\"");
			c.push(Surface.valOut(l_imgHeight));
			c.push("\" alt=\"");
			c.push(Surface.valOut(o.item.label));
			c.push("\" src=\"");
			c.push(Surface.valOut($S.callFunction("base.asset", o.item.icon, b, kwargs)));
			c.push("\">");
		}
		c.push("\n <span>");
		c.push(Surface.valOut(S.Modifier.capitalize(o.item.label)));
		c.push("</span>\n </label>\n </li>\n");
	}
	else if (((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.max) != "undefined" && o.item.max !== null) && (typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.min) != "undefined" && o.item.min !== null))) {
		l_selected = [];
		l_min = o.item.min;
		l_max = o.item.max;
		l_name = S.compat.add(S.compat.add(o.collection, "-"), o.item.id);
		l_currMin = l_min;
		l_currMax = l_max;
		l_active = false;
		c.push("\n");
		if (((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null) && S.Modifier.get(o.filter, o.collection))) {
			l_selected = S.Modifier.get(o.filter, o.collection);
			l_for_serverbrowserwarsaw_filteritem_57_9_list = l_selected;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filteritem_57_9_list), 0)) {
				for (var l_for_serverbrowserwarsaw_filteritem_57_9_key in l_for_serverbrowserwarsaw_filteritem_57_9_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filteritem_57_9_list[l_for_serverbrowserwarsaw_filteritem_57_9_key])) {
						continue;
					}
					var l_value = l_for_serverbrowserwarsaw_filteritem_57_9_list[l_for_serverbrowserwarsaw_filteritem_57_9_key];
					l_values = S.Modifier.explode(l_value, ",");
					if (S.compat.eq(S.Modifier.get(l_values, 0), o.item.id)) {
						l_active = true;
						l_currMin = S.Modifier.get(l_values, 1);
						l_currMax = S.Modifier.get(l_values, 2);
						l_className = "on";
					}
				}
			}
		}
		c.push(" <li class=\"filter-range ");
		c.push(Surface.valOut(l_className));
		c.push("\" ");
		if (((typeof(o) != "undefined" && o !== null && typeof(o.toggleSection) != "undefined" && o.toggleSection !== null) ? o.toggleSection : false)) {
			c.push("data-toggle=\"section\"");
		}
		c.push(">\n <input type=\"checkbox\" name=\"");
		c.push(Surface.valOut(l_name));
		c.push("\" value=\"1\" id=\"");
		c.push(Surface.valOut(l_name));
		c.push("\" ");
		if (((typeof(l_active) != "undefined" && l_active !== null) ? l_active : false)) {
			c.push("checked");
		}
		c.push(" ");
		if (((typeof(o) != "undefined" && o !== null && typeof(o.disabled) != "undefined" && o.disabled !== null) ? o.disabled : false)) {
			c.push("disabled");
		}
		c.push(">\n <label for=\"");
		c.push(Surface.valOut(l_name));
		c.push("\">");
		c.push(Surface.valOut(S.Modifier.capitalize(((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.label) != "undefined" && o.item.label !== null) ? o.item.label : ""))));
		c.push("</label>\n <div class=\"pull-right min-max-field\">\n <input id=\"");
		c.push(Surface.valOut(o.item.id));
		c.push("-min\" name=\"");
		c.push(Surface.valOut(o.item.id));
		c.push("-min\" type=\"number\" maxlength=\"4\"\n min=\"");
		c.push(Surface.valOut(l_min));
		c.push("\" max=\"");
		c.push(Surface.valOut(l_max));
		c.push("\" value=\"");
		c.push(Surface.valOut(l_currMin));
		c.push("\" pattern=\"[0-9]*\"/> - <input\n id=\"");
		c.push(Surface.valOut(o.item.id));
		c.push("-max\" name=\"");
		c.push(Surface.valOut(o.item.id));
		c.push("-max\" type=\"number\" maxlength=\"4\"\n min=\"");
		c.push(Surface.valOut(l_min));
		c.push("\" max=\"");
		c.push(Surface.valOut(l_max));
		c.push("\" value=\"");
		c.push(Surface.valOut(l_currMax));
		c.push("\" pattern=\"[0-9]*\"/>\n </div>\n </li>\n");
	}
	else if ((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.label) != "undefined" && o.item.label !== null)) {
		l_selected = [];
		if (((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null) && S.Modifier.get(o.filter, o.collection))) {
			l_selected = S.Modifier.get(o.filter, o.collection);
			if (S.Modifier.contains(l_selected, o.item.id)) {
				l_className = "on";
			}
		}
		c.push(" <li");
		if (S.compat.neq(l_className, "")) {
			c.push(" class=\"");
			c.push(Surface.valOut(l_className));
			c.push("\"");
		}
		c.push(" ");
		if (((typeof(o) != "undefined" && o !== null && typeof(o.toggleSection) != "undefined" && o.toggleSection !== null) ? o.toggleSection : false)) {
			c.push("data-toggle=\"section\"");
		}
		c.push(">\n");
		l_checked = false;
		if (S.Modifier.contains(l_selected, o.item.id)) {
			l_checked = true;
		}
		else if ((S.compat.eq(o.collection, "advanced") && S.Modifier.contains(S.Modifier.get(o.filter, "settings"), S.Modifier.join([o.item.id, "1", "1"], ",")))) {
			l_checked = true;
		}
		c.push("\n <input type=\"checkbox\" name=\"");
		c.push(Surface.valOut(o.collection));
		c.push("\" value=\"");
		c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.value) != "undefined" && o.item.value !== null) ? o.item.value : o.item.id)));
		c.push("\" id=\"");
		c.push(Surface.valOut(o.collection));
		c.push("-");
		c.push(Surface.valOut(o.item.id));
		c.push("\"");
		if (l_checked) {
			c.push(" checked");
		}
		c.push(" ");
		if (((typeof(o) != "undefined" && o !== null && typeof(o.disabled) != "undefined" && o.disabled !== null) ? o.disabled : false)) {
			c.push("disabled");
		}
		c.push(">\n <label for=\"");
		c.push(Surface.valOut(o.collection));
		c.push("-");
		c.push(Surface.valOut(o.item.id));
		c.push("\">\n");
		if (S.compat.eq(o.collection, "serverTypes")) {
			l_icons = {1: "official", 2: "ranked", 4: "unranked", 8: "private"};
			if (S.compat.eq(Surface.globalContext.realm.section, 8192)) {
				o.item.icon = S.Modifier.concat(S.Modifier.concat(S.Modifier.concat("/public/serverguide/icon-rank-", S.Modifier.get(l_icons, o.item.id)), "-dark"), ".png");
			}
			else {
				o.item.icon = S.Modifier.concat(S.Modifier.concat("/public/serverguide/icon-rank-", S.Modifier.get(l_icons, o.item.id)), ".png");
			}
			l_imgWidth = "11";
			l_imgHeight = "16";
		}
		c.push("\n");
		if ((typeof(o) != "undefined" && o !== null && typeof(o.item) != "undefined" && o.item !== null && typeof(o.item.icon) != "undefined" && o.item.icon !== null)) {
			l_imgsrc = $S.callFunction("base.asset", o.item.icon, b, kwargs);
			c.push(" <img class=\"icon\" width=\"");
			c.push(Surface.valOut(l_imgWidth));
			c.push("\" height=\"");
			c.push(Surface.valOut(l_imgHeight));
			c.push("\" alt=\"");
			c.push(Surface.valOut(S.Modifier.capitalize(o.item.label)));
			c.push("\" src=\"");
			c.push(Surface.valOut(l_imgsrc));
			c.push("\" />\n");
		}
		if (S.compat.eq(o.item.id, "XP0_Firestorm")) {
			o.item.label = S.Modifier.replace(o.item.label, "OPERATION", "OP.");
		}
		c.push(" <span>");
		c.push(Surface.valOut(S.Modifier.capitalize(o.item.label)));
		c.push("</span>\n </label>\n </li>\n");
	}
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filtermaps = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filtermaps'));
serverbrowserwarsaw.filtermaps.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filtermaps;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filtermaps');
	var l_disabled;
	var l_showTitle;
	var l_label;
	var l_for_serverbrowserwarsaw_filtermaps_66_9_list;
	var l_item;
	var l_realm;
	var l_excluded;
	var l_expansion;
	var l_mapinfo;
	var l_mapsSorted;
	c.push("\n");
	l_realm = S.Modifier.get(Surface.globalContext, "realm");
	o.xpack = ((typeof(o) != "undefined" && o !== null && typeof(o.xpack) != "undefined" && o.xpack !== null) ? o.xpack : "core");
	c.push("<section class=\"filter split");
	if (S.compat.neq(o.xpack, "core")) {
		c.push(" xpack-filter");
	}
	c.push("\">\n <ul>\n");
	l_showTitle = true;
	if (((typeof(S.Modifier.get(S.Modifier.get(o.maps, 0), "platforms")) != "undefined" && S.Modifier.get(S.Modifier.get(o.maps, 0), "platforms") !== null) ? S.Modifier.get(S.Modifier.get(o.maps, 0), "platforms") : false)) {
		if (!(S.Modifier.contains(S.Modifier.get(S.Modifier.get(o.maps, 0), "platforms"), o.platform))) {
			l_showTitle = false;
		}
	}
	c.push("\n");
	l_disabled = false;
	if (l_showTitle) {
		l_expansion = S.Modifier.get(S.Modifier.get(o.maps, 0), "gameExpansion");
		if (S.compat.eq(o.xpack, "core")) {
			l_label = "";
			c.push("\n");
			if (S.compat.eq(l_realm.section, 2048)) {
				l_label = "バトルフィールド 4";
			}
			else if (S.compat.eq(l_realm.section, 8192)) {
				l_label = "バトルフィールド ハードライン";
			}
			c.push("\n");
			l_item = {"id": 0, "label": l_label, "name": "gameexpansions", "index": o.index, "expansion": l_expansion};
			c.push("\n");
		}
		else {
			l_label = "";
			c.push("\n");
			if (S.compat.eq(l_realm.section, 2048)) {
				l_label = $S.callFunction("common.getTranslatedBf4ExpansionName", o.xpack, b, kwargs);
			}
			else if (S.compat.eq(l_realm.section, 8192)) {
				l_label = $S.callFunction("common.getTranslatedBfhExpansionName", o.xpack, b, kwargs);
			}
			c.push("\n");
			l_item = {"id": l_expansion, "name": "gameexpansions", "label": l_label, "icon": S.Modifier.concat(S.Modifier.concat("/public/common/tags/expansion/", l_expansion), ".gif"), "width": "14", "height": "14", "index": o.index, "expansion": l_expansion};
			c.push("\n");
		}
		c.push("\n");
		l_excluded = S.Modifier.contains(S.Modifier.get(o.filter, "excludeExpansions"), l_expansion);
		if (l_excluded) {
			l_disabled = true;
		}
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_item, "collection": "gameexpansion", "filter": o.filter, "toggleSection": true}, null, kwargs));
		c.push("\n");
	}
	c.push("\n");
	l_mapsSorted = S.Modifier.sortfast(o.maps, "label", "asc");
	l_for_serverbrowserwarsaw_filtermaps_66_9_list = l_mapsSorted;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtermaps_66_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtermaps_66_9_key in l_for_serverbrowserwarsaw_filtermaps_66_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtermaps_66_9_list[l_for_serverbrowserwarsaw_filtermaps_66_9_key])) {
				continue;
			}
			var l_map = l_for_serverbrowserwarsaw_filtermaps_66_9_list[l_for_serverbrowserwarsaw_filtermaps_66_9_key];
			l_mapinfo = $S.callFunction("common.mapinfo", Surface.globalContext.realm.game, l_map.id, b, kwargs);
			l_map.icon = S.Modifier.get(l_mapinfo, "imageIcon");
			c.push("\n");
			l_map.label = l_map.label;
			if (((typeof(l_map) != "undefined" && l_map !== null && typeof(l_map.platforms) != "undefined" && l_map.platforms !== null) ? l_map.platforms : false)) {
				if (!(S.Modifier.contains(l_map.platforms, o.platform))) {
					continue;
				}
			}
			c.push("\n");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_map, "collection": "maps", "filter": o.filter, "disabled": l_disabled}, null, kwargs));
			c.push("\n");
		}
	}
	c.push("\n </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filternumber = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filternumber'));
serverbrowserwarsaw.filternumber.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filternumber;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filternumber');
	var l_settingValueMax;
	var l_settingValue;
	var l_settingValueMin;
	var l_settingMaxLength;
	var l_serverSettingKey;
	var l_nameSID;
	var l_gameServerSettingInfo;
	var l_settingValueDefault;
	var l_for_serverbrowserwarsaw_filternumber_6_1_list;
	c.push("\n<div class=\"serverbrowser-advanced-filter-name\">\n <h1>");
	c.push(Surface.valOut("規制"));
	c.push("</h1>\n</div>\n<table>\n");
	l_for_serverbrowserwarsaw_filternumber_6_1_list = o.filters.filters;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filternumber_6_1_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filternumber_6_1_key in l_for_serverbrowserwarsaw_filternumber_6_1_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filternumber_6_1_list[l_for_serverbrowserwarsaw_filternumber_6_1_key])) {
				continue;
			}
			var l_filter = l_for_serverbrowserwarsaw_filternumber_6_1_list[l_for_serverbrowserwarsaw_filternumber_6_1_key];
			l_serverSettingKey = l_filter.key;
			l_gameServerSettingInfo = l_filter;
			l_settingValue = S.Modifier.get(o.serverSettings, l_serverSettingKey, false);
			l_settingValueDefault = S.Modifier.get(l_gameServerSettingInfo, "default", 0);
			l_settingValueMin = S.Modifier.get(l_settingValue, "min", S.Modifier.get(l_gameServerSettingInfo, "min", l_settingValueDefault));
			l_settingValueMax = S.Modifier.get(l_settingValue, "max", S.Modifier.get(l_gameServerSettingInfo, "max", l_settingValueDefault));
			c.push("\n");
			l_nameSID = S.Modifier.concat(S.Modifier.get(l_gameServerSettingInfo, "nameSID"), "_WEB");
			c.push(" <tr>\n <td class=\"advanced-filter-col\">\n <div class=\"popup-serveradvancedfilter-title\">");
			c.push(Surface.valOut((S.translations[l_nameSID] || l_nameSID)));
			c.push("</div>\n </td>\n <td>\n <div data-filter=\"");
			c.push(Surface.valOut(o.filters.type));
			c.push("\" class=\"popup-serveradvancedfilter-value\" data-key=\"");
			c.push(Surface.valOut(l_serverSettingKey));
			c.push("\" ");
			if (S.compat.eq(S.Modifier.get(l_gameServerSettingInfo, "type"), "bool")) {
				c.push("data-type=\"bool\"");
			}
			else {
				c.push("data-type=\"range\"");
			}
			c.push(" data-default=\"");
			c.push(Surface.valOut(S.Modifier.get(l_gameServerSettingInfo, "default", 0)));
			c.push("\" filter=\"settings\">\n");
			if (S.compat.eq(S.Modifier.get(l_gameServerSettingInfo, "type"), "bool")) {
				c.push(" <select name=\"");
				c.push(Surface.valOut(l_serverSettingKey));
				c.push("\" class=\"popup-serveradvancedfilter-select\">\n <option value=\"-\">Any</option>\n <option value=\"1\"");
				if ((S.compat.eq(l_settingValueMin, "1") && l_settingValue)) {
					c.push(" selected");
				}
				c.push(">On</option>\n <option value=\"0\"");
				if ((S.compat.eq(l_settingValueMin, "0") && l_settingValue)) {
					c.push(" selected");
				}
				c.push(">Off</option>\n </select>\n <input name=\"");
				c.push(Surface.valOut(l_serverSettingKey));
				c.push("\" type=\"checkbox\" ");
				if (S.compat.eq(l_settingValueMin, "1")) {
					c.push("checked");
				}
				c.push(" />\n");
			}
			else {
				l_settingMaxLength = S.Modifier.count(S.Modifier.concat("", l_settingValueMax));
				c.push(" <input class=\"popup-serveradvancedfilter-input\" name=\"");
				c.push(Surface.valOut(l_serverSettingKey));
				c.push("-min\" type=\"number\" maxlength=\"");
				c.push(Surface.valOut(l_settingMaxLength));
				c.push("\" min=\"");
				c.push(Surface.valOut(l_settingValueMin));
				c.push("\" max=\"");
				c.push(Surface.valOut(l_settingValueMax));
				c.push("\" value=\"");
				c.push(Surface.valOut(l_settingValueMin));
				c.push("\" /> - <input class=\"popup-serveradvancedfilter-input\" name=\"");
				c.push(Surface.valOut(l_serverSettingKey));
				c.push("-max\" type=\"number\" maxlength=\"");
				c.push(Surface.valOut(l_settingMaxLength));
				c.push("\" min=\"");
				c.push(Surface.valOut(l_settingValueMin));
				c.push("\" max=\"");
				c.push(Surface.valOut(l_settingValueMax));
				c.push("\" value=\"");
				c.push(Surface.valOut(l_settingValueMax));
				c.push("\" />\n");
			}
			c.push(" <span style=\"color: #898989;\">");
			if (S.compat.eq(S.Modifier.get(l_gameServerSettingInfo, "unitType"), "percent")) {
				c.push("%");
			}
			else {
				c.push(Surface.valOut(S.Modifier.get(l_gameServerSettingInfo, "unitType")));
			}
			c.push("</span>\n <div class=\"base-clear\"></div>\n </div>\n </td>\n </tr>\n");
		}
	}
	c.push("</table>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterpercent = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterpercent'));
serverbrowserwarsaw.filterpercent.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterpercent;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterpercent');
	var l_for_serverbrowserwarsaw_filterpercent_6_1_list;
	var l_settingValueMax;
	var l_settingValue;
	var l_settingValueMin;
	var l_settingValueMinBase;
	var l_serverSettingKey;
	var l_settingValueMaxBase;
	var l_nameSID;
	var l_gameServerSettingInfo;
	var l_settingValueDefault;
	c.push("\n<div class=\"serverbrowser-advanced-filter-name\">\n <h1>");
	c.push(Surface.valOut("プレイヤー設定"));
	c.push("</h1>\n</div>\n<table>\n");
	l_for_serverbrowserwarsaw_filterpercent_6_1_list = o.filters.filters;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterpercent_6_1_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterpercent_6_1_key in l_for_serverbrowserwarsaw_filterpercent_6_1_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterpercent_6_1_list[l_for_serverbrowserwarsaw_filterpercent_6_1_key])) {
				continue;
			}
			var l_filter = l_for_serverbrowserwarsaw_filterpercent_6_1_list[l_for_serverbrowserwarsaw_filterpercent_6_1_key];
			l_gameServerSettingInfo = l_filter;
			l_serverSettingKey = l_filter.key;
			l_settingValue = S.Modifier.get(o.serverSettings, l_filter.key, false);
			l_settingValueDefault = S.Modifier.get(l_gameServerSettingInfo, "default", 0);
			l_settingValueMinBase = S.Modifier.get(l_gameServerSettingInfo, "min", l_settingValueDefault);
			l_settingValueMaxBase = S.Modifier.get(l_gameServerSettingInfo, "max", l_settingValueDefault);
			l_settingValueMin = S.Modifier.get(l_settingValue, "min", l_settingValueMinBase);
			l_settingValueMax = S.Modifier.get(l_settingValue, "max", l_settingValueMaxBase);
			c.push("\n");
			l_nameSID = S.Modifier.concat(S.Modifier.get(l_gameServerSettingInfo, "nameSID"), "_WEB");
			c.push(" <tr>\n <td class=\"advanced-filter-col\">\n <div class=\"popup-serveradvancedfilter-title\">");
			c.push(Surface.valOut((S.translations[l_nameSID] || l_nameSID)));
			c.push("</div>\n </td>\n <td>\n <div data-filter=\"");
			c.push(Surface.valOut(o.filters.type));
			c.push("\" class=\"popup-serveradvancedfilter-value\" data-key=\"");
			c.push(Surface.valOut(l_serverSettingKey));
			c.push("\" ");
			if (S.compat.eq(S.Modifier.get(l_gameServerSettingInfo, "type"), "bool")) {
				c.push("data-type=\"bool\"");
			}
			else {
				c.push("data-type=\"range\"");
			}
			c.push(" data-default=\"");
			c.push(Surface.valOut(S.Modifier.get(l_gameServerSettingInfo, "default", 0)));
			c.push("\" filter=\"settings\">\n");
			if (S.compat.eq(S.Modifier.get(l_gameServerSettingInfo, "type"), "bool")) {
				c.push(" <select name=\"");
				c.push(Surface.valOut(l_serverSettingKey));
				c.push("\" class=\"popup-serveradvancedfilter-select\">\n <option value=\"-\">Any</option>\n <option value=\"1\"");
				if ((S.compat.eq(l_settingValueMin, "1") && l_settingValue)) {
					c.push(" selected");
				}
				c.push(">On</option>\n <option value=\"0\"");
				if ((S.compat.eq(l_settingValueMin, "0") && l_settingValue)) {
					c.push(" selected");
				}
				c.push(">Off</option>\n </select>\n <input name=\"");
				c.push(Surface.valOut(l_serverSettingKey));
				c.push("\" type=\"checkbox\" ");
				if (S.compat.eq(l_settingValueMin, "1")) {
					c.push("checked");
				}
				c.push(" />\n");
			}
			else {
				c.push(" <input class=\"popup-serveradvancedfilter-input\" name=\"");
				c.push(Surface.valOut(l_filter.key));
				c.push("-min\" type=\"number\" maxlength=\"3\" min=\"");
				c.push(Surface.valOut(l_settingValueMinBase));
				c.push("\" max=\"");
				c.push(Surface.valOut(l_settingValueMaxBase));
				c.push("\" value=\"");
				c.push(Surface.valOut(l_settingValueMin));
				c.push("\" /> - <input class=\"popup-serveradvancedfilter-input\" name=\"");
				c.push(Surface.valOut(l_filter.key));
				c.push("-max\" type=\"number\" maxlength=\"3\" min=\"");
				c.push(Surface.valOut(l_settingValueMinBase));
				c.push("\" max=\"");
				c.push(Surface.valOut(l_settingValueMaxBase));
				c.push("\" value=\"");
				c.push(Surface.valOut(l_settingValueMax));
				c.push("\" />\n");
			}
			c.push(" <span style=\"color: #898989;\">");
			if (S.compat.eq(S.Modifier.get(l_gameServerSettingInfo, "unitType"), "percent")) {
				c.push("%");
			}
			else {
				c.push(Surface.valOut(S.Modifier.get(l_gameServerSettingInfo, "unitType")));
			}
			c.push("</span>\n <div class=\"base-clear\"></div>\n </div>\n </td>\n </tr>\n");
		}
	}
	c.push("</table>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterplayersettings = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterplayersettings'));
serverbrowserwarsaw.filterplayersettings.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterplayersettings;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterplayersettings');
	var l_for_serverbrowserwarsaw_filterplayersettings_7_9_list;
	var l_valueMin;
	var l_valueMax;
	var l_settingKey;
	var l_nameSID;
	var l_gameServerSettingInfo;
	var l_settingsKeys;
	var l_setting;
	c.push("\n");
	l_settingsKeys = ["vbdm", "vprt", "vshe"];
	l_gameServerSettingInfo = S.Modifier.get($S.callFunction("gamedata.get", Surface.globalContext.realm.section, "gameserver", b, kwargs), "gameServerSettings");
	c.push("<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("プレイヤー設定"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterplayersettings_7_9_list = ((typeof(l_settingsKeys) != "undefined" && l_settingsKeys !== null) ? l_settingsKeys : []);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterplayersettings_7_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterplayersettings_7_9_key in l_for_serverbrowserwarsaw_filterplayersettings_7_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterplayersettings_7_9_list[l_for_serverbrowserwarsaw_filterplayersettings_7_9_key])) {
				continue;
			}
			var l_key = l_for_serverbrowserwarsaw_filterplayersettings_7_9_list[l_for_serverbrowserwarsaw_filterplayersettings_7_9_key];
			l_settingKey = S.Modifier.get(l_gameServerSettingInfo, l_key);
			l_valueMin = S.Modifier.get(l_settingKey, "min", 0);
			l_valueMax = S.Modifier.get(l_settingKey, "max", 100);
			l_nameSID = S.Modifier.get(l_settingKey, "nameSID", l_key);
			l_setting = {"id": l_key, "label": (S.translations[l_nameSID] || l_nameSID), "min": l_valueMin, "max": l_valueMax};
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_setting, "collection": "settings", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterplaylist = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterplaylist'));
serverbrowserwarsaw.filterplaylist.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterplaylist;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterplaylist');
	var l_for_serverbrowserwarsaw_filterplaylist_5_9_list;
	c.push("\n<section class=\"filter split\">\n <h3>");
	c.push(Surface.valOut("プレイリスト"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterplaylist_5_9_list = o.playlists;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterplaylist_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterplaylist_5_9_key in l_for_serverbrowserwarsaw_filterplaylist_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterplaylist_5_9_list[l_for_serverbrowserwarsaw_filterplaylist_5_9_key])) {
				continue;
			}
			var l_playlist = l_for_serverbrowserwarsaw_filterplaylist_5_9_list[l_for_serverbrowserwarsaw_filterplaylist_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_playlist, "collection": "playlists", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterpresets = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterpresets'));
serverbrowserwarsaw.filterpresets.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterpresets;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterpresets');
	var l_for_serverbrowserwarsaw_filterpresets_5_9_list;
	c.push("\n<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("プリセット"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterpresets_5_9_list = o.gamepresets;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterpresets_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterpresets_5_9_key in l_for_serverbrowserwarsaw_filterpresets_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterpresets_5_9_list[l_for_serverbrowserwarsaw_filterpresets_5_9_key])) {
				continue;
			}
			var l_preset = l_for_serverbrowserwarsaw_filterpresets_5_9_list[l_for_serverbrowserwarsaw_filterpresets_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_preset, "collection": "gamepresets", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterregion = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterregion'));
serverbrowserwarsaw.filterregion.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterregion;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterregion');
	var l_availableRegions;
	var l_filterCountrySettings;
	var l_for_serverbrowserwarsaw_filterregion_28_13_list;
	var l_for_serverbrowserwarsaw_filterregion_8_9_list;
	c.push("\n");
	l_availableRegions = S.Modifier.get($S.callFunction("gamedata.get", Surface.globalContext.realm.section, "gameserver", b, kwargs), "regions");
	l_filterCountrySettings = S.Modifier.get(Surface.globalContext, "filterCountrySettings");
	c.push("<section id=\"serverbrowser-region-filter\" class=\"filter\">\n <h3>");
	c.push(Surface.valOut("地域"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterregion_8_9_list = l_availableRegions;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterregion_8_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterregion_8_9_key in l_for_serverbrowserwarsaw_filterregion_8_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterregion_8_9_list[l_for_serverbrowserwarsaw_filterregion_8_9_key])) {
				continue;
			}
			var l_region = l_for_serverbrowserwarsaw_filterregion_8_9_list[l_for_serverbrowserwarsaw_filterregion_8_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_region, "collection": "regions", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push("\n");
	if ((((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null) ? Surface.globalContext.staticContext.activePersona : false) && S.compat.eq(Surface.globalContext.staticContext.activePersona.platform, 1))) {
		c.push(" <li id=\"serverguide-region-settings-checkbox\" class=\"");
		if (S.compat.gt(S.Modifier.count(o.filter.country), 0)) {
			c.push("on");
		}
		c.push("\">\n <input type=\"checkbox\" ");
		if (S.compat.gt(S.Modifier.count(o.filter.country), 0)) {
			c.push("checked");
		}
		c.push(" name=\"custom\" value=\"0\">\n <label for=\"custom\">\n");
		c.push(serverbrowserwarsaw.filterregion.surface_16_21.render({"filterCountrySettings": ((typeof(l_filterCountrySettings) != "undefined" && l_filterCountrySettings !== null) ? l_filterCountrySettings : null)}, b, kwargs));
		c.push(" </label>\n </li>\n");
	}
	c.push(" </ul>\n <div class=\"countrycustom\">\n");
	if (S.compat.gt(S.Modifier.count(o.filter.country), 0)) {
		l_for_serverbrowserwarsaw_filterregion_28_13_list = o.filter.country;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterregion_28_13_list), 0)) {
			for (var l_for_serverbrowserwarsaw_filterregion_28_13_key in l_for_serverbrowserwarsaw_filterregion_28_13_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterregion_28_13_list[l_for_serverbrowserwarsaw_filterregion_28_13_key])) {
					continue;
				}
				var l_country = l_for_serverbrowserwarsaw_filterregion_28_13_list[l_for_serverbrowserwarsaw_filterregion_28_13_key];
				c.push(" <input type=\"hidden\" name=\"country\" value=\"");
				c.push(Surface.valOut(l_country));
				c.push("\" />\n");
			}
		}
	}
	c.push(" </div>\n</section>");
	return c.join('');
}
;
serverbrowserwarsaw.filterregion.surface_16_21 = new Surface.SingleSurface("serverbrowserwarsaw.filterregion.surface_16_21");
serverbrowserwarsaw.filterregion.surface_16_21.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterregion;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterregion');
	c.push("<surf:container id=\"serverguide-open-region-link\"");
	c.push(">");
	c.push(" ");
	c.push(Surface.valOut("カスタム"));
	c.push("\n");
	if (S.Modifier.count(o.filterCountrySettings)) {
		c.push(" <span>(");
		c.push(Surface.valOut(S.Modifier.count(o.filterCountrySettings)));
		c.push(")</span>\n");
	}
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.filterregion", "surface_16_21", "serverguide-open-region-link", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterrules = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterrules'));
serverbrowserwarsaw.filterrules.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterrules;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterrules');
	var l_valueMin;
	var l_valueMax;
	var l_settingKey;
	var l_nameSID;
	var l_for_serverbrowserwarsaw_filterrules_7_9_list;
	var l_gameServerSettingInfo;
	var l_settingsKeys;
	var l_setting;
	c.push("\n");
	l_settingsKeys = ["vtkk", "vnit", "vtkc", "vvsd", "vgmc"];
	l_gameServerSettingInfo = S.Modifier.get($S.callFunction("gamedata.get", Surface.globalContext.realm.section, "gameserver", b, kwargs), "gameServerSettings");
	c.push("<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut("規制"));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterrules_7_9_list = ((typeof(l_settingsKeys) != "undefined" && l_settingsKeys !== null) ? l_settingsKeys : []);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterrules_7_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterrules_7_9_key in l_for_serverbrowserwarsaw_filterrules_7_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterrules_7_9_list[l_for_serverbrowserwarsaw_filterrules_7_9_key])) {
				continue;
			}
			var l_key = l_for_serverbrowserwarsaw_filterrules_7_9_list[l_for_serverbrowserwarsaw_filterrules_7_9_key];
			l_settingKey = S.Modifier.get(l_gameServerSettingInfo, l_key);
			l_valueMin = S.Modifier.get(l_settingKey, "min", 0);
			l_valueMax = S.Modifier.get(l_settingKey, "max", 100);
			l_nameSID = S.Modifier.get(l_settingKey, "nameSID");
			l_setting = {"id": l_key, "label": (S.translations[l_nameSID] || l_nameSID), "min": l_valueMin, "max": l_valueMax};
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_setting, "collection": "settings", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterservertype = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterservertype'));
serverbrowserwarsaw.filterservertype.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterservertype;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterservertype');
	var l_for_serverbrowserwarsaw_filterservertype_5_9_list;
	c.push("\n<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut(S.Modifier.upper("タイプ")));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filterservertype_5_9_list = o.serverTypeFilter;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filterservertype_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filterservertype_5_9_key in l_for_serverbrowserwarsaw_filterservertype_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filterservertype_5_9_list[l_for_serverbrowserwarsaw_filterservertype_5_9_key])) {
				continue;
			}
			var l_preset = l_for_serverbrowserwarsaw_filterservertype_5_9_list[l_for_serverbrowserwarsaw_filterservertype_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_preset, "collection": "serverTypes", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filterslots = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filterslots'));
serverbrowserwarsaw.filterslots.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filterslots;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filterslots');
	c.push("\n<div class=\"serverbrowser-filter serverbrowser-filter-slots\">\n <div class=\"serverbrowser-filter-name\"><h1>");
	c.push(Surface.valOut("ゲームサイズ"));
	c.push("</h1></div>\n <div class=\"serverbrowser-filter-selectables\">\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.gameSize, 16), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gameSize\" value=\"16\" iteration=\"2\">\n <div class=\"ticbox\"></div>\n <span>16</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.gameSize, 24), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gameSize\" value=\"24\" iteration=\"3\">\n <div class=\"ticbox\"></div>\n <span>24</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.gameSize, 32), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gameSize\" value=\"32\" iteration=\"4\">\n <div class=\"ticbox\"></div>\n <span>32</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.gameSize, 48), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gameSize\" value=\"48\" iteration=\"5\">\n <div class=\"ticbox\"></div>\n <span>48</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.gameSize, 64), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gameSize\" value=\"64\" iteration=\"6\">\n <div class=\"ticbox\"></div>\n <span>64</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.gameSize, 0), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"gameSize\" value=\"0\" iteration=\"1\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("その他"));
	c.push("</span>\n </div>\n <input type=\"hidden\" name=\"gameSize\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.gameSize) != "undefined" && o.filter.gameSize !== null) ? o.filter.gameSize : []), "|")));
	c.push("\" />\n <div style=\"clear:both;\"></div>\n </div>\n <div class=\"base-clear\"></div>\n <div class=\"serverbrowser-filter-name\"><h1>");
	c.push(Surface.valOut("空きスロット"));
	c.push("</h1></div>\n <div class=\"serverbrowser-filter-selectables\">\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.slots, 1), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"slots\" value=\"1\" iteration=\"1\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("1-5"));
	c.push("</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.slots, 2), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"slots\" value=\"2\" iteration=\"2\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("6-10"));
	c.push("</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.slots, 3), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"slots\" value=\"3\" iteration=\"3\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("10+"));
	c.push("</span>\n </div>\n <div class=\"serverbrowser-selectable ");
	if (S.compat.gt(S.Modifier.contains(o.filter.slots, 4), 0)) {
		c.push("serverbrowser-include");
	}
	else {
		c.push("serverbrowser-exclude");
	}
	c.push("\" filter=\"slots\" value=\"4\" iteration=\"4\">\n <div class=\"ticbox\"></div>\n <span>");
	c.push(Surface.valOut("空白"));
	c.push("</span>\n </div>\n <input type=\"hidden\" name=\"slots\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.slots) != "undefined" && o.filter.slots !== null) ? o.filter.slots : []), "|")));
	c.push("\" />\n <div style=\"clear:both;\"></div>\n </div>\n</div>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_filtertickrate = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('filtertickrate'));
serverbrowserwarsaw.filtertickrate.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_filtertickrate;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.filtertickrate');
	var l_for_serverbrowserwarsaw_filtertickrate_5_9_list;
	c.push("\n<section class=\"filter\">\n <h3>");
	c.push(Surface.valOut(S.Modifier.upper("チックレート")));
	c.push("</h3>\n <ul>\n");
	l_for_serverbrowserwarsaw_filtertickrate_5_9_list = o.tickRates;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_filtertickrate_5_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_filtertickrate_5_9_key in l_for_serverbrowserwarsaw_filtertickrate_5_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_filtertickrate_5_9_list[l_for_serverbrowserwarsaw_filtertickrate_5_9_key])) {
				continue;
			}
			var l_tickRate = l_for_serverbrowserwarsaw_filtertickrate_5_9_list[l_for_serverbrowserwarsaw_filtertickrate_5_9_key];
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteritem")), {"item": l_tickRate, "collection": "tickRates", "filter": o.filter}, null, kwargs));
			c.push("\n");
		}
	}
	c.push(" </ul>\n</section>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_friends = new Surface.BlockConfig('serverbrowserwarsaw.base', {'content': 'serverbrowserwarsaw.friends.block_content', 'title': 'serverbrowserwarsaw.friends.block_title', 'titleItem': 'serverbrowserwarsaw.friends.block_titleItem'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('friends'));
serverbrowserwarsaw.friends.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_friends;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.friends');
	c.push("\n");
	o.serverbrowserTab = "friends";
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.base', o, b, kwargs);
}
;
serverbrowserwarsaw.friends.block_titleItem = new Surface.Block('serverbrowserwarsaw.friends.block_titleItem');
serverbrowserwarsaw.friends.block_titleItem.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("Friends Playing - ");
	return c.join("");
}
;
serverbrowserwarsaw.friends.block_title = new Surface.Block('serverbrowserwarsaw.friends.block_title');
serverbrowserwarsaw.friends.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("Friends Playing");
	return c.join("");
}
;
serverbrowserwarsaw.friends.block_content = new Surface.Block('serverbrowserwarsaw.friends.block_content');
serverbrowserwarsaw.friends.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	if (S.compat.gt(S.Modifier.count(o.servers), 0)) {
		c.push(" <div style=\"float: left; width:656px;\">\n ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverlist")), {"servers": o.servers}, null, kwargs));
		c.push("\n </div>\n ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "bf3serverinfo")), o, null, kwargs));
		c.push("\n");
	}
	else {
		c.push(" <div id=\"serverbrowser-noservers\">\n <h1>");
		c.push(Surface.valOut("フレンドがプレイ中のサーバーは見つかりませんでした"));
		c.push("</h1>\n <p>");
		c.push(Surface.valOut("フレンドは現在、誰もPCでプレイしていません"));
		c.push("</p>\n </div>\n");
	}
	return c.join("");
}
;
;var block_serverbrowserwarsaw_functions = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('functions'));
serverbrowserwarsaw.functions.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_functions;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.functions');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return c.join('');
}
;
serverbrowserwarsaw.function_addFavoriteServerUrl = function(l_guid, b, kwargs) {
	var o = {};
	var c = [];
	var l_url;
	l_url = S.Modifier.urlformat("/{_section}/{_language}/gameserverbookmark/toggleFavourite/", Surface.urlContext);
	return l_url;
}
;
serverbrowserwarsaw.function_numPlayersUrl = function(l_guid, l_section, l_platform, b, kwargs) {
	var o = {};
	var c = [];
	var l_url;
	l_url = S.Modifier.urlformat("/{_section}/{_language}/servers/getNumPlayersOnServer/{platform}/{guid}/", Surface.urlContext, {"_section": $S.callFunction("base.section", l_section, b, kwargs), "platform": S.Modifier.lower($S.callFunction("base.platform", l_platform, b, kwargs)), "guid": l_guid});
	return l_url;
}
;
serverbrowserwarsaw.function_showServerUrl = function(l_platform, l_guid, l_name, b, kwargs) {
	var o = {};
	var c = [];
	var l_url;
	l_url = S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": l_guid, "platform": S.Modifier.lower($S.callFunction("base.platform", l_platform, b, kwargs)), "slug": S.Modifier.slugify(l_name)});
	return l_url;
}
;
serverbrowserwarsaw.function_showAbsoluteServerUrl = function(l_platform, l_guid, l_name, b, kwargs) {
	var o = {};
	var c = [];
	var l_url;
	var l_host;
	if (S.compat.eq(Surface.globalContext.staticContext.sslStrategy, "all")) {
		l_host = Surface.globalContext.staticContext.currentHostSecure;
	}
	else {
		l_host = Surface.globalContext.staticContext.currentHost;
	}
	l_url = S.Modifier.concat(l_host, S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": l_guid, "platform": S.Modifier.lower($S.callFunction("base.platform", l_platform, b, kwargs)), "slug": S.Modifier.slugify(l_name)}));
	return l_url;
}
;
serverbrowserwarsaw.function_gameServerTickRateString = function(l_tickRate, b, kwargs) {
	var o = {};
	var c = [];
	if (S.compat.eq(l_tickRate, 30)) {
		return "通常 (30 Hz)";
	}
	else if (S.compat.eq(l_tickRate, 60)) {
		return "高 (60 Hz)";
	}
	else if (S.compat.eq(l_tickRate, 120)) {
		return "超高 (120 Hz)";
	}
	else if (S.compat.eq(l_tickRate, 144)) {
		return "超超高 (144 Hz)";
	}
}
;
serverbrowserwarsaw.function_gameServerPresetStringLocalized = function(l_gameServerPreset, b, kwargs) {
	var o = {};
	var c = [];
	if (S.compat.eq(l_gameServerPreset, 1)) {
		return "ノーマル";
	}
	else if (S.compat.eq(l_gameServerPreset, 2)) {
		return "ハードコア";
	}
	else if (S.compat.eq(l_gameServerPreset, 4)) {
		return "歩兵のみ";
	}
	else if (S.compat.eq(l_gameServerPreset, 8)) {
		return "カスタム";
	}
	else if (S.compat.eq(l_gameServerPreset, 16)) {
		return "イマーシブ";
	}
	else if (S.compat.eq(l_gameServerPreset, 32)) {
		return "クラシック";
	}
	else if (S.compat.eq(l_gameServerPreset, 64)) {
		return "新規プレイヤー専用";
	}
	else {
		return "不明";
	}
}
;
serverbrowserwarsaw.function_gameServerPresetStringNoLocalization = function(l_gameServerPreset, b, kwargs) {
	var o = {};
	var c = [];
	var l_name;
	l_name = "unknown";
	if (S.compat.eq(l_gameServerPreset, 1)) {
		l_name = "normal";
	}
	else if (S.compat.eq(l_gameServerPreset, 2)) {
		l_name = "hardcore";
	}
	else if (S.compat.eq(l_gameServerPreset, 4)) {
		l_name = "infantry";
	}
	else if (S.compat.eq(l_gameServerPreset, 8)) {
		l_name = "custom";
	}
	else if (S.compat.eq(l_gameServerPreset, 16)) {
		l_name = "immersive";
	}
	else if (S.compat.eq(l_gameServerPreset, 32)) {
		l_name = "classic";
	}
	return l_name;
}
;
serverbrowserwarsaw.function_getServerRegionLocalized = function(l_serverRegion, b, kwargs) {
	var o = {};
	var c = [];
	var l_regionLocalized;
	l_regionLocalized = "不明";
	if (S.compat.eq(l_serverRegion, 1)) {
		l_regionLocalized = "北米";
	}
	else if (S.compat.eq(l_serverRegion, 2)) {
		l_regionLocalized = "南アメリカ";
	}
	else if (S.compat.eq(l_serverRegion, 4)) {
		l_regionLocalized = "南極";
	}
	else if (S.compat.eq(l_serverRegion, 8)) {
		l_regionLocalized = "アフリカ";
	}
	else if (S.compat.eq(l_serverRegion, 16)) {
		l_regionLocalized = "ヨーロッパ";
	}
	else if (S.compat.eq(l_serverRegion, 32)) {
		l_regionLocalized = "アジア";
	}
	else if (S.compat.eq(l_serverRegion, 64)) {
		l_regionLocalized = "オセアニア";
	}
	return l_regionLocalized;
}
;
serverbrowserwarsaw.function_gameServerModeStringLocalized = function(l_gameMode, l_game, b, kwargs) {
	var o = {};
	var c = [];
	return $S.callFunction("gamedata.localizedGameMode", l_game, l_gameMode, b, kwargs);
}
;
serverbrowserwarsaw.function_playlistStringLocalized = function(l_playlist, b, kwargs) {
	var o = {};
	var c = [];
	var l_playlistLocalized;
	l_playlistLocalized = S.Modifier.concat("ID_WEB_SERVERGUIDE_PLAYLIST_", l_playlist);
	return (S.translations[l_playlistLocalized] || l_playlistLocalized);
}
;
serverbrowserwarsaw.function_getServersUrl = function(l_platform, b, kwargs) {
	var o = {};
	var c = [];
	var l_url;
	l_url = S.Modifier.urlformat("/{_section}/{_language}/servers/getServers/{platform}/", Surface.urlContext, {"platform": S.Modifier.lower($S.callFunction("base.platform", l_platform, b, kwargs))});
	return l_url;
}
;
serverbrowserwarsaw.function_getServerSlotInfo = function(l_server, l_slotType, b, kwargs) {
	var o = {};
	var c = [];
	var l_info;
	var l_slotInfo;
	l_slotInfo = false;
	l_info = S.Modifier.get(l_server.slots, l_slotType);
	if (S.compat.neq(l_info, null)) {
		l_slotInfo = S.compat.add(S.compat.add(l_info.current, " / "), l_info.max);
	}
	return l_slotInfo;
}
;
serverbrowserwarsaw.function_gameServerServerTypeString = function(l_gameServerType, b, kwargs) {
	var o = {};
	var c = [];
	var l_gameServerServerTypeString;
	var l_serverTypeLookup;
	l_serverTypeLookup = S.Modifier.get($S.callFunction("gamedata.get", 2048, "gameserver", b, kwargs), "serverTypeLookup");
	l_gameServerServerTypeString = S.Modifier.get(l_serverTypeLookup, l_gameServerType);
	return (S.translations[l_gameServerServerTypeString] || l_gameServerServerTypeString);
}
;
serverbrowserwarsaw.function_gameServerExperienceString = function(l_game, l_gameServerExperience, b, kwargs) {
	var o = {};
	var c = [];
	var l_gameServerExperienceString;
	var l_experienceLookup;
	if (S.compat.eq(l_game, 8192)) {
		l_experienceLookup = S.Modifier.get($S.callFunction("gamedata.get", 8192, "experiences", b, kwargs), "experiences");
		l_gameServerExperienceString = S.Modifier.get(S.Modifier.get(l_experienceLookup, S.Modifier.toint(l_gameServerExperience), {}), "name");
	}
	else {
		l_experienceLookup = S.Modifier.get($S.callFunction("gamedata.get", l_game, "gameserver", b, kwargs), "experienceLookup");
		l_gameServerExperienceString = S.Modifier.get(S.Modifier.get(l_experienceLookup, l_gameServerExperience), "name");
	}
	return (S.translations[l_gameServerExperienceString] || l_gameServerExperienceString);
}
;
serverbrowserwarsaw.function_massageToWarsawEoR = function(l_scoreboard, b, kwargs) {
	var o = {};
	var c = [];
	var l_for_serverbrowserwarsaw_functions_156_6_list;
	var l_for_serverbrowserwarsaw_functions_166_10_list;
	var l_team;
	var l_data;
	l_data = {"game": S.Modifier.get(l_scoreboard, "game"), "gameMode": S.Modifier.get(l_scoreboard, "gameMode"), "map": S.Modifier.get(l_scoreboard, "map"), "teams": {}, "gunMasterPlayers": S.Modifier.get(l_scoreboard, "gunMasterPlayers", []), "players": []};
	l_for_serverbrowserwarsaw_functions_156_6_list = S.Modifier.get(l_scoreboard, "teams", {});
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_functions_156_6_list), 0)) {
		for (var l_for_serverbrowserwarsaw_functions_156_6_key in l_for_serverbrowserwarsaw_functions_156_6_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_functions_156_6_list[l_for_serverbrowserwarsaw_functions_156_6_key])) {
				continue;
			}
			var l_t = l_for_serverbrowserwarsaw_functions_156_6_list[l_for_serverbrowserwarsaw_functions_156_6_key];
			l_team = {"id": S.Modifier.get(l_t.status, "teamId"), "name": S.Modifier.get(l_t.status, "name", "US"), "score": S.Modifier.get(l_t.status, "tickets", 0), "scoreMax": S.Modifier.get(l_t.status, "ticketsMax", 0), "players": [], "isAttacker": S.compat.eq(S.Modifier.get(l_t.status, "teamType"), "attackers") ? true : false};
			l_for_serverbrowserwarsaw_functions_166_10_list = S.Modifier.get(l_t, "players", []);
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_functions_166_10_list), 0)) {
				for (var l_for_serverbrowserwarsaw_functions_166_10_key in l_for_serverbrowserwarsaw_functions_166_10_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_functions_166_10_list[l_for_serverbrowserwarsaw_functions_166_10_key])) {
						continue;
					}
					var l_p = l_for_serverbrowserwarsaw_functions_166_10_list[l_for_serverbrowserwarsaw_functions_166_10_key];
					l_team.players = S.Modifier.append(l_team.players, l_p.personaId);
					l_data.players = S.Modifier.append(l_data.players, l_p);
				}
			}
			l_data.teams = S.Modifier.set(l_data.teams, l_team.id, l_team);
		}
	}
	return l_data;
}
;
;var block_serverbrowserwarsaw_gunmasterprogress = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('gunmasterprogress'));
serverbrowserwarsaw.gunmasterprogress.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_gunmasterprogress;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.gunmasterprogress');
	var l_for_serverbrowserwarsaw_gunmasterprogress_15_13_list;
	var l_for_serverbrowserwarsaw_gunmasterprogress_5_1_list;
	var l_me;
	var l_maxLevel;
	var l_for_serverbrowserwarsaw_gunmasterprogress_23_45_list;
	c.push("\n");
	l_maxLevel = 0;
	l_for_serverbrowserwarsaw_gunmasterprogress_5_1_list = S.Modifier.to(1, 17);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_gunmasterprogress_5_1_list), 0)) {
		for (var l_for_serverbrowserwarsaw_gunmasterprogress_5_1_key in l_for_serverbrowserwarsaw_gunmasterprogress_5_1_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_gunmasterprogress_5_1_list[l_for_serverbrowserwarsaw_gunmasterprogress_5_1_key])) {
				continue;
			}
			var l_level = l_for_serverbrowserwarsaw_gunmasterprogress_5_1_list[l_for_serverbrowserwarsaw_gunmasterprogress_5_1_key];
			if (S.compat.gt(S.Modifier.count(S.Modifier.get(o.level_progress, l_level, [])), 0)) {
				l_maxLevel = l_level;
			}
		}
	}
	c.push("\n<div id=\"gunmaster-progress-container\">\n <h3>");
	c.push(Surface.valOut("ガンマスターの進行状況"));
	c.push("</h3>\n <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"gm-progress\">\n <tr>\n");
	l_for_serverbrowserwarsaw_gunmasterprogress_15_13_list = S.Modifier.to(1, l_maxLevel);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_gunmasterprogress_15_13_list), 0)) {
		for (var l_for_serverbrowserwarsaw_gunmasterprogress_15_13_key in l_for_serverbrowserwarsaw_gunmasterprogress_15_13_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_gunmasterprogress_15_13_list[l_for_serverbrowserwarsaw_gunmasterprogress_15_13_key])) {
				continue;
			}
			var l_level = l_for_serverbrowserwarsaw_gunmasterprogress_15_13_list[l_for_serverbrowserwarsaw_gunmasterprogress_15_13_key];
			c.push(" <td class=\"gunmaster-level-arrow\">\n <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"playerWpr\">\n <tr>\n <td valign=\"middle\" class=\"gunmaster-player-wpr\">\n <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"players");
			if (S.compat.eq(S.Modifier.count(S.Modifier.get(o.level_progress, l_level)), 4)) {
				c.push(" fourWide");
			}
			c.push("\">\n <tr>\n <td class=\"gunmaster-players\">\n");
			l_for_serverbrowserwarsaw_gunmasterprogress_23_45_list = S.Modifier.get(o.level_progress, l_level);
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_gunmasterprogress_23_45_list), 0)) {
				for (var l_for_serverbrowserwarsaw_gunmasterprogress_23_45_key in l_for_serverbrowserwarsaw_gunmasterprogress_23_45_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_gunmasterprogress_23_45_list[l_for_serverbrowserwarsaw_gunmasterprogress_23_45_key])) {
						continue;
					}
					var l_player = l_for_serverbrowserwarsaw_gunmasterprogress_23_45_list[l_for_serverbrowserwarsaw_gunmasterprogress_23_45_key];
					l_me = ((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.session) != "undefined" && Surface.globalContext.session !== null && typeof(Surface.globalContext.session.user) != "undefined" && Surface.globalContext.session.user !== null) && S.compat.eq(Surface.globalContext.session.user.userId, S.Modifier.get(l_player.user, "userId", false)));
					c.push(" <div class=\"gunmaster-player-info");
					if (l_me) {
						c.push(" myself");
					}
					c.push("\" data-personaid=\"");
					c.push(Surface.valOut(l_player.personaId));
					c.push("\" data-tooltip=\"");
					c.push(Surface.valOut(l_player.personaName));
					c.push("\">");
					c.push(Surface.valOut(l_player.personaName));
					c.push("</div>\n");
				}
			}
			c.push(" </td>\n </tr>\n </table>\n </td>\n </tr>\n </table>\n </td>\n");
		}
	}
	c.push(" </tr>\n </table>\n</div>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_history = new Surface.BlockConfig('serverbrowserwarsaw.base', {'content': 'serverbrowserwarsaw.history.block_content', 'title': 'serverbrowserwarsaw.history.block_title', 'sidebar': 'serverbrowserwarsaw.history.block_sidebar', 'titleItem': 'serverbrowserwarsaw.history.block_titleItem'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('history'));
serverbrowserwarsaw.history.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_history;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.history');
	c.push("\n");
	o.serverbrowserTab = "history";
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.base', o, b, kwargs);
}
;
serverbrowserwarsaw.history.block_titleItem = new Surface.Block('serverbrowserwarsaw.history.block_titleItem');
serverbrowserwarsaw.history.block_titleItem.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("履歴"));
	c.push(" - ");
	return c.join("");
}
;
serverbrowserwarsaw.history.block_title = new Surface.Block('serverbrowserwarsaw.history.block_title');
serverbrowserwarsaw.history.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("履歴"));
	return c.join("");
}
;
serverbrowserwarsaw.history.block_sidebar = new Surface.Block('serverbrowserwarsaw.history.block_sidebar');
serverbrowserwarsaw.history.block_sidebar.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "warsawserverinfo")), o, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.history.block_content = new Surface.Block('serverbrowserwarsaw.history.block_content');
serverbrowserwarsaw.history.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("<section id=\"server-history\" style=\"margin-top: 16px\" data-contain=\"sticky\">\n");
	if (S.compat.gt(S.Modifier.count(Surface.globalContext.servers), 0)) {
		c.push("\n <div class=\"row\">\n <div class=\"span9\">\n ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverlist")), {"servers": o.servers}, null, kwargs));
		c.push("\n </div>\n <aside class=\"span3\">\n");
		c.push(b.get('sidebar')(o, b, kwargs));
		c.push(" </aside>\n </div>\n");
	}
	else {
		c.push(" <div class=\"box no-results\">\n <div class=\"box-content\">\n <h3>");
		c.push(Surface.valOut("サーバーが見つかりませんでした"));
		c.push("</h3>\n <p>");
		c.push(Surface.valOut("サーバー履歴が空です"));
		c.push("</p>\n </div>\n </div>\n");
	}
	c.push("</section>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_index = new Surface.BlockConfig('serverbrowserwarsaw.base', {'content': 'serverbrowserwarsaw.index.block_content', 'title': 'serverbrowserwarsaw.index.block_title', 'recommendedServers': 'serverbrowserwarsaw.index.block_recommendedServers', 'sidebar': 'serverbrowserwarsaw.index.block_sidebar'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('index'));
serverbrowserwarsaw.index.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_index;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.index');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.base', o, b, kwargs);
}
;
serverbrowserwarsaw.index.block_title = new Surface.Block('serverbrowserwarsaw.index.block_title');
serverbrowserwarsaw.index.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("マルチプレイヤー"));
	return c.join("");
}
;
serverbrowserwarsaw.index.block_recommendedServers = new Surface.Block('serverbrowserwarsaw.index.block_recommendedServers');
serverbrowserwarsaw.index.block_recommendedServers.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	if ((Surface.globalContext.session.isLoggedIn && S.compat.eq(o.platform, ((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : 0)))) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "recommendedservers")), {"recommendedServers": []}, null, kwargs));
		c.push("\n");
	}
	return c.join("");
}
;
serverbrowserwarsaw.index.block_sidebar = new Surface.Block('serverbrowserwarsaw.index.block_sidebar');
serverbrowserwarsaw.index.block_sidebar.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.index.block_content = new Surface.Block('serverbrowserwarsaw.index.block_content');
serverbrowserwarsaw.index.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n");
	Surface.globalContext.hideFooter = 1;
	c.push("\n <div id=\"serverbrowser-loading-list-indicator\"><div class=\"common-spinner\" data-size=\"big\"></div></div>\n <section id=\"servers\" data-contain=\"sticky\">\n <div id=\"serverbrowser-loading-list-indicator\"><div class=\"common-spinner\" data-size=\"big\"></div></div>\n <div id=\"results-container\" class=\"row\">\n <div class=\"span9\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverlist")), {"servers": o.servers}, null, kwargs));
	c.push("\n");
	if (Surface.globalContext.staticContext.detectedBrowser.isTouchDevice) {
		c.push(" <div class=\"box\">\n <footer class=\"padding-none\">\n <button class=\"btn btn-subtle btn-block\"\n data-bind-action=\"view-more-servers\">");
		c.push(Surface.valOut("詳細を表示"));
		c.push("</button>\n </footer>\n </div>\n");
	}
	c.push(" </div>\n <aside class=\"span3\">\n");
	c.push(b.get('sidebar')(o, b, kwargs));
	c.push(" </aside>\n </div>\n <div id=\"no-results\" class=\"box no-results\" style=\"display: none;\">\n <div class=\"box-content\">\n <h3>");
	c.push(Surface.valOut("サーバーが見つかりませんでした"));
	c.push("</h3>\n <p>");
	c.push(Surface.valOut("フィルター設定を変更してもう一度お試しください"));
	c.push("</p>\n </div>\n </div>\n </section>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_indexwarsaw = new Surface.BlockConfig('base.index', {'mainContent': 'serverbrowserwarsaw.indexwarsaw.block_mainContent'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('indexwarsaw'));
;var block_serverbrowserwarsaw_joinfriendform = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('joinfriendform'));
serverbrowserwarsaw.joinfriendform.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_joinfriendform;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.joinfriendform');
	var l_buttonValue;
	var l_game;
	var l_joinBtnClass;
	var l_realm;
	var l_btnClass;
	var l_platform;
	var l_classes;
	c.push("\n");
	l_realm = S.Modifier.get(Surface.globalContext, "realm");
	c.push("\n");
	l_game = S.Modifier.get(o.presence.playingMp, "game");
	l_platform = S.Modifier.get(o.presence.playingMp, "platform");
	c.push("\n");
	if (S.compat.eq(Surface.globalContext.staticContext.activePersona.platform, l_platform)) {
		c.push("\n");
		if ((typeof(o) != "undefined" && o !== null && typeof(o.label) != "undefined" && o.label !== null)) {
			l_buttonValue = o.label;
		}
		else {
			l_buttonValue = "参加";
		}
		l_btnClass = "";
		l_joinBtnClass = "";
		if (S.compat.eq(l_realm.game, 2048)) {
			l_btnClass = "btn btn-tiny btn-primary ";
		}
		else {
			l_joinBtnClass = "btn-primary ";
		}
		c.push("\n");
		l_classes = "";
		if (((typeof(o) != "undefined" && o !== null && typeof(o.friendJoinButton) != "undefined" && o.friendJoinButton !== null) ? o.friendJoinButton : false)) {
			l_classes = S.compat.add(l_joinBtnClass, " join-friend-submit-link join-friend join-friendcomcenter-interact-playing");
			l_buttonValue = "<i class=\"icon-join-friend\"></i>";
		}
		else if (((typeof(o) != "undefined" && o !== null && typeof(o.textButton) != "undefined" && o.textButton !== null) ? o.textButton : false)) {
			l_classes = "join-friend-submit-link";
		}
		else if (((typeof(o) != "undefined" && o !== null && typeof(o.profileButton) != "undefined" && o.profileButton !== null) ? o.profileButton : false)) {
			l_classes = "base-button-arrow-large";
		}
		else {
			l_classes = S.compat.add("base-button-arrow-tiny ", l_btnClass);
		}
		c.push("\n");
		if (($S.callFunction("comcenter.isPlayingMp", o.presence, b, kwargs) && (typeof(S.Modifier.get(o.presence.playingMp, "serverGuid")) != "undefined" && S.Modifier.get(o.presence.playingMp, "serverGuid") !== null))) {
			l_classes = S.compat.add(S.compat.add(l_classes, " "), ((typeof(o) != "undefined" && o !== null && typeof(o.extraClass) != "undefined" && o.extraClass !== null) ? o.extraClass : ""));
			c.push(" <a\n href=\"");
			c.push(Surface.valOut($S.callFunction("common.showServerUrlByServer", o.presence.playingMp, b, kwargs)));
			c.push("\"\n class=\"");
			c.push(Surface.valOut(l_classes));
			if (!($S.callFunction("comcenter.isFriendJoinable", o.presence, b, kwargs))) {
				c.push(" disabled");
			}
			c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"friend.playing.server.join\"\n data-role=\"");
			c.push(Surface.valOut(1));
			c.push("\"\n data-guid=\"");
			c.push(Surface.valOut(S.Modifier.get(o.presence.playingMp, "serverGuid")));
			c.push("\"\n data-game=\"");
			c.push(Surface.valOut(l_game));
			c.push("\"\n data-platform=\"");
			c.push(Surface.valOut(l_platform));
			c.push("\"\n data-friendPersonaId=\"");
			c.push(Surface.valOut(o.friendPersonaId));
			c.push("\"\n data-track=\"friend.playing.server.join\">\n ");
			c.push(l_buttonValue);
			c.push("\n </a>\n");
		}
	}
	return c.join('');
}
;
;var block_serverbrowserwarsaw_maprotation = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('maprotation'));
serverbrowserwarsaw.maprotation.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_maprotation;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.maprotation');
	var l_mapName;
	var l_mapsOnServer;
	var l_mapBubbleInfo;
	var l_for_serverbrowserwarsaw_maprotation_10_9_list;
	var l_width;
	var l_mapInfo;
	c.push("\n<div class=\"box spacing-top-tight\">\n <header>\n <h1>");
	c.push(Surface.valOut("マップローテーション"));
	c.push("</h1>\n </header>\n <div class=\"box-content no-padding\" id=\"map-rotation\">\n");
	l_mapsOnServer = S.Modifier.get(o.server.maps, "maps", []);
	l_width = S.compat.sub(S.compat.mul(162, S.Modifier.count(l_mapsOnServer)), 12);
	c.push(" <ul class=\"clearfix\" style=\"width: ");
	c.push(Surface.valOut(l_width));
	c.push("px;\">\n");
	l_for_serverbrowserwarsaw_maprotation_10_9_list = l_mapsOnServer;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_maprotation_10_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_maprotation_10_9_key in l_for_serverbrowserwarsaw_maprotation_10_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_maprotation_10_9_list[l_for_serverbrowserwarsaw_maprotation_10_9_key])) {
				continue;
			}
			var l_mapRotation = l_for_serverbrowserwarsaw_maprotation_10_9_list[l_for_serverbrowserwarsaw_maprotation_10_9_key];
			l_mapInfo = $S.callFunction("common.mapinfo", o.server.game, l_mapRotation.map, b, kwargs);
			l_mapName = S.Modifier.get(l_mapInfo, "name");
			l_mapBubbleInfo = (S.translations[l_mapName] || l_mapName);
			if (S.compat.gt(((typeof(l_mapRotation) != "undefined" && l_mapRotation !== null && typeof(l_mapRotation.mapVariant) != "undefined" && l_mapRotation.mapVariant !== null) ? l_mapRotation.mapVariant : 0), 0)) {
				l_mapBubbleInfo = S.Modifier.concat(S.Modifier.concat(l_mapBubbleInfo, " #"), S.compat.add(l_mapRotation.mapVariant, 1));
			}
			c.push(" <li class=\"");
			if (S.compat.eq(o.server.map, l_mapRotation.map)) {
				c.push("currentMap");
			}
			c.push("\">\n <img\n src=\"");
			c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.get(l_mapInfo, "imageBig"), b, kwargs)));
			c.push("\"\n alt=\"");
			c.push(Surface.valOut(l_mapBubbleInfo));
			c.push("\"\n data-tooltip=\"");
			c.push(Surface.valOut(l_mapBubbleInfo));
			c.push("\" />\n <br>\n ");
			c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", l_mapRotation.mapMode, o.server.game, b, kwargs)));
			c.push("\n </li>\n");
		}
	}
	else {
		c.push(" ");
		c.push(Surface.valOut("マップローテーションにマップがありません"));
		c.push("\n");
	}
	c.push(" </ul>\n </div>\n</div>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_mohwfilters = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('mohwfilters'));
serverbrowserwarsaw.mohwfilters.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwfilters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwfilters');
	var l_url;
	var l_forceExpandedFilter;
	c.push("\n");
	l_forceExpandedFilter = S.Modifier.get(Surface.globalContext, "forceExpandedFilter");
	c.push("\n");
	if ((S.compat.gt(S.Modifier.count(o.servers), 0) && S.compat.neq(l_forceExpandedFilter, 1))) {
		o.showFilters = 0;
	}
	else {
		o.showFilters = 1;
	}
	l_url = S.Modifier.urlformat("/{_section}/{_language}/servers/getAutoBrowseServers/{platform}/", Surface.urlContext, {"platform": o.platformString});
	c.push("<input type=\"hidden\" id=\"serverbrowser-autobrowse-url\" value=\"");
	c.push(Surface.valOut(l_url));
	c.push("\" />\n");
	l_url = S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": "%GUID%", "platform": o.platformtring});
	c.push("<input type=\"hidden\" id=\"serverbrowser-show-url\" value=\"");
	c.push(Surface.valOut(l_url));
	c.push("?json=1\" />\n<form id=\"serverbrowser-filter-form\" ");
	if (!(o.showFilters)) {
		c.push("class=\"serverbrowser-filter-form-contracted\"");
	}
	c.push(" method=\"GET\"\n action=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
	c.push("\">\n<input type=\"hidden\" name=\"filtered\" value=\"1\" />\n<input type=\"hidden\" name=\"expand\" value=\"");
	c.push(Surface.valOut(o.showFilters));
	c.push("\" />\n");
	c.push(Surface.importTemplate(("common" + ("." + "focusbar")), o, block_serverbrowserwarsaw_mohwfilters_use_21_5, kwargs));
	c.push("\n</form>");
	return c.join('');
}
;
var block_serverbrowserwarsaw_mohwfilters_use_21_5 = new Surface.BlockConfig('common.focusbar', {'content': 'serverbrowserwarsaw.mohwfilters._use_21_5_block_content', 'extraInnerClass': 'serverbrowserwarsaw.mohwfilters._use_21_5_block_extraInnerClass', 'extraClass': 'serverbrowserwarsaw.mohwfilters._use_21_5_block_extraClass'});
serverbrowserwarsaw.mohwfilters._use_21_5_block_extraClass = new Surface.Block('serverbrowserwarsaw.mohwfilters._use_21_5_block_extraClass');
serverbrowserwarsaw.mohwfilters._use_21_5_block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverbrowser-filter-width");
	return c.join("");
}
;
serverbrowserwarsaw.mohwfilters._use_21_5_block_extraInnerClass = new Surface.Block('serverbrowserwarsaw.mohwfilters._use_21_5_block_extraInnerClass');
serverbrowserwarsaw.mohwfilters._use_21_5_block_extraInnerClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverbrowser-filter-inner");
	return c.join("");
}
;
serverbrowserwarsaw.mohwfilters.surface_33_17 = new Surface.SingleSurface("serverbrowserwarsaw.mohwfilters.surface_33_17");
serverbrowserwarsaw.mohwfilters.surface_33_17.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwfilters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwfilters');
	c.push("<surf:container id=\"serverbrowser-filterstring\"");
	c.push(">");
	c.push(" <div class=\"serverbrowser-filterlist-generic\">\n <div id=\"custom-filter-list\">\n <em>");
	c.push(Surface.valOut("サーバー検索"));
	c.push(" :</em>\n <div id=\"custom-filter-list-content\"></div>\n <a class=\"serverbrowser-reset-filter-button\"\n href=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/clearFilter/{platform}/", Surface.urlContext, {"platform": o.platformString})));
	c.push("\">\n ");
	c.push(Surface.valOut("フィルターのリセット"));
	c.push("\n </a>\n </div>\n </div>\n <span class=\"serverbrowser-toggler\"></span>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.mohwfilters", "surface_33_17", "serverbrowser-filterstring", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.mohwfilters._use_21_5_block_content = new Surface.Block('serverbrowserwarsaw.mohwfilters._use_21_5_block_content');
serverbrowserwarsaw.mohwfilters._use_21_5_block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_serverFilterOptions;
	c.push("\n");
	c.push("\n");
	l_serverFilterOptions = $S.callFunction("gamedata.get", 4096, "gameserver", b, kwargs);
	c.push("\n <div id=\"serverbrowser-filtertoggle\" class=\"serverbrowser-filtertoggle-");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilters) != "undefined" && o.showFilters !== null) ? o.showFilters : 1)) {
		c.push("expanded");
	}
	else {
		c.push("contracted");
	}
	c.push("\">\n");
	c.push(serverbrowserwarsaw.mohwfilters.surface_33_17.render({"platformString": ((typeof(o) != "undefined" && o !== null && typeof(o.platformString) != "undefined" && o.platformString !== null) ? o.platformString : null)}, b, kwargs));
	c.push(" <div class=\"serverbrowser-header-refresh-button\">\n ");
	c.push(Surface.importTemplate(("common" + ("." + "button")), {"title": "フィルターの更新と保存", "type": "submit", "style": "medium-grey", "extraClass": "serverbrowser-apply-filter-button"}, null, kwargs));
	c.push("\n </div>\n </div>\n <div id=\"serverbrowser-filters-container\">\n <div id=\"serverbrowser-filters\" ");
	if (!(o.showFilters)) {
		c.push("style=\"display:none;\"");
	}
	c.push(">\n <div class=\"filter-col span1\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergameexpansion")), {"gameexpansions": S.Modifier.get(l_serverFilterOptions, "gameexpansions"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterregion")), {"regions": S.Modifier.get(l_serverFilterOptions, "regions"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterfreetext")), o, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1\">\n <!-- float: left; width:184px; padding-left: 16px; background: #ffc; -->\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterpresets")), {"gamepresets": S.Modifier.get(l_serverFilterOptions, "gamepresets"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterdetails")), {"gamedetails": S.Modifier.get(l_serverFilterOptions, "gamedetails"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteradvanced")), {"filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1 pull1\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamesize")), {"gamesize": S.Modifier.get(l_serverFilterOptions, "gamesize"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergameslots")), {"gameslots": S.Modifier.get(l_serverFilterOptions, "gameslots"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span2 push1\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterplaylist")), {"playlists": S.Modifier.get(l_serverFilterOptions, "playlists"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamemode")), {"gamemodes": S.Modifier.get(l_serverFilterOptions, "gamemodes"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtermaps")), {"maps": S.Modifier.get(l_serverFilterOptions, "maps"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n </div>\n <input type=\"hidden\" name=\"settings\" id=\"serverbrowser-filter-settings-input\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.settings) != "undefined" && o.filter.settings !== null) ? o.filter.settings : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"regions\" id=\"serverbrowser-filter-regions-input\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.regions) != "undefined" && o.filter.regions !== null) ? o.filter.regions : []), "|")));
	c.push("\" />\n <input type=\"hidden\" name=\"country\" id=\"serverbrowser-filter-countries-input\" value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.country) != "undefined" && o.filter.country !== null) ? o.filter.country : []), "|")));
	c.push("\" />\n <div id=\"serverbrowser-apply-filters\" ");
	if (!(o.showFilters)) {
		c.push("style=\"display:none;\"");
	}
	c.push(">\n ");
	c.push(Surface.importTemplate(("common" + ("." + "button")), {"title": "フィルターの更新と保存", "type": "submit", "style": "medium-grey", "extraClass": "serverbrowser-apply-filter-button"}, null, kwargs));
	c.push("\n <div id=\"serverbrowser-filter-count\">\n ");
	c.push(Surface.valOut("見つかりました"));
	c.push(" <span class=\"serverbrowser-filter-count-amount\">1337</span> ");
	c.push(Surface.valOut("サーバー"));
	c.push("\n </div>\n <div id=\"serverbrowser-filter-saved\">");
	c.push(Surface.valOut("フィルターをセーブしました！"));
	c.push("</div>\n </div>\n ");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_mohwindex = new Surface.BlockConfig('serverbrowserwarsaw.index', {'settings': 'serverbrowserwarsaw.mohwindex.block_settings', 'filters': 'serverbrowserwarsaw.mohwindex.block_filters'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('mohwindex'));
serverbrowserwarsaw.mohwindex.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwindex;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwindex');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.index', o, b, kwargs);
}
;
serverbrowserwarsaw.mohwindex.block_filters = new Surface.Block('serverbrowserwarsaw.mohwindex.block_filters');
serverbrowserwarsaw.mohwindex.block_filters.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilter) != "undefined" && o.showFilter !== null) ? o.showFilter : true)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "mohwfilters")), o, null, kwargs));
		c.push("\n");
	}
	else {
		c.push(" <div style=\"position: relative;clear:both;padding:16px 0\">\n <a href=\"");
		c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
		c.push("\"\n style=\"font-weight:normal; font-size:12px;\" >\n ");
		c.push(Surface.valOut("全サーバーを表示"));
		c.push("\n </a>\n </div>\n");
	}
	return c.join("");
}
;
serverbrowserwarsaw.mohwindex.block_settings = new Surface.Block('serverbrowserwarsaw.mohwindex.block_settings');
serverbrowserwarsaw.mohwindex.block_settings.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "mohwserverinfo")), o, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_mohwserverinfo = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('mohwserverinfo'));
serverbrowserwarsaw.mohwserverinfo.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwserverinfo');
	c.push("\n<div id=\"serverbrowser-show-column-rail\" class=\"base-secondary-right-column\">\n<div id=\"serverbrowser-show-column\">\n");
	c.push(serverbrowserwarsaw.mohwserverinfo.surface_4_1.render({"favGuids": ((typeof(o) != "undefined" && o !== null && typeof(o.favGuids) != "undefined" && o.favGuids !== null) ? o.favGuids : null), "friends": ((typeof(o) != "undefined" && o !== null && typeof(o.friends) != "undefined" && o.friends !== null) ? o.friends : null), "loading": ((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : null), "platformString": ((typeof(o) != "undefined" && o !== null && typeof(o.platformString) != "undefined" && o.platformString !== null) ? o.platformString : null), "players": ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : null), "serverinfo": ((typeof(o) != "undefined" && o !== null && typeof(o.serverinfo) != "undefined" && o.serverinfo !== null) ? o.serverinfo : null), "session": {"isLoggedIn": ((typeof(o) != "undefined" && o !== null && typeof(o.session) != "undefined" && o.session !== null && typeof(o.session.isLoggedIn) != "undefined" && o.session.isLoggedIn !== null) ? o.session.isLoggedIn : null)}}, b, kwargs));
	c.push("\n</div>\n</div>\n");
	return c.join('');
}
;
var block_serverbrowserwarsaw_mohwserverinfo_use_138_21 = new Surface.BlockConfig('common.secondarycontent', {'content': 'serverbrowserwarsaw.mohwserverinfo._use_138_21_block_content', 'title': 'serverbrowserwarsaw.mohwserverinfo._use_138_21_block_title', 'extraClass': 'serverbrowserwarsaw.mohwserverinfo._use_138_21_block_extraClass'});
var block_serverbrowserwarsaw_mohwserverinfo_use_110_21 = new Surface.BlockConfig('common.secondarycontent', {'content': 'serverbrowserwarsaw.mohwserverinfo._use_110_21_block_content', 'title': 'serverbrowserwarsaw.mohwserverinfo._use_110_21_block_title', 'extraClass': 'serverbrowserwarsaw.mohwserverinfo._use_110_21_block_extraClass'});
serverbrowserwarsaw.mohwserverinfo.surface_4_1 = new Surface.SingleSurface("serverbrowserwarsaw.mohwserverinfo.surface_4_1");
serverbrowserwarsaw.mohwserverinfo._use_110_21_block_extraClass = new Surface.Block('serverbrowserwarsaw.mohwserverinfo._use_110_21_block_extraClass');
serverbrowserwarsaw.mohwserverinfo._use_110_21_block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverinfo-players-box");
	return c.join("");
}
;
serverbrowserwarsaw.mohwserverinfo._use_110_21_block_title = new Surface.Block('serverbrowserwarsaw.mohwserverinfo._use_110_21_block_title');
serverbrowserwarsaw.mohwserverinfo._use_110_21_block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut(S.Modifier.count(o.friends)));
	c.push(" ");
	c.push(Surface.valOut(S.Modifier.pluralize(S.Modifier.count(o.friends), "フレンド", "フレンド")));
	return c.join("");
}
;
serverbrowserwarsaw.mohwserverinfo._use_110_21_block_content = new Surface.Block('serverbrowserwarsaw.mohwserverinfo._use_110_21_block_content');
serverbrowserwarsaw.mohwserverinfo._use_110_21_block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_for_serverbrowserwarsaw_mohwserverinfo_117_29_list;
	var l_for_serverbrowserwarsaw_mohwserverinfo_117_29_iteration;
	var l_for_serverbrowserwarsaw_mohwserverinfo_117_29_isEven;
	var l_for_serverbrowserwarsaw_mohwserverinfo_117_29_isOdd;
	l_for_serverbrowserwarsaw_mohwserverinfo_117_29_list = o.friends;
	l_for_serverbrowserwarsaw_mohwserverinfo_117_29_iteration = 0;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_mohwserverinfo_117_29_list), 0)) {
		for (var l_for_serverbrowserwarsaw_mohwserverinfo_117_29_key in l_for_serverbrowserwarsaw_mohwserverinfo_117_29_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_mohwserverinfo_117_29_list[l_for_serverbrowserwarsaw_mohwserverinfo_117_29_key])) {
				continue;
			}
			var l_friend = l_for_serverbrowserwarsaw_mohwserverinfo_117_29_list[l_for_serverbrowserwarsaw_mohwserverinfo_117_29_key];
			l_for_serverbrowserwarsaw_mohwserverinfo_117_29_iteration = S.compat.add(l_for_serverbrowserwarsaw_mohwserverinfo_117_29_iteration, 1);
			l_for_serverbrowserwarsaw_mohwserverinfo_117_29_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_mohwserverinfo_117_29_iteration, 2), 0);
			l_for_serverbrowserwarsaw_mohwserverinfo_117_29_isOdd = !(l_for_serverbrowserwarsaw_mohwserverinfo_117_29_isEven);
			c.push(" <div class=\"serverbrowser-show-playerrow serverbrowser-show-friendrow\">\n <span ");
			if (l_for_serverbrowserwarsaw_mohwserverinfo_117_29_isOdd) {
				c.push("class=\"serverbrowser-show-player-odd\"");
			}
			c.push(">\n ");
			c.push(Surface.importTemplate(("ui" + ("." + "avatar")), {"user": l_friend, "size": 22}, null, kwargs));
			c.push("\n <div class=\"serverbrowser-show-player\">\n <div class=\"serverbrowser-show-playerlink-container\">\n <a class=\"serverbrowser-show-playerlink\" href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/user/{username}/", Surface.urlContext, {"username": l_friend.username})));
			c.push("\">");
			c.push(Surface.valOut(l_friend.username));
			c.push("</a>\n </div>\n </div>\n </span>\n </div>\n");
		}
	}
	c.push(" <div style=\"clear:both;\"></div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.mohwserverinfo._use_138_21_block_extraClass = new Surface.Block('serverbrowserwarsaw.mohwserverinfo._use_138_21_block_extraClass');
serverbrowserwarsaw.mohwserverinfo._use_138_21_block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("serverinfo-players-box");
	return c.join("");
}
;
serverbrowserwarsaw.mohwserverinfo._use_138_21_block_title = new Surface.Block('serverbrowserwarsaw.mohwserverinfo._use_138_21_block_title');
serverbrowserwarsaw.mohwserverinfo._use_138_21_block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.mohwserverinfo._use_138_21_block_content = new Surface.Block('serverbrowserwarsaw.mohwserverinfo._use_138_21_block_content');
serverbrowserwarsaw.mohwserverinfo._use_138_21_block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_soldierSlots;
	l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.serverinfo, 2, b, kwargs);
	c.push(" <div id=\"serverinfo-players-all-wrapper\"></div>\n <div id=\"serverinfo-players-all-view\" class=\"base-link\" data-numPlayers=\"");
	c.push(Surface.valOut(l_soldierSlots.current));
	c.push("\" data=\"");
	c.push(Surface.valOut(o.serverinfo.guid));
	c.push("\">");
	c.push(Surface.valOut("表示"));
	c.push(" ");
	c.push(Surface.valOut(S.Modifier.pluralize(l_soldierSlots.current, "プレイヤー", "全プレイヤー")));
	c.push("</div>\n <div id=\"serverinfo-players-all-hide\" class=\"base-link\">");
	c.push(Surface.valOut("非表示"));
	c.push(" ");
	c.push(Surface.valOut(S.Modifier.pluralize(l_soldierSlots.current, "プレイヤー", "全プレイヤー")));
	c.push("</div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.mohwserverinfo.surface_4_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwserverinfo');
	c.push("<surf:container id=\"serverbrowser-show\"");
	c.push(">");
	var l_favGuids;
	var l_soldierSlots;
	var l_isFavorite;
	var l_session;
	var l_mapname;
	var l_mapinfo;
	o.players = o.players;
	c.push("\n <div class=\"serverbrowser-");
	if (!(((typeof(o) != "undefined" && o !== null && typeof(o.serverinfo) != "undefined" && o.serverinfo !== null && typeof(o.serverinfo.online) != "undefined" && o.serverinfo.online !== null) ? o.serverinfo.online : false))) {
		c.push("offline");
	}
	else {
		c.push("online");
	}
	c.push("-info\">\n");
	l_session = S.Modifier.get(Surface.globalContext, "session");
	l_favGuids = S.Modifier.get(Surface.globalContext, "favGuids");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : false)) {
		c.push(" <div class=\"loading\"></div>\n");
	}
	else {
		if ((typeof(o) != "undefined" && o !== null && typeof(o.serverinfo) != "undefined" && o.serverinfo !== null)) {
			l_isFavorite = S.Modifier.contains(l_favGuids, S.Modifier.get(o.serverinfo, "guid", ""));
			l_mapinfo = $S.callFunction("common.mapinfo", o.serverinfo.game, o.serverinfo.map, b, kwargs);
			l_mapname = S.Modifier.get(l_mapinfo, "name");
			c.push("\n");
			l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.serverinfo, 2, b, kwargs);
			c.push("\n <span class=\"");
			c.push(Surface.valOut($S.callFunction("common.getGameIconCSS", o.serverinfo.game, o.serverinfo.platform, o.serverinfo.gameExpansions, b, kwargs)));
			c.push("\"></span>\n <h1 id=\"selected-server-name\" class=\"wfont\">\n <a href=\"");
			c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": o.serverinfo.guid, "platform": o.platformString, "slug": S.Modifier.slugify(o.serverinfo.name)})));
			c.push("\">\n ");
			c.push(Surface.valOut(o.serverinfo.name));
			c.push("\n </a>\n </h1>\n <div style=\"clear: both;\"></div>\n");
			if (o.serverinfo.online) {
				c.push(" <div id=\"serverbrowser-show-serverjoin\">\n <a href=\"");
				c.push(Surface.valOut($S.callFunction("common.showServerUrlByServer", o.serverinfo, b, kwargs)));
				c.push("\"\n class=\"base-button-arrow-almost-gigantic\n ");
				if (!($S.callFunction("serverguide.enableJoinButton", o.serverinfo, b, kwargs))) {
					c.push(" disabled");
				}
				c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-role=\"");
				c.push(Surface.valOut(1));
				c.push("\"\n data-guid=\"");
				c.push(Surface.valOut(o.serverinfo.guid));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(o.serverinfo.game));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(o.serverinfo.platform));
				c.push("\"\n data-gameid=\"");
				c.push(Surface.valOut(o.serverinfo.gameId));
				c.push("\"\n data-ip=\"");
				c.push(Surface.valOut(o.serverinfo.ip));
				c.push("\"\n data-port=\"");
				c.push(Surface.valOut(o.serverinfo.port));
				c.push("\"\n data-track=\"serverbrowser.server.selected.join\">\n ");
				c.push(Surface.valOut("サーバーに参加"));
				c.push("\n </a>\n <div class=\"base-clear\"></div>\n </div>\n <input type=\"text\" class=\"serverbrowser-server-link-field base-no-ajax\"\n value=\"");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.showAbsoluteServerUrl", o.serverinfo.platform, o.serverinfo.guid, o.serverinfo.name, b, kwargs)));
				c.push("\" />\n <div style=\"clear: both;\"></div>\n <div id=\"selected-server-mapimage\">\n <img src=\"");
				c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.get(l_mapinfo, "imageBig"), b, kwargs)));
				c.push("\" alt=\"");
				c.push(Surface.valOut(S.Modifier.get(l_mapinfo, "name")));
				c.push("\" width=146 height=79 />\n </div>\n <div class=\"selected-server-info-wrapper\">\n");
				if (((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false)) {
					c.push(" <div class=\"serverbrowser-add-favorite\">\n <form action=\"");
					c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/gameserverbookmark/toggleFavourite/", Surface.urlContext)));
					c.push("\">\n <input type=\"hidden\" name=\"guid\" value=\"");
					c.push(Surface.valOut(o.serverinfo.guid));
					c.push("\" />\n </form>\n <div class=\"serverbrowser-add-favorite-toggle ");
					if (l_isFavorite) {
						c.push("isFavorite");
					}
					c.push("\" ><span>");
					if (l_isFavorite) {
						c.push(Surface.valOut("お気に入り"));
					}
					else {
						c.push(Surface.valOut("お気に入りに追加"));
					}
					c.push("</span></div>\n <div class=\"serverbrowser-add-favorite-loading\">\n <img width=\"16\" height=\"16\" src=\"");
					c.push(Surface.valOut($S.callFunction("base.asset", "/public/base/shared/ajax-loader.gif", b, kwargs)));
					c.push("\" alt=\"");
					c.push(Surface.valOut("ロード中…"));
					c.push("\" />\n </div>\n </div>\n <div class=\"base-clear\"></div>\n");
				}
				c.push("\n <ul id=\"selected-server-info\">\n <li>");
				c.push(Surface.valOut(l_soldierSlots.current));
				c.push(" / ");
				c.push(Surface.valOut(l_soldierSlots.max));
				c.push(" ");
				c.push(Surface.valOut("プレイヤー"));
				c.push("</li>\n <li>");
				c.push(Surface.valOut((S.translations[l_mapname] || l_mapname)));
				c.push("</li>\n <li>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", o.serverinfo.mapMode, o.serverinfo.game, b, kwargs)));
				c.push("</li>\n <li>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.playlistStringLocalized", o.serverinfo.playlist, b, kwargs)));
				c.push("</li>\n </ul>\n </div>\n <div style=\"clear: both;\"></div>\n");
				if ($S.callFunction("serverguide.liveScoreboardEnabled", o.serverinfo.game, o.serverinfo.platform, b, kwargs)) {
					c.push(" ");
					c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverinfoscore")), o, null, kwargs));
					c.push("\n");
				}
				c.push("\n <div style=\"clear: both;\"></div>\n <div id=\"serverinfo-more-info\">\n <div id=\"selected-server-settings\">\n <h2>");
				c.push(Surface.valOut("サーバー設定"));
				c.push("</h2>\n <ul id=\"server-settings\">\n <li>");
				c.push(Surface.valOut("ランク"));
				c.push("<span class=\"selected-server-setting selected-server-setting-ranked selected-server-setting-ranked-");
				if (o.serverinfo.ranked) {
					c.push("on");
				}
				else {
					c.push("off");
				}
				c.push("\">");
				if (o.serverinfo.ranked) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</span></li>\n <li>");
				c.push(Surface.valOut("プリセット"));
				c.push("<span class=\"selected-server-setting selected-server-setting-type selected-server-setting-type-");
				c.push(Surface.valOut(S.Modifier.lower($S.callFunction("serverbrowserwarsaw.gameServerPresetStringNoLocalization", o.serverinfo.preset, b, kwargs))));
				c.push("\">");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", o.serverinfo.preset, b, kwargs)));
				c.push("</span></li>\n <li>Punkbuster<span class=\"selected-server-setting selected-server-setting-pb selected-server-setting-pb-");
				if (o.serverinfo.punkbuster) {
					c.push("on");
				}
				else {
					c.push("off");
				}
				c.push("\">");
				if (o.serverinfo.punkbuster) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</span></li>\n <li>");
				c.push(Surface.valOut("パスワード"));
				c.push("<span class=\"selected-server-setting selected-server-setting-password selected-server-setting-password-");
				if (o.serverinfo.hasPassword) {
					c.push("on");
				}
				else {
					c.push("off");
				}
				c.push("\">");
				if (o.serverinfo.hasPassword) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</span></li>\n </ul>\n </div>\n </div>\n <div style=\"clear: both;\"></div>\n");
				if ((S.compat.gt(S.Modifier.count(o.friends), 0) && ((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false))) {
					c.push(Surface.importTemplate(("common" + ("." + "secondarycontent")), o, block_serverbrowserwarsaw_mohwserverinfo_use_110_21, kwargs));
				}
				c.push("\n");
				if (S.compat.gt(l_soldierSlots.current, 0)) {
					c.push(" <div style=\"clear:both;\"></div>\n");
					c.push(Surface.importTemplate(("common" + ("." + "secondarycontent")), o, block_serverbrowserwarsaw_mohwserverinfo_use_138_21, kwargs));
				}
				c.push("\n <div style=\"clear:both;\"></div>\n");
			}
			else {
				c.push(" <div class=\"common-secondary-column-line\"></div>\n <h1 id=\"serverinfo-serveroffline\">");
				c.push(Surface.valOut("サーバーはオフラインです"));
				c.push("</h1>\n <div class=\"common-secondary-column-line\"></div>\n");
			}
		}
	}
	c.push(" </div>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.mohwserverinfo", "surface_4_1", "serverbrowser-show", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_mohwserverintro = new Surface.BlockConfig('base.ajaxindex', {'titleComponent': 'serverbrowserwarsaw.mohwserverintro.block_titleComponent', 'mainContent': 'serverbrowserwarsaw.mohwserverintro.block_mainContent'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('mohwserverintro'));
serverbrowserwarsaw.mohwserverintro.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwserverintro;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwserverintro');
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('base.ajaxindex', o, b, kwargs);
}
;
serverbrowserwarsaw.mohwserverintro.block_titleComponent = new Surface.Block('serverbrowserwarsaw.mohwserverintro.block_titleComponent');
serverbrowserwarsaw.mohwserverintro.block_titleComponent.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("サーバーブラウザー"));
	c.push(" - ");
	return c.join("");
}
;
serverbrowserwarsaw.mohwserverintro.block_mainContent = new Surface.Block('serverbrowserwarsaw.mohwserverintro.block_mainContent');
serverbrowserwarsaw.mohwserverintro.block_mainContent.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("<div id=\"serverbrowser-mohwintro\" class=\"base-middle common-box\">\n <h1>");
	c.push(Surface.valOut("ブラウザーからサーバーに参加する"));
	c.push("</h1>\n <p>");
	c.push(Surface.valOut("メダル オブ オナー ウォーファイターをPCから起動すると、サーバーおよびフレンドの元へ、ブラウザーから直接参加できるため非常に便利です。"));
	c.push("</p>\n <div class=\"image\"></div>\n</div>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_mohwshow = new Surface.BlockConfig('serverbrowserwarsaw.show', {'mapRotation': 'serverbrowserwarsaw.mohwshow.block_mapRotation', 'settings': 'serverbrowserwarsaw.mohwshow.block_settings', 'shortInfo': 'serverbrowserwarsaw.mohwshow.block_shortInfo', 'scoreBoard': 'serverbrowserwarsaw.mohwshow.block_scoreBoard', 'header': 'serverbrowserwarsaw.mohwshow.block_header'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('mohwshow'));
serverbrowserwarsaw.mohwshow.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwshow');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.show', o, b, kwargs);
}
;
serverbrowserwarsaw.mohwshow.block_header = new Surface.Block('serverbrowserwarsaw.mohwshow.block_header');
serverbrowserwarsaw.mohwshow.block_header.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "showserverheader")), {"server": o.server}, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.mohwshow.surface_26_35 = new Surface.SingleSurface("serverbrowserwarsaw.mohwshow.surface_26_35");
serverbrowserwarsaw.mohwshow.surface_26_35.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_mohwshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.mohwshow');
	c.push("<surf:container id=\"serverbrowser-show-info-ping\"");
	c.push(">");
	c.push(Surface.valOut(o.server.ping));
	c.push(" ms");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.mohwshow", "surface_26_35", "serverbrowser-show-info-ping", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.mohwshow.block_shortInfo = new Surface.Block('serverbrowserwarsaw.mohwshow.block_shortInfo');
serverbrowserwarsaw.mohwshow.block_shortInfo.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_soldierSlots;
	var l_queueSlots;
	c.push("\n <table id=\"server-info-short\">\n <thead>\n <tr>\n <th>");
	c.push(Surface.valOut("プレイヤー"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("PING"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("ランク"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("プリセット"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("Punkbuster"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("パスワード"));
	c.push("</th>\n </tr>\n </thead>\n <tbody>\n <tr>\n");
	l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
	l_queueSlots = $S.callFunction("serverguide.getServerSlots", o.server, 1, b, kwargs);
	c.push(" <td id=\"server-info-players\">");
	c.push(Surface.valOut(l_soldierSlots.current));
	c.push(" / ");
	c.push(Surface.valOut(l_soldierSlots.max));
	if (S.compat.gt(l_queueSlots.current, 0)) {
		c.push(" [<abbr title=\"");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push(" ");
		c.push(Surface.valOut("人待ち"));
		c.push("\">");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push("</abbr>]");
	}
	c.push("</td>\n <td id=\"server-info-ping\">");
	c.push(serverbrowserwarsaw.mohwshow.surface_26_35.render({"server": {"ping": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.ping) != "undefined" && o.server.ping !== null) ? o.server.ping : null)}}, b, kwargs));
	c.push("</td>\n <td id=\"server-info-ranked\" ");
	if (!(o.server.ranked)) {
		c.push("class=\"server-info-off\"");
	}
	c.push(">");
	if (o.server.ranked) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n <td id=\"server-info-preset\"");
	if (S.compat.neq(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 0), 2)) {
		c.push(" class=\"server-info-off\"");
	}
	c.push(">");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 1), b, kwargs)));
	c.push("</td>\n <td id=\"server-info-punkbuster\"");
	if (!(o.server.punkbuster)) {
		c.push(" class=\"server-info-off\"");
	}
	c.push(">");
	if (o.server.punkbuster) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n <td id=\"server-info-password\" class=\"last");
	if (!(o.server.hasPassword)) {
		c.push(" server-info-off");
	}
	c.push("\">");
	if (o.server.hasPassword) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n </tr>\n </tbody>\n</table>\n");
	return c.join("");
}
;
serverbrowserwarsaw.mohwshow.block_settings = new Surface.Block('serverbrowserwarsaw.mohwshow.block_settings');
serverbrowserwarsaw.mohwshow.block_settings.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serversettings")), {"server": o.server}, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.mohwshow.block_mapRotation = new Surface.Block('serverbrowserwarsaw.mohwshow.block_mapRotation');
serverbrowserwarsaw.mohwshow.block_mapRotation.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "maprotation")), {"server": o.server}, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.mohwshow.block_scoreBoard = new Surface.Block('serverbrowserwarsaw.mohwshow.block_scoreBoard');
serverbrowserwarsaw.mohwshow.block_scoreBoard.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" <div id=\"server-players-list\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "scoreboard")), {"server": o.server}, null, kwargs));
	c.push("\n </div>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_playnow = new Surface.BlockConfig('serverbrowserwarsaw.base', {'content': 'serverbrowserwarsaw.playnow.block_content', 'title': 'serverbrowserwarsaw.playnow.block_title', 'recommendedServers': 'serverbrowserwarsaw.playnow.block_recommendedServers', 'titleItem': 'serverbrowserwarsaw.playnow.block_titleItem'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('playnow'));
serverbrowserwarsaw.playnow.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_playnow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.playnow');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.base', o, b, kwargs);
}
;
serverbrowserwarsaw.playnow.block_titleItem = new Surface.Block('serverbrowserwarsaw.playnow.block_titleItem');
serverbrowserwarsaw.playnow.block_titleItem.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("今すぐプレイ"));
	c.push(" - ");
	return c.join("");
}
;
serverbrowserwarsaw.playnow.block_title = new Surface.Block('serverbrowserwarsaw.playnow.block_title');
serverbrowserwarsaw.playnow.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("今すぐプレイ"));
	return c.join("");
}
;
serverbrowserwarsaw.playnow.block_recommendedServers = new Surface.Block('serverbrowserwarsaw.playnow.block_recommendedServers');
serverbrowserwarsaw.playnow.block_recommendedServers.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "recommendedservers")), {"recommendedServers": []}, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
serverbrowserwarsaw.playnow.surface_50_21 = new Surface.SingleSurface("serverbrowserwarsaw.playnow.surface_50_21");
serverbrowserwarsaw.playnow.surface_50_21.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_playnow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.playnow');
	c.push("<surf:container id=\"play-now-tab-content\"");
	c.push(">");
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "playnowtabcontent")), {"selectedMode": o.selectedMode, "playlists": S.Modifier.listextend(o.playlists, o.premiumPlaylists)}, null, kwargs));
	c.push("\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.playnow", "surface_50_21", "play-now-tab-content", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.playnow.block_content = new Surface.Block('serverbrowserwarsaw.playnow.block_content');
serverbrowserwarsaw.playnow.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_for_serverbrowserwarsaw_playnow_20_30_list;
	var l_imageUrl;
	var l_for_serverbrowserwarsaw_playnow_33_30_list;
	c.push(" <section id=\"playnow\" class=\"spacing-top\">\n <div class=\"row-tight\" data-intro=\"fxp\" data-intro-step=\"4\">\n <div class=\"span2\" data-intro=\"fxp\" data-intro-step=\"3\">\n <div class=\"box\">\n <header>\n <h1>");
	c.push(Surface.valOut("モード選択"));
	c.push("</h1>\n </header>\n <nav class=\"play-now-menu\" data-bind-intro=\"next\" data-intro-step=\"3\">\n <ul>\n");
	l_for_serverbrowserwarsaw_playnow_20_30_list = o.playlists;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_playnow_20_30_list), 0)) {
		for (var l_for_serverbrowserwarsaw_playnow_20_30_key in l_for_serverbrowserwarsaw_playnow_20_30_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_playnow_20_30_list[l_for_serverbrowserwarsaw_playnow_20_30_key])) {
				continue;
			}
			var l_playlist = l_for_serverbrowserwarsaw_playnow_20_30_list[l_for_serverbrowserwarsaw_playnow_20_30_key];
			c.push("\n");
			if (S.compat.eq(S.Modifier.get(l_playlist, "nameSID"), "CONQUEST_LADDER")) {
				continue;
			}
			c.push("\n <li data-url=\"");
			c.push(Surface.valOut(S.Modifier.get(l_playlist, "url")));
			c.push("\"");
			if (((typeof(S.Modifier.get(l_playlist, "selected")) != "undefined" && S.Modifier.get(l_playlist, "selected") !== null) ? S.Modifier.get(l_playlist, "selected") : false)) {
				c.push(" class=\"active\"");
			}
			c.push(" data-game-mode-name=\"");
			c.push(Surface.valOut(S.Modifier.get(l_playlist, "name")));
			c.push("\">\n");
			l_imageUrl = $S.callFunction("base.asset", S.Modifier.get(l_playlist, "smallImage"), b, kwargs);
			c.push(" <div style=\"background: url(");
			c.push(Surface.valOut(l_imageUrl));
			c.push(");\"></div>\n <a href=\"#\">");
			c.push(Surface.valOut(S.Modifier.get(l_playlist, "nameSID")));
			c.push("</a>\n </li>\n ");
		}
	}
	c.push("\n");
	l_for_serverbrowserwarsaw_playnow_33_30_list = o.premiumPlaylists;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_playnow_33_30_list), 0)) {
		for (var l_for_serverbrowserwarsaw_playnow_33_30_key in l_for_serverbrowserwarsaw_playnow_33_30_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_playnow_33_30_list[l_for_serverbrowserwarsaw_playnow_33_30_key])) {
				continue;
			}
			var l_playlist = l_for_serverbrowserwarsaw_playnow_33_30_list[l_for_serverbrowserwarsaw_playnow_33_30_key];
			c.push(" <li data-url=\"");
			c.push(Surface.valOut(S.Modifier.get(l_playlist, "url")));
			c.push("\" class=\"premium");
			if (((typeof(S.Modifier.get(l_playlist, "selected")) != "undefined" && S.Modifier.get(l_playlist, "selected") !== null) ? S.Modifier.get(l_playlist, "selected") : false)) {
				c.push(" active");
			}
			c.push("\" data-game-mode-name=\"");
			c.push(Surface.valOut(S.Modifier.get(l_playlist, "name")));
			c.push("\">\n");
			l_imageUrl = $S.callFunction("base.asset", S.Modifier.get(l_playlist, "smallImage"), b, kwargs);
			c.push(" <div style=\"background: url(");
			c.push(Surface.valOut(l_imageUrl));
			c.push(");\"></div>\n <a href=\"#\">\n <span class=\"icon-premium-p\"></span>\n ");
			c.push(Surface.valOut(S.Modifier.get(l_playlist, "nameSID")));
			c.push("\n </a>\n </li>\n");
		}
	}
	c.push(" </ul>\n </nav>\n </div>\n </div>\n <div class=\"span4\">\n <div class=\"box\">\n");
	c.push(serverbrowserwarsaw.playnow.surface_50_21.render({"playlists": ((typeof(o) != "undefined" && o !== null && typeof(o.playlists) != "undefined" && o.playlists !== null) ? o.playlists : null), "premiumPlaylists": ((typeof(o) != "undefined" && o !== null && typeof(o.premiumPlaylists) != "undefined" && o.premiumPlaylists !== null) ? o.premiumPlaylists : null), "selectedMode": ((typeof(o) != "undefined" && o !== null && typeof(o.selectedMode) != "undefined" && o.selectedMode !== null) ? o.selectedMode : null)}, b, kwargs));
	c.push("\n </div>\n </div>\n </div>\n </section>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_playnowtabcontent = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('playnowtabcontent'));
serverbrowserwarsaw.playnowtabcontent.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_playnowtabcontent;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.playnowtabcontent');
	var l_for_serverbrowserwarsaw_playnowtabcontent_54_26_list;
	var l_hl;
	var l_header;
	var l_for_serverbrowserwarsaw_playnowtabcontent_50_22_list;
	var l_name;
	var l_objectives;
	var l_for_serverbrowserwarsaw_playnowtabcontent_4_6_list;
	var l_for_serverbrowserwarsaw_playnowtabcontent_12_18_list;
	c.push("\n<div class=\"box-content playnow-tab-content\">\n");
	l_for_serverbrowserwarsaw_playnowtabcontent_4_6_list = o.playlists;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_playnowtabcontent_4_6_list), 0)) {
		for (var l_for_serverbrowserwarsaw_playnowtabcontent_4_6_key in l_for_serverbrowserwarsaw_playnowtabcontent_4_6_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_playnowtabcontent_4_6_list[l_for_serverbrowserwarsaw_playnowtabcontent_4_6_key])) {
				continue;
			}
			var l_playlist = l_for_serverbrowserwarsaw_playnowtabcontent_4_6_list[l_for_serverbrowserwarsaw_playnowtabcontent_4_6_key];
			if (S.compat.eq(o.selectedMode, S.Modifier.get(l_playlist, "name"))) {
				c.push("\n");
				l_name = S.Modifier.get(l_playlist, "nameSID");
				c.push(" <p class=\"objective-text\">");
				c.push(Surface.valOut(l_name));
				c.push(": ");
				c.push(Surface.valOut(S.Modifier.get(l_playlist, "description")));
				c.push("</p>\n");
				if (S.compat.eq(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : null), 1)) {
					c.push(" <button class=\"btn btn-primary\"\n");
					l_for_serverbrowserwarsaw_playnowtabcontent_12_18_list = S.Modifier.get(l_playlist, "launchParams");
					if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_playnowtabcontent_12_18_list), 0)) {
						for (var l_attr in l_for_serverbrowserwarsaw_playnowtabcontent_12_18_list) {
							if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_playnowtabcontent_12_18_list[l_attr])) {
								continue;
							}
							var l_value = l_for_serverbrowserwarsaw_playnowtabcontent_12_18_list[l_attr];
							c.push(" ");
							c.push(Surface.valOut(l_attr));
							c.push("= \"");
							c.push(Surface.valOut(l_value));
							c.push("\"\n");
						}
					}
					c.push(" data-platform=\"");
					c.push(Surface.valOut(1));
					c.push("\"\n data-game=\"");
					c.push(Surface.valOut(Surface.globalContext.realm.game));
					c.push("\"\n data-bind-intro=\"next\"\n data-intro-step=\"4\">\n ");
					c.push(Surface.valOut("今すぐプレイ"));
					c.push("\n </button>\n");
					if (!($S.callFunction("common.ownsGameExpansion", Surface.globalContext.staticContext.gameExpansions.BF4TRIAL, Surface.globalContext.staticContext.activePersona.platform, b, kwargs))) {
						c.push(" <label class=\"ranked-only\"><input type=\"checkbox\" id=\"ranked-only\" value=\"1\" /> ");
						c.push(Surface.valOut("ランクのみ"));
						c.push("</label>\n");
					}
				}
				c.push(" <div class=\"game-mode-image\">\n");
				if (S.Modifier.get(l_playlist, "movieUrl")) {
					l_hl = Surface.globalContext.staticContext.locale;
					c.push(" <div class=\"play-button\" data-bind=\"game-mode-video-play\"></div>\n <div class=\"video hide\" data-src=\"");
					c.push(S.Modifier.get(l_playlist, "movieUrl"));
					c.push("?rel=0&amp;cc_lang_pref=");
					c.push(Surface.valOut(S.Modifier.substring(l_hl, 0, 2)));
					c.push("&amp;cc_load_policy=1&amp;vq=hd1080&amp;autoplay=1\"></div>\n");
				}
				c.push(" <div class=\"image\" style=\"background-image: url(");
				c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.get(l_playlist, "largeImage"), b, kwargs)));
				c.push(");\"></div>\n </div>\n <div class=\"game-mode-legends\">\n <ul>\n <li id=\"legend-squad\"><i class=\"legend-icon squad\"></i><span>");
				c.push(Surface.valOut("分隊"));
				c.push("</span></li>\n <li id=\"legend-friendly\"><i class=\"legend-icon friendly\"></i><span>");
				c.push(Surface.valOut("味方"));
				c.push("</span></li>\n <li id=\"legend-enemy\"><i class=\"legend-icon enemy\"></i><span>");
				c.push(Surface.valOut("敵"));
				c.push("</span></li>\n </ul>\n </div>\n <div class=\"game-mode-objectives\">\n");
				if (S.Modifier.get(l_playlist, "premiumPlaylist", false)) {
					c.push(" <h5>");
					c.push(Surface.valOut("プレミアム限定"));
					c.push("</h5>\n");
				}
				else {
					l_objectives = S.Modifier.get(l_playlist, "objectives", []);
					l_for_serverbrowserwarsaw_playnowtabcontent_50_22_list = l_objectives;
					if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_playnowtabcontent_50_22_list), 0)) {
						for (var l_for_serverbrowserwarsaw_playnowtabcontent_50_22_key in l_for_serverbrowserwarsaw_playnowtabcontent_50_22_list) {
							if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_playnowtabcontent_50_22_list[l_for_serverbrowserwarsaw_playnowtabcontent_50_22_key])) {
								continue;
							}
							var l_objective = l_for_serverbrowserwarsaw_playnowtabcontent_50_22_list[l_for_serverbrowserwarsaw_playnowtabcontent_50_22_key];
							l_header = S.Modifier.get(l_objective, "header", "目標");
							c.push(" <h5>");
							c.push(Surface.valOut(l_header));
							c.push("</h5>\n <ul class=\"objectives\">\n");
							l_for_serverbrowserwarsaw_playnowtabcontent_54_26_list = S.Modifier.get(l_objective, "bullets", []);
							if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_playnowtabcontent_54_26_list), 0)) {
								for (var l_for_serverbrowserwarsaw_playnowtabcontent_54_26_key in l_for_serverbrowserwarsaw_playnowtabcontent_54_26_list) {
									if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_playnowtabcontent_54_26_list[l_for_serverbrowserwarsaw_playnowtabcontent_54_26_key])) {
										continue;
									}
									var l_bullet = l_for_serverbrowserwarsaw_playnowtabcontent_54_26_list[l_for_serverbrowserwarsaw_playnowtabcontent_54_26_key];
									c.push(" <li>");
									c.push(Surface.valOut(l_bullet));
									c.push("</li>\n");
								}
							}
							c.push(" </ul>\n");
						}
					}
				}
				c.push(" </div>\n ");
			}
			c.push("\n");
		}
	}
	c.push("\n</div>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_popupadvancedfilter = new Surface.BlockConfig('ui.dialog', {'content': 'serverbrowserwarsaw.popupadvancedfilter.block_content', 'title': 'serverbrowserwarsaw.popupadvancedfilter.block_title', 'extraClass': 'serverbrowserwarsaw.popupadvancedfilter.block_extraClass'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('popupadvancedfilter'));
serverbrowserwarsaw.popupadvancedfilter.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_popupadvancedfilter;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.popupadvancedfilter');
	c.push("\n");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.data) != "undefined" && o.data !== null && typeof(o.data.position) != "undefined" && o.data.position !== null)) {
		o.position = o.data.position;
	}
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('ui.dialog', o, b, kwargs);
}
;
serverbrowserwarsaw.popupadvancedfilter.block_title = new Surface.Block('serverbrowserwarsaw.popupadvancedfilter.block_title');
serverbrowserwarsaw.popupadvancedfilter.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("上級フィルター設定"));
	return c.join("");
}
;
serverbrowserwarsaw.popupadvancedfilter.block_extraClass = new Surface.Block('serverbrowserwarsaw.popupadvancedfilter.block_extraClass');
serverbrowserwarsaw.popupadvancedfilter.block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("medium advanced-server-filter");
	return c.join("");
}
;
serverbrowserwarsaw.popupadvancedfilter.block_content = new Surface.Block('serverbrowserwarsaw.popupadvancedfilter.block_content');
serverbrowserwarsaw.popupadvancedfilter.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_advanced_filters;
	l_advanced_filters = S.Modifier.get($S.callFunction("gamedata.get", Surface.globalContext.realm.section, "gameserver", b, kwargs), "advancedsettings");
	c.push("\n <form id=\"serverfilter-advancedfilters-form\">\n <div class=\"popup-serveradvancedfilter-container\">\n <div id=\"popup-serveradvancedfilter-settings-gamesettings\" class=\"popup-serveradvancedfilter-settings\">\n ");
	if (S.compat.gt(S.Modifier.count(S.Modifier.get(l_advanced_filters, "bool", {})), 0)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterbool")), {"filters": S.Modifier.get(l_advanced_filters, "bool", {}), "serverSettings": o.serverSettings}, null, kwargs));
		c.push("\n");
	}
	c.push(" </div>\n");
	if (S.compat.gt(S.Modifier.count(S.Modifier.get(S.Modifier.get(l_advanced_filters, "percent", {}), "filters", {})), 0)) {
		c.push(" <div id=\"popup-serveradvancedfilter-settings-othersettings\" class=\"popup-serveradvancedfilter-settings\">\n");
		if (S.compat.gt(S.Modifier.count(S.Modifier.get(S.Modifier.get(l_advanced_filters, "percent", {}), "filters", {})), 0)) {
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterpercent")), {"filters": S.Modifier.get(l_advanced_filters, "percent", {}), "serverSettings": o.serverSettings}, null, kwargs));
			c.push("\n");
		}
		c.push("\n");
		if (S.compat.gt(S.Modifier.count(S.Modifier.get(S.Modifier.get(l_advanced_filters, "number", {}), "filters", {})), 0)) {
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filternumber")), {"filters": S.Modifier.get(l_advanced_filters, "number", {}), "serverSettings": o.serverSettings}, null, kwargs));
			c.push("\n");
		}
		c.push(" <div class=\"base-clear\"></div>\n </div>\n");
	}
	c.push(" <div class=\"base-clear\"></div>\n </div>\n </form>\n <div class=\"base-clear\"></div>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_quickmatch = new Surface.BlockConfig('serverbrowserwarsaw.base', {'content': 'serverbrowserwarsaw.quickmatch.block_content', 'title': 'serverbrowserwarsaw.quickmatch.block_title', 'titleItem': 'serverbrowserwarsaw.quickmatch.block_titleItem'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('quickmatch'));
serverbrowserwarsaw.quickmatch.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_quickmatch;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.quickmatch');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.base', o, b, kwargs);
}
;
serverbrowserwarsaw.quickmatch.block_titleItem = new Surface.Block('serverbrowserwarsaw.quickmatch.block_titleItem');
serverbrowserwarsaw.quickmatch.block_titleItem.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("クイックマッチ"));
	c.push(" - ");
	return c.join("");
}
;
serverbrowserwarsaw.quickmatch.block_title = new Surface.Block('serverbrowserwarsaw.quickmatch.block_title');
serverbrowserwarsaw.quickmatch.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("クイックマッチ"));
	return c.join("");
}
;
serverbrowserwarsaw.quickmatch.block_content = new Surface.Block('serverbrowserwarsaw.quickmatch.block_content');
serverbrowserwarsaw.quickmatch.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_hasPlatform;
	var l_experienceImages;
	var l_for_serverbrowserwarsaw_quickmatch_30_13_list;
	var l_for_serverbrowserwarsaw_quickmatch_30_13_iteration;
	var l_shortName;
	var l_experience;
	var l_name;
	var l_description;
	var l_experienceKey;
	var l_personaData;
	c.push("\n");
	l_personaData = Surface.globalContext.staticContext.activePersona;
	c.push("\n");
	l_hasPlatform = ((typeof(l_personaData) != "undefined" && l_personaData !== null && typeof(l_personaData.platform) != "undefined" && l_personaData.platform !== null) ? l_personaData.platform : false);
	c.push("\n");
	l_experienceImages = {"TDM": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/tdm-7224f018.jpg", "TWS": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/conquest-5f3f9d2e.jpg", "TWL": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/conquest_large-6a5cf4a0.jpg", "HIT": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/crosshair-446d085b.jpg", "BM": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/blood_money-6a21fc00.jpg", "HOT": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/hotwire-44b9dd49.jpg", "HOS": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/rescue-b863badc.jpg", "HST": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/heist-3021910a.jpg", "CG": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/bounty_hunter-4254705f.jpg", "SWM": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/crosshair-446d085b.jpg", "CRM": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/tdm-7224f018.jpg", "SQH": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/squadheist-39ea99e5.jpg", "CTF": "//eaassets-a.akamaihd.net/battlelog/bb/bfh/gamemodes/gwy_capture_the_bag-04f5545e.jpg"};
	c.push("\n <section id=\"quickmatch\">\n <div class=\"row\">\n");
	l_for_serverbrowserwarsaw_quickmatch_30_13_list = o.experiences;
	l_for_serverbrowserwarsaw_quickmatch_30_13_iteration = 0;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_quickmatch_30_13_list), 0)) {
		for (var l_for_serverbrowserwarsaw_quickmatch_30_13_key in l_for_serverbrowserwarsaw_quickmatch_30_13_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_quickmatch_30_13_list[l_for_serverbrowserwarsaw_quickmatch_30_13_key])) {
				continue;
			}
			var l_experienceIndex = l_for_serverbrowserwarsaw_quickmatch_30_13_list[l_for_serverbrowserwarsaw_quickmatch_30_13_key];
			l_for_serverbrowserwarsaw_quickmatch_30_13_iteration = S.compat.add(l_for_serverbrowserwarsaw_quickmatch_30_13_iteration, 1);
			l_experience = S.Modifier.get(S.Modifier.get($S.callFunction("gamedata.get", 8192, "experiences", b, kwargs), "experiences"), l_experienceIndex, {});
			l_experienceKey = S.Modifier.get(l_experience, "key");
			l_name = S.Modifier.get(l_experience, "name");
			l_description = S.Modifier.get(l_experience, "desc");
			l_shortName = S.Modifier.get(S.Modifier.explode(l_experienceKey, "_"), 0);
			c.push(" <div class=\"span4 box ");
			c.push(Surface.valOut(l_shortName));
			c.push("\">\n <img class=\"game-mode\" src=\"");
			c.push(Surface.valOut(S.Modifier.get(l_experienceImages, l_shortName)));
			c.push("\" />\n <div class=\"box-content no-top-spacing\">\n <h5>");
			c.push(Surface.valOut(S.Modifier.replace((S.translations[l_name] || l_name), "BFH ", "")));
			c.push("</h5>\n <p class=\"info\">");
			c.push(Surface.valOut((S.translations[l_description] || l_description)));
			c.push("</p>\n");
			if ((l_hasPlatform && S.compat.eq(l_personaData.platform, 1))) {
				c.push(" <a class=\"btn btn-primary\"\n data-bind-action=\"matchmake-mp-role\"\n data-role=\"");
				c.push(Surface.valOut(1));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(l_personaData.platform));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(l_personaData.game));
				c.push("\"\n data-experience=\"");
				c.push(Surface.valOut(S.Modifier.get(l_experience, "index")));
				c.push("\"\n data-expansion=\"");
				c.push(Surface.valOut(S.Modifier.get(l_experience, "expansion", "")));
				c.push("\"\n data-track=\"playnow.matchmake.");
				c.push(Surface.valOut(S.Modifier.get(l_experience, "index")));
				c.push(".join\">");
				c.push(Surface.valOut("クイックマッチ"));
				c.push("</a>\n");
			}
			else {
				c.push(" <span class=\"btn btn-primary disabled\" data-tooltip=\"");
				c.push(Surface.valOut("ゲームを購入して 参加しよう！"));
				c.push("\">");
				c.push(Surface.valOut("クイックマッチ"));
				c.push("</span>\n");
			}
			c.push(" </div>\n </div>\n");
			if (S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_quickmatch_30_13_iteration, 3), 0)) {
				c.push(" </div>\n <div class=\"row\">\n");
			}
		}
	}
	c.push(" </div>\n </section>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_recommendedservers = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('recommendedservers'));
serverbrowserwarsaw.recommendedservers.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_recommendedservers;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.recommendedservers');
	c.push("\n");
	c.push(serverbrowserwarsaw.recommendedservers.surface_2_1.render({"isLoading": ((typeof(o) != "undefined" && o !== null && typeof(o.isLoading) != "undefined" && o.isLoading !== null) ? o.isLoading : null), "recommendedServers": ((typeof(o) != "undefined" && o !== null && typeof(o.recommendedServers) != "undefined" && o.recommendedServers !== null) ? o.recommendedServers : null)}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.recommendedservers.surface_2_1 = new Surface.SingleSurface("serverbrowserwarsaw.recommendedservers.surface_2_1");
serverbrowserwarsaw.recommendedservers.surface_2_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_recommendedservers;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.recommendedservers');
	c.push("<section id=\"serverbrowser-recommended-servers\"");
	c.push(" ");
	c.push("class");
	c.push("=\"");
	c.push("box");
	c.push("\"");
	c.push(">");
	var l_gameModeString;
	var l_servers;
	var l_mapInfo;
	var l_for_serverbrowserwarsaw_recommendedservers_17_13_list;
	var l_mapinfo;
	var l_for_serverbrowserwarsaw_recommendedservers_79_17_list;
	if (S.compat.lt(S.Modifier.count(o.recommendedServers), 3)) {
		l_servers = [];
	}
	else {
		l_servers = o.recommendedServers;
	}
	c.push("\n");
	if (S.compat.gt(S.Modifier.count(l_servers), 0)) {
		c.push(" <header>\n <h1>");
		c.push(Surface.valOut("オススメのサーバー"));
		c.push("</h1>\n </header>\n <ul class=\"row-tight spacing-top-tight\">\n ");
		l_for_serverbrowserwarsaw_recommendedservers_17_13_list = S.Modifier.limit(l_servers, 3);
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_recommendedservers_17_13_list), 0)) {
			for (var l_for_serverbrowserwarsaw_recommendedservers_17_13_key in l_for_serverbrowserwarsaw_recommendedservers_17_13_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_recommendedservers_17_13_list[l_for_serverbrowserwarsaw_recommendedservers_17_13_key])) {
					continue;
				}
				var l_rec = l_for_serverbrowserwarsaw_recommendedservers_17_13_list[l_for_serverbrowserwarsaw_recommendedservers_17_13_key];
				if (!((typeof(l_rec) != "undefined" && l_rec !== null))) {
					continue;
				}
				c.push("\n");
				l_mapinfo = $S.callFunction("common.mapinfo", l_rec.server.game, l_rec.server.map, b, kwargs);
				c.push(" <li class=\"span2 server\" data-guid=\"");
				c.push(Surface.valOut(l_rec.server.guid));
				c.push("\"\n data-url=\"");
				c.push(Surface.valOut($S.callFunction("common.showServerUrlByServer", l_rec.server, b, kwargs)));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(l_rec.server.game));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(l_rec.server.platform));
				c.push("\"\n data-role=\"");
				c.push(Surface.valOut(1));
				c.push("\">\n <img class=\"show-on-load\" src=\"");
				c.push(Surface.valOut($S.callFunction("base.asset", l_mapinfo.image335x160, b, kwargs)));
				c.push("\" />\n <header>\n <p class=\"recommendation\">\n");
				if (S.compat.eq(l_rec.reason, "filter")) {
					c.push("\n");
					c.push(Surface.valOut("サーバー"));
					c.push("\n");
				}
				else if (S.compat.eq(l_rec.reason, "friends")) {
					c.push(" ");
					c.push(Surface.valOut("フレンドがプレイ中"));
					c.push("\n");
				}
				else if (S.compat.eq(l_rec.reason, "history")) {
					c.push(" ");
					c.push(Surface.valOut("プレイ済み"));
					c.push("\n");
				}
				else if (S.compat.eq(l_rec.reason, "favourite")) {
					c.push(" ");
					c.push(Surface.valOut("お気に入りのサーバー"));
					c.push("\n");
				}
				c.push(" </p>\n <p class=\"server-name\">\n <a href=\"");
				c.push(Surface.valOut($S.callFunction("common.showServerUrlByServer", l_rec.server, b, kwargs)));
				c.push("\">\n ");
				c.push(Surface.valOut(l_rec.server.name));
				c.push("\n </a>\n </p>\n </header>\n <button class=\"btn btn-small join-button arrow pull-right\n ");
				if (!($S.callFunction("serverguide.enableJoinButton", l_rec.server, b, kwargs))) {
					c.push(" disabled");
				}
				c.push("\"\n data-track=\"serverbrowser.recommendedserver.join\"\n data-telemetry-action=\"recommendedserver\"\n data-bind-action=\"join-mp-gameserver\">\n ");
				c.push(Surface.valOut("参加"));
				c.push("\n </button>\n <div class=\"server-info\">\n <p>\n");
				l_mapInfo = $S.callFunction("common.mapinfo", l_rec.server.game, l_rec.server.map, b, kwargs);
				l_gameModeString = $S.callFunction("serverguide.gameServerModeStringLocalized", l_rec.server.mapMode, l_rec.server.game, b, kwargs);
				c.push("\n <span class=\"map\">");
				c.push(Surface.valOut(S.Modifier.capitalize(S.Modifier.get(l_mapInfo, "name"))));
				c.push("</span>\n <span class=\"mode\">");
				c.push(Surface.valOut(l_gameModeString));
				c.push("</span>\n </p>\n </div>\n");
				if (S.compat.gt(S.Modifier.count(((typeof(l_rec) != "undefined" && l_rec !== null && typeof(l_rec.friends) != "undefined" && l_rec.friends !== null) ? l_rec.friends : [])), 0)) {
					c.push(" <div class=\"players\">\n ");
					c.push(Surface.importTemplate(("base" + ("." + "userlist")), {"users": l_rec.friends, "avatarOnly": true, "size": 30, "maxIterations": 5, "capFriends": true, "showMoreFriendsLink": false}, null, kwargs));
					c.push("\n </div>\n");
				}
				c.push(" </li>\n");
			}
		}
		else {
			l_for_serverbrowserwarsaw_recommendedservers_79_17_list = [1, 2, 3];
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_recommendedservers_79_17_list), 0)) {
				for (var l_for_serverbrowserwarsaw_recommendedservers_79_17_key in l_for_serverbrowserwarsaw_recommendedservers_79_17_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_recommendedservers_79_17_list[l_for_serverbrowserwarsaw_recommendedservers_79_17_key])) {
						continue;
					}
					var l_i = l_for_serverbrowserwarsaw_recommendedservers_79_17_list[l_for_serverbrowserwarsaw_recommendedservers_79_17_key];
					c.push(" <li class=\"span2 server\">\n <header>\n");
					if (((typeof(o) != "undefined" && o !== null && typeof(o.isLoading) != "undefined" && o.isLoading !== null) ? o.isLoading : true)) {
						c.push(" <p class=\"recommendation\">");
						c.push(Surface.valOut("ロード中…"));
						c.push("</p>\n");
					}
					else {
						c.push(" <p class=\"recommendation\">");
						c.push(Surface.valOut("サーバーが見つかりません"));
						c.push("</p>\n");
					}
					c.push(" </header>\n </li>\n");
				}
			}
		}
		c.push(" </ul>\n ");
	}
	c.push("\n");
	c.push("</section>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.recommendedservers", "surface_2_1", "serverbrowser-recommended-servers", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_regionfilter = new Surface.BlockConfig('common.popup', {'footer': 'serverbrowserwarsaw.regionfilter.block_footer', 'content': 'serverbrowserwarsaw.regionfilter.block_content', 'title': 'serverbrowserwarsaw.regionfilter.block_title', 'extraClass': 'serverbrowserwarsaw.regionfilter.block_extraClass'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('regionfilter'));
serverbrowserwarsaw.regionfilter.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_regionfilter;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.regionfilter');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('common.popup', o, b, kwargs);
}
;
serverbrowserwarsaw.regionfilter.block_title = new Surface.Block('serverbrowserwarsaw.regionfilter.block_title');
serverbrowserwarsaw.regionfilter.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut("地域フィルター設定"));
	return c.join("");
}
;
serverbrowserwarsaw.regionfilter.block_extraClass = new Surface.Block('serverbrowserwarsaw.regionfilter.block_extraClass');
serverbrowserwarsaw.regionfilter.block_extraClass.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("medium region-server-filter");
	return c.join("");
}
;
serverbrowserwarsaw.regionfilter.block_content = new Surface.Block('serverbrowserwarsaw.regionfilter.block_content');
serverbrowserwarsaw.regionfilter.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_for_serverbrowserwarsaw_regionfilter_11_9_list;
	var l_iter;
	var l_column;
	var l_for_serverbrowserwarsaw_regionfilter_60_29_list;
	var l_for_serverbrowserwarsaw_regionfilter_12_13_list;
	var l_lang_country;
	var l_for_serverbrowserwarsaw_regionfilter_40_13_list;
	var l_for_serverbrowserwarsaw_regionfilter_53_25_isEven;
	var l_regions;
	var l_for_serverbrowserwarsaw_regionfilter_39_9_list;
	var l_lang_country_key;
	var l_regionLabel;
	var l_for_serverbrowserwarsaw_regionfilter_18_29_list;
	var l_for_serverbrowserwarsaw_regionfilter_53_25_isOdd;
	var l_for_serverbrowserwarsaw_regionfilter_53_25_list;
	var l_for_serverbrowserwarsaw_regionfilter_53_25_iteration;
	c.push("\n");
	l_regions = S.Modifier.get($S.callFunction("gamedata.get", Surface.globalContext.realm.section, "gameserver", b, kwargs), "regions");
	if (S.Modifier.count(o.existingRegions)) {
		c.push(" <div id=\"serverbrowser-region-serverfilter-popup\">\n <h1>");
		c.push(Surface.valOut("1.地域を選択してください"));
		c.push("</h1>\n");
		l_for_serverbrowserwarsaw_regionfilter_11_9_list = o.existingRegions;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_regionfilter_11_9_list), 0)) {
			for (var l_key in l_for_serverbrowserwarsaw_regionfilter_11_9_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_regionfilter_11_9_list[l_key])) {
					continue;
				}
				var l_value = l_for_serverbrowserwarsaw_regionfilter_11_9_list[l_key];
				l_for_serverbrowserwarsaw_regionfilter_12_13_list = l_regions;
				if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_regionfilter_12_13_list), 0)) {
					for (var l_for_serverbrowserwarsaw_regionfilter_12_13_key in l_for_serverbrowserwarsaw_regionfilter_12_13_list) {
						if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_regionfilter_12_13_list[l_for_serverbrowserwarsaw_regionfilter_12_13_key])) {
							continue;
						}
						var l_region = l_for_serverbrowserwarsaw_regionfilter_12_13_list[l_for_serverbrowserwarsaw_regionfilter_12_13_key];
						if (S.compat.eq(l_key, l_region.id)) {
							c.push(" <div id=\"serverbrowser-region-filter-show-");
							c.push(Surface.valOut(l_region.id));
							c.push("\" class=\"serverbrowser-region-filter-show\" data-region=\"");
							c.push(Surface.valOut(l_region.id));
							c.push("\">\n");
							l_regionLabel = S.Modifier.get(l_region, "label");
							c.push(" <span class=\"label\">");
							c.push(Surface.valOut((S.translations[l_regionLabel] || l_regionLabel)));
							c.push("</span>\n");
							l_iter = 0;
							l_for_serverbrowserwarsaw_regionfilter_18_29_list = l_value;
							if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_regionfilter_18_29_list), 0)) {
								for (var l_for_serverbrowserwarsaw_regionfilter_18_29_key in l_for_serverbrowserwarsaw_regionfilter_18_29_list) {
									if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_regionfilter_18_29_list[l_for_serverbrowserwarsaw_regionfilter_18_29_key])) {
										continue;
									}
									var l_c = l_for_serverbrowserwarsaw_regionfilter_18_29_list[l_for_serverbrowserwarsaw_regionfilter_18_29_key];
									if (S.Modifier.contains(o.countryFilters, l_c)) {
										l_iter = S.compat.add(l_iter, 1);
									}
								}
							}
							if (S.Modifier.contains(o.regionFilters, l_region.id)) {
								l_iter = S.Modifier.count(l_value);
							}
							c.push("\n <span class=\"numcountries\" style=\"color: #898989;\">");
							if (S.compat.gt(l_iter, 0)) {
								c.push("(");
								c.push(Surface.valOut(l_iter));
								c.push(")");
							}
							c.push("</span>\n </div>\n");
						}
					}
				}
			}
		}
		c.push(" <input type=\"hidden\" id=\"filter-regions-input\" name=\"regions\" value=\"");
		c.push(Surface.valOut(S.Modifier.join(o.regionFilters, "|")));
		c.push("\" />\n <div class=\"base-clear\"></div>\n </div>\n <div id=\"serverbrowser-country-serverfilter-popup\">\n <h1 style=\"display:none;\">");
		c.push(Surface.valOut("2.国を選択してください"));
		c.push("</h1>\n <div>\n");
		l_for_serverbrowserwarsaw_regionfilter_39_9_list = o.existingRegions;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_regionfilter_39_9_list), 0)) {
			for (var l_key in l_for_serverbrowserwarsaw_regionfilter_39_9_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_regionfilter_39_9_list[l_key])) {
					continue;
				}
				var l_value = l_for_serverbrowserwarsaw_regionfilter_39_9_list[l_key];
				l_for_serverbrowserwarsaw_regionfilter_40_13_list = l_regions;
				if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_regionfilter_40_13_list), 0)) {
					for (var l_for_serverbrowserwarsaw_regionfilter_40_13_key in l_for_serverbrowserwarsaw_regionfilter_40_13_list) {
						if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_regionfilter_40_13_list[l_for_serverbrowserwarsaw_regionfilter_40_13_key])) {
							continue;
						}
						var l_region = l_for_serverbrowserwarsaw_regionfilter_40_13_list[l_for_serverbrowserwarsaw_regionfilter_40_13_key];
						if (S.compat.eq(S.Modifier.toint(l_key), S.Modifier.toint(l_region.id))) {
							c.push(" <div id=\"serverbrowser-region-countries-");
							c.push(Surface.valOut(l_region.id));
							c.push("\" class=\"serverbrowser-region-countries\" data-region=\"");
							c.push(Surface.valOut(l_region.id));
							c.push("\">\n <div class=\"serverbrowser-regionfilter-selectable-selectall ");
							if (S.Modifier.contains(o.regionFilters, S.Modifier.get(l_region, "value"))) {
								c.push("serverbrowser-include");
							}
							else {
								c.push("serverbrowser-exclude");
							}
							c.push("\" filter=\"regions\" value=\"");
							c.push(Surface.valOut(S.Modifier.get(l_region, "value")));
							c.push("\" >\n <div class=\"ticbox\"></div>\n");
							l_lang_country_key = S.Modifier.get(l_region, "label");
							c.push(" <span fullname=\"");
							c.push(Surface.valOut((S.translations[l_lang_country_key] || l_lang_country_key)));
							c.push("\">\n ");
							c.push(Surface.valOut("全てを選択"));
							c.push("\n </span>\n <div class=\"base-clear\"></div>\n </div>\n");
							l_for_serverbrowserwarsaw_regionfilter_53_25_list = l_value;
							l_for_serverbrowserwarsaw_regionfilter_53_25_iteration = 0;
							if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_regionfilter_53_25_list), 0)) {
								for (var l_for_serverbrowserwarsaw_regionfilter_53_25_key in l_for_serverbrowserwarsaw_regionfilter_53_25_list) {
									if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_regionfilter_53_25_list[l_for_serverbrowserwarsaw_regionfilter_53_25_key])) {
										continue;
									}
									var l_c = l_for_serverbrowserwarsaw_regionfilter_53_25_list[l_for_serverbrowserwarsaw_regionfilter_53_25_key];
									l_for_serverbrowserwarsaw_regionfilter_53_25_iteration = S.compat.add(l_for_serverbrowserwarsaw_regionfilter_53_25_iteration, 1);
									l_for_serverbrowserwarsaw_regionfilter_53_25_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_regionfilter_53_25_iteration, 2), 0);
									l_for_serverbrowserwarsaw_regionfilter_53_25_isOdd = !(l_for_serverbrowserwarsaw_regionfilter_53_25_isEven);
									l_column = "";
									if ((S.compat.gt(S.Modifier.count(l_value), 10) && l_for_serverbrowserwarsaw_regionfilter_53_25_isEven)) {
										l_column = "even-column";
									}
									else if ((S.compat.gt(S.Modifier.count(l_value), 10) && l_for_serverbrowserwarsaw_regionfilter_53_25_isOdd)) {
										l_column = "odd-column";
									}
									l_for_serverbrowserwarsaw_regionfilter_60_29_list = S.Modifier.countrycodes("", $S.callFunction("common.getCountryNameLookup", b, kwargs));
									if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_regionfilter_60_29_list), 0)) {
										for (var l_for_serverbrowserwarsaw_regionfilter_60_29_key in l_for_serverbrowserwarsaw_regionfilter_60_29_list) {
											if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_regionfilter_60_29_list[l_for_serverbrowserwarsaw_regionfilter_60_29_key])) {
												continue;
											}
											var l_countryCode = l_for_serverbrowserwarsaw_regionfilter_60_29_list[l_for_serverbrowserwarsaw_regionfilter_60_29_key];
											if (S.compat.eq(S.Modifier.lower(l_c), S.Modifier.lower(l_countryCode))) {
												c.push(" <div class=\"serverbrowser-regionfilter-selectable ");
												if ((typeof(l_column) != "undefined" && l_column !== null)) {
													c.push(Surface.valOut(l_column));
												}
												c.push(" ");
												if ((S.Modifier.contains(o.countryFilters, S.Modifier.lower(l_countryCode)) || S.Modifier.contains(o.regionFilters, S.Modifier.get(l_region, "key")))) {
													c.push("serverbrowser-include");
												}
												else {
													c.push("serverbrowser-exclude");
												}
												c.push("\" filter=\"countries\" value=\"");
												c.push(Surface.valOut(S.Modifier.lower(l_countryCode)));
												c.push("\" >\n <div class=\"ticbox\"></div>\n");
												l_lang_country = $S.callFunction("common.countryName", l_countryCode, b, kwargs);
												c.push(" <span>\n <img style=\"padding-right: 5px; padding-left: 5px; padding-top:5px;\"\n src=\"");
												c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.concat(S.Modifier.concat("/public/common/flags/", S.Modifier.lower(l_countryCode)), ".gif"), b, kwargs)));
												c.push("\"\n alt=\"");
												c.push(Surface.valOut(l_lang_country));
												c.push("\"\n data-tooltip=\"");
												c.push(Surface.valOut(l_lang_country));
												c.push("\" />\n ");
												c.push(Surface.valOut(l_lang_country));
												c.push("\n </span>\n <div class=\"base-clear\"></div>\n </div>\n");
											}
										}
									}
								}
							}
							c.push(" </div>\n");
						}
					}
				}
			}
		}
		c.push(" </div>\n <input id=\"filter-countries-input\" type=\"hidden\" name=\"countries\" value=\"");
		c.push(Surface.valOut(S.Modifier.join(o.countryFilters, "|")));
		c.push("\" />\n </div>\n");
	}
	else {
		c.push(" <div id=\"serverfilter-region-noneavailable\">");
		c.push(Surface.valOut("現在、地域フィルターはご利用いただけません"));
		c.push("</div>\n");
	}
	c.push("\n <div class=\"base-clear\" style=\"padding-bottom: 20px;\"></div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.regionfilter.block_footer = new Surface.Block('serverbrowserwarsaw.regionfilter.block_footer');
serverbrowserwarsaw.regionfilter.block_footer.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" <div class=\"popup-reportabuse-buttons\">\n <div style=\"float:right;\"><input type=\"button\" class=\"base-button-arrow-small-grey region-cancel\" value=\"");
	c.push(Surface.valOut("キャンセル"));
	c.push("\" /></div>\n <input style=\"margin-right:6px;float:right;\" type=\"button\" class='base-button-arrow-small serverbrowser-save-region-filter' value='");
	c.push(Surface.valOut("はい"));
	c.push("' />\n </div>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_reportserverpopup = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('reportserverpopup'));
serverbrowserwarsaw.reportserverpopup.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_reportserverpopup;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.reportserverpopup');
	c.push("\n<ul>\n <li><a class=\"base-no-ajax\" onclick=\"serverbrowserwarsaw.reportServer('");
	c.push(Surface.valOut(o.guid));
	c.push("', 2);\" data-title=\"");
	c.push(Surface.valOut("ブースト/フラッグランを報告"));
	c.push("\" href=\"#\">");
	c.push(Surface.valOut("ブースト/フラッグランを報告"));
	c.push("</a></li>\n <li><a class=\"base-no-ajax\" onclick=\"serverbrowserwarsaw.reportServer('");
	c.push(Surface.valOut(o.guid));
	c.push("', 3);\" data-title=\"");
	c.push(Surface.valOut("内容について報告"));
	c.push("\" href=\"#\">");
	c.push(Surface.valOut("内容について報告"));
	c.push("</a></li>\n</ul>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_scoreboard = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('scoreboard'));
serverbrowserwarsaw.scoreboard.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_scoreboard;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.scoreboard');
	var l_squadLetters;
	var l_faction;
	c.push("\n");
	l_squadLetters = {0: "", 1: "A", 2: "B", 3: "C", 4: "D", 5: "E", 6: "F", 7: "G", 8: "H", 9: "I", 10: "J", 11: "K", 12: "L", 13: "M", 14: "N", 15: "O", 16: "P", 17: "Q", 18: "R", 19: "S", 20: "T", 21: "U", 22: "V", 23: "W", 24: "X", 25: "Y", 26: "Z", 27: "1", 28: "2", 29: "3", 30: "4", 31: "5", 32: "6", 33: "7", 34: "8", 35: "9", 36: "0"};
	c.push("\n");
	l_faction = {1: "US", 2: "RU"};
	c.push("\n");
	c.push(serverbrowserwarsaw.scoreboard.surface_27_1.render({"faction": ((typeof(l_faction) != "undefined" && l_faction !== null) ? l_faction : null), "gameModes": {"CONQUEST": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.CONQUEST) != "undefined" && o.gameModes.CONQUEST !== null) ? o.gameModes.CONQUEST : null), "CONQUESTASSAULTLARGE": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.CONQUESTASSAULTLARGE) != "undefined" && o.gameModes.CONQUESTASSAULTLARGE !== null) ? o.gameModes.CONQUESTASSAULTLARGE : null), "CONQUESTASSAULTSMALL": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.CONQUESTASSAULTSMALL) != "undefined" && o.gameModes.CONQUESTASSAULTSMALL !== null) ? o.gameModes.CONQUESTASSAULTSMALL : null), "CONQUESTLARGE": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.CONQUESTLARGE) != "undefined" && o.gameModes.CONQUESTLARGE !== null) ? o.gameModes.CONQUESTLARGE : null), "DOMINATION": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.DOMINATION) != "undefined" && o.gameModes.DOMINATION !== null) ? o.gameModes.DOMINATION : null), "GUNMASTER": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.GUNMASTER) != "undefined" && o.gameModes.GUNMASTER !== null) ? o.gameModes.GUNMASTER : null), "RUSH": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.RUSH) != "undefined" && o.gameModes.RUSH !== null) ? o.gameModes.RUSH : null), "SQDM": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.SQDM) != "undefined" && o.gameModes.SQDM !== null) ? o.gameModes.SQDM : null), "SQRUSH": ((typeof(o) != "undefined" && o !== null && typeof(o.gameModes) != "undefined" && o.gameModes !== null && typeof(o.gameModes.SQRUSH) != "undefined" && o.gameModes.SQRUSH !== null) ? o.gameModes.SQRUSH : null)}, "gameReport": ((typeof(o) != "undefined" && o !== null && typeof(o.gameReport) != "undefined" && o.gameReport !== null) ? o.gameReport : null), "liveupdating": ((typeof(o) != "undefined" && o !== null && typeof(o.liveupdating) != "undefined" && o.liveupdating !== null) ? o.liveupdating : null), "scoreboard": ((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) ? o.scoreboard : null), "server": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : null), "showplayers": ((typeof(o) != "undefined" && o !== null && typeof(o.showplayers) != "undefined" && o.showplayers !== null) ? o.showplayers : null), "squadLetters": ((typeof(l_squadLetters) != "undefined" && l_squadLetters !== null) ? l_squadLetters : null)}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.scoreboard.surface_27_1 = new Surface.SingleSurface("serverbrowserwarsaw.scoreboard.surface_27_1");
serverbrowserwarsaw.scoreboard.surface_27_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_scoreboard;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.scoreboard');
	c.push("<surf:container id=\"serverbrowser-scoreboard\"");
	c.push(">");
	var l_soldierSlots;
	var l_for_serverbrowserwarsaw_scoreboard_45_17_list;
	var l_locatkey;
	var l_for_serverbrowserwarsaw_scoreboard_116_29_iteration;
	var l_for_serverbrowserwarsaw_scoreboard_53_13_iteration;
	var l_for_serverbrowserwarsaw_scoreboard_44_13_list;
	var l_for_serverbrowserwarsaw_scoreboard_81_41_list;
	var l_for_serverbrowserwarsaw_scoreboard_116_29_list;
	var l_level_progress;
	var l_for_serverbrowserwarsaw_scoreboard_81_41_iteration;
	var l_for_serverbrowserwarsaw_scoreboard_53_13_isEven;
	var l_sort_column;
	var l_for_serverbrowserwarsaw_scoreboard_53_13_list;
	if ((S.compat.gt(S.Modifier.count(o.scoreboard), 0) && S.compat.eq(S.Modifier.get(o.scoreboard, "status"), "OK"))) {
		c.push(" <div id=\"live-header\">\n <h2>");
		c.push(Surface.valOut("スコアボード"));
		c.push("</h2>\n <div id=\"live-selector\">\n <p>");
		c.push(Surface.valOut("ライブアップデート"));
		c.push("</p>\n <ul class=\"common-selector\">\n <li id=\"live-selector-on\"");
		if (o.liveupdating) {
			c.push(" class=\"selected\"");
		}
		c.push("><div>On</div></li>\n <li id=\"live-selector-off\"");
		if (!(o.liveupdating)) {
			c.push(" class=\"selected\"");
		}
		c.push("><div>Off</div></li>\n </ul>\n </div>\n </div>\n");
		if (S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.GUNMASTER)) {
			c.push("\n");
			l_level_progress = [];
			l_for_serverbrowserwarsaw_scoreboard_44_13_list = S.Modifier.get(o.scoreboard.result, "teams");
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_scoreboard_44_13_list), 0)) {
				for (var l_for_serverbrowserwarsaw_scoreboard_44_13_key in l_for_serverbrowserwarsaw_scoreboard_44_13_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_scoreboard_44_13_list[l_for_serverbrowserwarsaw_scoreboard_44_13_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_scoreboard_44_13_list[l_for_serverbrowserwarsaw_scoreboard_44_13_key];
					l_for_serverbrowserwarsaw_scoreboard_45_17_list = S.Modifier.multisort(S.Modifier.get(l_team, "players"), "gunMasterLevel", "desc");
					if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_scoreboard_45_17_list), 0)) {
						for (var l_for_serverbrowserwarsaw_scoreboard_45_17_key in l_for_serverbrowserwarsaw_scoreboard_45_17_list) {
							if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_scoreboard_45_17_list[l_for_serverbrowserwarsaw_scoreboard_45_17_key])) {
								continue;
							}
							var l_player = l_for_serverbrowserwarsaw_scoreboard_45_17_list[l_for_serverbrowserwarsaw_scoreboard_45_17_key];
							l_level_progress = S.Modifier.set(l_level_progress, l_player.gunMasterLevel, S.Modifier.append(S.Modifier.get(l_level_progress, l_player.gunMasterLevel, []), {"personaId": l_player.personaId, "personaName": l_player.name}));
						}
					}
				}
			}
			c.push(" ");
			c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "gunmasterprogress")), {"level_progress": l_level_progress}, null, kwargs));
			c.push("\n");
		}
		c.push("\n");
		c.push(" <ul class=\"teams-list\">\n");
		l_for_serverbrowserwarsaw_scoreboard_53_13_list = S.Modifier.get(o.scoreboard.result, "teams");
		l_for_serverbrowserwarsaw_scoreboard_53_13_iteration = 0;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_scoreboard_53_13_list), 0)) {
			for (var l_for_serverbrowserwarsaw_scoreboard_53_13_key in l_for_serverbrowserwarsaw_scoreboard_53_13_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_scoreboard_53_13_list[l_for_serverbrowserwarsaw_scoreboard_53_13_key])) {
					continue;
				}
				var l_team = l_for_serverbrowserwarsaw_scoreboard_53_13_list[l_for_serverbrowserwarsaw_scoreboard_53_13_key];
				l_for_serverbrowserwarsaw_scoreboard_53_13_iteration = S.compat.add(l_for_serverbrowserwarsaw_scoreboard_53_13_iteration, 1);
				l_for_serverbrowserwarsaw_scoreboard_53_13_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_scoreboard_53_13_iteration, 2), 0);
				c.push(" <li class=\"team-col");
				if (l_for_serverbrowserwarsaw_scoreboard_53_13_isEven) {
					c.push(" inverted");
				}
				c.push("\">\n <h3>\n");
				if ((S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.RUSH) || S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.SQRUSH))) {
					c.push(" ");
					c.push(Surface.valOut(l_team.status.teamType));
					c.push("\n");
				}
				else if (S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.SQDM)) {
					l_locatkey = "ID_M_CHAT_SQUAD";
					c.push(" ");
					c.push(Surface.valOut((S.translations[l_locatkey] || l_locatkey)));
					c.push(" ");
					c.push(Surface.valOut(S.Modifier.get(o.squadLetters, l_team.status.teamId, "")));
					c.push("\n");
				}
				else if (((((S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.CONQUEST) || S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.CONQUESTLARGE)) || S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.CONQUESTASSAULTLARGE)) || S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.CONQUESTASSAULTSMALL)) || (S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.DOMINATION) || S.compat.eq(o.scoreboard.result.gameMode, 131072)))) {
					c.push("\n");
					if ((typeof(l_team) != "undefined" && l_team !== null && typeof(l_team.status) != "undefined" && l_team.status !== null && typeof(l_team.status.faction) != "undefined" && l_team.status.faction !== null)) {
						c.push(" ");
						c.push(Surface.valOut(S.Modifier.get(o.faction, l_team.status.faction)));
						c.push("\n");
					}
					else {
						c.push(" ");
						c.push(Surface.valOut("チーム"));
						c.push(" ");
						c.push(Surface.valOut(l_team.status.teamId));
						c.push("\n");
					}
				}
				else {
					c.push(" ");
					c.push(Surface.valOut("チーム"));
					c.push(" ");
					c.push(Surface.valOut(S.Modifier.get(o.squadLetters, l_team.status.teamId, "")));
					c.push("\n");
				}
				c.push("\n");
				if (S.compat.neq(o.scoreboard.result.gameMode, o.gameModes.GUNMASTER)) {
					c.push(" <span>\n");
					if (((S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.RUSH) || S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.SQRUSH)) && S.compat.eq(S.Modifier.upper(l_team.status.teamType), "DEFENDERS"))) {
						c.push(" <ul class=\"rush-mcoms\">\n");
						l_for_serverbrowserwarsaw_scoreboard_81_41_list = S.Modifier.range(1, S.compat.sub(l_team.status.ticketsMax, 1));
						l_for_serverbrowserwarsaw_scoreboard_81_41_iteration = 0;
						if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_scoreboard_81_41_list), 0)) {
							for (var l_for_serverbrowserwarsaw_scoreboard_81_41_key in l_for_serverbrowserwarsaw_scoreboard_81_41_list) {
								if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_scoreboard_81_41_list[l_for_serverbrowserwarsaw_scoreboard_81_41_key])) {
									continue;
								}
								var l_i = l_for_serverbrowserwarsaw_scoreboard_81_41_list[l_for_serverbrowserwarsaw_scoreboard_81_41_key];
								l_for_serverbrowserwarsaw_scoreboard_81_41_iteration = S.compat.add(l_for_serverbrowserwarsaw_scoreboard_81_41_iteration, 1);
								c.push(" <li");
								if (S.compat.gt(l_i, S.compat.sub(l_team.status.ticketsMax, l_team.status.tickets))) {
									c.push(" class=\"active\"");
								}
								c.push(">Objective ");
								c.push(Surface.valOut(l_for_serverbrowserwarsaw_scoreboard_81_41_iteration));
								c.push("</li>\n ");
							}
						}
						c.push("\n </ul>\n");
					}
					else {
						c.push(" <div class=\"tickets-max\">");
						c.push(Surface.valOut(l_team.status.ticketsMax));
						c.push("</div>\n ");
						c.push(Surface.importTemplate(("common" + ("." + "percentbar")), {"width": "100px", "value": l_team.status.tickets, "max": l_team.status.ticketsMax}, null, kwargs));
						c.push("\n");
						c.push(Surface.valOut(l_team.status.tickets));
						c.push("\n");
					}
					c.push(" </span>\n ");
				}
				c.push("\n </h3>\n <table class=\"common-table players-score-table\" cellpadding=\"0\">\n <thead>\n <tr>\n <th class=\"player-position\">#</th>\n");
				if ((S.compat.neq(o.scoreboard.result.gameMode, o.gameModes.SQRUSH) && S.compat.neq(o.scoreboard.result.gameMode, o.gameModes.SQDM))) {
					c.push(" <th class=\"player-squad\">");
					c.push(Surface.valOut("Sq"));
					c.push("</th>\n");
				}
				c.push(" <th class=\"player-name align-left\">");
				c.push(Surface.valOut("兵士名"));
				c.push("</th>\n");
				if (S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.GUNMASTER)) {
					c.push(" <th class=\"player-level\">");
					c.push(Surface.valOut("レベル"));
					c.push("</th>\n");
				}
				c.push(" <th class=\"player-kills\">");
				c.push(Surface.valOut("K"));
				c.push("</th>\n <th class=\"player-deaths\">");
				c.push(Surface.valOut("D"));
				c.push("</th>\n <th class=\"player-score last\">");
				c.push(Surface.valOut("スコア"));
				c.push("</th>\n </tr>\n </thead>\n <tbody>\n");
				if (S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.GUNMASTER)) {
					l_sort_column = "gunMasterLevel";
				}
				else {
					l_sort_column = "score";
				}
				c.push("\n");
				l_for_serverbrowserwarsaw_scoreboard_116_29_list = S.Modifier.multisort(S.Modifier.get(l_team, "players"), l_sort_column, "desc");
				l_for_serverbrowserwarsaw_scoreboard_116_29_iteration = 0;
				if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_scoreboard_116_29_list), 0)) {
					for (var l_for_serverbrowserwarsaw_scoreboard_116_29_key in l_for_serverbrowserwarsaw_scoreboard_116_29_list) {
						if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_scoreboard_116_29_list[l_for_serverbrowserwarsaw_scoreboard_116_29_key])) {
							continue;
						}
						var l_player = l_for_serverbrowserwarsaw_scoreboard_116_29_list[l_for_serverbrowserwarsaw_scoreboard_116_29_key];
						l_for_serverbrowserwarsaw_scoreboard_116_29_iteration = S.compat.add(l_for_serverbrowserwarsaw_scoreboard_116_29_iteration, 1);
						c.push(" <tr id=\"p-");
						c.push(Surface.valOut(l_player.personaId));
						c.push("\" class=\"squad-");
						c.push(Surface.valOut(l_team.status.teamId));
						c.push("-");
						c.push(Surface.valOut(S.Modifier.get(l_player, "squad", 0)));
						c.push("\" data-personaId=\"");
						c.push(Surface.valOut(l_player.personaId));
						c.push("\">\n <td>");
						c.push(Surface.valOut(l_for_serverbrowserwarsaw_scoreboard_116_29_iteration));
						c.push("</td>\n");
						if ((S.compat.neq(o.scoreboard.result.gameMode, o.gameModes.SQRUSH) && S.compat.neq(o.scoreboard.result.gameMode, o.gameModes.SQDM))) {
							c.push(" <td>\n");
							if (S.compat.neq(((typeof(l_player) != "undefined" && l_player !== null && typeof(l_player.squad) != "undefined" && l_player.squad !== null) ? l_player.squad : 0), 0)) {
								c.push(" <div class=\"squad-box\">");
								c.push(Surface.valOut(S.Modifier.get(o.squadLetters, S.Modifier.get(l_player, "squad", 0), "")));
								c.push("</div>\n");
							}
							c.push(" </td>\n");
						}
						c.push(" <td class=\"player-name align-left\">\n ");
						c.push(Surface.importTemplate(("profile" + ("." + "showrank")), {"rank": S.Modifier.get(l_player, "rank", "0"), "rank_game": S.Modifier.get(o.gameReport, "game", 2), "rank_size": "tiny", "tag_class": "player-rank"}, null, kwargs));
						c.push("\n <p>\n <a href=\"");
						c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/soldier/{personaName}/stats/{personaId}/{platform}/", Surface.urlContext, $S.callFunction("profile.personaStatsUrl", l_player, S.Modifier.get(l_player, "game", 0), S.Modifier.get(l_player, "namespace", "missing1"), b, kwargs))));
						c.push("\">\n");
						if (S.compat.gt(S.Modifier.count(S.Modifier.get(l_player, "tag")), 0)) {
							c.push(" [");
							c.push(Surface.valOut(l_player.tag));
							c.push("]\n");
						}
						c.push(" ");
						c.push(Surface.valOut(S.Modifier.get(l_player, "name", "不明なプレイヤー")));
						c.push("\n </a>\n </p>\n </td>\n");
						if (S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.GUNMASTER)) {
							c.push(" <td>");
							c.push(Surface.valOut(l_player.gunMasterLevel));
							c.push("</td>\n");
						}
						c.push(" <td>");
						c.push(Surface.valOut(l_player.kills));
						c.push("</td>\n <td>");
						c.push(Surface.valOut(l_player.deaths));
						c.push("</td>\n <td>");
						c.push(Surface.valOut(l_player.score));
						c.push("</td>\n </tr>\n");
					}
				}
				c.push(" </tbody>\n </table>\n </li>\n ");
			}
		}
		c.push("\n </ul>\n");
	}
	else if (S.compat.gt(S.Modifier.count(o.showplayers), 0)) {
		c.push(" <div class=\"serverinfo-players-all\">\n");
		if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null)) {
			l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
			c.push(" <h2>");
			c.push(Surface.valOut(l_soldierSlots.current));
			c.push(" ");
			c.push(Surface.valOut(S.Modifier.pluralize(l_soldierSlots.current, "プレイヤー", "合計プレイヤー数")));
			c.push("</h2>\n");
			if (S.compat.gt(l_soldierSlots.current, 0)) {
				c.push(" <div id=\"serverinfo-players-all-wrapper\"></div>\n <div id=\"serverinfo-players-all-view\" class=\"base-link\" data-numPlayers=\"");
				c.push(Surface.valOut(l_soldierSlots.current));
				c.push("\" data=\"");
				c.push(Surface.valOut(o.server.guid));
				c.push("\">");
				c.push(Surface.valOut("表示"));
				c.push(" ");
				c.push(Surface.valOut(S.Modifier.pluralize(l_soldierSlots.current, "プレイヤー", "全プレイヤー")));
				c.push("</div>\n <div id=\"serverinfo-players-all-hide\" class=\"base-link\">");
				c.push(Surface.valOut("非表示"));
				c.push(" ");
				c.push(Surface.valOut(S.Modifier.pluralize(l_soldierSlots.current, "プレイヤー", "全プレイヤー")));
				c.push("</div>\n");
			}
		}
		c.push(" </div>\n");
	}
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.scoreboard", "surface_27_1", "serverbrowser-scoreboard", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_serverinfoscore = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('serverinfoscore'));
serverbrowserwarsaw.serverinfoscore.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serverinfoscore;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serverinfoscore');
	var l_gameModes;
	var l_squadLetters;
	c.push("\n");
	l_squadLetters = {0: "", 1: "A", 2: "B", 3: "C", 4: "D", 5: "E", 6: "F", 7: "G", 8: "H", 9: "I", 10: "J", 11: "K", 12: "L", 13: "M", 14: "N", 15: "O", 16: "P", 17: "Q", 18: "R", 19: "S", 20: "T", 21: "U", 22: "V", 23: "W", 24: "X", 25: "Y", 26: "Z", 27: "1", 28: "2", 29: "3", 30: "4", 31: "5", 32: "6", 33: "7", 34: "8", 35: "9", 36: "0"};
	c.push("\n");
	l_gameModes = Surface.globalContext.staticContext.gameServerMapModes;
	c.push("\n");
	c.push(serverbrowserwarsaw.serverinfoscore.surface_12_1.render({"errormessage": ((typeof(o) != "undefined" && o !== null && typeof(o.errormessage) != "undefined" && o.errormessage !== null) ? o.errormessage : null), "gameModes": {"CARRIERASSAULT": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.CARRIERASSAULT) != "undefined" && l_gameModes.CARRIERASSAULT !== null) ? l_gameModes.CARRIERASSAULT : null), "CARRIERASSAULTLARGE": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.CARRIERASSAULTLARGE) != "undefined" && l_gameModes.CARRIERASSAULTLARGE !== null) ? l_gameModes.CARRIERASSAULTLARGE : null), "CARRIERASSAULTSMALL": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.CARRIERASSAULTSMALL) != "undefined" && l_gameModes.CARRIERASSAULTSMALL !== null) ? l_gameModes.CARRIERASSAULTSMALL : null), "CONQUESTASSAULTLARGE": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.CONQUESTASSAULTLARGE) != "undefined" && l_gameModes.CONQUESTASSAULTLARGE !== null) ? l_gameModes.CONQUESTASSAULTLARGE : null), "CONQUESTASSAULTSMALL": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.CONQUESTASSAULTSMALL) != "undefined" && l_gameModes.CONQUESTASSAULTSMALL !== null) ? l_gameModes.CONQUESTASSAULTSMALL : null), "CONQUESTLARGE": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.CONQUESTLARGE) != "undefined" && l_gameModes.CONQUESTLARGE !== null) ? l_gameModes.CONQUESTLARGE : null), "DOMINATION": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.DOMINATION) != "undefined" && l_gameModes.DOMINATION !== null) ? l_gameModes.DOMINATION : null), "GUNMASTER": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.GUNMASTER) != "undefined" && l_gameModes.GUNMASTER !== null) ? l_gameModes.GUNMASTER : null), "NONE": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.NONE) != "undefined" && l_gameModes.NONE !== null) ? l_gameModes.NONE : null), "RUSH": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.RUSH) != "undefined" && l_gameModes.RUSH !== null) ? l_gameModes.RUSH : null), "SCAVENGER": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.SCAVENGER) != "undefined" && l_gameModes.SCAVENGER !== null) ? l_gameModes.SCAVENGER : null), "SQRUSH": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.SQRUSH) != "undefined" && l_gameModes.SQRUSH !== null) ? l_gameModes.SQRUSH : null), "SQUADDEATHMATCH": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.SQUADDEATHMATCH) != "undefined" && l_gameModes.SQUADDEATHMATCH !== null) ? l_gameModes.SQUADDEATHMATCH : null), "TANKSUPERIORITY": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.TANKSUPERIORITY) != "undefined" && l_gameModes.TANKSUPERIORITY !== null) ? l_gameModes.TANKSUPERIORITY : null), "TEAMDEATHMATCH": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.TEAMDEATHMATCH) != "undefined" && l_gameModes.TEAMDEATHMATCH !== null) ? l_gameModes.TEAMDEATHMATCH : null), "TEAMDEATHMATCHC": ((typeof(l_gameModes) != "undefined" && l_gameModes !== null && typeof(l_gameModes.TEAMDEATHMATCHC) != "undefined" && l_gameModes.TEAMDEATHMATCHC !== null) ? l_gameModes.TEAMDEATHMATCHC : null)}, "scoreboard": ((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) ? o.scoreboard : null), "squadLetters": ((typeof(l_squadLetters) != "undefined" && l_squadLetters !== null) ? l_squadLetters : null)}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.serverinfoscore.surface_12_1 = new Surface.SingleSurface("serverbrowserwarsaw.serverinfoscore.surface_12_1");
serverbrowserwarsaw.serverinfoscore.surface_12_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serverinfoscore;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serverinfoscore');
	c.push("<surf:container id=\"selected-server-scoreboard\"");
	c.push(">");
	var l_for_serverbrowserwarsaw_serverinfoscore_88_25_list;
	var l_team_status;
	var l_number_of_players;
	var l_for_serverbrowserwarsaw_serverinfoscore_53_33_iteration;
	var l_level_progress;
	var l_for_serverbrowserwarsaw_serverinfoscore_87_21_list;
	var l_locatkey;
	var l_for_serverbrowserwarsaw_serverinfoscore_53_33_list;
	var l_for_serverbrowserwarsaw_serverinfoscore_72_25_list;
	var l_for_serverbrowserwarsaw_serverinfoscore_94_25_list;
	var l_gameMode;
	c.push(" <div class=\"base-box-push\">\n <div id=\"serverinfo-scoreboard\" class=\"base-box-push-inner clearfix\">\n <h2>");
	c.push(Surface.valOut("スコアボード"));
	c.push("</h2>\n");
	if ((S.compat.gt(S.Modifier.count(o.scoreboard), 0) && S.compat.eq(S.Modifier.get(o.scoreboard, "status"), "OK"))) {
		l_gameMode = o.scoreboard.result.gameMode;
		if (((((((((S.compat.eq(l_gameMode, o.gameModes.NONE) || S.compat.eq(l_gameMode, o.gameModes.TEAMDEATHMATCH)) || S.compat.eq(l_gameMode, o.gameModes.CONQUESTLARGE)) || S.compat.eq(l_gameMode, o.gameModes.CONQUESTASSAULTLARGE)) || S.compat.eq(l_gameMode, o.gameModes.CONQUESTASSAULTSMALL)) || S.compat.eq(l_gameMode, o.gameModes.DOMINATION)) || S.compat.eq(l_gameMode, o.gameModes.TEAMDEATHMATCHC)) || S.compat.eq(l_gameMode, o.gameModes.TANKSUPERIORITY)) || S.compat.eq(l_gameMode, o.gameModes.SCAVENGER))) {
			c.push("\n <ul class=\"conquest\">\n <li class=\"team1\">\n");
			l_team_status = S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 0), "status");
			c.push(" <h4>");
			c.push(Surface.valOut("US"));
			c.push("</h4>\n <div class=\"current-score\">\n <p>");
			c.push(Surface.valOut(S.Modifier.get(l_team_status, "tickets")));
			c.push("<span>");
			c.push(Surface.valOut(S.Modifier.get(l_team_status, "ticketsMax")));
			c.push("</span></p>\n ");
			c.push(Surface.importTemplate(("common" + ("." + "percentbar")), {"width": "62px", "value": S.Modifier.get(l_team_status, "tickets"), "max": S.Modifier.get(l_team_status, "ticketsMax")}, null, kwargs));
			c.push("\n </div>\n </li>\n <li class=\"team2\">\n");
			l_team_status = S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 1), "status");
			c.push(" <h4>");
			c.push(Surface.valOut("RU"));
			c.push("</h4>\n <div class=\"current-score\">\n <p>");
			c.push(Surface.valOut(S.Modifier.get(l_team_status, "tickets")));
			c.push("<span>");
			c.push(Surface.valOut(S.Modifier.get(l_team_status, "ticketsMax")));
			c.push("</span></p>\n ");
			c.push(Surface.importTemplate(("common" + ("." + "percentbar")), {"width": "62px", "value": S.Modifier.get(l_team_status, "tickets"), "max": S.Modifier.get(l_team_status, "ticketsMax")}, null, kwargs));
			c.push("\n </div>\n </li>\n </ul>\n");
		}
		else if ((S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.RUSH) || S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.SQRUSH))) {
			c.push(" <ul class=\"rush\">\n <li class=\"team2\">\n <h4>");
			c.push(Surface.valOut("守備側"));
			c.push("</h4>\n <ol class=\"objectives\">\n");
			l_for_serverbrowserwarsaw_serverinfoscore_53_33_list = S.Modifier.range(1, S.compat.sub(S.Modifier.get(S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 1), "status"), "ticketsMax"), 1));
			l_for_serverbrowserwarsaw_serverinfoscore_53_33_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverinfoscore_53_33_list), 0)) {
				for (var l_for_serverbrowserwarsaw_serverinfoscore_53_33_key in l_for_serverbrowserwarsaw_serverinfoscore_53_33_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverinfoscore_53_33_list[l_for_serverbrowserwarsaw_serverinfoscore_53_33_key])) {
						continue;
					}
					var l_i = l_for_serverbrowserwarsaw_serverinfoscore_53_33_list[l_for_serverbrowserwarsaw_serverinfoscore_53_33_key];
					l_for_serverbrowserwarsaw_serverinfoscore_53_33_iteration = S.compat.add(l_for_serverbrowserwarsaw_serverinfoscore_53_33_iteration, 1);
					c.push(" <li class=\"");
					if (S.compat.gt(l_i, S.compat.sub(S.Modifier.get(S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 1), "status"), "ticketsMax"), S.Modifier.get(S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 1), "status"), "tickets")))) {
						c.push("active");
					}
					else {
						c.push("destroyed");
					}
					c.push("\">\n Objective ");
					c.push(Surface.valOut(l_for_serverbrowserwarsaw_serverinfoscore_53_33_iteration));
					c.push("</li>\n");
				}
			}
			c.push(" </ol>\n </li>\n <li class=\"team1\">\n <h4>");
			c.push(Surface.valOut("攻撃側"));
			c.push("</h4>\n <div class=\"current-score\">\n");
			l_team_status = S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 0), "status");
			c.push(" <p>");
			c.push(Surface.valOut(S.Modifier.get(l_team_status, "tickets")));
			c.push("<span>");
			c.push(Surface.valOut(S.Modifier.get(l_team_status, "ticketsMax")));
			c.push("</span></p>\n ");
			c.push(Surface.importTemplate(("common" + ("." + "percentbar")), {"width": "135px", "value": S.Modifier.get(l_team_status, "tickets"), "max": S.Modifier.get(l_team_status, "ticketsMax")}, null, kwargs));
			c.push("\n </div>\n </li>\n </ul>\n");
		}
		else if (S.compat.eq(o.scoreboard.result.gameMode, o.gameModes.SQUADDEATHMATCH)) {
			l_locatkey = "ID_M_CHAT_SQUAD";
			c.push(" <ul class=\"sqdm\">\n");
			l_for_serverbrowserwarsaw_serverinfoscore_72_25_list = S.Modifier.get(o.scoreboard.result, "teams");
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverinfoscore_72_25_list), 0)) {
				for (var l_for_serverbrowserwarsaw_serverinfoscore_72_25_key in l_for_serverbrowserwarsaw_serverinfoscore_72_25_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverinfoscore_72_25_list[l_for_serverbrowserwarsaw_serverinfoscore_72_25_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_serverinfoscore_72_25_list[l_for_serverbrowserwarsaw_serverinfoscore_72_25_key];
					c.push(" <li>\n <h4>");
					c.push(Surface.valOut((S.translations[l_locatkey] || l_locatkey)));
					c.push(" ");
					c.push(Surface.valOut(S.Modifier.get(o.squadLetters, l_team.status.teamId, "")));
					c.push("</h4>\n <div class=\"current-score\">\n <p>");
					c.push(Surface.valOut(l_team.status.tickets));
					c.push("</p>\n ");
					c.push(Surface.importTemplate(("common" + ("." + "percentbar")), {"width": "140px", "value": l_team.status.tickets, "max": l_team.status.ticketsMax}, null, kwargs));
					c.push("\n </div>\n </li>\n");
				}
			}
			c.push(" </ul>\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameModes.GUNMASTER)) {
			l_level_progress = [];
			c.push("\n");
			l_for_serverbrowserwarsaw_serverinfoscore_87_21_list = S.Modifier.get(o.scoreboard.result, "teams");
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverinfoscore_87_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_serverinfoscore_87_21_key in l_for_serverbrowserwarsaw_serverinfoscore_87_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverinfoscore_87_21_list[l_for_serverbrowserwarsaw_serverinfoscore_87_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_serverinfoscore_87_21_list[l_for_serverbrowserwarsaw_serverinfoscore_87_21_key];
					l_for_serverbrowserwarsaw_serverinfoscore_88_25_list = S.Modifier.multisort(S.Modifier.get(l_team, "players"), "gunMasterLevel", "desc");
					if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverinfoscore_88_25_list), 0)) {
						for (var l_for_serverbrowserwarsaw_serverinfoscore_88_25_key in l_for_serverbrowserwarsaw_serverinfoscore_88_25_list) {
							if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverinfoscore_88_25_list[l_for_serverbrowserwarsaw_serverinfoscore_88_25_key])) {
								continue;
							}
							var l_player = l_for_serverbrowserwarsaw_serverinfoscore_88_25_list[l_for_serverbrowserwarsaw_serverinfoscore_88_25_key];
							l_number_of_players = S.Modifier.get(l_level_progress, l_player.gunMasterLevel, 0);
							l_level_progress = S.Modifier.set(l_level_progress, l_player.gunMasterLevel, S.compat.add(l_number_of_players, 1));
						}
					}
				}
			}
			c.push(" <ul class=\"gm\">\n");
			l_for_serverbrowserwarsaw_serverinfoscore_94_25_list = S.Modifier.to(1, 17);
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverinfoscore_94_25_list), 0)) {
				for (var l_for_serverbrowserwarsaw_serverinfoscore_94_25_key in l_for_serverbrowserwarsaw_serverinfoscore_94_25_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverinfoscore_94_25_list[l_for_serverbrowserwarsaw_serverinfoscore_94_25_key])) {
						continue;
					}
					var l_level = l_for_serverbrowserwarsaw_serverinfoscore_94_25_list[l_for_serverbrowserwarsaw_serverinfoscore_94_25_key];
					c.push(" <li");
					if (S.compat.gt(S.Modifier.get(l_level_progress, l_level), 0)) {
						c.push(" class=\"completed\"");
					}
					c.push(">Player</li>\n");
				}
			}
			c.push(" </ul>\n");
		}
		else if (((S.compat.eq(l_gameMode, o.gameModes.CARRIERASSAULT) || S.compat.eq(l_gameMode, o.gameModes.CARRIERASSAULTLARGE)) || S.compat.eq(l_gameMode, o.gameModes.CARRIERASSAULTSMALL))) {
			c.push("\n <ul class=\"conquest\">\n <li class=\"team1\">\n");
			l_team_status = S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 0), "status");
			c.push(" <h4>");
			c.push(Surface.valOut("US"));
			c.push("</h4>\n </li>\n <li class=\"team2\">\n");
			l_team_status = S.Modifier.get(S.Modifier.get(o.scoreboard.result.teams, 1), "status");
			c.push(" <h4>");
			c.push(Surface.valOut("RU"));
			c.push("</h4>\n </li>\n </ul>\n ");
		}
		c.push("\n");
	}
	else if (S.compat.gt(S.Modifier.count(o.errormessage), 0)) {
		c.push(" <p class=\"info\">");
		c.push(Surface.valOut((S.translations[o.errormessage] || o.errormessage)));
		c.push("</p>\n");
	}
	else {
		c.push(" <img id=\"loader-spinner\" src=\"");
		c.push(Surface.valOut($S.callFunction("base.asset", "/public/serverbrowser/invited_loader.gif", b, kwargs)));
		c.push("\" />\n");
	}
	c.push(" </div>\n </div>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.serverinfoscore", "surface_12_1", "selected-server-scoreboard", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_serverlist = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('serverlist'));
serverbrowserwarsaw.serverlist.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serverlist;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serverlist');
	var l_serverbrowserTab;
	c.push("\n");
	l_serverbrowserTab = S.Modifier.get(Surface.globalContext, "serverbrowserTab");
	c.push("\n");
	o.isTouchDevice = Surface.globalContext.staticContext.detectedBrowser.isTouchDevice;
	c.push("\n");
	c.push(serverbrowserwarsaw.serverlist.surface_9_1.render({"isTouchDevice": ((typeof(o) != "undefined" && o !== null && typeof(o.isTouchDevice) != "undefined" && o.isTouchDevice !== null) ? o.isTouchDevice : null), "serverbrowserTab": ((typeof(l_serverbrowserTab) != "undefined" && l_serverbrowserTab !== null) ? l_serverbrowserTab : null), "servers": ((typeof(o) != "undefined" && o !== null && typeof(o.servers) != "undefined" && o.servers !== null) ? o.servers : null)}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.serverlist.surface_9_1 = new Surface.SingleSurface("serverbrowserwarsaw.serverlist.surface_9_1");
serverbrowserwarsaw.serverlist.surface_9_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serverlist;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serverlist');
	c.push("<surf:container id=\"serverbrowser-results\"");
	c.push(">");
	var l_tblClasses;
	c.push("\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.serverbrowserTab) != "undefined" && o.serverbrowserTab !== null) && S.compat.neq(o.serverbrowserTab, "history"))) {
	}
	else {
	}
	c.push("\n");
	l_tblClasses = "table table-hover servers-list loading";
	if (o.isTouchDevice) {
		l_tblClasses = "table table-hover servers-list";
	}
	c.push(" <table class=\"");
	c.push(Surface.valOut(l_tblClasses));
	c.push("\">\n <thead>\n <tr>\n <th class=\"floating-width server-info\" colspan=\"");
	if ((o.isTouchDevice || S.compat.neq(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : 0), 1))) {
		c.push("2");
	}
	else {
		c.push("3");
	}
	c.push("\">\n <span class=\"pull-right\">");
	c.push(Surface.valOut("ソート項目"));
	c.push(" :\n");
	if (S.compat.eq(o.serverbrowserTab, "history")) {
		c.push(" <a href=\"#\" data-sort=\"recentlyPlayed\" class=\"ignored-trigger-el\">");
		c.push(Surface.valOut("最近プレイしたサーバー"));
		c.push("</a>,\n");
	}
	c.push(" <a href=\"#\" data-sort=\"name\" class=\"ignored-trigger-el\">");
	c.push(Surface.valOut("名前"));
	c.push("</a>,\n <a href=\"#\" data-sort=\"mode\" class=\"ignored-trigger-el\">");
	c.push(Surface.valOut("モード"));
	c.push("</a>,\n <a href=\"#\" data-sort=\"map\" class=\"ignored-trigger-el\">");
	c.push(Surface.valOut("マップ"));
	c.push("</a>,\n <a href=\"#\" data-sort=\"friend\" class=\"ignored-trigger-el\">");
	c.push(Surface.valOut("フレンド"));
	c.push("</a>\n </span>\n ");
	c.push(Surface.valOut("サーバー"));
	c.push("\n </th>\n <th class=\"center players\">\n <a href=\"#\" data-sort=\"players\" class=\"ignored-trigger-el\">");
	c.push(Surface.valOut("プレイヤー"));
	c.push("</a>\n </th>\n <th class=\"server-icons\">\n <a href=\"#\" data-sort=\"ranked\" class=\"ignored-trigger-el\"><i class=\"icon ranked on\"></i></a>\n </th>\n <th class=\"center ping\">\n <a href=\"#\" data-sort=\"ping\" class=\"ignored-trigger-el\">");
	c.push(Surface.valOut("PING"));
	c.push("</a>\n </th>\n </tr>\n </thead>\n <tbody>\n </tbody>\n <tfoot>\n <tr>\n <th colspan=\"8\">");
	c.push(Surface.importTemplate(("ui" + ("." + "loader")), {"size": "small"}, null, kwargs));
	c.push("&nbsp;");
	c.push(Surface.valOut("ロード中…"));
	c.push("</th>\n </tr>\n </tfoot>\n </table>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.serverlist", "surface_9_1", "serverbrowser-results", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_serverpagegamemode = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('serverpagegamemode'));
serverbrowserwarsaw.serverpagegamemode.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serverpagegamemode;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serverpagegamemode');
	var l_for_serverbrowserwarsaw_serverpagegamemode_44_17_list;
	var l_currentMapName;
	var l_serverbrowserUrl;
	var l_currentMapInfo;
	c.push("\n<div id=\"server-page-gamemode\" class=\"box box-content \">\n <p>\n");
	l_serverbrowserUrl = S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": S.Modifier.lower($S.callFunction("base.platform", o.server.platform, b, kwargs))});
	c.push("\n");
	if ((S.compat.eq(Surface.globalContext.realm.section, 8192) && S.compat.neq(o.server.platform, 1))) {
		c.push("\n");
	}
	else {
		c.push(" <a href=\"");
		c.push(Surface.valOut(l_serverbrowserUrl));
		c.push("\" class=\"pull-right\">");
		c.push(Surface.valOut("サーバーブラウザーを表示"));
		c.push("</a>\n");
	}
	if (S.compat.eq(Surface.globalContext.realm.section, 8192)) {
		c.push(" <span class=\"gameicon ");
		c.push(Surface.valOut($S.callFunction("common.getGameIconCSSHorizontal", o.server.game, o.server.platform, o.server.gameExpansions, b, kwargs)));
		c.push("\"></span>\n");
	}
	else {
		c.push(" <span class=\"gameicon ");
		c.push(Surface.valOut($S.callFunction("common.getGameIconCSSBrightHorizontal", o.server.game, o.server.platform, o.server.gameExpansions, b, kwargs)));
		c.push(" invert\"></span>\n");
	}
	c.push("\n");
	if ((((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.country) != "undefined" && o.server.country !== null) ? o.server.country : false) && S.compat.eq(o.server.platform, 1))) {
		c.push(" ");
		c.push(Surface.importTemplate(("common" + ("." + "countryflag")), {"countryCode": o.server.country, "extraClass": "flag"}, null, kwargs));
		c.push("\n");
	}
	c.push("\n");
	l_currentMapInfo = $S.callFunction("common.mapinfo", o.server.game, o.server.map, b, kwargs);
	l_currentMapName = S.Modifier.get(l_currentMapInfo, "name");
	c.push(" <strong class=\"uppercase\">\n ");
	c.push(Surface.valOut(l_currentMapName));
	c.push("\n");
	if (S.compat.gt(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.mapVariant) != "undefined" && o.server.mapVariant !== null) ? o.server.mapVariant : 0), 0)) {
		c.push(" #");
		c.push(Surface.valOut(S.compat.add(o.server.mapVariant, 1)));
	}
	c.push("\n </strong>\n <span class=\"bullet\">&bull;</span>\n <strong class=\"uppercase\">\n ");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", o.server.mapMode, o.server.game, b, kwargs)));
	c.push("\n </strong>\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.playlist) != "undefined" && o.server.playlist !== null) ? o.server.playlist : false)) {
		c.push(" <span class=\"bullet\">&bull;</span>\n <strong class=\"uppercase\">\n ");
		c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.playlistStringLocalized", o.server.playlist, b, kwargs)));
		c.push("\n </strong>\n");
	}
	c.push("\n");
	if (S.compat.gt(S.Modifier.count(o.server.gameExpansions), 0)) {
		c.push(" &bull;\n");
		l_for_serverbrowserwarsaw_serverpagegamemode_44_17_list = o.server.gameExpansions;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverpagegamemode_44_17_list), 0)) {
			for (var l_for_serverbrowserwarsaw_serverpagegamemode_44_17_key in l_for_serverbrowserwarsaw_serverpagegamemode_44_17_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverpagegamemode_44_17_list[l_for_serverbrowserwarsaw_serverpagegamemode_44_17_key])) {
					continue;
				}
				var l_gameExpansion = l_for_serverbrowserwarsaw_serverpagegamemode_44_17_list[l_for_serverbrowserwarsaw_serverpagegamemode_44_17_key];
				if (!(S.Modifier.contains([Surface.globalContext.staticContext.gameExpansions.VANILLA], l_gameExpansion))) {
					c.push(" <strong class=\"uppercase\">");
					c.push(Surface.importTemplate(("common" + ("." + "gameExpansionImage")), {"game": o.server.game, "expansion": l_gameExpansion}, null, kwargs));
					c.push("</strong>\n");
				}
				c.push(" ");
			}
		}
		c.push("\n");
	}
	c.push("\n </p>\n </div>");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_serverplayerlist = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('serverplayerlist'));
serverbrowserwarsaw.serverplayerlist.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serverplayerlist;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serverplayerlist');
	var l_for_serverbrowserwarsaw_serverplayerlist_5_5_iteration;
	var l_for_serverbrowserwarsaw_serverplayerlist_23_5_isEven;
	var l_usedSlots;
	var l_for_serverbrowserwarsaw_serverplayerlist_23_5_iteration;
	var l_for_serverbrowserwarsaw_serverplayerlist_5_5_isOdd;
	var l_for_serverbrowserwarsaw_serverplayerlist_5_5_list;
	var l_friendIds;
	var l_for_serverbrowserwarsaw_serverplayerlist_5_5_isEven;
	var l_for_serverbrowserwarsaw_serverplayerlist_23_5_isOdd;
	var l_for_serverbrowserwarsaw_serverplayerlist_23_5_list;
	c.push("\n");
	l_friendIds = S.Modifier.get(Surface.globalContext, "friendIds");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null)) {
		l_for_serverbrowserwarsaw_serverplayerlist_5_5_list = ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : []);
		l_for_serverbrowserwarsaw_serverplayerlist_5_5_iteration = 0;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverplayerlist_5_5_list), 0)) {
			for (var l_for_serverbrowserwarsaw_serverplayerlist_5_5_key in l_for_serverbrowserwarsaw_serverplayerlist_5_5_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverplayerlist_5_5_list[l_for_serverbrowserwarsaw_serverplayerlist_5_5_key])) {
					continue;
				}
				var l_player = l_for_serverbrowserwarsaw_serverplayerlist_5_5_list[l_for_serverbrowserwarsaw_serverplayerlist_5_5_key];
				l_for_serverbrowserwarsaw_serverplayerlist_5_5_iteration = S.compat.add(l_for_serverbrowserwarsaw_serverplayerlist_5_5_iteration, 1);
				l_for_serverbrowserwarsaw_serverplayerlist_5_5_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_serverplayerlist_5_5_iteration, 2), 0);
				l_for_serverbrowserwarsaw_serverplayerlist_5_5_isOdd = !(l_for_serverbrowserwarsaw_serverplayerlist_5_5_isEven);
				c.push(" <div class=\"serverbrowser-show-playerrow ");
				if (S.Modifier.contains(l_friendIds, ((typeof(l_player) != "undefined" && l_player !== null && typeof(l_player.userId) != "undefined" && l_player.userId !== null) ? l_player.userId : 0))) {
					c.push("myfriend");
				}
				c.push("\">\n <span ");
				if (l_for_serverbrowserwarsaw_serverplayerlist_5_5_isOdd) {
					c.push("class=\"serverbrowser-show-player-odd\"");
				}
				c.push(">\n ");
				c.push(Surface.importTemplate(("ui" + ("." + "avatar")), {"user": l_player.persona.user, "size": 22}, null, kwargs));
				c.push("\n <div class=\"serverbrowser-show-player\">\n ");
				c.push(Surface.importTemplate(("common" + ("." + "playername")), {"persona": l_player.persona, "user": l_player.persona.user}, null, kwargs));
				c.push("\n </div>\n <div class=\"serverbrowser-show-score-container\">\n <div class=\"serverbrowser-player-score-");
				c.push(Surface.valOut(l_player.persona.personaId));
				c.push("\"></div>\n </div>\n </span>\n </div>\n");
			}
		}
		c.push("\n");
		l_usedSlots = S.compat.sub(((typeof(o) != "undefined" && o !== null && typeof(o.numPlayers) != "undefined" && o.numPlayers !== null) ? o.numPlayers : 0), 1);
		l_for_serverbrowserwarsaw_serverplayerlist_23_5_list = S.Modifier.to(S.Modifier.count(((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : [])), l_usedSlots);
		l_for_serverbrowserwarsaw_serverplayerlist_23_5_iteration = 0;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverplayerlist_23_5_list), 0)) {
			for (var l_for_serverbrowserwarsaw_serverplayerlist_23_5_key in l_for_serverbrowserwarsaw_serverplayerlist_23_5_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverplayerlist_23_5_list[l_for_serverbrowserwarsaw_serverplayerlist_23_5_key])) {
					continue;
				}
				var l_n = l_for_serverbrowserwarsaw_serverplayerlist_23_5_list[l_for_serverbrowserwarsaw_serverplayerlist_23_5_key];
				l_for_serverbrowserwarsaw_serverplayerlist_23_5_iteration = S.compat.add(l_for_serverbrowserwarsaw_serverplayerlist_23_5_iteration, 1);
				l_for_serverbrowserwarsaw_serverplayerlist_23_5_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_serverplayerlist_23_5_iteration, 2), 0);
				l_for_serverbrowserwarsaw_serverplayerlist_23_5_isOdd = !(l_for_serverbrowserwarsaw_serverplayerlist_23_5_isEven);
				c.push(" <div class=\"serverbrowser-show-playerrow\">\n <span ");
				if (l_for_serverbrowserwarsaw_serverplayerlist_23_5_isOdd) {
					c.push("class=\"serverbrowser-show-player-odd\"");
				}
				c.push(">\n ");
				c.push(Surface.importTemplate(("ui" + ("." + "avatar")), {"size": 22}, null, kwargs));
				c.push("\n <div class=\"serverbrowser-show-player\">\n <div class=\"serverbrowser-show-player-persona shaded unknown\">");
				c.push(Surface.valOut("不明"));
				c.push("</div>\n </div>\n <div class=\"serverbrowser-show-score-container\">\n <div class=\"serverbrowser-player-score--\"></div>\n </div>\n </span>\n </div>\n");
			}
		}
	}
	else {
		c.push(" <div class=\"common-spinner\" data-size=\"big\"></div>\n");
	}
	c.push("\n<div style=\"clear:both;\"></div>\n");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_serverrow = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('serverrow'));
serverbrowserwarsaw.serverrow.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serverrow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serverrow');
	var l_mapicon;
	var l_soldierSlots;
	var l_session;
	var l_for_serverbrowserwarsaw_serverrow_47_18_list;
	var l_queueSlots;
	c.push("\n");
	l_session = S.Modifier.get(Surface.globalContext, "session");
	c.push("\n");
	o.isTouchDevice = Surface.globalContext.staticContext.detectedBrowser.isTouchDevice;
	c.push("\n");
	if (o.server.online) {
		c.push("<tr class=\"server-row trigger-el\">\n");
		if ((!(o.isTouchDevice) && S.compat.eq(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : 0), 1))) {
			c.push(" <td class=\"favorite no-separator\">\n");
			if (((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false)) {
				c.push(" <div class=\"star");
				if (o.isFavorite) {
					c.push(" starred");
				}
				c.push("\" data-bind-toggle=\"favorite\" data-type=\"server\"\n data-tooltip=\"");
				c.push(Surface.valOut("お気に入りの変更"));
				c.push("\" data-tooltip-show-delay=\"1000\" data-tooltip-position=\"left\"></div>\n ");
			}
			c.push("\n");
			c.push(" </td>\n ");
		}
		c.push("\n");
		c.push("\n <td class=\"map less-padding no-separator \">\n");
		l_mapicon = $S.callFunction("base.asset", o.mapinfo.imageSmall, b, kwargs);
		if ((o.isTouchDevice || !($S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs)))) {
			c.push(" <div class=\"map-thumb\">\n <img src=\"");
			c.push(Surface.valOut(l_mapicon));
			c.push("\" alt=\"");
			c.push(Surface.valOut((S.translations[o.mapinfo.name] || o.mapinfo.name)));
			c.push("\"/>\n </div>\n <div class=\"loader small\"></div>\n");
		}
		else {
			c.push(" <div class=\"map-thumb\"\n data-track=\"serverbrowser.server.inline.join\"\n data-bind-action=\"join-mp-gameserver\"\n data-telemetry-action=\"serverbrowser\">\n <div class=\"quick-join\"></div>\n <img src=\"");
			c.push(Surface.valOut(l_mapicon));
			c.push("\" alt=\"");
			c.push(Surface.valOut((S.translations[o.mapinfo.name] || o.mapinfo.name)));
			c.push("\"/>\n </div>\n");
		}
		c.push(" </td>\n <td class=\"server less-padding floating-width\" style=\"");
		if (o.isTouchDevice) {
			c.push("width: 536px");
		}
		c.push("\">\n <div class=\"server-name\">\n ");
		c.push(Surface.importTemplate(("common" + ("." + "servername")), {"name": o.server.name, "first": 28, "limit": 80}, null, kwargs));
		c.push("\n </div>\n <div class=\"server-details\">\n <div class=\"expansions pull-right\">\n");
		l_for_serverbrowserwarsaw_serverrow_47_18_list = S.Modifier.sortfast(o.server.gameExpansions);
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serverrow_47_18_list), 0)) {
			for (var l_for_serverbrowserwarsaw_serverrow_47_18_key in l_for_serverbrowserwarsaw_serverrow_47_18_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serverrow_47_18_list[l_for_serverbrowserwarsaw_serverrow_47_18_key])) {
					continue;
				}
				var l_gameExpansion = l_for_serverbrowserwarsaw_serverrow_47_18_list[l_for_serverbrowserwarsaw_serverrow_47_18_key];
				if (!(S.Modifier.contains([Surface.globalContext.staticContext.gameExpansions.VANILLA], l_gameExpansion))) {
					c.push(" ");
					c.push(Surface.importTemplate(("common" + ("." + "gameExpansionImage")), {"game": o.server.game, "expansion": l_gameExpansion}, null, kwargs));
					c.push("\n");
				}
				c.push("\n");
			}
		}
		c.push("\n </div>\n");
		if ((((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.country) != "undefined" && o.server.country !== null) ? o.server.country : false) && S.compat.eq(o.server.platform, 1))) {
			c.push(" <span class=\"country-flag\">\n ");
			c.push(Surface.importTemplate(("common" + ("." + "countryflag")), {"skipTitle": true, "countryCode": o.server.country}, null, kwargs));
			c.push("\n </span>\n");
		}
		c.push(" <span class=\"mode\" data-tooltip=\"");
		c.push(Surface.valOut("モード"));
		c.push("\" data-tooltip-show-delay=\"1000\">\n ");
		c.push(Surface.valOut(o.server.mapModeString));
		c.push("\n </span> &bull;\n <span class=\"map\" data-tooltip=\"");
		c.push(Surface.valOut("マップ"));
		c.push("\" data-tooltip-show-delay=\"1000\">\n ");
		c.push(Surface.valOut(S.Modifier.capitalize(o.mapinfo.name)));
		if (S.compat.gt(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.mapVariant) != "undefined" && o.server.mapVariant !== null) ? o.server.mapVariant : 0), 0)) {
			c.push(" #");
			c.push(Surface.valOut(S.compat.add(o.server.mapVariant, 1)));
		}
		c.push("\n </span> &bull;\n <span class=\"preset\" data-tooltip=\"");
		c.push(Surface.valOut("プリセット"));
		c.push("\" data-tooltip-show-delay=\"1000\">\n ");
		c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", o.server.preset, b, kwargs)));
		c.push("\n </span> &bull;\n <span class=\"tick-rate\" data-tooltip=\"");
		c.push(Surface.valOut("チックレート"));
		c.push("\" data-tooltip-show-delay=\"1000\">\n ");
		c.push(Surface.valOut(o.server.tickRate));
		c.push(" Hz\n </span>\n </div>\n </td>\n ");
		l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
		l_queueSlots = $S.callFunction("serverguide.getServerSlots", o.server, 1, b, kwargs);
		c.push(" <td class=\"players\">\n <span class=\"occupied\">");
		c.push(Surface.valOut(l_soldierSlots.current));
		c.push("</span> /\n <span class=\"max\">");
		c.push(Surface.valOut(l_soldierSlots.max));
		c.push("</span>\n ");
		if (S.compat.gt(l_queueSlots.current, 0)) {
			c.push(" (<abbr class=\"queue\" data-tooltip=\"");
			c.push(Surface.valOut(l_queueSlots.current));
			c.push(" ");
			c.push(Surface.valOut("人待ち"));
			c.push("\">");
			c.push(Surface.valOut(l_queueSlots.current));
			c.push("</abbr>)");
		}
		c.push("\n </td>\n <td class=\"less-padding server-icons\">\n <i class=\"icon-servertype icon-servertype-");
		c.push(Surface.valOut(o.server.serverType));
		c.push("\"></i>\n </td>\n <td class=\"ping no-separator\">\n ");
		c.push(Surface.importTemplate(("ui" + ("." + "pingbar")), {"ping": o.ping}, null, kwargs));
		c.push("\n </td>\n</tr>\n");
	}
	c.push("\n");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_serversettings = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('serversettings'));
serverbrowserwarsaw.serversettings.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_serversettings;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.serversettings');
	var l_settingValue;
	var l_gameServerSettings;
	var l_settingsPerColumn;
	var l_for_serverbrowserwarsaw_serversettings_67_17_iteration;
	var l_for_serverbrowserwarsaw_serversettings_44_17_iteration;
	var l_thirdColumn;
	var l_for_serverbrowserwarsaw_serversettings_91_17_list;
	var l_gameserverDetails;
	var l_secondColumn;
	var l_settingsCount;
	var l_nameSID;
	var l_firstColumn;
	var l_for_serverbrowserwarsaw_serversettings_67_17_list;
	var l_for_serverbrowserwarsaw_serversettings_44_17_list;
	var l_lang_country;
	var l_for_serverbrowserwarsaw_serversettings_91_17_iteration;
	var l_filterInfo;
	c.push("\n<div id=\"server-page-settings\" class=\"row-tight spacing-top-tight\">\n <div class=\"span2 box\">\n <div class=\"box-content\">\n <dl>\n <dt>");
	c.push(Surface.valOut(S.Modifier.upper("地域")));
	c.push("</dt>\n <dd>");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.getServerRegionLocalized", o.server.region, b, kwargs)));
	c.push("\n");
	if ((((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.country) != "undefined" && o.server.country !== null) ? o.server.country : false) && S.compat.eq(o.server.platform, 1))) {
		c.push(" ");
		l_lang_country = $S.callFunction("common.countryName", o.server.country, b, kwargs);
		c.push(" - ");
		c.push(Surface.valOut(l_lang_country));
		c.push("\n");
	}
	c.push(" </dd>\n </dl>\n <dl>\n <dt>");
	c.push(Surface.valOut(S.Modifier.upper("Punkbuster")));
	c.push("</dt>\n <dd>");
	if (o.server.punkbuster) {
		c.push("<span class=\"icon icon-punkbuster ");
		if (S.compat.eq(Surface.globalContext.realm.section, 8192)) {
			c.push("dark");
		}
		c.push("\"></span> ");
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push("<span class=\"icon icon-punkbuster disabled\"></span> ");
		c.push(Surface.valOut("オフ"));
	}
	c.push("</dd>\n </dl>\n <dl>\n <dt>");
	c.push(Surface.valOut(S.Modifier.upper("FairFight")));
	c.push("</dt>\n <dd>");
	if (o.server.fairfight) {
		c.push("<span class=\"icon icon-fairfight ");
		if (S.compat.eq(Surface.globalContext.realm.section, 8192)) {
			c.push("dark");
		}
		c.push("\"></span> ");
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push("<span class=\"icon icon-fairfight disabled\"></span> ");
		c.push(Surface.valOut("オフ"));
	}
	c.push("</dd>\n </dl>\n <dl>\n <dt>");
	c.push(Surface.valOut(S.Modifier.upper("パスワード")));
	c.push("</dt>\n <dd>");
	if (o.server.hasPassword) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</dd>\n </dl>\n");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.settings) != "undefined" && o.server.settings !== null)) {
		l_settingsCount = S.compat.add(S.Modifier.count(o.server.settings), 4);
		l_settingsPerColumn = S.Modifier.ceil(S.compat.div(l_settingsCount, 3));
		if (S.compat.lt(l_settingsPerColumn, 4)) {
			l_settingsPerColumn = 4;
		}
		l_firstColumn = S.compat.sub(l_settingsPerColumn, 4);
		l_secondColumn = S.compat.add(l_firstColumn, l_settingsPerColumn);
		l_thirdColumn = S.compat.add(l_secondColumn, l_settingsPerColumn);
		c.push("\n");
		l_gameserverDetails = $S.callFunction("gamedata.get", o.server.game, "gameserver", b, kwargs);
		l_gameServerSettings = S.Modifier.get(l_gameserverDetails, "gameServerSettings");
		c.push("\n");
		l_for_serverbrowserwarsaw_serversettings_44_17_list = o.server.settings;
		l_for_serverbrowserwarsaw_serversettings_44_17_iteration = 0;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serversettings_44_17_list), 0)) {
			for (var l_settingKey in l_for_serverbrowserwarsaw_serversettings_44_17_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serversettings_44_17_list[l_settingKey])) {
					continue;
				}
				var l_settingValue = l_for_serverbrowserwarsaw_serversettings_44_17_list[l_settingKey];
				l_for_serverbrowserwarsaw_serversettings_44_17_iteration = S.compat.add(l_for_serverbrowserwarsaw_serversettings_44_17_iteration, 1);
				if (S.compat.gt(l_for_serverbrowserwarsaw_serversettings_44_17_iteration, l_firstColumn)) {
					break;
				}
				l_filterInfo = S.Modifier.get(l_gameServerSettings, l_settingKey);
				if (S.compat.eq(S.Modifier.get(l_filterInfo, "type"), "bool")) {
					if (S.compat.eq(l_settingValue, 1)) {
						l_settingValue = "オン";
					}
					else {
						l_settingValue = "オフ";
					}
				}
				l_nameSID = S.Modifier.get(l_filterInfo, "nameSID");
				c.push(" <dl>\n <dt>");
				c.push(Surface.valOut((S.translations[l_nameSID] || l_nameSID)));
				c.push("</dt>\n <dd>");
				c.push(Surface.valOut(l_settingValue));
				c.push("</dd>\n </dl>\n");
			}
		}
	}
	c.push(" </div>\n </div>\n <div class=\"span2 box\">\n <div class=\"box-content\">\n");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.settings) != "undefined" && o.server.settings !== null)) {
		l_for_serverbrowserwarsaw_serversettings_67_17_list = o.server.settings;
		l_for_serverbrowserwarsaw_serversettings_67_17_iteration = 0;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serversettings_67_17_list), 0)) {
			for (var l_settingKey in l_for_serverbrowserwarsaw_serversettings_67_17_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serversettings_67_17_list[l_settingKey])) {
					continue;
				}
				var l_settingValue = l_for_serverbrowserwarsaw_serversettings_67_17_list[l_settingKey];
				l_for_serverbrowserwarsaw_serversettings_67_17_iteration = S.compat.add(l_for_serverbrowserwarsaw_serversettings_67_17_iteration, 1);
				if (S.compat.lte(l_for_serverbrowserwarsaw_serversettings_67_17_iteration, l_firstColumn)) {
					continue;
				}
				if (S.compat.gt(l_for_serverbrowserwarsaw_serversettings_67_17_iteration, l_secondColumn)) {
					break;
				}
				l_filterInfo = S.Modifier.get(l_gameServerSettings, l_settingKey);
				if (S.compat.eq(S.Modifier.get(l_filterInfo, "type"), "bool")) {
					if (S.compat.eq(l_settingValue, 1)) {
						l_settingValue = "オン";
					}
					else {
						l_settingValue = "オフ";
					}
				}
				l_nameSID = S.Modifier.get(l_filterInfo, "nameSID");
				c.push(" <dl>\n <dt>");
				c.push(Surface.valOut((S.translations[l_nameSID] || l_nameSID)));
				c.push("</dt>\n <dd>");
				c.push(Surface.valOut(l_settingValue));
				c.push("</dd>\n </dl>\n");
			}
		}
	}
	c.push(" </div>\n </div>\n <div class=\"span2 box\">\n <div class=\"box-content\">\n");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.settings) != "undefined" && o.server.settings !== null)) {
		l_for_serverbrowserwarsaw_serversettings_91_17_list = o.server.settings;
		l_for_serverbrowserwarsaw_serversettings_91_17_iteration = 0;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_serversettings_91_17_list), 0)) {
			for (var l_settingKey in l_for_serverbrowserwarsaw_serversettings_91_17_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_serversettings_91_17_list[l_settingKey])) {
					continue;
				}
				var l_settingValue = l_for_serverbrowserwarsaw_serversettings_91_17_list[l_settingKey];
				l_for_serverbrowserwarsaw_serversettings_91_17_iteration = S.compat.add(l_for_serverbrowserwarsaw_serversettings_91_17_iteration, 1);
				if (S.compat.lte(l_for_serverbrowserwarsaw_serversettings_91_17_iteration, l_secondColumn)) {
					continue;
				}
				if (S.compat.gt(l_for_serverbrowserwarsaw_serversettings_91_17_iteration, l_thirdColumn)) {
					break;
				}
				l_filterInfo = S.Modifier.get(l_gameServerSettings, l_settingKey);
				if (S.compat.eq(S.Modifier.get(l_filterInfo, "type"), "bool")) {
					if (S.compat.eq(l_settingValue, 1)) {
						l_settingValue = "オン";
					}
					else {
						l_settingValue = "オフ";
					}
				}
				l_nameSID = S.Modifier.get(l_filterInfo, "nameSID");
				if (S.compat.eq(l_nameSID, " ")) {
					continue;
				}
				c.push(" <dl>\n <dt>");
				c.push(Surface.valOut((S.translations[l_nameSID] || l_nameSID)));
				c.push("</dt>\n <dd>");
				c.push(Surface.valOut(l_settingValue));
				c.push("</dd>\n </dl>\n");
			}
		}
	}
	c.push(" </div>\n </div>\n</div>\n");
	return c.join('');
}
;
;var block_serverbrowserwarsaw_show = new Surface.BlockConfig('serverbrowserwarsaw.base', {'mapRotation': 'serverbrowserwarsaw.show.block_mapRotation', 'title': 'serverbrowserwarsaw.show.block_title', 'joinButtons': 'serverbrowserwarsaw.show.block_joinButtons', 'settings': 'serverbrowserwarsaw.show.block_settings', 'shortInfo': 'serverbrowserwarsaw.show.block_shortInfo', 'scoreBoard': 'serverbrowserwarsaw.show.block_scoreBoard', 'titleItem': 'serverbrowserwarsaw.show.block_titleItem', 'mainContent': 'serverbrowserwarsaw.show.block_mainContent'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('show'));
serverbrowserwarsaw.show.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_show;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.show');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.base', o, b, kwargs);
}
;
serverbrowserwarsaw.show.block_titleItem = new Surface.Block('serverbrowserwarsaw.show.block_titleItem');
serverbrowserwarsaw.show.block_titleItem.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(Surface.valOut(o.server.name));
	c.push(" - ");
	return c.join("");
}
;
serverbrowserwarsaw.show.block_title = new Surface.Block('serverbrowserwarsaw.show.block_title');
serverbrowserwarsaw.show.block_title.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("Server");
	return c.join("");
}
;
serverbrowserwarsaw.show.surface_31_5 = new Surface.SingleSurface("serverbrowserwarsaw.show.surface_31_5");
serverbrowserwarsaw.show.surface_37_13 = new Surface.SingleSurface("serverbrowserwarsaw.show.surface_37_13");
serverbrowserwarsaw.show.block_shortInfo = new Surface.Block('serverbrowserwarsaw.show.block_shortInfo');
serverbrowserwarsaw.show.block_shortInfo.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.show.block_joinButtons = new Surface.Block('serverbrowserwarsaw.show.block_joinButtons');
serverbrowserwarsaw.show.block_joinButtons.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.show.block_mapRotation = new Surface.Block('serverbrowserwarsaw.show.block_mapRotation');
serverbrowserwarsaw.show.block_mapRotation.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.show.block_settings = new Surface.Block('serverbrowserwarsaw.show.block_settings');
serverbrowserwarsaw.show.block_settings.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	return c.join("");
}
;
serverbrowserwarsaw.show.surface_37_13.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_show;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.show');
	c.push("<surf:container id=\"serverbrowser-page-info\"");
	c.push(">");
	c.push(" <div class=\"box-collection\">\n");
	o.server = o.server;
	if (S.compat.eq(Surface.globalContext.realm.section, 8192)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverpagegamemode")), o, null, kwargs));
		c.push("\n");
	}
	c.push(b.get('shortInfo')(o, b, kwargs));
	c.push(b.get('joinButtons')(o, b, kwargs));
	c.push(" </div>\n");
	c.push(b.get('mapRotation')(o, b, kwargs));
	c.push(b.get('settings')(o, b, kwargs));
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.show", "surface_37_13", "serverbrowser-page-info", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.show.block_scoreBoard = new Surface.Block('serverbrowserwarsaw.show.block_scoreBoard');
serverbrowserwarsaw.show.block_scoreBoard.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" <div id=\"server-players-list\" class=\"box spacing-top-tight\">\n <header>\n <h1>");
	c.push(Surface.valOut("スコアボード"));
	c.push("</h1>\n </header>\n <div class=\"box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "scoreboard")), {"gameModes": o.gameModes, "server": o.server}, null, kwargs));
	c.push("\n </div>\n </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.show.surface_31_5.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_show;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.show');
	c.push("<surf:container id=\"serverbrowser-page\"");
	c.push(">");
	if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null)) {
		o.players = o.players;
		c.push("\n");
		o.server.ping = "-";
		c.push(serverbrowserwarsaw.show.surface_37_13.render({"server": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : null)}, b, kwargs));
		c.push(b.get('scoreBoard')(o, b, kwargs));
	}
	else {
		c.push(" <div id=\"serverbrowser-result\" class=\"box\">\n <div class=\"box-content\">\n <p class=\"serverbrowser-show-infomsg\">");
		c.push(Surface.valOut("サーバーが見つかりません"));
		c.push("</p>\n </div>\n </div>\n");
	}
	c.push("\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.show", "surface_31_5", "serverbrowser-page", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.show.block_mainContent = new Surface.Block('serverbrowserwarsaw.show.block_mainContent');
serverbrowserwarsaw.show.block_mainContent.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_favGuids;
	var l_isLoggedIn;
	var l_session;
	l_session = S.Modifier.get(Surface.globalContext, "session");
	l_favGuids = S.Modifier.get(Surface.globalContext, "favGuids");
	l_isLoggedIn = ((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false);
	c.push("<section id=\"server-page\"\n data-guid=\"");
	c.push(Surface.valOut(o.server.guid));
	c.push("\"\n data-game=\"");
	c.push(Surface.valOut(o.server.game));
	c.push("\"\n data-platform=\"");
	c.push(Surface.valOut(o.server.platform));
	c.push("\"\n data-ip=\"");
	c.push(Surface.valOut(o.server.ip));
	c.push("\"\n class=\"grid-container\">\n <header>\n <div class=\"server-buttons pull-right ");
	if (l_isLoggedIn) {
		c.push("can-favorite");
	}
	c.push("\">\n");
	if ((l_isLoggedIn && S.compat.eq(o.server.platform, 1))) {
		c.push(" <div class=\"btn btn-small ");
		if (S.compat.neq(((typeof(S.Modifier.indexOf(l_favGuids, o.server.guid)) != "undefined" && S.Modifier.indexOf(l_favGuids, o.server.guid) !== null) ? S.Modifier.indexOf(l_favGuids, o.server.guid) : -1), -1)) {
			c.push("starred");
		}
		c.push("\" data-type=\"server\" data-bind-toggle=\"favorite\"><span class=\"star\"></span>");
		c.push(Surface.valOut("お気に入り"));
		c.push("</div>\n");
	}
	c.push(" </div>\n <div class=\"server-title pull-left\">\n <h1 class=\"wrappable\">");
	c.push(Surface.valOut(o.server.name));
	c.push("</h1>\n </div>\n </header>\n");
	if (S.compat.eq(Surface.globalContext.realm.section, 2048)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serverpagegamemode")), o, null, kwargs));
		c.push("\n");
	}
	c.push("\n");
	c.push(serverbrowserwarsaw.show.surface_31_5.render({"players": ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : null), "server": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : null)}, b, kwargs));
	c.push("</section>\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_showserverinfo = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('showserverinfo'));
serverbrowserwarsaw.showserverinfo.surface_1_0 = new Surface.SingleSurface("serverbrowserwarsaw.showserverinfo.surface_1_0");
serverbrowserwarsaw.showserverinfo.surface_20_47 = new Surface.SingleSurface("serverbrowserwarsaw.showserverinfo.surface_20_47");
serverbrowserwarsaw.showserverinfo.surface_20_47.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_showserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.showserverinfo');
	c.push("<surf:container id=\"serverbrowser-show-info-ping\"");
	c.push(">");
	c.push(Surface.valOut(o.server.ping));
	c.push(" ms");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.showserverinfo", "surface_20_47", "serverbrowser-show-info-ping", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.showserverinfo.surface_1_0.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_showserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.showserverinfo');
	c.push("<surf:container id=\"serverbrowser-show-info\"");
	c.push(">");
	var l_mapName;
	var l_mapsOnServer;
	var l_mapBubbleInfo;
	var l_soldierSlots;
	var l_mapInfo;
	var l_queueSlots;
	var l_for_serverbrowserwarsaw_showserverinfo_53_33_list;
	c.push(" <div id=\"server-info\" class=\"common-box-container\" data-ip=\"");
	c.push(Surface.valOut(o.server.ip));
	c.push("\">\n <div class=\"common-box-inner\">\n <table id=\"server-info-short\">\n <thead>\n <tr>\n <th>");
	c.push(Surface.valOut("プレイヤー"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("PING"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("ランク"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("プリセット"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("Punkbuster"));
	c.push("</th>\n <th>");
	c.push(Surface.valOut("パスワード"));
	c.push("</th>\n </tr>\n </thead>\n <tbody>\n <tr>\n");
	l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
	l_queueSlots = $S.callFunction("serverguide.getServerSlots", o.server, 1, b, kwargs);
	c.push(" <td id=\"server-info-players\">");
	c.push(Surface.valOut(l_soldierSlots.current));
	c.push(" / ");
	c.push(Surface.valOut(l_soldierSlots.max));
	if (S.compat.gt(l_queueSlots.current, 0)) {
		c.push(" [<abbr title=\"");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push(" ");
		c.push(Surface.valOut("人待ち"));
		c.push("\">");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push("</abbr>]");
	}
	c.push("</td>\n <td id=\"server-info-ping\">");
	c.push(serverbrowserwarsaw.showserverinfo.surface_20_47.render({"server": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : null)}, b, kwargs));
	c.push("</td>\n <td id=\"server-info-ranked\" ");
	if (!(o.server.ranked)) {
		c.push("class=\"server-info-off\"");
	}
	c.push(">");
	if (o.server.ranked) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n <td id=\"server-info-preset\"");
	if (S.compat.neq(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 0), 2)) {
		c.push(" class=\"server-info-off\"");
	}
	c.push(">");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 1), b, kwargs)));
	c.push("</td>\n <td id=\"server-info-punkbuster\"");
	if (!(o.server.punkbuster)) {
		c.push(" class=\"server-info-off\"");
	}
	c.push(">");
	if (o.server.punkbuster) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n <td id=\"server-info-password\" class=\"last");
	if (!(o.server.hasPassword)) {
		c.push(" server-info-off");
	}
	c.push("\">");
	if (o.server.hasPassword) {
		c.push(Surface.valOut("オン"));
	}
	else {
		c.push(Surface.valOut("オフ"));
	}
	c.push("</td>\n </tr>\n </tbody>\n </table>\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serversettings")), {"server": o.server}, null, kwargs));
	c.push("\n <div class=\"base-clear\"></div>\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.extendedInfo) != "undefined" && o.server.extendedInfo !== null && typeof(o.server.extendedInfo.desc) != "undefined" && o.server.extendedInfo.desc !== null) ? o.server.extendedInfo.desc : "")) {
		c.push(" <div id=\"server-description\">\n <h3>");
		c.push(Surface.valOut("説明"));
		c.push("</h3>\n <p>");
		c.push(S.Modifier.nl2br(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.extendedInfo) != "undefined" && o.server.extendedInfo !== null && typeof(o.server.extendedInfo.desc) != "undefined" && o.server.extendedInfo.desc !== null) ? o.server.extendedInfo.desc : "")));
		c.push("</p>\n </div>\n");
	}
	c.push("\n <div id=\"server-info-maprotation-container\" class=\"base-box-push\">\n <div class=\"base-box-push-inner\">\n <div id=\"server-info-maprotation-slider-wrapper\">\n <div class=\"server-info-maprotation-title\">\n ");
	c.push(Surface.valOut("マップローテーション"));
	c.push("\n </div>\n <div id=\"maprotation-nav-left\" class=\"maprotation-nav sodaSlider-arrow-left\"></div>\n <div id=\"maprotation-nav-right\" class=\"maprotation-nav sodaSlider-arrow-right\"></div>\n <table id=\"maprotation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"sodaSlider-slider\">\n <tr>\n");
	l_mapsOnServer = S.Modifier.get(o.server.maps, "maps", []);
	l_for_serverbrowserwarsaw_showserverinfo_53_33_list = l_mapsOnServer;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_showserverinfo_53_33_list), 0)) {
		for (var l_for_serverbrowserwarsaw_showserverinfo_53_33_key in l_for_serverbrowserwarsaw_showserverinfo_53_33_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_showserverinfo_53_33_list[l_for_serverbrowserwarsaw_showserverinfo_53_33_key])) {
				continue;
			}
			var l_mapRotation = l_for_serverbrowserwarsaw_showserverinfo_53_33_list[l_for_serverbrowserwarsaw_showserverinfo_53_33_key];
			l_mapInfo = $S.callFunction("common.mapinfo", o.server.game, l_mapRotation.map, b, kwargs);
			l_mapName = S.Modifier.get(l_mapInfo, "name");
			l_mapBubbleInfo = (S.translations[l_mapName] || l_mapName);
			if (S.compat.gt(((typeof(l_mapRotation) != "undefined" && l_mapRotation !== null && typeof(l_mapRotation.mapVariant) != "undefined" && l_mapRotation.mapVariant !== null) ? l_mapRotation.mapVariant : 0), 0)) {
				l_mapBubbleInfo = S.Modifier.concat(S.Modifier.concat(l_mapBubbleInfo, " #"), S.compat.add(l_mapRotation.mapVariant, 1));
			}
			c.push(" <td><img src=\"");
			c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.get(l_mapInfo, "imageBig"), b, kwargs)));
			c.push("\" alt=\"");
			c.push(Surface.valOut(l_mapBubbleInfo));
			c.push("\" data-tooltip=\"");
			c.push(Surface.valOut(l_mapBubbleInfo));
			c.push("<br>");
			c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", l_mapRotation.mapMode, o.server.game, b, kwargs)));
			c.push("\" /></td>\n");
		}
	}
	else {
		c.push(" ");
		c.push(Surface.valOut("マップローテーションにマップがありません"));
		c.push("\n");
	}
	c.push(" </tr>\n </table>\n </div>\n </div>\n </div>\n <div class=\"base-clear\"></div>\n </div>\n </div>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.showserverinfo", "surface_1_0", "serverbrowser-show-info", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_urlactions = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('urlactions'));
serverbrowserwarsaw.urlactions.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_urlactions;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.urlactions');
	c.push("\n");
	return c.join('');
}
;
serverbrowserwarsaw.function_urlaction_getBasicServer = function(l_args, b, kwargs) {
	var o = {};
	var c = [];
	return S.Modifier.urlformat("/{_section}/{_language}/servers/getBasicServer/{platform}/{guid}/{extended}/", Surface.urlContext, l_args);
}
;
;var block_serverbrowserwarsaw_warsawfilters = new Surface.BlockConfig('', {'content': 'serverbrowserwarsaw.warsawfilters.block_content'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('warsawfilters'));
serverbrowserwarsaw.warsawfilters.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawfilters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawfilters');
	var l_forceExpandedFilter;
	c.push("\n");
	l_forceExpandedFilter = S.Modifier.get(Surface.globalContext, "forceExpandedFilter");
	c.push("\n");
	if (S.compat.neq(l_forceExpandedFilter, 1)) {
		o.showFilters = 0;
	}
	else {
		o.showFilters = 1;
	}
	c.push("\n<form id=\"serverbrowser-filters\" class=\"box box-primary spacing-top ");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilters) != "undefined" && o.showFilters !== null) ? o.showFilters : false)) {
		c.push("\nexpanded");
	}
	c.push("\" method=\"GET\"\n action=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
	c.push("\">\n <input type=\"hidden\" name=\"filtered\" value=\"1\" />\n <input type=\"hidden\" name=\"expand\" value=\"");
	c.push(Surface.valOut(o.showFilters));
	c.push("\" id=\"serverbrowser-filter-expanded\" />\n");
	c.push(b.get('content')(o, b, kwargs));
	c.push("\n</form>");
	return c.join('');
}
;
serverbrowserwarsaw.warsawfilters.surface_69_17 = new Surface.SingleSurface("serverbrowserwarsaw.warsawfilters.surface_69_17");
serverbrowserwarsaw.warsawfilters.surface_69_17.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawfilters;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawfilters');
	c.push("<surf:container id=\"serverbrowser-filterstring\"");
	c.push(">");
	c.push(" <em>");
	c.push(Surface.valOut("サーバー検索"));
	c.push(" :</em>\n <span id=\"custom-filter-list-content\"></span>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.warsawfilters", "surface_69_17", "serverbrowser-filterstring", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.warsawfilters.block_content = new Surface.Block('serverbrowserwarsaw.warsawfilters.block_content');
serverbrowserwarsaw.warsawfilters.block_content.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_xpack;
	var l_gameModes;
	var l_maps;
	var l_allMaps;
	var l_for_serverbrowserwarsaw_warsawfilters_129_21_iteration;
	var l_for_serverbrowserwarsaw_warsawfilters_142_21_list;
	var l_serverFilterOptions;
	var l_gm;
	var l_for_serverbrowserwarsaw_warsawfilters_46_13_list;
	var l_gameModeCodeMap;
	var l_for_serverbrowserwarsaw_warsawfilters_129_21_list;
	var l_for_serverbrowserwarsaw_warsawfilters_40_13_list;
	var l_for_serverbrowserwarsaw_warsawfilters_58_17_list;
	var l_xpackMaps;
	var l_allGameModes;
	c.push(" <input type=\"hidden\"\n name=\"settings\"\n id=\"serverbrowser-filter-settings-input\"\n value=\"");
	c.push(Surface.valOut(S.Modifier.join(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.settings) != "undefined" && o.filter.settings !== null) ? o.filter.settings : []), "|")));
	c.push("\">\n <input type=\"hidden\" name=\"useLocation\" id=\"serverbrowser-filter-use-location\" value=\"1\" />\n <input type=\"hidden\"\n name=\"useAdvanced\"\n id=\"serverbrowser-filter-settings-use-advanced\"\n value=\"");
	c.push(Surface.valOut(((typeof(o) != "undefined" && o !== null && typeof(o.filter) != "undefined" && o.filter !== null && typeof(o.filter.useAdvanced) != "undefined" && o.filter.useAdvanced !== null) ? o.filter.useAdvanced : -1)));
	c.push("\">\n <header\n class=\"serverbrowser-refresh serverbrowser-apply-filter-button\">&#8635;</header>\n <header class=\"toggle\">\n");
	l_serverFilterOptions = $S.callFunction("gamedata.get", 2048, "gameserver", b, kwargs);
	c.push("\n");
	l_allMaps = S.Modifier.get(l_serverFilterOptions, "maps");
	l_allGameModes = S.Modifier.get(l_serverFilterOptions, "gamemodes");
	l_gameModeCodeMap = {};
	c.push("\n");
	l_for_serverbrowserwarsaw_warsawfilters_40_13_list = l_allGameModes;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawfilters_40_13_list), 0)) {
		for (var l_for_serverbrowserwarsaw_warsawfilters_40_13_key in l_for_serverbrowserwarsaw_warsawfilters_40_13_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawfilters_40_13_list[l_for_serverbrowserwarsaw_warsawfilters_40_13_key])) {
				continue;
			}
			var l_gameMode = l_for_serverbrowserwarsaw_warsawfilters_40_13_list[l_for_serverbrowserwarsaw_warsawfilters_40_13_key];
			l_gameModeCodeMap = S.Modifier.set(l_gameModeCodeMap, S.compat.add("", l_gameMode.id), l_gameMode);
		}
	}
	c.push("\n");
	l_maps = {};
	l_gameModes = [];
	l_for_serverbrowserwarsaw_warsawfilters_46_13_list = l_allMaps;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawfilters_46_13_list), 0)) {
		for (var l_for_serverbrowserwarsaw_warsawfilters_46_13_key in l_for_serverbrowserwarsaw_warsawfilters_46_13_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawfilters_46_13_list[l_for_serverbrowserwarsaw_warsawfilters_46_13_key])) {
				continue;
			}
			var l_map = l_for_serverbrowserwarsaw_warsawfilters_46_13_list[l_for_serverbrowserwarsaw_warsawfilters_46_13_key];
			l_xpack = $S.callFunction("common.getXpackFromGameExpansion", l_map.gameExpansion, b, kwargs);
			if ((S.compat.eq(l_xpack, "xp6") || S.compat.eq(l_xpack, "xp7"))) {
				l_xpack = "core";
			}
			if ((S.compat.neq(l_xpack, "core") && !(S.Modifier.contains(o.validXpacks, l_xpack)))) {
				l_maps = S.Modifier.set(l_maps, l_xpack, []);
				continue;
			}
			l_xpackMaps = ((typeof(S.Modifier.get(l_maps, l_xpack)) != "undefined" && S.Modifier.get(l_maps, l_xpack) !== null) ? S.Modifier.get(l_maps, l_xpack) : []);
			l_xpackMaps = S.Modifier.append(l_xpackMaps, l_map);
			l_maps = S.Modifier.set(l_maps, l_xpack, l_xpackMaps);
			l_for_serverbrowserwarsaw_warsawfilters_58_17_list = l_map.gameModes;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawfilters_58_17_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawfilters_58_17_key in l_for_serverbrowserwarsaw_warsawfilters_58_17_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawfilters_58_17_list[l_for_serverbrowserwarsaw_warsawfilters_58_17_key])) {
						continue;
					}
					var l_gameMode = l_for_serverbrowserwarsaw_warsawfilters_58_17_list[l_for_serverbrowserwarsaw_warsawfilters_58_17_key];
					l_gm = S.Modifier.get(l_gameModeCodeMap, S.compat.add("", l_gameMode));
					if (!(S.Modifier.contains(l_gameModes, l_gm))) {
						l_gameModes = S.Modifier.append(l_gameModes, l_gm);
					}
				}
			}
		}
	}
	c.push("\n");
	l_gameModes = S.Modifier.sortfast(l_gameModes, "label", "asc");
	c.push("\n <div class=\"serverbrowser-filterstring arrow-container\">\n");
	c.push(serverbrowserwarsaw.warsawfilters.surface_69_17.render({}, b, kwargs));
	c.push("\n <div class=\"outerarrow\">\n <div class=\"arrow\"></div>\n </div>\n </div>\n </header>\n <div class=\"filters-container\">\n <div class=\"row-tight spacing-top-tight\">\n <div class=\"filter-col span1-04 box box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtermaps")), {"platform": o.platform, "maps": S.Modifier.get(l_maps, "core"), "filter": o.filter, "index": 0}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamemode")), {"platform": o.platform, "gamemodes": l_gameModes, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box box-content\">\n");
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergameslots")), {"gameslots": S.Modifier.get(l_serverFilterOptions, "gameslots"), "commanderSlots": S.Modifier.get(l_serverFilterOptions, "commanderGameslots"), "spectatorSlots": S.Modifier.get(l_serverFilterOptions, "spectatorGameslots"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtergamesize")), {"gamesize": S.Modifier.get(l_serverFilterOptions, "gamesize"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterfreetext")), o, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterservertype")), {"serverTypeFilter": S.Modifier.get(l_serverFilterOptions, "serverTypeFilter"), "filter": o.filter}, null, kwargs));
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtertickrate")), {"tickRates": S.Modifier.get(l_serverFilterOptions, "tickRates"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n");
	if (S.Modifier.count(o.validXpacks)) {
		c.push(" <div class=\"row-tight spacing-top-tight\">\n");
		l_for_serverbrowserwarsaw_warsawfilters_129_21_list = o.validXpacks;
		l_for_serverbrowserwarsaw_warsawfilters_129_21_iteration = 0;
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawfilters_129_21_list), 0)) {
			for (var l_for_serverbrowserwarsaw_warsawfilters_129_21_key in l_for_serverbrowserwarsaw_warsawfilters_129_21_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawfilters_129_21_list[l_for_serverbrowserwarsaw_warsawfilters_129_21_key])) {
					continue;
				}
				var l_xpack = l_for_serverbrowserwarsaw_warsawfilters_129_21_list[l_for_serverbrowserwarsaw_warsawfilters_129_21_key];
				l_for_serverbrowserwarsaw_warsawfilters_129_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawfilters_129_21_iteration, 1);
				c.push(" <div class=\"filter-col span1-04 box box-content\">\n");
				if (S.Modifier.get(l_maps, l_xpack)) {
					c.push(" ");
					c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filtermaps")), {"platform": o.platform, "maps": S.Modifier.get(l_maps, l_xpack), "filter": o.filter, "xpack": l_xpack, "index": l_for_serverbrowserwarsaw_warsawfilters_129_21_iteration}, null, kwargs));
					c.push("\n");
				}
				c.push("\n </div>\n ");
			}
		}
		c.push("\n");
		l_for_serverbrowserwarsaw_warsawfilters_142_21_list = S.Modifier.to(1, S.compat.sub(5, S.Modifier.count(o.validXpacks)));
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawfilters_142_21_list), 0)) {
			for (var l_for_serverbrowserwarsaw_warsawfilters_142_21_key in l_for_serverbrowserwarsaw_warsawfilters_142_21_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawfilters_142_21_list[l_for_serverbrowserwarsaw_warsawfilters_142_21_key])) {
					continue;
				}
				var l_n = l_for_serverbrowserwarsaw_warsawfilters_142_21_list[l_for_serverbrowserwarsaw_warsawfilters_142_21_key];
				c.push(" <div class=\"filter-col span1-04 box box-content\"></div>\n");
			}
		}
		c.push(" </div>\n ");
	}
	c.push("\n <div class=\"row-tight spacing-top-tight box advanced-filters\">\n <div class=\"filter-col span1-04\">\n <div class=\"box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterpresets")), {"gamepresets": S.Modifier.get(l_serverFilterOptions, "gamepresets"), "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterextra")), {"filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n <div class=\"filter-col span1-04 box box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterregion")), {"regions": S.Modifier.get(l_serverFilterOptions, "regions"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span1-04 box box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filteradvanced")), {"advancedsettings": S.Modifier.get(l_serverFilterOptions, "advancedsettings"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col span2 box filter-player-settings\">\n <div class=\"box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterplayersettings")), {"playersettings": S.Modifier.get(l_serverFilterOptions, "playersettings"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n <div class=\"filter-col box-content\">\n ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "filterrules")), {"rules": S.Modifier.get(l_serverFilterOptions, "rules"), "platformString": o.platformString, "filter": o.filter}, null, kwargs));
	c.push("\n </div>\n </div>\n </div>\n <div class=\"box box-content button-row spacing-top-tight\">\n <button type=\"button\" class=\"btn btn-small btn-clean pull-left toggle-advanced arrow-container\">");
	c.push(Surface.valOut("アドバンス"));
	c.push("\n <div class=\"outerarrow\">\n <div class=\"arrow\"></div>\n </div>\n </button>\n <button class=\"btn btn-small btn-primary pull-right\" type=\"submit\">");
	c.push(Surface.valOut("フィルターを適用"));
	c.push("</button>\n <a href=\"");
	c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/clearFilter/{platform}/", Surface.urlContext, {"platform": o.platformString})));
	c.push("\" class=\"btn btn-small pull-right reset-filters\">");
	c.push(Surface.valOut("リセット"));
	c.push("</a>\n </div>\n </div>\n ");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_warsawindex = new Surface.BlockConfig('serverbrowserwarsaw.index', {'sidebar': 'serverbrowserwarsaw.warsawindex.block_sidebar', 'filters': 'serverbrowserwarsaw.warsawindex.block_filters'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('warsawindex'));
serverbrowserwarsaw.warsawindex.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawindex;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawindex');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.index', o, b, kwargs);
}
;
serverbrowserwarsaw.warsawindex.block_filters = new Surface.Block('serverbrowserwarsaw.warsawindex.block_filters');
serverbrowserwarsaw.warsawindex.block_filters.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.showFilter) != "undefined" && o.showFilter !== null) ? o.showFilter : true)) {
		c.push(" ");
		c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "warsawfilters")), o, null, kwargs));
		c.push("\n");
	}
	else {
		c.push(" <a href=\"");
		c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/{platform}/", Surface.urlContext, {"platform": o.platformString})));
		c.push("\">\n ");
		c.push(Surface.valOut("全サーバーを表示"));
		c.push("\n </a>\n");
	}
	return c.join("");
}
;
serverbrowserwarsaw.warsawindex.block_sidebar = new Surface.Block('serverbrowserwarsaw.warsawindex.block_sidebar');
serverbrowserwarsaw.warsawindex.block_sidebar.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" ");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "warsawserverinfo")), o, null, kwargs));
	c.push("\n");
	return c.join("");
}
;
;var block_serverbrowserwarsaw_warsawscore = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('warsawscore'));
serverbrowserwarsaw.warsawscore.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawscore;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawscore');
	var l_gameServerMapModes;
	var l_gameModeCategories;
	c.push("\n");
	l_gameServerMapModes = $S.callFunction("battlereport.getGameServerMapModes", b, kwargs);
	l_gameModeCategories = $S.callFunction("battlereport.getGameModeCategories", b, kwargs);
	c.push("\n");
	c.push(serverbrowserwarsaw.warsawscore.surface_5_1.render({"errormessage": ((typeof(o) != "undefined" && o !== null && typeof(o.errormessage) != "undefined" && o.errormessage !== null) ? o.errormessage : null), "gameModeCategories": {"carrier": ((typeof(l_gameModeCategories) != "undefined" && l_gameModeCategories !== null && typeof(l_gameModeCategories.carrier) != "undefined" && l_gameModeCategories.carrier !== null) ? l_gameModeCategories.carrier : null), "ticket": ((typeof(l_gameModeCategories) != "undefined" && l_gameModeCategories !== null && typeof(l_gameModeCategories.ticket) != "undefined" && l_gameModeCategories.ticket !== null) ? l_gameModeCategories.ticket : null)}, "gameServerMapModes": {"CAPTURETHEFLAG": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.CAPTURETHEFLAG) != "undefined" && l_gameServerMapModes.CAPTURETHEFLAG !== null) ? l_gameServerMapModes.CAPTURETHEFLAG : null), "CHAINLINK": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.CHAINLINK) != "undefined" && l_gameServerMapModes.CHAINLINK !== null) ? l_gameServerMapModes.CHAINLINK : null), "GUNMASTER": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.GUNMASTER) != "undefined" && l_gameServerMapModes.GUNMASTER !== null) ? l_gameServerMapModes.GUNMASTER : null), "OBLITERATION": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.OBLITERATION) != "undefined" && l_gameServerMapModes.OBLITERATION !== null) ? l_gameServerMapModes.OBLITERATION : null), "RUSH": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.RUSH) != "undefined" && l_gameServerMapModes.RUSH !== null) ? l_gameServerMapModes.RUSH : null), "SQDM": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.SQDM) != "undefined" && l_gameServerMapModes.SQDM !== null) ? l_gameServerMapModes.SQDM : null), "SQUADOBLITERATION": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.SQUADOBLITERATION) != "undefined" && l_gameServerMapModes.SQUADOBLITERATION !== null) ? l_gameServerMapModes.SQUADOBLITERATION : null), "TEAMDEATHMATCH": ((typeof(l_gameServerMapModes) != "undefined" && l_gameServerMapModes !== null && typeof(l_gameServerMapModes.TEAMDEATHMATCH) != "undefined" && l_gameServerMapModes.TEAMDEATHMATCH !== null) ? l_gameServerMapModes.TEAMDEATHMATCH : null)}, "scoreboard": ((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) ? o.scoreboard : null)}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.warsawscore.surface_5_1 = new Surface.SingleSurface("serverbrowserwarsaw.warsawscore.surface_5_1");
serverbrowserwarsaw.warsawscore.surface_5_1.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawscore;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawscore');
	c.push("<surf:container id=\"selected-server-scoreboard\"");
	c.push(">");
	var l_nTargets;
	var l_teamLocale;
	var l_for_serverbrowserwarsaw_warsawscore_168_21_list;
	var l_for_serverbrowserwarsaw_warsawscore_42_21_list;
	var l_for_serverbrowserwarsaw_warsawscore_66_21_list;
	var l_for_serverbrowserwarsaw_warsawscore_192_21_list;
	var l_for_serverbrowserwarsaw_warsawscore_107_21_iteration;
	var l_objectives;
	var l_teams;
	var l_for_serverbrowserwarsaw_warsawscore_107_21_list;
	var l_gameMode;
	var l_for_serverbrowserwarsaw_warsawscore_149_21_iteration;
	var l_maxFlags;
	var l_pullClass;
	var l_att;
	var l_for_serverbrowserwarsaw_warsawscore_89_21_iteration;
	var l_defenders;
	var l_for_serverbrowserwarsaw_warsawscore_168_21_iteration;
	var l_flags;
	var l_isEven;
	var l_for_serverbrowserwarsaw_warsawscore_66_21_iteration;
	var l_teamScore;
	var l_for_serverbrowserwarsaw_warsawscore_149_21_list;
	var l_progressOptions;
	var l_for_serverbrowserwarsaw_warsawscore_42_21_iteration;
	var l_for_serverbrowserwarsaw_warsawscore_132_21_list;
	var l_for_serverbrowserwarsaw_warsawscore_120_29_list;
	var l_carrierHealth;
	var l_for_serverbrowserwarsaw_warsawscore_89_21_list;
	var l_for_serverbrowserwarsaw_warsawscore_19_9_list;
	var l_attackers;
	var l_for_serverbrowserwarsaw_warsawscore_192_21_iteration;
	var l_result;
	if ((typeof(o) != "undefined" && o !== null && typeof(o.errormessage) != "undefined" && o.errormessage !== null)) {
		c.push(" <div class=\"box\">\n <div class=\"box-content center-text error\">\n ");
		c.push(Surface.valOut((S.translations[o.errormessage] || o.errormessage)));
		c.push("\n </div>\n </div>\n");
	}
	else if ((((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) && S.compat.eq(S.Modifier.get(o.scoreboard, "status"), "OK")) && (typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null && typeof(o.scoreboard.result) != "undefined" && o.scoreboard.result !== null))) {
		c.push("\n");
		l_result = o.scoreboard.result;
		l_teams = S.Modifier.get(l_result, "teams", []);
		l_gameMode = S.Modifier.get(l_result, "gameMode", 64);
		c.push("\n");
		l_for_serverbrowserwarsaw_warsawscore_19_9_list = S.Modifier.get(l_result, "teams", {});
		if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_19_9_list), 0)) {
			for (var l_for_serverbrowserwarsaw_warsawscore_19_9_key in l_for_serverbrowserwarsaw_warsawscore_19_9_list) {
				if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_19_9_list[l_for_serverbrowserwarsaw_warsawscore_19_9_key])) {
					continue;
				}
				var l_t = l_for_serverbrowserwarsaw_warsawscore_19_9_list[l_for_serverbrowserwarsaw_warsawscore_19_9_key];
				if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.faction) != "undefined" && l_t.status.faction !== null)) {
					l_t.name = $S.callFunction("battlereport.getTeamFromFaction", l_t.status.faction, b, kwargs);
				}
				else if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.teamType) != "undefined" && l_t.status.teamType !== null)) {
					c.push("\n");
					l_t.name = l_t.status.teamType;
				}
				else {
					l_t.name = $S.callFunction("battlereport.getTeamFromFaction", S.compat.sub(l_t.status.teamId, 1), b, kwargs);
				}
			}
		}
		c.push(" <div class=\"box\">\n <div class=\"box-content gamemode-");
		c.push(Surface.valOut(l_gameMode));
		c.push("\">\n");
		l_progressOptions = {"size": "thicker", "border": false, "percent": 30, "type": "home", "reverse": false, "extraClass": "home"};
		c.push("\n");
		if (S.Modifier.contains(o.gameModeCategories.ticket, l_gameMode)) {
			l_for_serverbrowserwarsaw_warsawscore_42_21_list = l_teams;
			l_for_serverbrowserwarsaw_warsawscore_42_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_42_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawscore_42_21_key in l_for_serverbrowserwarsaw_warsawscore_42_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_42_21_list[l_for_serverbrowserwarsaw_warsawscore_42_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_42_21_list[l_for_serverbrowserwarsaw_warsawscore_42_21_key];
					l_for_serverbrowserwarsaw_warsawscore_42_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawscore_42_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_42_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_warsawscore_42_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_teamScore = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "tickets", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					l_progressOptions.type = S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_42_21_iteration, 1) ? "home" : "away";
					l_progressOptions.reverse = l_isEven ? false : true;
					l_progressOptions.extraClass = l_progressOptions.type;
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n");
					l_progressOptions.percent = S.compat.mul(S.compat.div(l_teamScore, S.Modifier.get(S.Modifier.get(l_team, "status", {}), "ticketsMax", l_teamScore)), 100);
					c.push(" <div class=\"pull-right\">");
					c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
					c.push("</div>\n </div>\n <p class=\"team-score\">");
					c.push(Surface.valOut(l_teamScore));
					c.push("</p>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.TEAMDEATHMATCH)) {
			l_for_serverbrowserwarsaw_warsawscore_66_21_list = l_teams;
			l_for_serverbrowserwarsaw_warsawscore_66_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_66_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawscore_66_21_key in l_for_serverbrowserwarsaw_warsawscore_66_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_66_21_list[l_for_serverbrowserwarsaw_warsawscore_66_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_66_21_list[l_for_serverbrowserwarsaw_warsawscore_66_21_key];
					l_for_serverbrowserwarsaw_warsawscore_66_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawscore_66_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_66_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_warsawscore_66_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_teamScore = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "tickets", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					l_progressOptions.type = S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_66_21_iteration, 1) ? "home" : "away";
					l_progressOptions.extraClass = l_progressOptions.type;
					l_progressOptions.reverse = l_isEven ? false : true;
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <p class=\"team-score\">");
					c.push(Surface.valOut(l_teamScore));
					c.push("</p>\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n");
					l_progressOptions.percent = S.compat.mul(S.compat.div(l_teamScore, S.Modifier.get(S.Modifier.get(l_team, "status", {}), "ticketsMax", l_teamScore)), 100);
					c.push(" <div class=\"pull-right\">");
					c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
					c.push("</div>\n </div>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.SQDM)) {
			l_for_serverbrowserwarsaw_warsawscore_89_21_list = l_teams;
			l_for_serverbrowserwarsaw_warsawscore_89_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_89_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawscore_89_21_key in l_for_serverbrowserwarsaw_warsawscore_89_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_89_21_list[l_for_serverbrowserwarsaw_warsawscore_89_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_89_21_list[l_for_serverbrowserwarsaw_warsawscore_89_21_key];
					l_for_serverbrowserwarsaw_warsawscore_89_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawscore_89_21_iteration, 1);
					l_teamLocale = $S.callFunction("battlereport.getSquadLocale", S.Modifier.get(S.Modifier.get(l_team, "status", {}), "teamId", 0), b, kwargs);
					l_teamScore = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "tickets", 0);
					l_progressOptions.type = S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_89_21_iteration, 1) ? "home" : "away";
					l_progressOptions.extraClass = l_progressOptions.type;
					c.push("\n <div class=\"team\">\n <div class=\"clearfix\">\n <p class=\"team-name pull-left\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n");
					l_progressOptions.percent = S.compat.mul(S.compat.div(l_teamScore, S.Modifier.get(S.Modifier.get(l_team, "status", {}), "ticketsMax", l_teamScore)), 100);
					c.push(" <p class=\"team-score pull-left\">");
					c.push(Surface.valOut(l_teamScore));
					c.push("</p>\n <div class=\"pull-left\">");
					c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
					c.push("</div>\n </div>\n </div>\n");
				}
			}
			c.push("\n");
		}
		else if ((S.compat.eq(l_gameMode, o.gameServerMapModes.OBLITERATION) || S.compat.eq(l_gameMode, o.gameServerMapModes.SQUADOBLITERATION))) {
			l_for_serverbrowserwarsaw_warsawscore_107_21_list = l_teams;
			l_for_serverbrowserwarsaw_warsawscore_107_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_107_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawscore_107_21_key in l_for_serverbrowserwarsaw_warsawscore_107_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_107_21_list[l_for_serverbrowserwarsaw_warsawscore_107_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_107_21_list[l_for_serverbrowserwarsaw_warsawscore_107_21_key];
					l_for_serverbrowserwarsaw_warsawscore_107_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawscore_107_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_107_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_warsawscore_107_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_teamScore = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "tickets", 0);
					l_nTargets = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "ticketsMax", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <div class=\"targets\">\n");
					l_for_serverbrowserwarsaw_warsawscore_120_29_list = S.Modifier.to(1, l_nTargets);
					if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_120_29_list), 0)) {
						for (var l_for_serverbrowserwarsaw_warsawscore_120_29_key in l_for_serverbrowserwarsaw_warsawscore_120_29_list) {
							if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_120_29_list[l_for_serverbrowserwarsaw_warsawscore_120_29_key])) {
								continue;
							}
							var l_i = l_for_serverbrowserwarsaw_warsawscore_120_29_list[l_for_serverbrowserwarsaw_warsawscore_120_29_key];
							c.push(" <span class=\"target");
							if (S.compat.lte(l_i, S.compat.sub(l_nTargets, l_teamScore))) {
								c.push(" destroyed");
							}
							c.push("\">");
							c.push(Surface.valOut($S.callFunction("battlereport.getSquadLetter", l_i, b, kwargs)));
							c.push("</span>\n");
						}
					}
					c.push(" </div>\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n </div>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.RUSH)) {
			l_att = 0;
			l_for_serverbrowserwarsaw_warsawscore_132_21_list = l_teams;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_132_21_list), 0)) {
				for (var l_t in l_for_serverbrowserwarsaw_warsawscore_132_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_132_21_list[l_t])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_132_21_list[l_t];
					if (S.compat.eq(S.Modifier.get(S.Modifier.get(l_team, "status", {}), "teamType"), "attackers")) {
						l_att = l_t;
					}
				}
			}
			l_attackers = S.Modifier.get(l_teams, l_att);
			l_defenders = S.Modifier.get(l_teams, S.compat.eq(l_att, 0) ? 1 : 0);
			l_progressOptions.percent = S.compat.mul(S.compat.div(l_attackers.status.tickets, l_attackers.status.ticketsMax), 100);
			c.push(" <div class=\"clearfix\">\n <p class=\"team-score pull-left\">");
			c.push(Surface.valOut(l_attackers.status.tickets));
			c.push("</p>\n <div class=\"pull-left\">");
			c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
			c.push("</div>\n <p class=\"team-score pull-right lspace\">");
			c.push(Surface.valOut(l_defenders.status.tickets));
			c.push("/");
			c.push(Surface.valOut(l_defenders.status.ticketsMax));
			c.push("</p>\n </div>\n <p class=\"team-name\">");
			c.push(Surface.valOut("攻撃側"));
			c.push("</p>\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.CAPTURETHEFLAG)) {
			l_for_serverbrowserwarsaw_warsawscore_149_21_list = l_teams;
			l_for_serverbrowserwarsaw_warsawscore_149_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_149_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawscore_149_21_key in l_for_serverbrowserwarsaw_warsawscore_149_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_149_21_list[l_for_serverbrowserwarsaw_warsawscore_149_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_149_21_list[l_for_serverbrowserwarsaw_warsawscore_149_21_key];
					l_for_serverbrowserwarsaw_warsawscore_149_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawscore_149_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_149_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_warsawscore_149_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_flags = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "flags", 0);
					l_maxFlags = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "flagsMax", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n </div>\n <p class=\"team-score lspace\">");
					c.push(Surface.valOut(l_flags));
					c.push("/");
					c.push(Surface.valOut(l_maxFlags));
					c.push("</p>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.Modifier.contains(o.gameModeCategories.carrier, l_gameMode)) {
			l_for_serverbrowserwarsaw_warsawscore_168_21_list = l_teams;
			l_for_serverbrowserwarsaw_warsawscore_168_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_168_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawscore_168_21_key in l_for_serverbrowserwarsaw_warsawscore_168_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_168_21_list[l_for_serverbrowserwarsaw_warsawscore_168_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_168_21_list[l_for_serverbrowserwarsaw_warsawscore_168_21_key];
					l_for_serverbrowserwarsaw_warsawscore_168_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawscore_168_21_iteration, 1);
					if (S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_168_21_iteration, 3)) {
						break;
					}
					c.push("\n");
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_warsawscore_168_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					l_carrierHealth = S.Modifier.get(l_team.status, "carrierHealth", 100);
					l_objectives = S.Modifier.get(l_team.status, "objectivesDestroyed", 0);
					l_progressOptions.type = S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_168_21_iteration, 1) ? "home" : "away";
					l_progressOptions.reverse = l_isEven ? false : true;
					l_progressOptions.extraClass = l_progressOptions.type;
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <p class=\"team-score\">");
					c.push(Surface.valOut(l_carrierHealth));
					c.push("%</p>\n <div class=\"clearfix\">\n <p class=\"team-name ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n");
					l_progressOptions.percent = S.compat.mul(S.compat.div(l_carrierHealth, 100), 100);
					c.push(" <div class=\"pull-right\">");
					c.push(Surface.importTemplate(("ui" + ("." + "progressbar")), l_progressOptions, null, kwargs));
					c.push("</div>\n </div>\n <p class=\"objectives\">");
					c.push(Surface.valOut(l_objectives));
					c.push("/2</p>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.CHAINLINK)) {
			l_for_serverbrowserwarsaw_warsawscore_192_21_list = l_teams;
			l_for_serverbrowserwarsaw_warsawscore_192_21_iteration = 0;
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawscore_192_21_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawscore_192_21_key in l_for_serverbrowserwarsaw_warsawscore_192_21_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawscore_192_21_list[l_for_serverbrowserwarsaw_warsawscore_192_21_key])) {
						continue;
					}
					var l_team = l_for_serverbrowserwarsaw_warsawscore_192_21_list[l_for_serverbrowserwarsaw_warsawscore_192_21_key];
					l_for_serverbrowserwarsaw_warsawscore_192_21_iteration = S.compat.add(l_for_serverbrowserwarsaw_warsawscore_192_21_iteration, 1);
					c.push("\n");
					if (S.compat.eq(l_for_serverbrowserwarsaw_warsawscore_192_21_iteration, 3)) {
						break;
					}
					l_isEven = S.compat.eq(Surface.modulo(l_for_serverbrowserwarsaw_warsawscore_192_21_iteration, 2), 0) ? false : true;
					l_teamLocale = S.compat.add("ID_WEB_BATTLEREPORT_TEAM_", l_team.name);
					l_teamScore = S.Modifier.get(S.Modifier.get(l_team, "status", {}), "tickets", 0);
					l_pullClass = l_isEven ? "pull-left" : "pull-right";
					c.push("\n <div class=\"team ");
					c.push(Surface.valOut(l_pullClass));
					c.push("\">\n <div>\n <p class=\"team-name\">");
					c.push(Surface.valOut((S.translations[l_teamLocale] || l_teamLocale)));
					c.push("</p>\n </div>\n <div class=\"links\">\n <span></span>\n <div class=\"link-icon\">\n </div>\n </div>\n <div>\n <p class=\"team-score\">");
					c.push(Surface.valOut(l_teamScore));
					c.push("</p>\n </div>\n </div>\n ");
				}
			}
			c.push("\n");
		}
		else if (S.compat.eq(l_gameMode, o.gameServerMapModes.GUNMASTER)) {
			c.push(" <h2>Highest level</h2>\n <h1>");
			c.push(Surface.valOut(S.Modifier.get(S.Modifier.get(S.Modifier.get(l_teams, 0), "status", {}), "highestLevel", 0)));
			c.push("</h1>\n");
		}
		c.push(" <div class=\"round-time\">\n ");
		c.push(Surface.valOut(S.Modifier.timer(l_result.roundTime)));
		c.push("\n </div>\n </div>\n </div>\n");
	}
	else {
		c.push(" <div class=\"box\">\n <div class=\"box-content center-text\">\n ");
		c.push(Surface.importTemplate(("ui" + ("." + "loader")), {"size": "small"}, null, kwargs));
		c.push("\n </div>\n </div>\n");
	}
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.warsawscore", "surface_5_1", "selected-server-scoreboard", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_warsawserverinfo = new Surface.BlockConfig('', {});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('warsawserverinfo'));
serverbrowserwarsaw.warsawserverinfo.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawserverinfo');
	c.push("\n");
	c.push(serverbrowserwarsaw.warsawserverinfo.surface_2_2.render({"favGuids": ((typeof(o) != "undefined" && o !== null && typeof(o.favGuids) != "undefined" && o.favGuids !== null) ? o.favGuids : null), "friendsOnServer": ((typeof(o) != "undefined" && o !== null && typeof(o.friendsOnServer) != "undefined" && o.friendsOnServer !== null) ? o.friendsOnServer : null), "isHybridApp": ((typeof(o) != "undefined" && o !== null && typeof(o.isHybridApp) != "undefined" && o.isHybridApp !== null) ? o.isHybridApp : null), "isTouchDevice": ((typeof(o) != "undefined" && o !== null && typeof(o.isTouchDevice) != "undefined" && o.isTouchDevice !== null) ? o.isTouchDevice : null), "loading": ((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : null), "players": ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : null), "server": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null) ? o.server : null), "session": {"isLoggedIn": ((typeof(o) != "undefined" && o !== null && typeof(o.session) != "undefined" && o.session !== null && typeof(o.session.isLoggedIn) != "undefined" && o.session.isLoggedIn !== null) ? o.session.isLoggedIn : null)}}, b, kwargs));
	return c.join('');
}
;
serverbrowserwarsaw.warsawserverinfo.surface_2_2 = new Surface.SingleSurface("serverbrowserwarsaw.warsawserverinfo.surface_2_2");
serverbrowserwarsaw.warsawserverinfo.surface_2_2.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawserverinfo;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawserverinfo');
	c.push("<surf:container id=\"serverbrowser-show\"");
	c.push(">");
	var l_favGuids;
	var l_spectatorSlot;
	var l_soldierSlots;
	var l_canSpectate;
	var l_for_serverbrowserwarsaw_warsawserverinfo_37_26_list;
	var l_isFavorite;
	var l_commanderSlots;
	var l_session;
	var l_commanderSlot;
	var l_mapname;
	var l_hasOpenCommanderSlots;
	var l_canJoin;
	var l_activePersonaPlatformIsPS3;
	var l_mapImage;
	var l_platform;
	var l_mapinfo;
	o.players = o.players;
	o.isTouchDevice = Surface.globalContext.staticContext.detectedBrowser.isTouchDevice;
	o.isHybridApp = Surface.globalContext.staticContext.detectedBrowser.isHybridApp;
	c.push(" <div class=\"server-info\">\n");
	l_session = S.Modifier.get(Surface.globalContext, "session");
	l_favGuids = S.Modifier.get(Surface.globalContext, "favGuids");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.loading) != "undefined" && o.loading !== null) ? o.loading : false)) {
		c.push(" <div class=\"loading\"></div>\n");
	}
	else {
		if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null)) {
			l_isFavorite = S.Modifier.contains(l_favGuids, S.Modifier.get(o.server, "guid", ""));
			l_mapinfo = $S.callFunction("common.mapinfo", o.server.game, o.server.map, b, kwargs);
			l_mapname = l_mapinfo.name;
			l_platform = o.server.platform;
			c.push("\n");
			l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
			l_mapImage = $S.callFunction("base.asset", l_mapinfo.image335x160, b, kwargs);
			c.push(" <div class=\"quick-info\" style=\"background-image: url('");
			c.push(Surface.valOut(l_mapImage));
			c.push("')\">\n");
			if (o.server.online) {
				c.push(" <div class=\"holder\">\n <p class=\"player-count\">");
				c.push(Surface.valOut(l_soldierSlots.current));
				c.push(" / ");
				c.push(Surface.valOut(l_soldierSlots.max));
				c.push(" ");
				c.push(Surface.valOut("プレイヤー"));
				c.push("</p>\n <ul class=\"map-info\">\n");
				if ((((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.country) != "undefined" && o.server.country !== null) ? o.server.country : false) && S.compat.eq(o.server.platform, 1))) {
					c.push(" <li class=\"country-flag\">\n ");
					c.push(Surface.importTemplate(("common" + ("." + "countryflag")), {"countryCode": o.server.country}, null, kwargs));
					c.push("\n </li>\n");
				}
				c.push(" <li><span>");
				c.push(Surface.valOut(S.Modifier.capitalize((S.translations[l_mapname] || l_mapname))));
				c.push("</span></li>\n <li><span>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", o.server.mapMode, o.server.game, b, kwargs)));
				c.push("</span></li>\n </ul>\n");
				if ((S.compat.gt(S.Modifier.count(o.friendsOnServer), 0) && ((typeof(l_session) != "undefined" && l_session !== null && typeof(l_session.isLoggedIn) != "undefined" && l_session.isLoggedIn !== null) ? l_session.isLoggedIn : false))) {
					c.push(" <ul class=\"friends\">\n");
					l_for_serverbrowserwarsaw_warsawserverinfo_37_26_list = o.friendsOnServer;
					if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawserverinfo_37_26_list), 0)) {
						for (var l_for_serverbrowserwarsaw_warsawserverinfo_37_26_key in l_for_serverbrowserwarsaw_warsawserverinfo_37_26_list) {
							if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawserverinfo_37_26_list[l_for_serverbrowserwarsaw_warsawserverinfo_37_26_key])) {
								continue;
							}
							var l_friend = l_for_serverbrowserwarsaw_warsawserverinfo_37_26_list[l_for_serverbrowserwarsaw_warsawserverinfo_37_26_key];
							c.push(" <li>\n <a href=\"");
							c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/user/{username}/", Surface.urlContext, {"username": l_friend.username})));
							c.push("\" data-tooltip=\"");
							c.push(Surface.valOut(l_friend.username));
							c.push("\">\n ");
							c.push(Surface.importTemplate(("ui" + ("." + "avatar")), {"user": l_friend, "size": 22}, null, kwargs));
							c.push("\n </a>\n </li>\n");
						}
					}
					c.push(" </ul>\n");
				}
				c.push(" </div>\n");
			}
			c.push(" </div>\n");
			if (o.server.online) {
				l_canJoin = $S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs);
				l_canSpectate = $S.callFunction("serverguide.enableSpectateButton", o.server, b, kwargs);
				c.push(" <div class=\"action-buttons-container\">\n");
				if (l_canJoin) {
					c.push("\n <button class=\"btn btn-primary btn-large btn-block join arrow\"\n data-track=\"serverbrowser.selected.join\"\n data-bind-action=\"join-mp-gameserver\"\n data-role=\"");
					c.push(Surface.valOut(1));
					c.push("\"\n data-guid=\"");
					c.push(Surface.valOut(o.server.guid));
					c.push("\"\n data-game=\"");
					c.push(Surface.valOut(o.server.game));
					c.push("\"\n data-map-mode=\"");
					c.push(Surface.valOut(o.server.mapMode));
					c.push("\"\n data-platform=\"");
					c.push(Surface.valOut(o.server.platform));
					c.push("\"\n data-gameid=\"");
					c.push(Surface.valOut(o.server.gameId));
					c.push("\"\n data-ip=\"");
					c.push(Surface.valOut(o.server.ip));
					c.push("\"\n data-port=\"");
					c.push(Surface.valOut(o.server.port));
					c.push("\"\n data-telemetry-action=\"serverbrowser\">\n ");
					c.push(Surface.valOut("サーバーに参加"));
					c.push("\n </button>\n");
				}
				c.push(" <div class=\"hidden-server-data\"\n data-role=\"");
				c.push(Surface.valOut(1));
				c.push("\"\n data-guid=\"");
				c.push(Surface.valOut(o.server.guid));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(o.server.game));
				c.push("\"\n data-map-mode=\"");
				c.push(Surface.valOut(o.server.mapMode));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(o.server.platform));
				c.push("\"\n data-gameid=\"");
				c.push(Surface.valOut(o.server.gameId));
				c.push("\"\n data-ip=\"");
				c.push(Surface.valOut(o.server.ip));
				c.push("\"\n data-port=\"");
				c.push(Surface.valOut(o.server.port));
				c.push("\">\n </div>\n");
				if (o.isHybridApp) {
					l_activePersonaPlatformIsPS3 = S.compat.eq(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : 0), 4);
					if ((!(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.warsawCommanderDisablePS3Join) != "undefined" && Surface.globalContext.staticContext.warsawCommanderDisablePS3Join !== null) ? Surface.globalContext.staticContext.warsawCommanderDisablePS3Join : false)) || !(l_activePersonaPlatformIsPS3))) {
						if ($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs)) {
							l_commanderSlots = $S.callFunction("serverguide.getServerSlots", o.server, 4, b, kwargs);
							l_hasOpenCommanderSlots = S.compat.lt(l_commanderSlots.current, l_commanderSlots.max);
							c.push(" <button class=\"btn btn-primary btn-large btn-block join arrow\"\n ");
							if (!(l_hasOpenCommanderSlots)) {
								c.push("disabled");
							}
							c.push("\n data-track=\"serverbrowser.selected.hybridapp.commander.join\"\n data-bind-action=\"join-tablet-commander\"\n data-role=\"");
							c.push(Surface.valOut(2));
							c.push("\"\n data-guid=\"");
							c.push(Surface.valOut(o.server.guid));
							c.push("\"\n data-game=\"");
							c.push(Surface.valOut(o.server.game));
							c.push("\"\n data-platform=\"");
							c.push(Surface.valOut(o.server.platform));
							c.push("\"\n data-protocolversionstring=\"");
							c.push(Surface.valOut(o.server.protocolVersionString));
							c.push("\">\n ");
							c.push(Surface.valOut("司令官"));
							c.push("\n </button>\n");
						}
					}
				}
				else if ((S.compat.eq(l_platform, 1) && !(o.isTouchDevice))) {
					if ($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs)) {
						c.push(" <button class=\"btn btn-small btn-block join arrow ");
						if (!(l_canJoin)) {
							c.push("disabled");
						}
						c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.selected.commander.join\"\n data-role=\"");
						c.push(Surface.valOut(2));
						c.push("\"\n data-guid=\"");
						c.push(Surface.valOut(o.server.guid));
						c.push("\"\n data-game=\"");
						c.push(Surface.valOut(o.server.game));
						c.push("\"\n data-platform=\"");
						c.push(Surface.valOut(o.server.platform));
						c.push("\">\n ");
						c.push(Surface.valOut("司令官"));
						c.push("\n </button>\n");
					}
					c.push("\n");
					if ($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs)) {
						c.push(" <button class=\"btn btn-small btn-block spectator-join join arrow ");
						if (!(l_canSpectate)) {
							c.push("disabled");
						}
						c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.selected.spectator.join\"\n data-role=\"");
						c.push(Surface.valOut(4));
						c.push("\"\n data-guid=\"");
						c.push(Surface.valOut(o.server.guid));
						c.push("\"\n data-game=\"");
						c.push(Surface.valOut(o.server.game));
						c.push("\"\n data-platform=\"");
						c.push(Surface.valOut(o.server.platform));
						c.push("\">\n ");
						c.push(Surface.valOut("観戦者"));
						c.push("\n </button>\n");
					}
				}
				c.push("\n");
				if ((o.isTouchDevice && S.compat.eq(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.activePersona) != "undefined" && Surface.globalContext.staticContext.activePersona !== null && typeof(Surface.globalContext.staticContext.activePersona.platform) != "undefined" && Surface.globalContext.staticContext.activePersona.platform !== null) ? Surface.globalContext.staticContext.activePersona.platform : 0), 1))) {
					c.push(" <button class=\"btn btn-small btn-block favorite-toggle");
					if (l_isFavorite) {
						c.push(" starred");
					}
					c.push("\"\n data-guid=\"");
					c.push(Surface.valOut(o.server.guid));
					c.push("\"\n data-bind-toggle=\"favorite\"\n data-type=\"server\">\n <span class=\"add-text\">");
					c.push(Surface.valOut("お気に入りに追加"));
					c.push("</span>\n <span class=\"remove-text\">");
					c.push(Surface.valOut("お気に入り"));
					c.push("</span>\n </button>\n");
				}
				c.push(" </div>\n");
				if ($S.callFunction("serverguide.liveScoreboardEnabled", o.server.game, o.server.platform, b, kwargs)) {
					c.push(" ");
					c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "warsawscore")), o, null, kwargs));
					c.push("\n");
				}
				c.push("\n <div class=\"box details-container\">\n <div class=\"box-content\">\n <ul class=\"settings\">\n <li>");
				c.push(Surface.valOut("プリセット"));
				c.push("<b>");
				c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", o.server.preset, b, kwargs)));
				c.push("</b></li>\n");
				if ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.serverType) != "undefined" && o.server.serverType !== null)) {
					c.push(" <li>");
					c.push(Surface.valOut("タイプ"));
					c.push("<b><span class=\"icon icon-servertype icon-servertype-");
					c.push(Surface.valOut(o.server.serverType));
					c.push("\"></span> ");
					c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerServerTypeString", o.server.serverType, b, kwargs)));
					c.push("</b></li>\n");
				}
				if (S.compat.neq(o.server.experience, "0")) {
					c.push(" <li>");
					c.push(Surface.valOut("ゲームクラス"));
					c.push("<b>");
					c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerExperienceString", o.server.game, o.server.experience, b, kwargs)));
					c.push("</b></li>\n");
				}
				c.push(" <li>");
				c.push(Surface.valOut("チックレート"));
				c.push("<b>");
				c.push(Surface.valOut(o.server.tickRate));
				c.push(" Hz</b></li>\n <li>");
				c.push(Surface.valOut("Punkbuster"));
				c.push("<b>");
				if (o.server.punkbuster) {
					c.push("<span class=\"icon icon-punkbuster\"></span> ");
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push("<span class=\"icon icon-punkbuster disabled\"></span> ");
					c.push(Surface.valOut("オフ"));
				}
				c.push("</b></li>\n <li>");
				c.push(Surface.valOut("FairFight"));
				c.push("<b>");
				if (o.server.fairfight) {
					c.push("<span class=\"icon icon-fairfight\"></span> ");
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push("<span class=\"icon icon-fairfight disabled\"></span> ");
					c.push(Surface.valOut("オフ"));
				}
				c.push("</b></li>\n <li>");
				c.push(Surface.valOut("パスワード"));
				c.push("<b>");
				if (o.server.hasPassword) {
					c.push(Surface.valOut("オン"));
				}
				else {
					c.push(Surface.valOut("オフ"));
				}
				c.push("</b></li>\n");
				if ($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs)) {
					l_spectatorSlot = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 8, b, kwargs);
					if (l_spectatorSlot) {
						c.push(" <li>");
						c.push(Surface.valOut("観戦者"));
						c.push("<b>");
						c.push(Surface.valOut(l_spectatorSlot));
						c.push("</b></li>\n");
					}
				}
				c.push("\n");
				if ($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs)) {
					l_commanderSlot = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 4, b, kwargs);
					if (l_commanderSlot) {
						c.push(" <li>");
						c.push(Surface.valOut("司令官"));
						c.push("<b>");
						c.push(Surface.valOut(l_commanderSlot));
						c.push("</b></li>\n");
					}
				}
				c.push(" </ul>\n </div>\n <footer>\n <a href=\"");
				c.push(Surface.valOut(S.Modifier.urlformat("/{_section}/{_language}/servers/show/{platform}/{guid}/{slug}/", Surface.urlContext, {"guid": o.server.guid, "platform": S.Modifier.lower($S.callFunction("base.platform", o.server.platform, b, kwargs)), "slug": S.Modifier.slugify(o.server.name)})));
				c.push("\">\n ");
				c.push(Surface.valOut("サーバーページを表示"));
				c.push("\n </a>\n </footer>\n </div>\n");
			}
			else {
				c.push(" <div class=\"box\">\n <div class=\"box-content\">\n <h1 id=\"serverinfo-serveroffline\">");
				c.push(Surface.valOut("サーバーはオフラインです"));
				c.push("</h1>\n </div>\n </div>\n");
			}
			c.push(" ");
		}
		c.push("\n");
	}
	c.push(" </div>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.warsawserverinfo", "surface_2_2", "serverbrowser-show", o, b);
	return c.join('');
}
;
;var block_serverbrowserwarsaw_warsawshow = new Surface.BlockConfig('serverbrowserwarsaw.show', {'mapRotation': 'serverbrowserwarsaw.warsawshow.block_mapRotation', 'joinButtons': 'serverbrowserwarsaw.warsawshow.block_joinButtons', 'settings': 'serverbrowserwarsaw.warsawshow.block_settings', 'shortInfo': 'serverbrowserwarsaw.warsawshow.block_shortInfo', 'scoreBoard': 'serverbrowserwarsaw.warsawshow.block_scoreBoard'});
Surface.initComponent('serverbrowserwarsaw');
serverbrowserwarsaw.addTemplate(new Surface.Template('warsawshow'));
serverbrowserwarsaw.warsawshow.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawshow');
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	c.push("\n");
	return Surface.importTemplate('serverbrowserwarsaw.show', o, b, kwargs);
}
;
serverbrowserwarsaw.warsawshow.surface_73_21 = new Surface.SingleSurface("serverbrowserwarsaw.warsawshow.surface_73_21");
serverbrowserwarsaw.warsawshow.surface_73_21.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawshow');
	c.push("<surf:container id=\"serverbrowser-show-info-ping\"");
	c.push(">");
	c.push(" <h5>");
	c.push(Surface.importTemplate(("ui" + ("." + "pingbar")), {"ping": o.server.ping, "size": "large"}, null, kwargs));
	c.push(Surface.valOut("ms"));
	c.push("</h5>\n");
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.warsawshow", "surface_73_21", "serverbrowser-show-info-ping", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.warsawshow.block_shortInfo = new Surface.Block('serverbrowserwarsaw.warsawshow.block_shortInfo');
serverbrowserwarsaw.warsawshow.block_shortInfo.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_soldierSlots;
	var l_commanderSlots;
	var l_spectatorSlots;
	var l_queueSlots;
	c.push(" <div id=\"server-page-info\">\n <div class=\"row-tight\">\n <div class=\"box span1\">\n <header>\n <h1>");
	c.push(Surface.valOut("プレイヤー"));
	c.push("</h1>\n </header>\n </div>\n <div class=\"box span1\">\n <header>\n <h1>");
	c.push(Surface.valOut("PING"));
	c.push("</h1>\n </header>\n </div>\n <div class=\"box span1\">\n <header>\n <h1>");
	c.push(Surface.valOut("プリセット"));
	c.push("</h1>\n </header>\n </div>\n <div class=\"box span1\">\n <header>\n <h1>");
	c.push(Surface.valOut("タイプ"));
	c.push("</h1>\n </header>\n </div>\n <div class=\"box span1\">\n <header>\n <h1>");
	c.push(Surface.valOut("チックレート"));
	c.push("</h1>\n </header>\n </div>\n <div class=\"box span1\">\n <header>\n <h1>");
	c.push(Surface.valOut("ゲームクラス"));
	c.push("</h1>\n </header>\n </div>\n </div>\n <div class=\"row-tight\">\n <div class=\"box span1\">\n <section class=\"box-content\">\n <h5>\n");
	l_soldierSlots = $S.callFunction("serverguide.getServerSlots", o.server, 2, b, kwargs);
	l_queueSlots = $S.callFunction("serverguide.getServerSlots", o.server, 1, b, kwargs);
	c.push("\n");
	c.push(Surface.valOut(l_soldierSlots.current));
	c.push(" / ");
	c.push(Surface.valOut(l_soldierSlots.max));
	c.push("\n");
	if (((typeof(l_queueSlots) != "undefined" && l_queueSlots !== null) && S.compat.gt(l_queueSlots.current, 0))) {
		c.push(" [<abbr title=\"");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push(" ");
		c.push(Surface.valOut("人待ち"));
		c.push("\">");
		c.push(Surface.valOut(l_queueSlots.current));
		c.push("</abbr>]\n");
	}
	c.push(" </h5>\n <div id=\"server-page-slot-info\" class=\"row-tight\">\n");
	if ($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs)) {
		l_spectatorSlots = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 8, b, kwargs);
		c.push(" <dl>\n <dt>");
		c.push(Surface.valOut("観戦者"));
		c.push("</dt>\n <dd>");
		c.push(Surface.valOut(l_spectatorSlots));
		c.push("</dd>\n </dl>\n");
	}
	if ($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs)) {
		l_commanderSlots = $S.callFunction("serverbrowserwarsaw.getServerSlotInfo", o.server, 4, b, kwargs);
		c.push(" <dl>\n <dt>");
		c.push(Surface.valOut("司令官"));
		c.push("</dt>\n <dd>");
		c.push(Surface.valOut(l_commanderSlots));
		c.push("</dd>\n </dl>\n");
	}
	c.push(" </div>\n </section>\n </div>\n <div class=\"box span1\">\n <section class=\"box-content\">\n");
	c.push(serverbrowserwarsaw.warsawshow.surface_73_21.render({"server": {"ping": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.ping) != "undefined" && o.server.ping !== null) ? o.server.ping : null)}}, b, kwargs));
	c.push(" </section>\n </div>\n <div class=\"box span1\">\n <section class=\"box-content\">\n <h5>");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerPresetStringLocalized", ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.preset) != "undefined" && o.server.preset !== null) ? o.server.preset : 0), b, kwargs)));
	c.push("</h5>\n </section>\n </div>\n <div class=\"box span1\">\n <section class=\"box-content\">\n <h5><span class=\"icon-servertype-large icon-servertype-large-");
	c.push(Surface.valOut(o.server.serverType));
	c.push("\"></span> ");
	c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerServerTypeString", o.server.serverType, b, kwargs)));
	c.push("</h5>\n </section>\n </div>\n <div class=\"box span1\">\n <section class=\"box-content\">\n <h5>");
	c.push(Surface.valOut(o.server.tickRate));
	c.push(" Hz</h5>\n </section>\n </div>\n <div class=\"box span1\">\n <section class=\"box-content\">\n <h5>");
	if (S.compat.neq(o.server.experience, "0")) {
		c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerExperienceString", o.server.game, o.server.experience, b, kwargs)));
	}
	else {
		c.push(" - ");
	}
	c.push("</h5>\n </section>\n </div>\n </div>\n </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.warsawshow.block_joinButtons = new Surface.Block('serverbrowserwarsaw.warsawshow.block_joinButtons');
serverbrowserwarsaw.warsawshow.block_joinButtons.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_activePersonaPlatformIsPS3;
	var l_commanderSlots;
	var l_hasOpenCommanderSlots;
	c.push("\n <div id=\"server-page-join-buttons\" class=\"box box-content spacing-top-tight\"\n data-guid=\"");
	c.push(Surface.valOut(o.server.guid));
	c.push("\"\n data-gameid=\"");
	c.push(Surface.valOut(o.server.gameId));
	c.push("\"\n data-ip=\"");
	c.push(Surface.valOut(o.server.ip));
	c.push("\"\n data-port=\"");
	c.push(Surface.valOut(o.server.port));
	c.push("\"\n data-game=\"");
	c.push(Surface.valOut(o.server.game));
	c.push("\"\n data-platform=\"");
	c.push(Surface.valOut(o.server.platform));
	c.push("\">\n");
	if (($S.callFunction("serverguide.showJoinButton", o.server, b, kwargs) && $S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs))) {
		c.push(" <button class=\"btn btn-primary btn-large large arrow\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.server.join\"\n data-role=\"");
		c.push(Surface.valOut(1));
		c.push("\"\n data-telemetry-action=\"serverbrowser\">\n ");
		c.push(Surface.valOut("サーバーに参加"));
		c.push("\n </button>\n");
	}
	c.push("\n");
	if (Surface.globalContext.staticContext.detectedBrowser.isHybridApp) {
		l_activePersonaPlatformIsPS3 = S.compat.eq(Surface.globalContext.staticContext.activePersona.platform, 4);
		if ((!(((typeof(Surface) != "undefined" && Surface !== null && typeof(Surface.globalContext) != "undefined" && Surface.globalContext !== null && typeof(Surface.globalContext.staticContext) != "undefined" && Surface.globalContext.staticContext !== null && typeof(Surface.globalContext.staticContext.warsawCommanderDisablePS3Join) != "undefined" && Surface.globalContext.staticContext.warsawCommanderDisablePS3Join !== null) ? Surface.globalContext.staticContext.warsawCommanderDisablePS3Join : false)) || !(l_activePersonaPlatformIsPS3))) {
			if (($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs) && $S.callFunction("serverguide.showJoinButton", o.server, b, kwargs))) {
				l_commanderSlots = $S.callFunction("serverguide.getServerSlots", o.server, 4, b, kwargs);
				l_hasOpenCommanderSlots = S.compat.lt(l_commanderSlots.current, l_commanderSlots.max);
				c.push(" <button class=\"btn btn-large large arrow\"\n ");
				if (!(l_hasOpenCommanderSlots)) {
					c.push("disabled");
				}
				c.push("\n data-bind-action=\"join-tablet-commander\"\n data-track=\"serverbrowser.server.hybridapp.commander.join\"\n data-role=\"");
				c.push(Surface.valOut(2));
				c.push("\"\n data-guid=\"");
				c.push(Surface.valOut(o.server.guid));
				c.push("\"\n data-game=\"");
				c.push(Surface.valOut(o.server.game));
				c.push("\"\n data-platform=\"");
				c.push(Surface.valOut(o.server.platform));
				c.push("\"\n data-protocolversionstring=\"");
				c.push(Surface.valOut(o.server.protocolVersionString));
				c.push("\">\n ");
				c.push(Surface.valOut("司令官"));
				c.push("\n </button>\n");
			}
		}
	}
	else if ((S.compat.eq(o.server.platform, 1) && !(Surface.globalContext.staticContext.detectedBrowser.isTouchDevice))) {
		if ((($S.callFunction("serverguide.hasServerSlotType", o.server, 4, b, kwargs) && $S.callFunction("serverguide.showJoinButton", o.server, b, kwargs)) && $S.callFunction("serverguide.enableJoinButton", o.server, b, kwargs))) {
			c.push(" <button class=\"btn btn-large large arrow\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.server.commander.join\"\n data-role=\"");
			c.push(Surface.valOut(2));
			c.push("\">\n ");
			c.push(Surface.valOut("司令官"));
			c.push("\n </button>\n");
		}
		c.push("\n");
		if ((($S.callFunction("serverguide.hasServerSlotType", o.server, 8, b, kwargs) && $S.callFunction("serverguide.showJoinButton", o.server, b, kwargs)) && $S.callFunction("serverguide.enableSpectateButton", o.server, b, kwargs))) {
			c.push(" <button class=\"btn btn-large large arrow\n ");
			if (!($S.callFunction("serverguide.enableSpectateButton", o.server, b, kwargs))) {
				c.push(" disabled");
			}
			c.push("\"\n data-bind-action=\"join-mp-gameserver\"\n data-track=\"serverbrowser.server.spectator.join\"\n data-role=\"");
			c.push(Surface.valOut(4));
			c.push("\">\n ");
			c.push(Surface.valOut("観戦者"));
			c.push("\n </button>\n");
		}
	}
	c.push(" </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.warsawshow.block_mapRotation = new Surface.Block('serverbrowserwarsaw.warsawshow.block_mapRotation');
serverbrowserwarsaw.warsawshow.block_mapRotation.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	var l_mapName;
	var l_mapsOnServer;
	var l_mapClass;
	var l_mapInfo;
	var l_for_serverbrowserwarsaw_warsawshow_180_25_list;
	c.push(" <div id=\"server-page-map-rotation\" class=\"box spacing-top\">\n <header>\n <h1>");
	c.push(Surface.valOut("マップローテーション"));
	c.push("</h1>\n </header>\n <div class=\"scroll-area\">\n <table class=\"table\">\n <tbody>\n <tr>\n");
	l_mapsOnServer = S.Modifier.get(o.server.maps, "maps", []);
	l_for_serverbrowserwarsaw_warsawshow_180_25_list = l_mapsOnServer;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawshow_180_25_list), 0)) {
		for (var l_i in l_for_serverbrowserwarsaw_warsawshow_180_25_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawshow_180_25_list[l_i])) {
				continue;
			}
			var l_mapRotation = l_for_serverbrowserwarsaw_warsawshow_180_25_list[l_i];
			l_mapInfo = $S.callFunction("common.mapinfo", o.server.game, l_mapRotation.map, b, kwargs);
			l_mapName = S.Modifier.get(l_mapInfo, "name");
			l_mapName = (S.translations[l_mapName] || l_mapName);
			if (S.compat.gt(((typeof(l_mapRotation) != "undefined" && l_mapRotation !== null && typeof(l_mapRotation.mapVariant) != "undefined" && l_mapRotation.mapVariant !== null) ? l_mapRotation.mapVariant : 0), 0)) {
				l_mapName = S.Modifier.concat(S.Modifier.concat(l_mapName, " #"), S.compat.add(l_mapRotation.mapVariant, 1));
			}
			l_mapClass = "";
			if (S.compat.eq(l_i, o.server.maps.currentMapIndex)) {
				l_mapClass = "active";
			}
			else if (S.compat.eq(l_i, o.server.maps.nextMapIndex)) {
				l_mapClass = "next";
			}
			c.push("\n <td class=\"");
			c.push(Surface.valOut(l_mapClass));
			c.push("\">\n <span class=\"map-image\" style=\"background-image: url('");
			c.push(Surface.valOut($S.callFunction("base.asset", S.Modifier.get(l_mapInfo, "imageBigWide"), b, kwargs)));
			c.push("')\"></span>\n <p>\n");
			if (S.compat.neq(l_mapInfo.gameExpansion, 0)) {
				c.push(" ");
				c.push(Surface.importTemplate(("common" + ("." + "warsawxpicon")), {"xp": $S.callFunction("common.getXpackFromGameExpansion", l_mapInfo.gameExpansion, b, kwargs)}, null, kwargs));
				c.push("\n");
			}
			c.push(" <strong>");
			c.push(Surface.valOut(S.Modifier.capitalize(l_mapName)));
			c.push("</strong><br>\n <span>\n ");
			c.push(Surface.valOut($S.callFunction("serverbrowserwarsaw.gameServerModeStringLocalized", l_mapRotation.mapMode, o.server.game, b, kwargs)));
			c.push("\n </span>\n </p>\n");
			if (((S.compat.eq(l_mapClass, "active") && (typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.maps) != "undefined" && o.server.maps !== null && typeof(o.server.maps.numberMapRounds) != "undefined" && o.server.maps.numberMapRounds !== null)) && S.compat.gt(o.server.maps.numberMapRounds, 1))) {
				c.push(" <div class=\"round-status\">");
				c.push(Surface.valOut("ラウンド"));
				c.push(": ");
				c.push(Surface.valOut(S.compat.add(o.server.maps.currentMapRound, 1)));
				c.push(" / ");
				c.push(Surface.valOut(o.server.maps.numberMapRounds));
				c.push("</div>\n");
			}
			c.push(" </td>\n");
		}
	}
	else {
		c.push(" <td class=\"no-maps-rotation\">");
		c.push(Surface.valOut("マップローテーションにマップがありません"));
		c.push("</td>\n");
	}
	c.push(" <td class=\"empty\"></td>\n </tr>\n </tbody>\n </table>\n </div>\n </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.warsawshow.block_settings = new Surface.Block('serverbrowserwarsaw.warsawshow.block_settings');
serverbrowserwarsaw.warsawshow.block_settings.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push(" <div id=\"server-page-details\" class=\"box spacing-top\">\n <header>\n <h1>");
	c.push(Surface.valOut("サーバーの詳細"));
	c.push("</h1>\n </header>\n");
	if (((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.extendedInfo) != "undefined" && o.server.extendedInfo !== null && typeof(o.server.extendedInfo.desc) != "undefined" && o.server.extendedInfo.desc !== null) ? o.server.extendedInfo.desc : "")) {
		c.push(" <div id=\"server-description\" class=\"box spacing-top-tight\">\n <div class=\"box-content\">\n <p>");
		c.push(S.Modifier.nl2br(((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.extendedInfo) != "undefined" && o.server.extendedInfo !== null && typeof(o.server.extendedInfo.desc) != "undefined" && o.server.extendedInfo.desc !== null) ? o.server.extendedInfo.desc : "")));
		c.push("</p>\n </div>\n </div>\n");
	}
	c.push("\n");
	c.push(Surface.importTemplate(("serverbrowserwarsaw" + ("." + "serversettings")), o, null, kwargs));
	c.push("\n </div>\n");
	return c.join("");
}
;
serverbrowserwarsaw.function_formatForTemplate = function(l_data, l_playersContext, b, kwargs) {
	var o = {};
	var c = [];
	var l_pDict;
	var l_for_serverbrowserwarsaw_warsawshow_282_13_list;
	var l_for_serverbrowserwarsaw_warsawshow_243_9_list;
	var l_team;
	var l_gameModeCategories;
	var l_tpl;
	var l_for_serverbrowserwarsaw_warsawshow_254_9_list;
	var l_p;
	l_pDict = {};
	l_for_serverbrowserwarsaw_warsawshow_243_9_list = l_playersContext;
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawshow_243_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_warsawshow_243_9_key in l_for_serverbrowserwarsaw_warsawshow_243_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawshow_243_9_list[l_for_serverbrowserwarsaw_warsawshow_243_9_key])) {
				continue;
			}
			var l_p = l_for_serverbrowserwarsaw_warsawshow_243_9_list[l_for_serverbrowserwarsaw_warsawshow_243_9_key];
			c.push(Surface.valOut(S.Modifier.set(l_pDict, l_p.personaId, l_p)));
		}
	}
	l_tpl = {};
	l_tpl.gameId = S.Modifier.get(l_data, "gameId");
	l_tpl.gameMode = S.Modifier.get(l_data, "gameMode");
	l_tpl.type = "live";
	l_for_serverbrowserwarsaw_warsawshow_254_9_list = S.Modifier.get(l_data, "teams", []);
	if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawshow_254_9_list), 0)) {
		for (var l_for_serverbrowserwarsaw_warsawshow_254_9_key in l_for_serverbrowserwarsaw_warsawshow_254_9_list) {
			if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawshow_254_9_list[l_for_serverbrowserwarsaw_warsawshow_254_9_key])) {
				continue;
			}
			var l_t = l_for_serverbrowserwarsaw_warsawshow_254_9_list[l_for_serverbrowserwarsaw_warsawshow_254_9_key];
			l_team = {};
			l_team.id = l_t.status.teamId;
			if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.faction) != "undefined" && l_t.status.faction !== null)) {
				l_team.name = $S.callFunction("battlereport.getTeamFromFaction", l_t.status.faction, b, kwargs);
			}
			else if ((typeof(l_t) != "undefined" && l_t !== null && typeof(l_t.status) != "undefined" && l_t.status !== null && typeof(l_t.status.teamType) != "undefined" && l_t.status.teamType !== null)) {
				l_team.name = l_t.status.teamType;
			}
			else {
				l_team.name = $S.callFunction("battlereport.getTeamFromFaction", S.compat.sub(l_t.status.teamId, 1), b, kwargs);
			}
			l_gameModeCategories = $S.callFunction("battlereport.getGameModeCategories", b, kwargs);
			if (S.Modifier.contains(l_gameModeCategories.flag, l_data.gameMode)) {
				l_team.score = l_t.status.flags;
				l_team.scoreMax = l_t.status.flagsMax;
			}
			else if (S.Modifier.contains(l_gameModeCategories.carrier, l_data.gameMode)) {
				l_team.carrierHealth = l_t.status.carrierHealth;
				l_team.objectivesDestroyed = l_t.status.objectivesDestroyed;
			}
			else {
				l_team.score = l_t.status.tickets;
				l_team.scoreMax = l_t.status.ticketsMax;
			}
			l_tpl.players = ((typeof(l_tpl) != "undefined" && l_tpl !== null && typeof(l_tpl.players) != "undefined" && l_tpl.players !== null) ? l_tpl.players : {});
			l_team.players = [];
			l_team.commanders = [];
			l_for_serverbrowserwarsaw_warsawshow_282_13_list = S.Modifier.get(l_t, "players", []);
			if (S.compat.gt(S.Modifier.count(l_for_serverbrowserwarsaw_warsawshow_282_13_list), 0)) {
				for (var l_for_serverbrowserwarsaw_warsawshow_282_13_key in l_for_serverbrowserwarsaw_warsawshow_282_13_list) {
					if (!Surface.isValidLoopItem(l_for_serverbrowserwarsaw_warsawshow_282_13_list[l_for_serverbrowserwarsaw_warsawshow_282_13_key])) {
						continue;
					}
					var l_p = l_for_serverbrowserwarsaw_warsawshow_282_13_list[l_for_serverbrowserwarsaw_warsawshow_282_13_key];
					l_p = S.Modifier.set(l_p, "team", l_team.id);
					if (S.Modifier.get(l_pDict, l_p.personaId)) {
						l_p = S.Modifier.set(l_p, "persona", S.Modifier.get(S.Modifier.get(l_pDict, l_p.personaId), "persona"));
						l_p = S.Modifier.set(l_p, "user", S.Modifier.get(S.Modifier.get(S.Modifier.get(l_pDict, l_p.personaId), "persona", {}), "user"));
					}
					if (S.compat.eq(S.Modifier.get(l_p, "role", 1), 2)) {
						l_team.commanders = S.Modifier.append(l_team.commanders, l_p.personaId);
						l_p = S.Modifier.set(l_p, "commanderScore", S.Modifier.get(l_p, "score", 0));
					}
					else {
						l_team.players = S.Modifier.append(l_team.players, l_p.personaId);
						l_p = S.Modifier.set(l_p, "combatScore", S.Modifier.get(l_p, "score", 0));
					}
					l_tpl.players = S.Modifier.set(l_tpl.players, l_p.personaId, l_p);
				}
			}
			l_tpl.teams = ((typeof(l_tpl) != "undefined" && l_tpl !== null && typeof(l_tpl.teams) != "undefined" && l_tpl.teams !== null) ? l_tpl.teams : {});
			l_tpl.teams = S.Modifier.set(l_tpl.teams, l_team.id, l_team);
		}
	}
	return l_tpl;
}
;
serverbrowserwarsaw.warsawshow.surface_306_9 = new Surface.SingleSurface("serverbrowserwarsaw.warsawshow.surface_306_9");
serverbrowserwarsaw.warsawshow.surface_306_9.render = function(o, b, kwargs) {
	var c = [];
	b = b || block_serverbrowserwarsaw_warsawshow;
	kwargs = kwargs || {};
	Surface.Renderer.addUsedComponent('serverbrowserwarsaw');
	Surface.Renderer.addUsedTemplate('serverbrowserwarsaw.warsawshow');
	c.push("<surf:container id=\"serverbrowser-scoreboard\"");
	c.push(">");
	var l_mapName;
	var l_gameModeCategories;
	var l_gameModeLocale;
	var l_maxTickets;
	var l_mapInfo;
	var l_templateData;
	var l_result;
	if ($S.callFunction("serverguide.liveScoreboardEnabled", o.server.game, o.server.platform, b, kwargs)) {
		if (((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) && S.compat.eq(S.Modifier.get(o.scoreboard, "status"), "OK"))) {
			c.push(" <div id=\"live-header\" class=\"box\">\n <header class=\"clearfix\">\n <h1 class=\"pull-left\">");
			c.push(Surface.valOut("ライブスコアボード"));
			c.push("</h1>\n <div class=\"switch-container pull-right clearfix\">\n <div class=\"switch pull-left\">\n <input type=\"checkbox\" id=\"serverbrowser-edit-livescoreboard\" name=\"serverbrowser-edit-livescoreboard\" value=\"0\"");
			if (o.liveupdating) {
				c.push(" checked");
			}
			c.push("/>\n <div class=\"handle\"></div>\n </div>\n </div>\n </header>\n <div class=\"box-content center-text uppercase\">\n");
			l_result = S.Modifier.get(o.scoreboard, "result", {});
			l_mapInfo = $S.callFunction("common.mapinfo", o.server.game, l_result.mapName, b, kwargs);
			l_mapName = S.Modifier.get(l_mapInfo, "name");
			l_gameModeLocale = $S.callFunction("gamedata.localizedGameMode", o.server.game, l_result.gameMode, b, kwargs);
			l_gameModeCategories = $S.callFunction("battlereport.getGameModeCategories", b, kwargs);
			if ((S.Modifier.contains(l_gameModeCategories.ticket, l_result.gameMode) || S.Modifier.contains(l_gameModeCategories.kill, l_result.gameMode))) {
				l_maxTickets = S.Modifier.get(S.Modifier.get(S.Modifier.get(S.Modifier.get(l_result, "teams", []), 0), "status", {}), "ticketsMax", 0);
			}
			c.push(" ");
			c.push(Surface.valOut((S.translations[l_mapName] || l_mapName)));
			c.push(" - ");
			c.push(Surface.valOut((S.translations[l_gameModeLocale] || l_gameModeLocale)));
			if (S.compat.gt(((typeof(l_maxTickets) != "undefined" && l_maxTickets !== null) ? l_maxTickets : 0), 0)) {
				c.push(": ");
				c.push(Surface.valOut(l_maxTickets));
			}
			c.push(" - ");
			c.push(Surface.valOut("ラウンド時間"));
			c.push(": ");
			c.push(Surface.valOut(S.Modifier.timer(l_result.roundTime)));
			c.push("\n </div>\n </div>\n");
			l_templateData = $S.callFunction("serverbrowserwarsaw.formatForTemplate", S.Modifier.get(o.scoreboard, "result"), o.players, b, kwargs);
			c.push(" ");
			c.push(Surface.importTemplate(("battlereport" + ("." + "warsawscoreboard")), l_templateData, null, kwargs));
			c.push("\n");
		}
		else if (S.compat.eq(S.Modifier.get(o.scoreboard, "status"), "ROUND_NOT_STARTED")) {
			c.push(" <div class=\"box\">\n <div class=\"box-content uppercase center-text\">\n ");
			c.push(Surface.valOut("ラウンドはまだ開始していません"));
			c.push("\n </div>\n </div>\n");
		}
		else if (o.showplayers) {
			c.push(" <div class=\"box\">\n <div class=\"box-content uppercase center-text\">\n ");
			c.push(Surface.valOut("サーバー上のプレイヤー情報を取得できませんでした"));
			c.push("\n </div>\n </div>\n");
		}
		else {
			c.push(" <div class=\"box\">\n <div class=\"box-content center-text uppercase\">\n ");
			c.push(Surface.importTemplate(("ui" + ("." + "loader")), o, null, kwargs));
			c.push("\n </div>\n </div>\n");
		}
	}
	c.push("</surf:container>");
	Surface.Renderer.addSurfaceState("serverbrowserwarsaw.warsawshow", "surface_306_9", "serverbrowser-scoreboard", o, b);
	return c.join('');
}
;
serverbrowserwarsaw.warsawshow.block_scoreBoard = new Surface.Block('serverbrowserwarsaw.warsawshow.block_scoreBoard');
serverbrowserwarsaw.warsawshow.block_scoreBoard.render = function(o, b, kwargs) {
	var c = [];
	kwargs = kwargs || {};
	c.push("\n");
	c.push(" <div id=\"server-players-list\" data-livescore=\"false\">\n");
	c.push(serverbrowserwarsaw.warsawshow.surface_306_9.render({"liveupdating": ((typeof(o) != "undefined" && o !== null && typeof(o.liveupdating) != "undefined" && o.liveupdating !== null) ? o.liveupdating : null), "players": ((typeof(o) != "undefined" && o !== null && typeof(o.players) != "undefined" && o.players !== null) ? o.players : null), "scoreboard": ((typeof(o) != "undefined" && o !== null && typeof(o.scoreboard) != "undefined" && o.scoreboard !== null) ? o.scoreboard : null), "server": {"game": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.game) != "undefined" && o.server.game !== null) ? o.server.game : null), "platform": ((typeof(o) != "undefined" && o !== null && typeof(o.server) != "undefined" && o.server !== null && typeof(o.server.platform) != "undefined" && o.server.platform !== null) ? o.server.platform : null)}, "showplayers": ((typeof(o) != "undefined" && o !== null && typeof(o.showplayers) != "undefined" && o.showplayers !== null) ? o.showplayers : null)}, b, kwargs));
	c.push(" </div>\n");
	return c.join("");
}
;
;